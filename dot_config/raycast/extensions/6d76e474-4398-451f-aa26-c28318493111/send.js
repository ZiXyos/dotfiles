var Md=Object.create;var hr=Object.defineProperty,Ld=Object.defineProperties,kd=Object.getOwnPropertyDescriptor,Id=Object.getOwnPropertyDescriptors,jd=Object.getOwnPropertyNames,pn=Object.getOwnPropertySymbols,Bd=Object.getPrototypeOf,As=Object.prototype.hasOwnProperty,Ga=Object.prototype.propertyIsEnumerable;var Ka=(n,e,t)=>e in n?hr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,p=(n,e)=>{for(var t in e||(e={}))As.call(e,t)&&Ka(n,t,e[t]);if(pn)for(var t of pn(e))Ga.call(e,t)&&Ka(n,t,e[t]);return n},B=(n,e)=>Ld(n,Id(e)),Xa=n=>hr(n,"__esModule",{value:!0});var W=(n,e)=>{var t={};for(var s in n)As.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&pn)for(var s of pn(n))e.indexOf(s)<0&&Ga.call(n,s)&&(t[s]=n[s]);return t};var y=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Fd=(n,e)=>{for(var t in e)hr(n,t,{get:e[t],enumerable:!0})},Ja=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of jd(e))!As.call(n,a)&&(t||a!=="default")&&hr(n,a,{get:()=>e[a],enumerable:!(s=kd(e,a))||s.enumerable});return n},Ee=(n,e)=>Ja(Xa(hr(n!=null?Md(Bd(n)):{},"default",!e&&n&&n.__esModule?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n),xd=(n=>(e,t)=>n&&n.get(e)||(t=Ja(Xa({}),e,1),n&&n.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var Te=y(le=>{"use strict";Object.defineProperty(le,"__esModule",{value:!0});le.API_V1_1_STREAM_PREFIX=le.API_V1_1_UPLOAD_PREFIX=le.API_V1_1_PREFIX=le.API_V2_LABS_PREFIX=le.API_V2_PREFIX=void 0;le.API_V2_PREFIX="https://api.twitter.com/2/";le.API_V2_LABS_PREFIX="https://api.twitter.com/labs/2/";le.API_V1_1_PREFIX="https://api.twitter.com/1.1/";le.API_V1_1_UPLOAD_PREFIX="https://upload.twitter.com/1.1/";le.API_V1_1_STREAM_PREFIX="https://stream.twitter.com/1.1/"});var jt=y(bt=>{"use strict";Object.defineProperty(bt,"__esModule",{value:!0});bt.PreviousableTwitterPaginator=bt.TwitterPaginator=void 0;var _n=class{constructor({realData:e,rateLimit:t,instance:s,queryParams:a,sharedParams:u}){this._maxResultsWhenFetchLast=100,this._realData=e,this._rateLimit=t,this._instance=s,this._queryParams=a,this._sharedParams=u}get _isRateLimitOk(){return this._rateLimit.reset*1e3<Date.now()?!0:this._rateLimit.remaining>0}makeRequest(e){return this._instance.get(this.getEndpoint(),e,{fullResponse:!0,params:this._sharedParams})}makeNewInstanceFromResult(e,t){return new this.constructor({realData:e.data,rateLimit:e.rateLimit,instance:this._instance,queryParams:t,sharedParams:this._sharedParams})}getEndpoint(){return this._endpoint}injectQueryParams(e){return p(p({},e?{max_results:e}:{}),this._queryParams)}async next(e){let t=this.getNextQueryParams(e),s=await this.makeRequest(t);return this.makeNewInstanceFromResult(s,t)}async fetchNext(e){let t=this.getNextQueryParams(e),s=await this.makeRequest(t);return await this.refreshInstanceFromResult(s,!0),this}async fetchLast(e=1/0){let t=this.getNextQueryParams(this._maxResultsWhenFetchLast),s=0;for(;s<e&&this._isRateLimitOk;){let a=await this.makeRequest(t);if(await this.refreshInstanceFromResult(a,!0),s+=this.getPageLengthFromRequest(a),this.isFetchLastOver(a))break;t=this.getNextQueryParams(this._maxResultsWhenFetchLast)}return this}get rateLimit(){return p({},this._rateLimit)}get data(){return this._realData}get done(){return!this.canFetchNextPage(this._realData)}*[Symbol.iterator](){yield*this.getItemArray()}async*[Symbol.asyncIterator](){yield*this.getItemArray();let e=this,t=this.canFetchNextPage(this._realData);for(;t&&this._isRateLimitOk&&e.getItemArray().length>0;){let s=await e.next(this._maxResultsWhenFetchLast);this.refreshInstanceFromResult({data:s._realData,headers:{},rateLimit:s._rateLimit},!0),t=this.canFetchNextPage(s._realData),yield*s.getItemArray(),e=s}}async*fetchAndIterate(){for(let s of this.getItemArray())yield[s,this];let e=this,t=this.canFetchNextPage(this._realData);for(;t&&this._isRateLimitOk&&e.getItemArray().length>0;){let s=await e.next(this._maxResultsWhenFetchLast);this.refreshInstanceFromResult({data:s._realData,headers:{},rateLimit:s._rateLimit},!0),t=this.canFetchNextPage(s._realData);for(let a of s.getItemArray())yield[a,s];this._rateLimit=s._rateLimit,e=s}}};bt.TwitterPaginator=_n;var to=class extends _n{async previous(e){let t=this.getPreviousQueryParams(e),s=await this.makeRequest(t);return this.makeNewInstanceFromResult(s,t)}async fetchPrevious(e){let t=this.getPreviousQueryParams(e),s=await this.makeRequest(t);return await this.refreshInstanceFromResult(s,!1),this}};bt.PreviousableTwitterPaginator=to;bt.default=_n});var mr=y(Bt=>{"use strict";var Ud=Bt&&Bt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Bt,"__esModule",{value:!0});Bt.CursoredV1Paginator=void 0;var Wd=Ud(jt()),ro=class extends Wd.default{getNextQueryParams(e){var t;return p(B(p({},this._queryParams),{cursor:(t=this._realData.next_cursor_str)!==null&&t!==void 0?t:this._realData.next_cursor}),e?{count:e}:{})}isFetchLastOver(e){return!this.canFetchNextPage(e.data)}canFetchNextPage(e){return!this.isNextCursorInvalid(e.next_cursor)||!this.isNextCursorInvalid(e.next_cursor_str)}isNextCursorInvalid(e){return e===void 0||e===0||e===-1||e==="0"||e==="-1"}};Bt.CursoredV1Paginator=ro});var Ds=y(Ft=>{"use strict";Object.defineProperty(Ft,"__esModule",{value:!0});Ft.WelcomeDmV1Paginator=Ft.DmEventsV1Paginator=void 0;var no=mr(),so=class extends no.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="direct_messages/events/list.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.events.push(...s.events),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.events.length}getItemArray(){return this.events}get events(){return this._realData.events}};Ft.DmEventsV1Paginator=so;var io=class extends no.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="direct_messages/welcome_messages/list.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.welcome_messages.push(...s.welcome_messages),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.welcome_messages.length}getItemArray(){return this.welcomeMessages}get welcomeMessages(){return this._realData.welcome_messages}};Ft.WelcomeDmV1Paginator=io});var oo=y(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0})});var uo=y(pr=>{"use strict";Object.defineProperty(pr,"__esModule",{value:!0});pr.EUploadMimeType=void 0;var zd;(function(n){n.Jpeg="image/jpeg",n.Mp4="video/mp4",n.Gif="image/gif",n.Png="image/png",n.Srt="text/plain",n.Webp="image/webp"})(zd=pr.EUploadMimeType||(pr.EUploadMimeType={}))});var co=y(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0})});var ho=y(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0})});var po=y(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0})});var go=y(_o=>{"use strict";Object.defineProperty(_o,"__esModule",{value:!0})});var yo=y(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0})});var wo=y(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.EDirectMessageEventTypeV1=void 0;var Nd;(function(n){n.Create="message_create",n.WelcomeCreate="welcome_message"})(Nd=_r.EDirectMessageEventTypeV1||(_r.EDirectMessageEventTypeV1={}))});var To=y(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0})});var vo=y(Y=>{"use strict";var Vd=Y&&Y.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),Ne=Y&&Y.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Vd(e,n,t)};Object.defineProperty(Y,"__esModule",{value:!0});Ne(oo(),Y);Ne(uo(),Y);Ne(co(),Y);Ne(ho(),Y);Ne(po(),Y);Ne(go(),Y);Ne(yo(),Y);Ne(wo(),Y);Ne(To(),Y)});var Po=y(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0})});var Ao=y(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0})});var Co=y(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0})});var Eo=y(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0})});var Lo=y(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0})});var Io=y(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0})});var jo=y(ce=>{"use strict";var $d=ce&&ce.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),xt=ce&&ce.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&$d(e,n,t)};Object.defineProperty(ce,"__esModule",{value:!0});xt(Po(),ce);xt(Ao(),ce);xt(Co(),ce);xt(Eo(),ce);xt(Lo(),ce);xt(Io(),ce)});var Uo=y(H=>{"use strict";Object.defineProperty(H,"__esModule",{value:!0});H.EApiV2ErrorCode=H.EApiV1ErrorCode=H.ApiResponseError=H.ApiPartialResponseError=H.ApiRequestError=H.ETwitterApiError=void 0;var gn;(function(n){n.Request="request",n.PartialResponse="partial-response",n.Response="response"})(gn=H.ETwitterApiError||(H.ETwitterApiError={}));var bn=class extends Error{constructor(){super(...arguments);this.error=!0}},Bo=class extends bn{constructor(e,t){super(e);this.type=gn.Request,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t})}get request(){return this._options.request}get requestError(){return this._options.requestError}toJSON(){return{type:this.type,error:this.requestError}}};H.ApiRequestError=Bo;var Fo=class extends bn{constructor(e,t){super(e);this.type=gn.PartialResponse,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t})}get request(){return this._options.request}get response(){return this._options.response}get responseError(){return this._options.responseError}get rawContent(){return this._options.rawContent}toJSON(){return{type:this.type,error:this.responseError}}};H.ApiPartialResponseError=Fo;var xo=class extends bn{constructor(e,t){super(e);this.type=gn.Response,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t}),this.code=t.code,this.headers=t.headers,this.rateLimit=t.rateLimit,this.data=t.data}get request(){return this._options.request}get response(){return this._options.response}hasErrorCode(...e){let t=this.errors;if(!(t==null?void 0:t.length))return!1;if("code"in t[0])return t.some(u=>e.includes(u.code));let s=this.data;return e.includes(s.type)}get errors(){var e;return(e=this.data)===null||e===void 0?void 0:e.errors}get rateLimitError(){return this.code===420||this.code===429}get isAuthError(){return this.code===401?!0:this.hasErrorCode(gr.AuthTimestampInvalid,gr.AuthenticationFail,gr.BadAuthenticationData,gr.InvalidOrExpiredToken)}toJSON(){return{type:this.type,code:this.code,error:this.data,rateLimit:this.rateLimit,headers:this.headers}}};H.ApiResponseError=xo;var gr;(function(n){n[n.InvalidCoordinates=3]="InvalidCoordinates",n[n.NoLocationFound=13]="NoLocationFound",n[n.AuthenticationFail=32]="AuthenticationFail",n[n.InvalidOrExpiredToken=89]="InvalidOrExpiredToken",n[n.UnableToVerifyCredentials=99]="UnableToVerifyCredentials",n[n.AuthTimestampInvalid=135]="AuthTimestampInvalid",n[n.BadAuthenticationData=215]="BadAuthenticationData",n[n.NoUserMatch=17]="NoUserMatch",n[n.UserNotFound=50]="UserNotFound",n[n.ResourceNotFound=34]="ResourceNotFound",n[n.TweetNotFound=144]="TweetNotFound",n[n.TweetNotVisible=179]="TweetNotVisible",n[n.NotAllowedResource=220]="NotAllowedResource",n[n.MediaIdNotFound=325]="MediaIdNotFound",n[n.TweetNoLongerAvailable=421]="TweetNoLongerAvailable",n[n.TweetViolatedRules=422]="TweetViolatedRules",n[n.TargetUserSuspended=63]="TargetUserSuspended",n[n.YouAreSuspended=64]="YouAreSuspended",n[n.AccountUpdateFailed=120]="AccountUpdateFailed",n[n.NoSelfSpamReport=36]="NoSelfSpamReport",n[n.NoSelfMute=271]="NoSelfMute",n[n.AccountLocked=326]="AccountLocked",n[n.RateLimitExceeded=88]="RateLimitExceeded",n[n.NoDMRightForApp=93]="NoDMRightForApp",n[n.OverCapacity=130]="OverCapacity",n[n.InternalError=131]="InternalError",n[n.TooManyFollowings=161]="TooManyFollowings",n[n.TweetLimitExceeded=185]="TweetLimitExceeded",n[n.DuplicatedTweet=187]="DuplicatedTweet",n[n.TooManySpamReports=205]="TooManySpamReports",n[n.RequestLooksLikeSpam=226]="RequestLooksLikeSpam",n[n.NoWriteRightForApp=261]="NoWriteRightForApp",n[n.TweetActionsDisabled=425]="TweetActionsDisabled",n[n.TweetRepliesRestricted=433]="TweetRepliesRestricted",n[n.NamedParameterMissing=38]="NamedParameterMissing",n[n.InvalidAttachmentUrl=44]="InvalidAttachmentUrl",n[n.TweetTextTooLong=186]="TweetTextTooLong",n[n.MissingUrlParameter=195]="MissingUrlParameter",n[n.NoMultipleGifs=323]="NoMultipleGifs",n[n.InvalidMediaIds=324]="InvalidMediaIds",n[n.InvalidUrl=407]="InvalidUrl",n[n.TooManyTweetAttachments=386]="TooManyTweetAttachments",n[n.StatusAlreadyFavorited=139]="StatusAlreadyFavorited",n[n.FollowRequestAlreadySent=160]="FollowRequestAlreadySent",n[n.CannotUnmuteANonMutedAccount=272]="CannotUnmuteANonMutedAccount",n[n.TweetAlreadyRetweeted=327]="TweetAlreadyRetweeted",n[n.ReplyToDeletedTweet=385]="ReplyToDeletedTweet",n[n.DMReceiverNotFollowingYou=150]="DMReceiverNotFollowingYou",n[n.UnableToSendDM=151]="UnableToSendDM",n[n.MustAllowDMFromAnyone=214]="MustAllowDMFromAnyone",n[n.CannotSendDMToThisUser=349]="CannotSendDMToThisUser",n[n.DMTextTooLong=354]="DMTextTooLong",n[n.SubscriptionAlreadyExists=355]="SubscriptionAlreadyExists",n[n.CallbackUrlNotApproved=415]="CallbackUrlNotApproved",n[n.SuspendedApplication=416]="SuspendedApplication",n[n.OobOauthIsNotAllowed=417]="OobOauthIsNotAllowed"})(gr=H.EApiV1ErrorCode||(H.EApiV1ErrorCode={}));var Hd;(function(n){n.InvalidRequest="https://api.twitter.com/2/problems/invalid-request",n.ClientForbidden="https://api.twitter.com/2/problems/client-forbidden",n.UnsupportedAuthentication="https://api.twitter.com/2/problems/unsupported-authentication",n.InvalidRules="https://api.twitter.com/2/problems/invalid-rules",n.TooManyRules="https://api.twitter.com/2/problems/rule-cap",n.DuplicatedRules="https://api.twitter.com/2/problems/duplicate-rules",n.RateLimitExceeded="https://api.twitter.com/2/problems/usage-capped",n.ConnectionError="https://api.twitter.com/2/problems/streaming-connection",n.ClientDisconnected="https://api.twitter.com/2/problems/client-disconnected",n.TwitterDisconnectedYou="https://api.twitter.com/2/problems/operational-disconnect",n.ResourceNotFound="https://api.twitter.com/2/problems/resource-not-found",n.ResourceUnauthorized="https://api.twitter.com/2/problems/not-authorized-for-resource",n.DisallowedResource="https://api.twitter.com/2/problems/disallowed-resource"})(Hd=H.EApiV2ErrorCode||(H.EApiV2ErrorCode={}))});var zo=y(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0})});var No=y(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.ETwitterStreamEvent=void 0;var Qd;(function(n){n.Connected="connected",n.ConnectError="connect error",n.ConnectionError="connection error",n.ConnectionClosed="connection closed",n.ConnectionLost="connection lost",n.ReconnectAttempt="reconnect attempt",n.Reconnected="reconnected",n.ReconnectError="reconnect error",n.ReconnectLimitExceeded="reconnect limit exceeded",n.DataKeepAlive="data keep-alive",n.Data="data event content",n.DataError="data twitter error",n.TweetParseError="data tweet parse error",n.Error="stream error"})(Qd=br.ETwitterStreamEvent||(br.ETwitterStreamEvent={}))});var $o=y(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0})});var Qo=y(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.TwitterApiPluginResponseOverride=void 0;var Ho=class{constructor(e){this.value=e}};yn.TwitterApiPluginResponseOverride=Ho});var Yo=y(yt=>{"use strict";var Yd=yt&&yt.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),Kd=yt&&yt.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Yd(e,n,t)};Object.defineProperty(yt,"__esModule",{value:!0});Kd(Qo(),yt)});var Me=y(te=>{"use strict";var Gd=te&&te.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),wt=te&&te.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Gd(e,n,t)};Object.defineProperty(te,"__esModule",{value:!0});wt(vo(),te);wt(jo(),te);wt(Uo(),te);wt(zo(),te);wt(No(),te);wt($o(),te);wt(Yo(),te)});var Sn=y(wn=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.TwitterApiV2Settings=void 0;wn.TwitterApiV2Settings={debug:!1,deprecationWarnings:!0,logger:{log:console.log.bind(console)}}});var Es=y(re=>{"use strict";var Xd=re&&re.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),Jd=re&&re.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Zd=re&&re.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Xd(e,n,t);return Jd(e,n),e},ef=re&&re.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(re,"__esModule",{value:!0});re.RequestHandlerHelper=void 0;var tf=require("https"),J=Sn(),rf=ef(Tn()),Cs=Me(),Ve=Zd(require("zlib")),Os=class{constructor(e){this.requestData=e,this.requestErrorHandled=!1,this.responseData=[]}get hrefPathname(){let e=this.requestData.url;return e.hostname+e.pathname}isCompressionDisabled(){return!this.requestData.compression||this.requestData.compression==="identity"}isFormEncodedEndpoint(){return this.requestData.url.href.startsWith("https://api.twitter.com/oauth/")}createRequestError(e){return J.TwitterApiV2Settings.debug&&J.TwitterApiV2Settings.logger.log("Request error:",e),new Cs.ApiRequestError("Request failed.",{request:this.req,error:e})}createPartialResponseError(e,t){let a=`Request failed with partial response with HTTP code ${this.res.statusCode}`;return t?a+=" (connection abruptly closed)":a+=" (parse error)",new Cs.ApiPartialResponseError(a,{request:this.req,response:this.res,responseError:e,rawContent:Buffer.concat(this.responseData).toString()})}formatV1Errors(e){return e.map(({code:t,message:s})=>`${s} (Twitter code ${t})`).join(", ")}formatV2Error(e){return`${e.title}: ${e.detail} (see ${e.type})`}createResponseError({res:e,data:t,rateLimit:s,code:a}){var u;J.TwitterApiV2Settings.debug&&(J.TwitterApiV2Settings.logger.log(`Request failed with code ${a}, data:`,t),J.TwitterApiV2Settings.logger.log("Response headers:",e.headers));let f=`Request failed with code ${a}`;if((u=t==null?void 0:t.errors)===null||u===void 0?void 0:u.length){let c=t.errors;"code"in c[0]?f+=" - "+this.formatV1Errors(c):f+=" - "+this.formatV2Error(t)}return new Cs.ApiResponseError(f,{code:a,data:t,headers:e.headers,request:this.req,response:e,rateLimit:s})}getResponseDataStream(e){if(this.isCompressionDisabled())return e;let t=(e.headers["content-encoding"]||"identity").trim().toLowerCase();if(t==="br"){let s=Ve.createBrotliDecompress({flush:Ve.constants.BROTLI_OPERATION_FLUSH,finishFlush:Ve.constants.BROTLI_OPERATION_FLUSH});return e.pipe(s),s}if(t==="gzip"){let s=Ve.createGunzip({flush:Ve.constants.Z_SYNC_FLUSH,finishFlush:Ve.constants.Z_SYNC_FLUSH});return e.pipe(s),s}if(t==="deflate"){let s=Ve.createInflate({flush:Ve.constants.Z_SYNC_FLUSH,finishFlush:Ve.constants.Z_SYNC_FLUSH});return e.pipe(s),s}return e}detectResponseType(e){var t,s;return((t=e.headers["content-type"])===null||t===void 0?void 0:t.includes("application/json"))||((s=e.headers["content-type"])===null||s===void 0?void 0:s.includes("application/problem+json"))?"json":this.isFormEncodedEndpoint()?"url":"text"}getParsedResponse(e){let t=this.responseData,s=this.requestData.forceParseMode||this.detectResponseType(e);if(s==="buffer")return Buffer.concat(t);if(s==="text")return Buffer.concat(t).toString();if(s==="json"){let a=Buffer.concat(t).toString();return a.length?JSON.parse(a):void 0}else if(s==="url"){let a=Buffer.concat(t).toString(),u={};for(let[f,c]of new URLSearchParams(a))u[f]=c;return u}else return}getRateLimitFromResponse(e){let t;return e.headers["x-rate-limit-limit"]&&(t={limit:Number(e.headers["x-rate-limit-limit"]),remaining:Number(e.headers["x-rate-limit-remaining"]),reset:Number(e.headers["x-rate-limit-reset"])},this.requestData.rateLimitSaver&&this.requestData.rateLimitSaver(t)),t}onSocketEventHandler(e,t){t.on("close",this.onSocketCloseHandler.bind(this,e))}onSocketCloseHandler(e){if(this.req.removeAllListeners("timeout"),!this.res&&!this.requestErrorHandled)return e(this.createRequestError(new Error("Socket closed without any information.")))}requestErrorHandler(e,t){var s,a;(a=(s=this.requestData).requestEventDebugHandler)===null||a===void 0||a.call(s,"request-error",{requestError:t}),this.requestErrorHandled=!0,e(this.createRequestError(t))}timeoutErrorHandler(){this.requestErrorHandled=!0,this.req.destroy(new Error("Request timeout."))}classicResponseHandler(e,t,s){this.res=s;let a=this.getResponseDataStream(s);a.on("data",u=>this.responseData.push(u)),a.on("end",this.onResponseEndHandler.bind(this,e,t)),a.on("close",this.onResponseCloseHandler.bind(this,e,t)),this.requestData.requestEventDebugHandler&&(this.requestData.requestEventDebugHandler("response",{res:s}),s.on("aborted",u=>this.requestData.requestEventDebugHandler("response-aborted",{error:u})),s.on("error",u=>this.requestData.requestEventDebugHandler("response-error",{error:u})),s.on("close",()=>this.requestData.requestEventDebugHandler("response-close",{data:this.responseData})),s.on("end",()=>this.requestData.requestEventDebugHandler("response-end")))}onResponseEndHandler(e,t){let s=this.getRateLimitFromResponse(this.res),a;try{a=this.getParsedResponse(this.res)}catch(f){t(this.createPartialResponseError(f,!1));return}let u=this.res.statusCode;if(u>=400){t(this.createResponseError({data:a,res:this.res,rateLimit:s,code:u}));return}J.TwitterApiV2Settings.debug&&(J.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${this.res.statusCode}`),J.TwitterApiV2Settings.logger.log("Response body:",a)),e({data:a,headers:this.res.headers,rateLimit:s})}onResponseCloseHandler(e,t){let s=this.res;if(s.aborted)try{return this.getParsedResponse(this.res),this.onResponseEndHandler(e,t)}catch(a){return t(this.createPartialResponseError(a,!0))}if(!s.complete)return t(this.createPartialResponseError(new Error("Response has been interrupted before response could be parsed."),!0))}streamResponseHandler(e,t,s){if(s.statusCode<400){J.TwitterApiV2Settings.debug&&J.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${s.statusCode} (starting stream)`);let u=this.getResponseDataStream(s);e({req:this.req,res:u,originalResponse:s,requestData:this.requestData})}else this.classicResponseHandler(()=>{},t,s)}debugRequest(){let e=this.requestData.url;J.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]`,this.requestData.options),e.search&&J.TwitterApiV2Settings.logger.log("Request parameters:",[...e.searchParams.entries()].map(([t,s])=>`${t}: ${s}`)),this.requestData.body&&J.TwitterApiV2Settings.logger.log("Request body:",this.requestData.body)}buildRequest(){var e;let t=this.requestData.url,s=t.username?`${t.username}:${t.password}`:void 0,a=(e=this.requestData.options.headers)!==null&&e!==void 0?e:{};this.requestData.compression===!0||this.requestData.compression==="brotli"?a["accept-encoding"]="br;q=1.0, gzip;q=0.8, deflate;q=0.5, *;q=0.1":this.requestData.compression==="gzip"?a["accept-encoding"]="gzip;q=1, deflate;q=0.5, *;q=0.1":this.requestData.compression==="deflate"&&(a["accept-encoding"]="deflate;q=1, *;q=0.1"),J.TwitterApiV2Settings.debug&&this.debugRequest(),this.req=(0,tf.request)(B(p({},this.requestData.options),{host:t.hostname,port:t.port||void 0,path:t.pathname+t.search,protocol:t.protocol,auth:s,headers:a}))}registerRequestEventDebugHandlers(e){e.on("close",()=>this.requestData.requestEventDebugHandler("close")),e.on("abort",()=>this.requestData.requestEventDebugHandler("abort")),e.on("socket",t=>{this.requestData.requestEventDebugHandler("socket",{socket:t}),t.on("error",s=>this.requestData.requestEventDebugHandler("socket-error",{socket:t,error:s})),t.on("connect",()=>this.requestData.requestEventDebugHandler("socket-connect",{socket:t})),t.on("close",s=>this.requestData.requestEventDebugHandler("socket-close",{socket:t,withError:s})),t.on("end",()=>this.requestData.requestEventDebugHandler("socket-end",{socket:t})),t.on("lookup",(...s)=>this.requestData.requestEventDebugHandler("socket-lookup",{socket:t,data:s})),t.on("timeout",()=>this.requestData.requestEventDebugHandler("socket-timeout",{socket:t}))})}makeRequest(){return this.buildRequest(),new Promise((e,t)=>{let s=this.req;s.on("error",this.requestErrorHandler.bind(this,t)),s.on("socket",this.onSocketEventHandler.bind(this,t)),s.on("response",this.classicResponseHandler.bind(this,e,t)),this.requestData.options.timeout&&s.on("timeout",this.timeoutErrorHandler.bind(this)),this.requestData.requestEventDebugHandler&&this.registerRequestEventDebugHandlers(s),this.requestData.body&&s.write(this.requestData.body),s.end()})}async makeRequestAsStream(){let{req:e,res:t,requestData:s,originalResponse:a}=await this.makeRequestAndResolveWhenReady();return new rf.default(s,{req:e,res:t,originalResponse:a})}makeRequestAndResolveWhenReady(){return this.buildRequest(),new Promise((e,t)=>{let s=this.req;s.on("error",this.requestErrorHandler.bind(this,t)),s.on("response",this.streamResponseHandler.bind(this,e,t)),this.requestData.body&&s.write(this.requestData.body),s.end()})}};re.RequestHandlerHelper=Os;re.default=Os});var Ko=y(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.TweetStreamEventCombiner=void 0;var nf=require("events"),it=Me(),Ms=class extends nf.EventEmitter{constructor(e){super();this.stream=e,this.stack=[],this.onStreamData=this.onStreamData.bind(this),this.onStreamError=this.onStreamError.bind(this),this.onceNewEvent=this.once.bind(this,"event"),e.on(it.ETwitterStreamEvent.Data,this.onStreamData),e.on(it.ETwitterStreamEvent.ConnectionError,this.onStreamError),e.on(it.ETwitterStreamEvent.TweetParseError,this.onStreamError),e.on(it.ETwitterStreamEvent.ConnectionClosed,this.onStreamError)}nextEvent(){return new Promise(this.onceNewEvent)}hasStack(){return this.stack.length>0}popStack(){let e=this.stack;return this.stack=[],e}destroy(){this.removeAllListeners(),this.stream.off(it.ETwitterStreamEvent.Data,this.onStreamData),this.stream.off(it.ETwitterStreamEvent.ConnectionError,this.onStreamError),this.stream.off(it.ETwitterStreamEvent.TweetParseError,this.onStreamError),this.stream.off(it.ETwitterStreamEvent.ConnectionClosed,this.onStreamError)}emitEvent(e,t){this.emit("event",{type:e,payload:t})}onStreamError(e){this.emitEvent("error",e)}onStreamData(e){this.stack.push(e),this.emitEvent("data",e)}};yr.TweetStreamEventCombiner=Ms;yr.default=Ms});var Xo=y(Ut=>{"use strict";Object.defineProperty(Ut,"__esModule",{value:!0});Ut.EStreamParserEvent=void 0;var sf=require("events"),Go=class extends sf.EventEmitter{constructor(){super(...arguments);this.currentMessage=""}push(e){this.currentMessage+=e,e=this.currentMessage;let t=e.length,s=0,a=0;for(;a<t;){if(e.slice(a,a+2)===`\r
`){let u=e.slice(s,a);if(s=a+=2,!u.length)continue;try{let f=JSON.parse(u);if(f){this.emit(Ls.ParsedData,f);continue}}catch(f){this.emit(Ls.ParseError,f)}}a++}this.currentMessage=e.slice(s,t)}reset(){this.currentMessage=""}};Ut.default=Go;var Ls;(function(n){n.ParsedData="parsed data",n.ParseError="parse error"})(Ls=Ut.EStreamParserEvent||(Ut.EStreamParserEvent={}))});var Tn=y(ne=>{"use strict";var af=ne&&ne.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),of=ne&&ne.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),uf=ne&&ne.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&af(e,n,t);return of(e,n),e},eu=ne&&ne.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ne,"__esModule",{value:!0});ne.TweetStream=void 0;var lf=require("events"),Jo=eu(Es()),M=Me(),cf=eu(Ko()),ks=uf(Xo()),Zo=[5,15,30,60,90,120,180,300,600,900],df=n=>n>Zo.length?901e3:Zo[n-1]*1e3,Is=class extends lf.EventEmitter{constructor(e,t){super();this.requestData=e,this.autoReconnect=!1,this.autoReconnectRetries=5,this.keepAliveTimeoutMs=1e3*120,this.nextRetryTimeout=df,this.parser=new ks.default,this.connectionProcessRunning=!1,this.onKeepAliveTimeout=this.onKeepAliveTimeout.bind(this),this.initEventsFromParser(),t&&(this.req=t.req,this.res=t.res,this.originalResponse=t.originalResponse,this.initEventsFromRequest())}on(e,t){return super.on(e,t)}initEventsFromRequest(){if(!this.req||!this.res)throw new Error("TweetStream error: You cannot init TweetStream without a request and response object.");let e=t=>{this.emit(M.ETwitterStreamEvent.ConnectionError,t),this.emit(M.ETwitterStreamEvent.Error,{type:M.ETwitterStreamEvent.ConnectionError,error:t,message:"Connection lost or closed by Twitter."}),this.onConnectionError()};this.req.on("error",e),this.res.on("error",e),this.res.on("close",()=>e(new Error("Connection closed by Twitter."))),this.res.on("data",t=>{if(this.resetKeepAliveTimeout(),t.toString()===`\r
`)return this.emit(M.ETwitterStreamEvent.DataKeepAlive);this.parser.push(t.toString())}),this.resetKeepAliveTimeout()}initEventsFromParser(){let e=this.requestData.payloadIsError;this.parser.on(ks.EStreamParserEvent.ParsedData,t=>{e&&e(t)?(this.emit(M.ETwitterStreamEvent.DataError,t),this.emit(M.ETwitterStreamEvent.Error,{type:M.ETwitterStreamEvent.DataError,error:t,message:"Twitter sent a payload that is detected as an error payload."})):this.emit(M.ETwitterStreamEvent.Data,t)}),this.parser.on(ks.EStreamParserEvent.ParseError,t=>{this.emit(M.ETwitterStreamEvent.TweetParseError,t),this.emit(M.ETwitterStreamEvent.Error,{type:M.ETwitterStreamEvent.TweetParseError,error:t,message:"Failed to parse stream data."})})}resetKeepAliveTimeout(){this.unbindKeepAliveTimeout(),this.keepAliveTimeoutMs!==1/0&&(this.keepAliveTimeout=setTimeout(this.onKeepAliveTimeout,this.keepAliveTimeoutMs))}onKeepAliveTimeout(){this.emit(M.ETwitterStreamEvent.ConnectionLost),this.onConnectionError()}unbindTimeouts(){this.unbindRetryTimeout(),this.unbindKeepAliveTimeout()}unbindKeepAliveTimeout(){this.keepAliveTimeout&&(clearTimeout(this.keepAliveTimeout),this.keepAliveTimeout=void 0)}unbindRetryTimeout(){this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}closeWithoutEmit(){this.unbindTimeouts(),this.res&&(this.res.removeAllListeners(),this.res.destroy()),this.req&&(this.req.removeAllListeners(),this.req.destroy())}close(){this.emit(M.ETwitterStreamEvent.ConnectionClosed),this.closeWithoutEmit()}destroy(){this.removeAllListeners(),this.close()}async clone(){let t=await new Jo.default(this.requestData).makeRequestAsStream(),s=this.eventNames();for(let a of s){let u=this.listeners(a);for(let f of u)t.on(a,f)}return t}async connect(e={}){typeof e.autoReconnect<"u"&&(this.autoReconnect=e.autoReconnect),typeof e.autoReconnectRetries<"u"&&(this.autoReconnectRetries=e.autoReconnectRetries==="unlimited"?1/0:e.autoReconnectRetries),typeof e.keepAliveTimeout<"u"&&(this.keepAliveTimeoutMs=e.keepAliveTimeout==="disable"?1/0:e.keepAliveTimeout),typeof e.nextRetryTimeout<"u"&&(this.nextRetryTimeout=e.nextRetryTimeout),this.unbindTimeouts();try{await this.reconnect()}catch(t){if(this.emit(M.ETwitterStreamEvent.ConnectError,0),this.emit(M.ETwitterStreamEvent.Error,{type:M.ETwitterStreamEvent.ConnectError,error:t,message:"Connect error - Initial connection just failed."}),this.autoReconnect)this.makeAutoReconnectRetry(0,t);else throw t}return this}async reconnect(){if(this.connectionProcessRunning)throw new Error("Connection process is already running.");this.connectionProcessRunning=!0;try{let e=!0;this.req&&(e=!1,this.closeWithoutEmit());let{req:t,res:s,originalResponse:a}=await new Jo.default(this.requestData).makeRequestAndResolveWhenReady();this.req=t,this.res=s,this.originalResponse=a,this.emit(e?M.ETwitterStreamEvent.Connected:M.ETwitterStreamEvent.Reconnected),this.parser.reset(),this.initEventsFromRequest()}finally{this.connectionProcessRunning=!1}}async onConnectionError(e=0){if(this.unbindTimeouts(),this.closeWithoutEmit(),!this.autoReconnect){this.emit(M.ETwitterStreamEvent.ConnectionClosed);return}if(e>=this.autoReconnectRetries){this.emit(M.ETwitterStreamEvent.ReconnectLimitExceeded),this.emit(M.ETwitterStreamEvent.ConnectionClosed);return}try{this.emit(M.ETwitterStreamEvent.ReconnectAttempt,e),await this.reconnect()}catch(t){this.emit(M.ETwitterStreamEvent.ReconnectError,e),this.emit(M.ETwitterStreamEvent.Error,{type:M.ETwitterStreamEvent.ReconnectError,error:t,message:`Reconnect error - ${e+1} attempts made yet.`}),this.makeAutoReconnectRetry(e,t)}}makeAutoReconnectRetry(e,t){let s=this.nextRetryTimeout(e+1,t);this.retryTimeout=setTimeout(()=>{this.onConnectionError(e+1)},s)}async*[Symbol.asyncIterator](){let e=new cf.default(this);try{for(;;){if(!this.req||this.req.aborted)throw new Error("Connection closed");e.hasStack()&&(yield*e.popStack());let{type:t,payload:s}=await e.nextEvent();if(t==="error")throw s}}finally{e.destroy()}}};ne.TweetStream=Is;ne.default=Is});var tu=y(Wt=>{"use strict";Object.defineProperty(Wt,"__esModule",{value:!0});Wt.applyResponseHooks=Wt.hasRequestErrorPlugins=void 0;var vn=Me();function ff(n){var e;if(!((e=n.clientSettings.plugins)===null||e===void 0?void 0:e.length))return!1;for(let t of n.clientSettings.plugins)if(t.onRequestError||t.onResponseError)return!0;return!1}Wt.hasRequestErrorPlugins=ff;async function hf(n,e,t,s){let a;return s instanceof vn.ApiRequestError||s instanceof vn.ApiPartialResponseError?a=await this.applyPluginMethod("onRequestError",{client:this,url:this.getUrlObjectFromUrlString(n.url),params:n,computedParams:e,requestOptions:t,error:s}):s instanceof vn.ApiResponseError&&(a=await this.applyPluginMethod("onResponseError",{client:this,url:this.getUrlObjectFromUrlString(n.url),params:n,computedParams:e,requestOptions:t,error:s})),a&&a instanceof vn.TwitterApiPluginResponseOverride?a.value:Promise.reject(s)}Wt.applyResponseHooks=hf});var at=y(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.safeDeprecationWarning=Z.hasMultipleItems=Z.isTweetStreamV2ErrorPayload=Z.trimUndefinedProperties=Z.arrayWrap=Z.sharedPromise=void 0;var mf=Sn();function pf(n){let e={value:void 0,promise:n().then(t=>(e.value=t,t))};return e}Z.sharedPromise=pf;function _f(n){return Array.isArray(n)?n:[n]}Z.arrayWrap=_f;function gf(n){for(let e in n)n[e]===void 0&&delete n[e]}Z.trimUndefinedProperties=gf;function bf(n){return typeof n=="object"&&"errors"in n&&!("data"in n)}Z.isTweetStreamV2ErrorPayload=bf;function yf(n){return Array.isArray(n)&&n.length>1?!0:n.toString().includes(",")}Z.hasMultipleItems=yf;var ru=new Set;function wf(n){if(typeof console>"u"||!console.warn||!mf.TwitterApiV2Settings.deprecationWarnings)return;let e=`${n.instance}-${n.method}-${n.problem}`;if(ru.has(e))return;let t=`[twitter-api-v2] Deprecation warning: In ${n.instance}.${n.method}() call, ${n.problem}.
${n.resolution}.`;console.warn(t),console.warn("To disable this message, import variable TwitterApiV2Settings from twitter-api-v2 and set TwitterApiV2Settings.deprecationWarnings to false."),ru.add(e)}Z.safeDeprecationWarning=wf});var js=y(ve=>{"use strict";var Sf=ve&&ve.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),Tf=ve&&ve.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),vf=ve&&ve.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Sf(e,n,t);return Tf(e,n),e};Object.defineProperty(ve,"__esModule",{value:!0});ve.OAuth1Helper=void 0;var Rf=vf(require("crypto")),se=class{constructor(e){this.nonceLength=32,this.consumerKeys=e.consumerKeys}static percentEncode(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}hash(e,t){return Rf.createHmac("sha1",t).update(e).digest("base64")}authorize(e,t={}){let s={oauth_consumer_key:this.consumerKeys.key,oauth_nonce:this.getNonce(),oauth_signature_method:"HMAC-SHA1",oauth_timestamp:this.getTimestamp(),oauth_version:"1.0"};return t.key!==void 0&&(s.oauth_token=t.key),e.data||(e.data={}),s.oauth_signature=this.getSignature(e,t.secret,s),s}toHeader(e){let t=su(e),s="OAuth ";for(let a of t)a.key.indexOf("oauth_")===0&&(s+=se.percentEncode(a.key)+'="'+se.percentEncode(a.value)+'",');return{Authorization:s.slice(0,s.length-1)}}getNonce(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let s=0;s<this.nonceLength;s++)t+=e[Math.trunc(Math.random()*e.length)];return t}getTimestamp(){return Math.trunc(new Date().getTime()/1e3)}getSignature(e,t,s){return this.hash(this.getBaseString(e,s),this.getSigningKey(t))}getSigningKey(e){return se.percentEncode(this.consumerKeys.secret)+"&"+se.percentEncode(e||"")}getBaseString(e,t){return e.method.toUpperCase()+"&"+se.percentEncode(this.getBaseUrl(e.url))+"&"+se.percentEncode(this.getParameterString(e,t))}getParameterString(e,t){let s=su(Af(nu(t,nu(e.data,qf(e.url))))),a="";for(let{key:u,value:f}of s)if(f&&Array.isArray(f)){f.sort();let c="";f.forEach((h,S)=>{c+=u+"="+h,S<f.length&&(c+="&")}),a+=c}else a+=u+"="+f+"&";return a.slice(0,a.length-1)}getBaseUrl(e){return e.split("?")[0]}};ve.OAuth1Helper=se;ve.default=se;function nu(n,e){return p(p({},n||{}),e||{})}function su(n){return Object.keys(n).sort().map(e=>({key:e,value:n[e]}))}function Pf(n){let e=n.split("&"),t={};for(let s of e){let[a,u=""]=s.split("=");t[a]?(Array.isArray(t[a])||(t[a]=[t[a]]),t[a].push(decodeURIComponent(u))):t[a]=decodeURIComponent(u)}return t}function qf(n){let e=n.split("?");return e.length===1?{}:Pf(e[1])}function Af(n){let e={};for(let t in n){let s=n[t];s&&Array.isArray(s)?s=s.map(a=>se.percentEncode(a)):s=se.percentEncode(s),e[se.percentEncode(t)]=s}return e}});var iu=y(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.FormDataHelper=void 0;var Df=at(),Re=class{constructor(){this._boundary="",this._chunks=[]}bodyAppend(...e){let t=e.map(s=>s instanceof Buffer?s:Buffer.from(s));this._chunks.push(...t)}append(e,t,s){let a=t instanceof Buffer?t:t.toString(),u=this.getMultipartHeader(e,a,s);this.bodyAppend(u,a,Re.LINE_BREAK)}getHeaders(){return{"content-type":"multipart/form-data; boundary="+this.getBoundary()}}getLength(){return this._chunks.reduce((e,t)=>e+t.length,this.getMultipartFooter().length)}getBuffer(){let e=[...this._chunks,this.getMultipartFooter()],t=Buffer.alloc(this.getLength()),s=0;for(let a of e)for(let u=0;u<a.length;s++,u++)t[s]=a[u];return t}getBoundary(){return this._boundary||this.generateBoundary(),this._boundary}generateBoundary(){let e="--------------------------";for(let t=0;t<24;t++)e+=Math.floor(Math.random()*10).toString(16);this._boundary=e}getMultipartHeader(e,t,s){s||(s=t instanceof Buffer?Re.DEFAULT_CONTENT_TYPE:"");let a={"Content-Disposition":["form-data",`name="${e}"`],"Content-Type":s},u="";for(let[f,c]of Object.entries(a))!c.length||(u+=f+": "+(0,Df.arrayWrap)(c).join("; ")+Re.LINE_BREAK);return"--"+this.getBoundary()+Re.LINE_BREAK+u+Re.LINE_BREAK}getMultipartFooter(){return this._footerChunk?this._footerChunk:this._footerChunk=Buffer.from("--"+this.getBoundary()+"--"+Re.LINE_BREAK)}};Rn.FormDataHelper=Re;Re.LINE_BREAK=`\r
`;Re.DEFAULT_CONTENT_TYPE="application/octet-stream"});var Bs=y(St=>{"use strict";var Cf=St&&St.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(St,"__esModule",{value:!0});St.RequestParamHelpers=void 0;var Of=iu(),au=Cf(js()),Pn=class{static formatQueryToString(e){let t={};for(let s in e)typeof e[s]=="string"?t[s]=e[s]:typeof e[s]<"u"&&(t[s]=String(e[s]));return t}static autoDetectBodyType(e){if(e.pathname.startsWith("/2/")||e.pathname.startsWith("/labs/2/"))return e.password.startsWith("/2/oauth2")?"url":"json";if(e.hostname==="upload.twitter.com")return e.pathname==="/1.1/media/upload.json"?"form-data":"json";let t=e.pathname.split("/1.1/",2)[1];return this.JSON_1_1_ENDPOINTS.has(t)?"json":"url"}static addQueryParamsToUrl(e,t){let s=Object.entries(t);if(s.length){let a="";for(let[u,f]of s)a+=(a.length?"&":"?")+`${au.default.percentEncode(u)}=${au.default.percentEncode(f)}`;e.search=a}}static constructBodyParams(e,t,s){if(e instanceof Buffer)return e;if(s==="json")return t["content-type"]="application/json;charset=UTF-8",JSON.stringify(e);if(s==="url")return t["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",Object.keys(e).length?new URLSearchParams(e).toString().replace(/\*/g,"%2A"):"";if(s==="raw")throw new Error("You can only use raw body mode with Buffers. To give a string, use Buffer.from(str).");{let a=new Of.FormDataHelper;for(let f in e)a.append(f,e[f]);let u=a.getHeaders();return t["content-type"]=u["content-type"],a.getBuffer()}}static setBodyLengthHeader(e,t){var s;e.headers=(s=e.headers)!==null&&s!==void 0?s:{},typeof t=="string"?e.headers["content-length"]=Buffer.byteLength(t):e.headers["content-length"]=t.length}static isOAuthSerializable(e){return!(e instanceof Buffer)}static mergeQueryAndBodyForOAuth(e,t){let s={};for(let a in e)s[a]=e[a];if(this.isOAuthSerializable(t))for(let a in t){let u=t[a];this.isOAuthSerializable(u)&&(s[a]=typeof u=="object"&&u!==null&&"toString"in u?u.toString():u)}return s}static moveUrlQueryParamsIntoObject(e,t){for(let[s,a]of e.searchParams)t[s]=a;return e.search="",e}static applyRequestParametersToUrl(e,t){return e.pathname=e.pathname.replace(/:([A-Z_-]+)/ig,(s,a)=>t[a]!==void 0?String(t[a]):s),e}};St.RequestParamHelpers=Pn;Pn.JSON_1_1_ENDPOINTS=new Set(["direct_messages/events/new.json","direct_messages/welcome_messages/new.json","direct_messages/welcome_messages/rules/new.json","media/metadata/create.json","collections/entries/curate.json"]);St.default=Pn});var Fs=y(Le=>{"use strict";var Ef=Le&&Le.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),Mf=Le&&Le.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Lf=Le&&Le.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Ef(e,n,t);return Mf(e,n),e};Object.defineProperty(Le,"__esModule",{value:!0});Le.OAuth2Helper=void 0;var kf=Lf(require("crypto")),ou=class{static getCodeVerifier(){return this.generateRandomString(128)}static getCodeChallengeFromVerifier(e){return this.escapeBase64Url(kf.createHash("sha256").update(e).digest("base64"))}static getAuthHeader(e,t){let s=encodeURIComponent(e)+":"+encodeURIComponent(t);return Buffer.from(s).toString("base64")}static generateRandomString(e){let t="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";for(let a=0;a<e;a++)t+=s[Math.floor(Math.random()*s.length)];return t}static escapeBase64Url(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}};Le.OAuth2Helper=ou});var lu=y(Nt=>{"use strict";var qn=Nt&&Nt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Nt,"__esModule",{value:!0});Nt.ClientRequestMaker=void 0;var If=Me(),jf=qn(Tn()),uu=tu(),Bf=at(),Ff=qn(js()),xf=qn(Es()),$e=qn(Bs()),Uf=Fs(),zt=class{constructor(e){this.rateLimits={},this.clientSettings={},e&&(this.clientSettings=e)}getRateLimits(){return this.rateLimits}saveRateLimit(e,t){this.rateLimits[e]=t}async send(e){var t,s,a,u,f;if((t=this.clientSettings.plugins)===null||t===void 0?void 0:t.length){let w=await this.applyPreRequestConfigHooks(e);if(w)return w}let c=this.getHttpRequestArgs(e),h={method:c.method,headers:c.headers,timeout:e.timeout,agent:this.clientSettings.httpAgent},S=e.enableRateLimitSave!==!1;c.body&&$e.default.setBodyLengthHeader(h,c.body),((s=this.clientSettings.plugins)===null||s===void 0?void 0:s.length)&&await this.applyPreRequestHooks(e,c,h);let T=new xf.default({url:c.url,options:h,body:c.body,rateLimitSaver:S?this.saveRateLimit.bind(this,c.rawUrl):void 0,requestEventDebugHandler:e.requestEventDebugHandler,compression:(u=(a=e.compression)!==null&&a!==void 0?a:this.clientSettings.compression)!==null&&u!==void 0?u:!0,forceParseMode:e.forceParseMode}).makeRequest();(0,uu.hasRequestErrorPlugins)(this)&&(T=this.applyResponseErrorHooks(e,c,h,T));let P=await T;if((f=this.clientSettings.plugins)===null||f===void 0?void 0:f.length){let w=await this.applyPostRequestHooks(e,c,h,P);if(w)return w.value}return P}sendStream(e){var t,s;this.clientSettings.plugins&&this.applyPreStreamRequestConfigHooks(e);let a=this.getHttpRequestArgs(e),u={method:a.method,headers:a.headers,agent:this.clientSettings.httpAgent},f=e.enableRateLimitSave!==!1,c=e.autoConnect!==!1;a.body&&$e.default.setBodyLengthHeader(u,a.body);let h={url:a.url,options:u,body:a.body,rateLimitSaver:f?this.saveRateLimit.bind(this,a.rawUrl):void 0,payloadIsError:e.payloadIsError,compression:(s=(t=e.compression)!==null&&t!==void 0?t:this.clientSettings.compression)!==null&&s!==void 0?s:!0},S=new jf.default(h);return c?S.connect():S}initializeToken(e){if(typeof e=="string")this.bearerToken=e;else if(typeof e=="object"&&"appKey"in e)this.consumerToken=e.appKey,this.consumerSecret=e.appSecret,e.accessToken&&e.accessSecret&&(this.accessToken=e.accessToken,this.accessSecret=e.accessSecret),this._oauth=this.buildOAuth();else if(typeof e=="object"&&"username"in e){let t=encodeURIComponent(e.username)+":"+encodeURIComponent(e.password);this.basicToken=Buffer.from(t).toString("base64")}else typeof e=="object"&&"clientId"in e&&(this.clientId=e.clientId,this.clientSecret=e.clientSecret)}getActiveTokens(){return this.bearerToken?{type:"oauth2",bearerToken:this.bearerToken}:this.basicToken?{type:"basic",token:this.basicToken}:this.consumerSecret&&this._oauth?{type:"oauth-1.0a",appKey:this.consumerToken,appSecret:this.consumerSecret,accessToken:this.accessToken,accessSecret:this.accessSecret}:this.clientId?{type:"oauth2-user",clientId:this.clientId}:{type:"none"}}buildOAuth(){if(!this.consumerSecret||!this.consumerToken)throw new Error("Invalid consumer tokens");return new Ff.default({consumerKeys:{key:this.consumerToken,secret:this.consumerSecret}})}getOAuthAccessTokens(){if(!(!this.accessSecret||!this.accessToken))return{key:this.accessToken,secret:this.accessSecret}}getPlugins(){var e;return(e=this.clientSettings.plugins)!==null&&e!==void 0?e:[]}hasPlugins(){var e;return!!((e=this.clientSettings.plugins)===null||e===void 0?void 0:e.length)}async applyPluginMethod(e,t){var s;let a;for(let u of this.getPlugins()){let f=await((s=u[e])===null||s===void 0?void 0:s.call(u,t));f&&f instanceof If.TwitterApiPluginResponseOverride&&(a=f)}return a}writeAuthHeaders({headers:e,bodyInSignature:t,url:s,method:a,query:u,body:f}){if(e=p({},e),this.bearerToken)e.Authorization="Bearer "+this.bearerToken;else if(this.basicToken)e.Authorization="Basic "+this.basicToken;else if(this.clientId&&this.clientSecret)e.Authorization="Basic "+Uf.OAuth2Helper.getAuthHeader(this.clientId,this.clientSecret);else if(this.consumerSecret&&this._oauth){let c=t?$e.default.mergeQueryAndBodyForOAuth(u,f):u,h=this._oauth.authorize({url:s.toString(),method:a,data:c},this.getOAuthAccessTokens());e=p(p({},e),this._oauth.toHeader(h))}return e}getUrlObjectFromUrlString(e){return e.startsWith("http")||(e="https://"+e),new URL(e)}getHttpRequestArgs({url:e,method:t,query:s={},body:a={},headers:u,forceBodyMode:f,enableAuth:c,params:h}){let S;t=t.toUpperCase(),u=u??{},u["x-user-agent"]||(u["x-user-agent"]="Node.twitter-api-v2");let T=this.getUrlObjectFromUrlString(e),P=T.origin+T.pathname;h&&$e.default.applyRequestParametersToUrl(T,h);let w=$e.default.formatQueryToString(s);$e.default.moveUrlQueryParamsIntoObject(T,w),a instanceof Buffer||(0,Bf.trimUndefinedProperties)(a);let g=f??$e.default.autoDetectBodyType(T);if(c!==!1){let C=zt.BODY_METHODS.has(t)&&g==="url";u=this.writeAuthHeaders({headers:u,bodyInSignature:C,method:t,query:w,url:T,body:a})}return zt.BODY_METHODS.has(t)&&(S=$e.default.constructBodyParams(a,u,g)||void 0),$e.default.addQueryParamsToUrl(T,w),{rawUrl:P,url:T,method:t,headers:u,body:S}}async applyPreRequestConfigHooks(e){var t;let s=this.getUrlObjectFromUrlString(e.url);for(let a of this.getPlugins()){let u=await((t=a.onBeforeRequestConfig)===null||t===void 0?void 0:t.call(a,{client:this,url:s,params:e}));if(u)return u}}applyPreStreamRequestConfigHooks(e){var t;let s=this.getUrlObjectFromUrlString(e.url);for(let a of this.getPlugins())(t=a.onBeforeStreamRequestConfig)===null||t===void 0||t.call(a,{client:this,url:s,params:e})}async applyPreRequestHooks(e,t,s){await this.applyPluginMethod("onBeforeRequest",{client:this,url:this.getUrlObjectFromUrlString(e.url),params:e,computedParams:t,requestOptions:s})}async applyPostRequestHooks(e,t,s,a){return await this.applyPluginMethod("onAfterRequest",{client:this,url:this.getUrlObjectFromUrlString(e.url),params:e,computedParams:t,requestOptions:s,response:a})}applyResponseErrorHooks(e,t,s,a){return a.catch(uu.applyResponseHooks.bind(this,e,t,s))}};Nt.ClientRequestMaker=zt;zt.BODY_METHODS=new Set(["POST","PUT","PATCH"])});var Us=y(xs=>{"use strict";Object.defineProperty(xs,"__esModule",{value:!0});var Wf=lu(),cu=at(),du=Te(),An=class{constructor(e,t={}){this._currentUser=null,this._currentUserV2=null,e instanceof An?this._requestMaker=e._requestMaker:(this._requestMaker=new Wf.ClientRequestMaker(t),this._requestMaker.initializeToken(e))}setPrefix(e){this._prefix=e}cloneWithPrefix(e){let t=this.constructor(this);return t.setPrefix(e),t}getActiveTokens(){return this._requestMaker.getActiveTokens()}getPlugins(){return this._requestMaker.getPlugins()}getPluginOfType(e){return this.getPlugins().find(t=>t instanceof e)}hasHitRateLimit(e){var t;return this.isRateLimitStatusObsolete(e)?!1:((t=this.getLastRateLimitStatus(e))===null||t===void 0?void 0:t.remaining)===0}isRateLimitStatusObsolete(e){let t=this.getLastRateLimitStatus(e);return t===void 0?!0:t.reset*1e3<Date.now()}getLastRateLimitStatus(e){let t=e.match(/^https?:\/\//)?e:this._prefix+e;return this._requestMaker.getRateLimits()[t]}getCurrentUserObject(e=!1){return!e&&this._currentUser?this._currentUser.value?Promise.resolve(this._currentUser.value):this._currentUser.promise:(this._currentUser=(0,cu.sharedPromise)(()=>this.get("account/verify_credentials.json",{tweet_mode:"extended"},{prefix:du.API_V1_1_PREFIX})),this._currentUser.promise)}getCurrentUserV2Object(e=!1){return!e&&this._currentUserV2?this._currentUserV2.value?Promise.resolve(this._currentUserV2.value):this._currentUserV2.promise:(this._currentUserV2=(0,cu.sharedPromise)(()=>this.get("users/me",void 0,{prefix:du.API_V2_PREFIX})),this._currentUserV2.promise)}async get(e,t={},f={}){var c=f,{fullResponse:s,prefix:a=this._prefix}=c,u=W(c,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"GET",query:t},u));return s?h:h.data}async delete(e,t={},f={}){var c=f,{fullResponse:s,prefix:a=this._prefix}=c,u=W(c,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"DELETE",query:t},u));return s?h:h.data}async post(e,t,f={}){var c=f,{fullResponse:s,prefix:a=this._prefix}=c,u=W(c,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"POST",body:t},u));return s?h:h.data}async put(e,t,f={}){var c=f,{fullResponse:s,prefix:a=this._prefix}=c,u=W(c,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"PUT",body:t},u));return s?h:h.data}async patch(e,t,f={}){var c=f,{fullResponse:s,prefix:a=this._prefix}=c,u=W(c,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"PATCH",body:t},u));return s?h:h.data}getStream(e,t,u={}){var f=u,{prefix:s=this._prefix}=f,a=W(f,["prefix"]);return this._requestMaker.sendStream(p({url:s?s+e:e,method:"GET",query:t},a))}postStream(e,t,u={}){var f=u,{prefix:s=this._prefix}=f,a=W(f,["prefix"]);return this._requestMaker.sendStream(p({url:s?s+e:e,method:"POST",body:t},a))}};xs.default=An});var Dn=y(wr=>{"use strict";var zf=wr&&wr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(wr,"__esModule",{value:!0});var fu=zf(Us()),hu=class extends fu.default{constructor(e){if(!(e instanceof fu.default))throw new Error("You must instance SubTwitterApi instance from existing TwitterApi instance.");super(e)}};wr.default=hu});var Ws=y(de=>{"use strict";var Nf=de&&de.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(de,"__esModule",{value:!0});de.ListTimelineV1Paginator=de.UserTimelineV1Paginator=de.MentionTimelineV1Paginator=de.HomeTimelineV1Paginator=void 0;var Vf=Nf(jt()),Sr=class extends Vf.default{constructor(){super(...arguments);this.hasFinishedFetch=!1}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.push(...s),this.hasFinishedFetch=s.length===0)}getNextQueryParams(e){let t=BigInt(this._realData[this._realData.length-1].id_str);return B(p({},this.injectQueryParams(e)),{max_id:(t-BigInt(1)).toString()})}getPageLengthFromRequest(e){return e.data.length}isFetchLastOver(e){return!e.data.length}canFetchNextPage(e){return e.length>0}getItemArray(){return this.tweets}get tweets(){return this._realData}get done(){return super.done||this.hasFinishedFetch}},mu=class extends Sr{constructor(){super(...arguments);this._endpoint="statuses/home_timeline.json"}};de.HomeTimelineV1Paginator=mu;var pu=class extends Sr{constructor(){super(...arguments);this._endpoint="statuses/mentions_timeline.json"}};de.MentionTimelineV1Paginator=pu;var _u=class extends Sr{constructor(){super(...arguments);this._endpoint="statuses/user_timeline.json"}};de.UserTimelineV1Paginator=_u;var gu=class extends Sr{constructor(){super(...arguments);this._endpoint="lists/statuses.json"}};de.ListTimelineV1Paginator=gu});var zs=y(Vt=>{"use strict";Object.defineProperty(Vt,"__esModule",{value:!0});Vt.MuteUserIdsV1Paginator=Vt.MuteUserListV1Paginator=void 0;var bu=mr(),yu=class extends bu.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="mutes/users/list.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.users.push(...s.users),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.users.length}getItemArray(){return this.users}get users(){return this._realData.users}};Vt.MuteUserListV1Paginator=yu;var wu=class extends bu.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="mutes/users/ids.json",this._maxResultsWhenFetchLast=5e3}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.ids.push(...s.ids),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.ids.length}getItemArray(){return this.ids}get ids(){return this._realData.ids}};Vt.MuteUserIdsV1Paginator=wu});var Vs=y(ke=>{"use strict";var $f=ke&&ke.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ke,"__esModule",{value:!0});ke.FriendshipsOutgoingV1Paginator=ke.FriendshipsIncomingV1Paginator=ke.UserSearchV1Paginator=void 0;var Hf=$f(jt()),Qf=mr(),Su=class extends Hf.default{constructor(){super(...arguments);this._endpoint="users/search.json"}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&this._realData.push(...s)}getNextQueryParams(e){var t;let s=Number((t=this._queryParams.page)!==null&&t!==void 0?t:"1");return p(B(p({},this._queryParams),{page:s+1}),e?{count:e}:{})}getPageLengthFromRequest(e){return e.data.length}isFetchLastOver(e){return!e.data.length}canFetchNextPage(e){return e.length>0}getItemArray(){return this.users}get users(){return this._realData}};ke.UserSearchV1Paginator=Su;var Ns=class extends Qf.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="friendships/incoming.json",this._maxResultsWhenFetchLast=5e3}refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.ids.push(...s.ids),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.ids.length}getItemArray(){return this.ids}get ids(){return this._realData.ids}};ke.FriendshipsIncomingV1Paginator=Ns;var Tu=class extends Ns{constructor(){super(...arguments);this._endpoint="friendships/outgoing.json"}};ke.FriendshipsOutgoingV1Paginator=Tu});var Hs=y(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.ListSubscribersV1Paginator=fe.ListMembersV1Paginator=fe.ListSubscriptionsV1Paginator=fe.ListOwnershipsV1Paginator=fe.ListMembershipsV1Paginator=void 0;var vu=mr(),Cn=class extends vu.CursoredV1Paginator{refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.lists.push(...s.lists),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.lists.length}getItemArray(){return this.lists}get lists(){return this._realData.lists}},Ru=class extends Cn{constructor(){super(...arguments);this._endpoint="lists/memberships.json"}};fe.ListMembershipsV1Paginator=Ru;var Pu=class extends Cn{constructor(){super(...arguments);this._endpoint="lists/ownerships.json"}};fe.ListOwnershipsV1Paginator=Pu;var qu=class extends Cn{constructor(){super(...arguments);this._endpoint="lists/subscriptions.json"}};fe.ListSubscriptionsV1Paginator=qu;var $s=class extends vu.CursoredV1Paginator{refreshInstanceFromResult(e,t){let s=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.users.push(...s.users),this._realData.next_cursor=s.next_cursor)}getPageLengthFromRequest(e){return e.data.users.length}getItemArray(){return this.users}get users(){return this._realData.users}},Au=class extends $s{constructor(){super(...arguments);this._endpoint="lists/members.json"}};fe.ListMembersV1Paginator=Au;var Du=class extends $s{constructor(){super(...arguments);this._endpoint="lists/subscribers.json"}};fe.ListSubscribersV1Paginator=Du});var Ks=y(Rr=>{"use strict";var Ou=Rr&&Rr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Rr,"__esModule",{value:!0});var Yf=Ou(Dn()),Qs=Te(),Kf=at(),Gf=Ou(On()),Tr=Ws(),Cu=zs(),Ys=Vs(),vr=Hs(),Eu=class extends Yf.default{constructor(){super(...arguments);this._prefix=Qs.API_V1_1_PREFIX}singleTweet(e,t={}){return this.get("statuses/show.json",p({tweet_mode:"extended",id:e},t))}tweets(e,t={}){return this.post("statuses/lookup.json",p({tweet_mode:"extended",id:e},t))}oembedTweet(e,t={}){return this.get("oembed",p({url:`https://twitter.com/i/statuses/${e}`},t),{prefix:"https://publish.twitter.com/"})}async homeTimeline(e={}){let t=p({tweet_mode:"extended"},e),s=await this.get("statuses/home_timeline.json",t,{fullResponse:!0});return new Tr.HomeTimelineV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async mentionTimeline(e={}){let t=p({tweet_mode:"extended"},e),s=await this.get("statuses/mentions_timeline.json",t,{fullResponse:!0});return new Tr.MentionTimelineV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async userTimeline(e,t={}){let s=p({tweet_mode:"extended",user_id:e},t),a=await this.get("statuses/user_timeline.json",s,{fullResponse:!0});return new Tr.UserTimelineV1Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:s})}async userTimelineByUsername(e,t={}){let s=p({tweet_mode:"extended",screen_name:e},t),a=await this.get("statuses/user_timeline.json",s,{fullResponse:!0});return new Tr.UserTimelineV1Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:s})}user(e){return this.get("users/show.json",p({tweet_mode:"extended"},e))}users(e){return this.get("users/lookup.json",p({tweet_mode:"extended"},e))}verifyCredentials(e={}){return this.get("account/verify_credentials.json",e)}async listMutedUsers(e={}){let t=p({tweet_mode:"extended"},e),s=await this.get("mutes/users/list.json",t,{fullResponse:!0});return new Cu.MuteUserListV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async listMutedUserIds(e={}){let t=p({stringify_ids:!0},e),s=await this.get("mutes/users/ids.json",t,{fullResponse:!0});return new Cu.MuteUserIdsV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async searchUsers(e,t={}){let s=p({q:e,tweet_mode:"extended",page:1},t),a=await this.get("users/search.json",s,{fullResponse:!0});return new Ys.UserSearchV1Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:s})}friendship(e){return this.get("friendships/show.json",e)}friendships(e){return this.get("friendships/lookup.json",e)}friendshipsNoRetweets(){return this.get("friendships/no_retweets/ids.json",{stringify_ids:!0})}async friendshipsIncoming(e={}){let t=p({stringify_ids:!0},e),s=await this.get("friendships/incoming.json",t,{fullResponse:!0});return new Ys.FriendshipsIncomingV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async friendshipsOutgoing(e={}){let t=p({stringify_ids:!0},e),s=await this.get("friendships/outgoing.json",t,{fullResponse:!0});return new Ys.FriendshipsOutgoingV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}accountSettings(){return this.get("account/settings.json")}userProfileBannerSizes(e){return this.get("users/profile_banner.json",e)}list(e){return this.get("lists/show.json",p({tweet_mode:"extended"},e))}lists(e={}){return this.get("lists/list.json",p({tweet_mode:"extended"},e))}async listMembers(e={}){let t=p({tweet_mode:"extended"},e),s=await this.get("lists/members.json",t,{fullResponse:!0});return new vr.ListMembersV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}listGetMember(e){return this.get("lists/members/show.json",p({tweet_mode:"extended"},e))}async listMemberships(e={}){let t=p({tweet_mode:"extended"},e),s=await this.get("lists/memberships.json",t,{fullResponse:!0});return new vr.ListMembershipsV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async listOwnerships(e={}){let t=p({tweet_mode:"extended"},e),s=await this.get("lists/ownerships.json",t,{fullResponse:!0});return new vr.ListOwnershipsV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async listStatuses(e){let t=p({tweet_mode:"extended"},e),s=await this.get("lists/statuses.json",t,{fullResponse:!0});return new Tr.ListTimelineV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}async listSubscribers(e={}){let t=p({tweet_mode:"extended"},e),s=await this.get("lists/subscribers.json",t,{fullResponse:!0});return new vr.ListSubscribersV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}listGetSubscriber(e){return this.get("lists/subscribers/show.json",p({tweet_mode:"extended"},e))}async listSubscriptions(e={}){let t=p({tweet_mode:"extended"},e),s=await this.get("lists/subscriptions.json",t,{fullResponse:!0});return new vr.ListSubscriptionsV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}mediaInfo(e){return this.get("media/upload.json",{command:"STATUS",media_id:e},{prefix:Qs.API_V1_1_UPLOAD_PREFIX})}filterStream(s={}){var a=s,{autoConnect:e}=a,t=W(a,["autoConnect"]);let u={};for(let[c,h]of Object.entries(t))if(c==="follow"||c==="track")u[c]=h.toString();else if(c==="locations"){let S=h;u.locations=(0,Kf.arrayWrap)(S).map(T=>`${T.lng},${T.lat}`).join(",")}else u[c]=h;return this.stream.postStream("statuses/filter.json",u,{autoConnect:e})}sampleStream(s={}){var a=s,{autoConnect:e}=a,t=W(a,["autoConnect"]);return this.stream.getStream("statuses/sample.json",t,{autoConnect:e})}get stream(){let e=new Gf.default(this);return e.setPrefix(Qs.API_V1_1_STREAM_PREFIX),e}trendsByPlace(e,t={}){return this.get("trends/place.json",p({id:e},t))}trendsAvailable(){return this.get("trends/available.json")}trendsClosest(e,t){return this.get("trends/closest.json",{lat:e,long:t})}geoPlace(e){return this.get("geo/id/:place_id.json",void 0,{params:{place_id:e}})}geoSearch(e){return this.get("geo/search.json",e)}geoReverseGeoCode(e){return this.get("geo/reverse_geocode.json",e)}rateLimitStatuses(...e){return this.get("application/rate_limit_status.json",{resources:e})}supportedLanguages(){return this.get("help/languages.json")}};Rr.default=Eu});var ku=y(x=>{"use strict";var Xf=x&&x.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),Jf=x&&x.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),Zf=x&&x.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&Xf(e,n,t);return Jf(e,n),e};Object.defineProperty(x,"__esModule",{value:!0});x.readNextPartOf=x.sleepSecs=x.getMediaCategoryByMime=x.getMimeType=x.getFileSizeFromFileHandle=x.getFileHandle=x.readFileIntoBuffer=void 0;var En=Zf(require("fs")),Mu=at(),Q=Me();async function eh(n){let e=await Lu(n);return typeof e=="number"?new Promise((t,s)=>{En.readFile(e,(a,u)=>{if(a)return s(a);t(u)})}):e instanceof Buffer?e:e.readFile()}x.readFileIntoBuffer=eh;function Lu(n){if(typeof n=="string")return En.promises.open(n,"r");if(typeof n=="number")return n;if(typeof n=="object"&&!(n instanceof Buffer))return n;if(n instanceof Buffer)return n;throw new Error("Given file is not valid, please check its type.")}x.getFileHandle=Lu;async function th(n){return typeof n=="number"?(await new Promise((t,s)=>{En.fstat(n,(a,u)=>{a&&s(a),t(u)})})).size:n instanceof Buffer?n.length:(await n.stat()).size}x.getFileSizeFromFileHandle=th;function rh(n,e,t){if(typeof t=="string")return t;if(typeof n=="string"&&!e)return nh(n);if(typeof e=="string")return sh(e);throw new Error("You must specify type if file is a file handle or Buffer.")}x.getMimeType=rh;function nh(n){return n.endsWith(".jpeg")||n.endsWith(".jpg")?Q.EUploadMimeType.Jpeg:n.endsWith(".png")?Q.EUploadMimeType.Png:n.endsWith(".webp")?Q.EUploadMimeType.Webp:n.endsWith(".gif")?Q.EUploadMimeType.Gif:n.endsWith(".mpeg4")||n.endsWith(".mp4")?Q.EUploadMimeType.Mp4:n.endsWith(".srt")?Q.EUploadMimeType.Srt:((0,Mu.safeDeprecationWarning)({instance:"TwitterApiv1ReadWrite",method:"uploadMedia",problem:"options.mimeType is missing and filename couldn't help to resolve MIME type, so it will fallback to image/jpeg",resolution:"If you except to give filenames without extensions, please specify explicitlty the MIME type using options.mimeType"}),Q.EUploadMimeType.Jpeg)}function sh(n){return(0,Mu.safeDeprecationWarning)({instance:"TwitterApiv1ReadWrite",method:"uploadMedia",problem:"you're using options.type",resolution:"Remove options.type argument and migrate to options.mimeType which takes the real MIME type. If you're using type=longmp4, add options.longVideo alongside of mimeType=EUploadMimeType.Mp4"}),n==="gif"?Q.EUploadMimeType.Gif:n==="jpg"?Q.EUploadMimeType.Jpeg:n==="png"?Q.EUploadMimeType.Png:n==="webp"?Q.EUploadMimeType.Webp:n==="srt"?Q.EUploadMimeType.Srt:n==="mp4"||n==="longmp4"?Q.EUploadMimeType.Mp4:n}function ih(n,e){return n===Q.EUploadMimeType.Mp4?e==="tweet"?"TweetVideo":"DmVideo":n===Q.EUploadMimeType.Gif?e==="tweet"?"TweetGif":"DmGif":n===Q.EUploadMimeType.Srt?"Subtitles":e==="tweet"?"TweetImage":"DmImage"}x.getMediaCategoryByMime=ih;function ah(n){return new Promise(e=>setTimeout(e,n*1e3))}x.sleepSecs=ah;async function oh(n,e,t=0,s){if(n instanceof Buffer){let u=n.slice(t,t+e);return[u,u.length]}if(!s)throw new Error("Well, we will need a buffer to store file content.");let a;return typeof n=="number"?a=await new Promise((u,f)=>{En.read(n,s,0,e,t,(c,h)=>{c&&f(c),u(h)})}):a=(await n.read(s,0,e,t)).bytesRead,[s,a]}x.readNextPartOf=oh});var Xs=y(Pe=>{"use strict";var uh=Pe&&Pe.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),lh=Pe&&Pe.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),ch=Pe&&Pe.__importStar||function(n){if(n&&n.__esModule)return n;var e={};if(n!=null)for(var t in n)t!=="default"&&Object.prototype.hasOwnProperty.call(n,t)&&uh(e,n,t);return lh(e,n),e},dh=Pe&&Pe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Pe,"__esModule",{value:!0});var Tt=Te(),fh=dh(Ks()),hh=Me(),Iu=ch(require("fs")),Ie=ku(),Mn=at(),Gs="media/upload.json",ju=class extends fh.default{constructor(){super(...arguments);this._prefix=Tt.API_V1_1_PREFIX}get readOnly(){return this}tweet(e,t={}){let s=p({status:e,tweet_mode:"extended"},t);return this.post("statuses/update.json",s)}async quote(e,t,s={}){let a="https://twitter.com/i/statuses/"+t;return this.tweet(e,B(p({},s),{attachment_url:a}))}async tweetThread(e){let t=[];for(let s of e){let a=t.length?t[t.length-1]:null,u=p({},typeof s=="string"?{status:s}:s),f=a?a.id_str:u.in_reply_to_status_id,c=u.status;f?t.push(await this.reply(c,f,u)):t.push(await this.tweet(c,u))}return t}reply(e,t,s={}){return this.tweet(e,p({auto_populate_reply_metadata:!0,in_reply_to_status_id:t},s))}deleteTweet(e){return this.post("statuses/destroy/:id.json",{tweet_mode:"extended"},{params:{id:e}})}reportUserAsSpam(e){return this.post("users/report_spam.json",p({tweet_mode:"extended"},e))}updateFriendship(e){return this.post("friendships/update.json",e)}updateAccountSettings(e){return this.post("account/settings.json",e)}updateAccountProfile(e){return this.post("account/update_profile.json",e)}async updateAccountProfileBanner(e,t={}){let s=p({banner:await(0,Ie.readFileIntoBuffer)(e)},t);return this.post("account/update_profile_banner.json",s,{forceBodyMode:"form-data"})}async updateAccountProfileImage(e,t={}){let s=p({tweet_mode:"extended",image:await(0,Ie.readFileIntoBuffer)(e)},t);return this.post("account/update_profile_image.json",s,{forceBodyMode:"form-data"})}removeAccountProfileBanner(){return this.post("account/remove_profile_banner.json")}createList(e){return this.post("lists/create.json",p({tweet_mode:"extended"},e))}updateList(e){return this.post("lists/update.json",p({tweet_mode:"extended"},e))}removeList(e){return this.post("lists/destroy.json",p({tweet_mode:"extended"},e))}addListMembers(e){let s=e.user_id&&(0,Mn.hasMultipleItems)(e.user_id)||e.screen_name&&(0,Mn.hasMultipleItems)(e.screen_name)?"lists/members/create_all.json":"lists/members/create.json";return this.post(s,e)}removeListMembers(e){let s=e.user_id&&(0,Mn.hasMultipleItems)(e.user_id)||e.screen_name&&(0,Mn.hasMultipleItems)(e.screen_name)?"lists/members/destroy_all.json":"lists/members/destroy.json";return this.post(s,e)}subscribeToList(e){return this.post("lists/subscribers/create.json",p({tweet_mode:"extended"},e))}unsubscribeOfList(e){return this.post("lists/subscribers/destroy.json",p({tweet_mode:"extended"},e))}createMediaMetadata(e,t){return this.post("media/metadata/create.json",p({media_id:e},t),{prefix:Tt.API_V1_1_UPLOAD_PREFIX,forceBodyMode:"json"})}createMediaSubtitles(e,t){return this.post("media/subtitles/create.json",{media_id:e,media_category:"TweetVideo",subtitle_info:{subtitles:t}},{prefix:Tt.API_V1_1_UPLOAD_PREFIX,forceBodyMode:"json"})}deleteMediaSubtitles(e,...t){return this.post("media/subtitles/delete.json",{media_id:e,media_category:"TweetVideo",subtitle_info:{subtitles:t.map(s=>({language_code:s}))}},{prefix:Tt.API_V1_1_UPLOAD_PREFIX,forceBodyMode:"json"})}async uploadMedia(e,t={}){var s;let a=(s=t.chunkLength)!==null&&s!==void 0?s:1048576,{fileHandle:u,mediaCategory:f,fileSize:c,mimeType:h}=await this.getUploadMediaRequirements(e,t);try{let S=await this.post(Gs,{command:"INIT",total_bytes:c,media_type:h,media_category:f,additional_owners:t.additionalOwners,shared:t.shared?!0:void 0},{prefix:Tt.API_V1_1_UPLOAD_PREFIX});await this.mediaChunkedUpload(u,a,S.media_id_string,t.maxConcurrentUploads);let T=await this.post(Gs,{command:"FINALIZE",media_id:S.media_id_string},{prefix:Tt.API_V1_1_UPLOAD_PREFIX});return T.processing_info&&T.processing_info.state!=="succeeded"&&await this.awaitForMediaProcessingCompletion(T),T.media_id_string}finally{typeof e=="number"?Iu.close(e,()=>{}):typeof u=="object"&&!(u instanceof Buffer)&&u.close()}}async awaitForMediaProcessingCompletion(e){for(;;){e=await this.mediaInfo(e.media_id_string);let{processing_info:t}=e;if(!t||t.state==="succeeded")return;if(t.state==="failed"){if(t.error){let{name:s,message:a}=t.error;throw new Error(`Failed to process media: ${s} - ${a}.`)}throw new Error("Failed to process the media.")}t.check_after_secs?await(0,Ie.sleepSecs)(t.check_after_secs):await(0,Ie.sleepSecs)(5)}}async getUploadMediaRequirements(e,{mimeType:t,type:s,target:a,longVideo:u}={}){let f;try{f=await(0,Ie.getFileHandle)(e);let c=(0,Ie.getMimeType)(e,s,t),h;return c===hh.EUploadMimeType.Mp4&&(!t&&!s&&a!=="dm"||u)?h="amplify_video":h=(0,Ie.getMediaCategoryByMime)(c,a??"tweet"),{fileHandle:f,mediaCategory:h,fileSize:await(0,Ie.getFileSizeFromFileHandle)(f),mimeType:c}}catch(c){throw typeof e=="number"?Iu.close(e,()=>{}):typeof f=="object"&&!(f instanceof Buffer)&&f.close(),c}}async mediaChunkedUpload(e,t,s,a=3){let u=0;if(a<1)throw new RangeError("Bad maxConcurrentUploads parameter.");let f=e instanceof Buffer?void 0:Buffer.alloc(t),c,h,S=0;[c,h]=await(0,Ie.readNextPartOf)(e,t,S,f),S+=h;let T=new Set;for(;h;){let P=c.slice(0,h);if(P.length){let w=this.post(Gs,{command:"APPEND",media_id:s,segment_index:u,media:P},{prefix:Tt.API_V1_1_UPLOAD_PREFIX});T.add(w),w.then(()=>{T.delete(w)}),u++}T.size>=a&&await Promise.race(T),[c,h]=await(0,Ie.readNextPartOf)(e,t,S,f),S+=h}await Promise.all([...T])}};Pe.default=ju});var On=y(vt=>{"use strict";var mh=vt&&vt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(vt,"__esModule",{value:!0});vt.TwitterApiv1=void 0;var ph=Te(),Bu=Ds(),Pr=Me(),_h=mh(Xs()),Js=class extends _h.default{constructor(){super(...arguments);this._prefix=ph.API_V1_1_PREFIX}get readWrite(){return this}sendDm(a){var u=a,{recipient_id:e,custom_profile_id:t}=u,s=W(u,["recipient_id","custom_profile_id"]);let f={event:{type:Pr.EDirectMessageEventTypeV1.Create,[Pr.EDirectMessageEventTypeV1.Create]:{target:{recipient_id:e},message_data:s}}};return t&&(f.event[Pr.EDirectMessageEventTypeV1.Create].custom_profile_id=t),this.post("direct_messages/events/new.json",f,{forceBodyMode:"json"})}getDmEvent(e){return this.get("direct_messages/events/show.json",{id:e})}deleteDm(e){return this.delete("direct_messages/events/destroy.json",{id:e})}async listDmEvents(e={}){let t=p({},e),s=await this.get("direct_messages/events/list.json",t,{fullResponse:!0});return new Bu.DmEventsV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}newWelcomeDm(e,t){let s={[Pr.EDirectMessageEventTypeV1.WelcomeCreate]:{name:e,message_data:t}};return this.post("direct_messages/welcome_messages/new.json",s,{forceBodyMode:"json"})}getWelcomeDm(e){return this.get("direct_messages/welcome_messages/show.json",{id:e})}deleteWelcomeDm(e){return this.delete("direct_messages/welcome_messages/destroy.json",{id:e})}updateWelcomeDm(e,t){let s={message_data:t};return this.put("direct_messages/welcome_messages/update.json",s,{forceBodyMode:"json",query:{id:e}})}async listWelcomeDms(e={}){let t=p({},e),s=await this.get("direct_messages/welcome_messages/list.json",t,{fullResponse:!0});return new Bu.WelcomeDmV1Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t})}newWelcomeDmRule(e){return this.post("direct_messages/welcome_messages/rules/new.json",{welcome_message_rule:{welcome_message_id:e}},{forceBodyMode:"json"})}getWelcomeDmRule(e){return this.get("direct_messages/welcome_messages/rules/show.json",{id:e})}deleteWelcomeDmRule(e){return this.delete("direct_messages/welcome_messages/rules/destroy.json",{id:e})}async listWelcomeDmRules(e={}){let t=p({},e);return this.get("direct_messages/welcome_messages/rules/list.json",t)}async setWelcomeDm(e,t=!0){var s;let a=await this.listWelcomeDmRules();if((s=a.welcome_message_rules)===null||s===void 0?void 0:s.length)for(let u of a.welcome_message_rules)await this.deleteWelcomeDmRule(u.id),t&&await this.deleteWelcomeDm(u.welcome_message_id);return this.newWelcomeDmRule(e)}markDmAsRead(e,t){return this.post("direct_messages/mark_read.json",{last_read_event_id:e,recipient_id:t},{forceBodyMode:"url"})}indicateDmTyping(e){return this.post("direct_messages/indicate_typing.json",{recipient_id:e},{forceBodyMode:"url"})}async downloadDmImage(e){if(typeof e!="string"){let s=e[Pr.EDirectMessageEventTypeV1.Create].message_data.attachment;if(!s)throw new Error("The given direct message doesn't contain any attachment");e=s.media_url_https}let t=await this.get(e,void 0,{forceParseMode:"buffer",prefix:""});if(!t.length)throw new Error("Image not found. Make sure you are logged with credentials able to access direct messages, and check the URL.");return t}};vt.TwitterApiv1=Js;vt.default=Js});var Zs=y(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.TwitterV2IncludesHelper=void 0;var I=class{constructor(e){this.result=e}get tweets(){return I.tweets(this.result)}static tweets(e){var t,s;return(s=(t=e.includes)===null||t===void 0?void 0:t.tweets)!==null&&s!==void 0?s:[]}tweetById(e){return I.tweetById(this.result,e)}static tweetById(e,t){return this.tweets(e).find(s=>s.id===t)}retweet(e){return I.retweet(this.result,e)}static retweet(e,t){var s;let a=((s=t.referenced_tweets)!==null&&s!==void 0?s:[]).filter(u=>u.type==="retweeted").map(u=>u.id);return this.tweets(e).find(u=>a.includes(u.id))}quote(e){return I.quote(this.result,e)}static quote(e,t){var s;let a=((s=t.referenced_tweets)!==null&&s!==void 0?s:[]).filter(u=>u.type==="quoted").map(u=>u.id);return this.tweets(e).find(u=>a.includes(u.id))}repliedTo(e){return I.repliedTo(this.result,e)}static repliedTo(e,t){var s;let a=((s=t.referenced_tweets)!==null&&s!==void 0?s:[]).filter(u=>u.type==="replied_to").map(u=>u.id);return this.tweets(e).find(u=>a.includes(u.id))}author(e){return I.author(this.result,e)}static author(e,t){let s=t.author_id;return s?this.users(e).find(a=>a.id===s):void 0}repliedToAuthor(e){return I.repliedToAuthor(this.result,e)}static repliedToAuthor(e,t){let s=t.in_reply_to_user_id;return s?this.users(e).find(a=>a.id===s):void 0}get users(){return I.users(this.result)}static users(e){var t,s;return(s=(t=e.includes)===null||t===void 0?void 0:t.users)!==null&&s!==void 0?s:[]}userById(e){return I.userById(this.result,e)}static userById(e,t){return this.users(e).find(s=>s.id===t)}pinnedTweet(e){return I.pinnedTweet(this.result,e)}static pinnedTweet(e,t){return t.pinned_tweet_id?this.tweets(e).find(s=>s.id===t.pinned_tweet_id):void 0}get media(){return I.media(this.result)}static media(e){var t,s;return(s=(t=e.includes)===null||t===void 0?void 0:t.media)!==null&&s!==void 0?s:[]}medias(e){return I.medias(this.result,e)}static medias(e,t){var s,a;let u=(a=(s=t.attachments)===null||s===void 0?void 0:s.media_keys)!==null&&a!==void 0?a:[];return this.media(e).filter(f=>u.includes(f.media_key))}get polls(){return I.polls(this.result)}static polls(e){var t,s;return(s=(t=e.includes)===null||t===void 0?void 0:t.polls)!==null&&s!==void 0?s:[]}poll(e){return I.poll(this.result,e)}static poll(e,t){var s,a;let u=(a=(s=t.attachments)===null||s===void 0?void 0:s.poll_ids)!==null&&a!==void 0?a:[];if(u.length){let f=u[0];return this.polls(e).find(c=>c.id===f)}}get places(){return I.places(this.result)}static places(e){var t,s;return(s=(t=e.includes)===null||t===void 0?void 0:t.places)!==null&&s!==void 0?s:[]}place(e){return I.place(this.result,e)}static place(e,t){var s;let a=(s=t.geo)===null||s===void 0?void 0:s.place_id;return a?this.places(e).find(u=>u.id===a):void 0}listOwner(e){return I.listOwner(this.result,e)}static listOwner(e,t){let s=t.owner_id;return s?this.users(e).find(a=>a.id===s):void 0}spaceCreator(e){return I.spaceCreator(this.result,e)}static spaceCreator(e,t){let s=t.creator_id;return s?this.users(e).find(a=>a.id===s):void 0}spaceHosts(e){return I.spaceHosts(this.result,e)}static spaceHosts(e,t){var s;let a=(s=t.host_ids)!==null&&s!==void 0?s:[];return this.users(e).filter(u=>a.includes(u.id))}spaceSpeakers(e){return I.spaceSpeakers(this.result,e)}static spaceSpeakers(e,t){var s;let a=(s=t.speaker_ids)!==null&&s!==void 0?s:[];return this.users(e).filter(u=>a.includes(u.id))}spaceInvitedUsers(e){return I.spaceInvitedUsers(this.result,e)}static spaceInvitedUsers(e,t){var s;let a=(s=t.invited_user_ids)!==null&&s!==void 0?s:[];return this.users(e).filter(u=>a.includes(u.id))}};Ln.TwitterV2IncludesHelper=I});var kn=y($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.TimelineV2Paginator=$t.TwitterV2Paginator=void 0;var Fu=Zs(),gh=jt(),ei=class extends gh.PreviousableTwitterPaginator{updateIncludes(e){if(e.errors&&(this._realData.errors||(this._realData.errors=[]),this._realData.errors=[...this._realData.errors,...e.errors]),!e.includes)return;this._realData.includes||(this._realData.includes={});let t=this._realData.includes;for(let[s,a]of Object.entries(e.includes))t[s]||(t[s]=[]),t[s]=[...t[s],...a]}assertUsable(){if(this.unusable)throw new Error("Unable to use this paginator to fetch more data, as it does not contain any metadata. Check .errors property for more details.")}get meta(){return this._realData.meta}get includes(){var e;return((e=this._realData)===null||e===void 0?void 0:e.includes)?this._includesInstance?this._includesInstance:this._includesInstance=new Fu.TwitterV2IncludesHelper(this._realData):new Fu.TwitterV2IncludesHelper(this._realData)}get errors(){var e;return(e=this._realData.errors)!==null&&e!==void 0?e:[]}get unusable(){return this.errors.length>0&&!this._realData.meta&&!this._realData.data}};$t.TwitterV2Paginator=ei;var xu=class extends ei{refreshInstanceFromResult(e,t){var s;let a=e.data,u=(s=a.data)!==null&&s!==void 0?s:[];this._rateLimit=e.rateLimit,this._realData.data||(this._realData.data=[]),t?(this._realData.meta.result_count+=a.meta.result_count,this._realData.meta.next_token=a.meta.next_token,this._realData.data.push(...u)):(this._realData.meta.result_count+=a.meta.result_count,this._realData.meta.previous_token=a.meta.previous_token,this._realData.data.unshift(...u)),this.updateIncludes(a)}getNextQueryParams(e){return this.assertUsable(),B(p({},this.injectQueryParams(e)),{pagination_token:this._realData.meta.next_token})}getPreviousQueryParams(e){return this.assertUsable(),B(p({},this.injectQueryParams(e)),{pagination_token:this._realData.meta.previous_token})}getPageLengthFromRequest(e){var t,s;return(s=(t=e.data.data)===null||t===void 0?void 0:t.length)!==null&&s!==void 0?s:0}isFetchLastOver(e){var t;return!((t=e.data.data)===null||t===void 0?void 0:t.length)||!this.canFetchNextPage(e.data)}canFetchNextPage(e){var t;return!!((t=e.meta)===null||t===void 0?void 0:t.next_token)}};$t.TimelineV2Paginator=xu});var Ku=y(z=>{"use strict";Object.defineProperty(z,"__esModule",{value:!0});z.TweetV2ListTweetsPaginator=z.TweetV2UserLikedTweetsPaginator=z.TweetBookmarksTimelineV2Paginator=z.TweetUserMentionTimelineV2Paginator=z.TweetUserTimelineV2Paginator=z.TweetHomeTimelineV2Paginator=z.QuotedTweetsTimelineV2Paginator=z.TweetSearchAllV2Paginator=z.TweetSearchRecentV2Paginator=void 0;var ti=kn(),ri=class extends ti.TwitterV2Paginator{refreshInstanceFromResult(e,t){var s;let a=e.data,u=(s=a.data)!==null&&s!==void 0?s:[];this._rateLimit=e.rateLimit,this._realData.data||(this._realData.data=[]),t?(this._realData.meta.oldest_id=a.meta.oldest_id,this._realData.meta.result_count+=a.meta.result_count,this._realData.meta.next_token=a.meta.next_token,this._realData.data.push(...u)):(this._realData.meta.newest_id=a.meta.newest_id,this._realData.meta.result_count+=a.meta.result_count,this._realData.data.unshift(...u)),this.updateIncludes(a)}getNextQueryParams(e){this.assertUsable();let t=p({},this.injectQueryParams(e));return this._realData.meta.next_token?t.next_token=this._realData.meta.next_token:(t.start_time&&(t.since_id=this.dateStringToSnowflakeId(t.start_time),delete t.start_time),t.end_time&&delete t.end_time,t.until_id=this._realData.meta.oldest_id),t}getPreviousQueryParams(e){return this.assertUsable(),B(p({},this.injectQueryParams(e)),{since_id:this._realData.meta.newest_id})}getPageLengthFromRequest(e){var t,s;return(s=(t=e.data.data)===null||t===void 0?void 0:t.length)!==null&&s!==void 0?s:0}isFetchLastOver(e){var t;return!((t=e.data.data)===null||t===void 0?void 0:t.length)||!this.canFetchNextPage(e.data)}canFetchNextPage(e){return!!e.meta.next_token}getItemArray(){return this.tweets}dateStringToSnowflakeId(e){let t=BigInt("1288834974657"),s=new Date(e);if(isNaN(s.valueOf()))throw new Error("Unable to convert start_time/end_time to a valid date. A ISO 8601 DateTime is excepted, please check your input.");return(BigInt(s.valueOf())-t<<BigInt("22")).toString()}get tweets(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}},Ht=class extends ti.TimelineV2Paginator{refreshInstanceFromResult(e,t){super.refreshInstanceFromResult(e,t);let s=e.data;t?this._realData.meta.oldest_id=s.meta.oldest_id:this._realData.meta.newest_id=s.meta.newest_id}getItemArray(){return this.tweets}get tweets(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}},Uu=class extends ri{constructor(){super(...arguments);this._endpoint="tweets/search/recent"}};z.TweetSearchRecentV2Paginator=Uu;var Wu=class extends ri{constructor(){super(...arguments);this._endpoint="tweets/search/all"}};z.TweetSearchAllV2Paginator=Wu;var zu=class extends Ht{constructor(){super(...arguments);this._endpoint="tweets/:id/quote_tweets"}};z.QuotedTweetsTimelineV2Paginator=zu;var Nu=class extends Ht{constructor(){super(...arguments);this._endpoint="users/:id/timelines/reverse_chronological"}};z.TweetHomeTimelineV2Paginator=Nu;var Vu=class extends Ht{constructor(){super(...arguments);this._endpoint="users/:id/tweets"}};z.TweetUserTimelineV2Paginator=Vu;var $u=class extends Ht{constructor(){super(...arguments);this._endpoint="users/:id/mentions"}};z.TweetUserMentionTimelineV2Paginator=$u;var Hu=class extends Ht{constructor(){super(...arguments);this._endpoint="users/:id/bookmarks"}};z.TweetBookmarksTimelineV2Paginator=Hu;var ni=class extends ti.TimelineV2Paginator{get tweets(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}getItemArray(){return this.tweets}},Qu=class extends ni{constructor(){super(...arguments);this._endpoint="users/:id/liked_tweets"}};z.TweetV2UserLikedTweetsPaginator=Qu;var Yu=class extends ni{constructor(){super(...arguments);this._endpoint="lists/:id/tweets"}};z.TweetV2ListTweetsPaginator=Yu});var si=y($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.TweetRetweetersUsersV2Paginator=$.TweetLikingUsersV2Paginator=$.UserListFollowersV2Paginator=$.UserListMembersV2Paginator=$.UserFollowingV2Paginator=$.UserFollowersV2Paginator=$.UserMutingUsersV2Paginator=$.UserBlockingUsersV2Paginator=void 0;var bh=kn(),He=class extends bh.TimelineV2Paginator{getItemArray(){return this.users}get users(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}},Gu=class extends He{constructor(){super(...arguments);this._endpoint="users/:id/blocking"}};$.UserBlockingUsersV2Paginator=Gu;var Xu=class extends He{constructor(){super(...arguments);this._endpoint="users/:id/muting"}};$.UserMutingUsersV2Paginator=Xu;var Ju=class extends He{constructor(){super(...arguments);this._endpoint="users/:id/followers"}};$.UserFollowersV2Paginator=Ju;var Zu=class extends He{constructor(){super(...arguments);this._endpoint="users/:id/following"}};$.UserFollowingV2Paginator=Zu;var el=class extends He{constructor(){super(...arguments);this._endpoint="lists/:id/members"}};$.UserListMembersV2Paginator=el;var tl=class extends He{constructor(){super(...arguments);this._endpoint="lists/:id/followers"}};$.UserListFollowersV2Paginator=tl;var rl=class extends He{constructor(){super(...arguments);this._endpoint="tweets/:id/liking_users"}};$.TweetLikingUsersV2Paginator=rl;var nl=class extends He{constructor(){super(...arguments);this._endpoint="tweets/:id/retweeted_by"}};$.TweetRetweetersUsersV2Paginator=nl});var ol=y(ot=>{"use strict";Object.defineProperty(ot,"__esModule",{value:!0});ot.UserListFollowedV2Paginator=ot.UserListMembershipsV2Paginator=ot.UserOwnedListsV2Paginator=void 0;var yh=kn(),In=class extends yh.TimelineV2Paginator{getItemArray(){return this.lists}get lists(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}},sl=class extends In{constructor(){super(...arguments);this._endpoint="users/:id/owned_lists"}};ot.UserOwnedListsV2Paginator=sl;var il=class extends In{constructor(){super(...arguments);this._endpoint="users/:id/list_memberships"}};ot.UserListMembershipsV2Paginator=il;var al=class extends In{constructor(){super(...arguments);this._endpoint="users/:id/followed_lists"}};ot.UserListFollowedV2Paginator=al});var ii=y(K=>{"use strict";var wh=K&&K.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),Qe=K&&K.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&wh(e,n,t)};Object.defineProperty(K,"__esModule",{value:!0});Qe(Ku(),K);Qe(jt(),K);Qe(Ds(),K);Qe(zs(),K);Qe(Ws(),K);Qe(Vs(),K);Qe(si(),K);Qe(Hs(),K);Qe(ol(),K)});var ai=y(qr=>{"use strict";var Sh=qr&&qr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qr,"__esModule",{value:!0});var Th=Sh(Dn()),vh=Te(),ul=class extends Th.default{constructor(){super(...arguments);this._prefix=vh.API_V2_LABS_PREFIX}};qr.default=ul});var oi=y(Ar=>{"use strict";var cl=Ar&&Ar.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ar,"__esModule",{value:!0});var Rh=cl(Dn()),Ph=Te(),he=ii(),qh=cl(ai()),ut=si(),ll=at(),dl=class extends Rh.default{constructor(){super(...arguments);this._prefix=Ph.API_V2_PREFIX}get labs(){return this._labs?this._labs:this._labs=new qh.default(this)}async search(e,t={}){let s=typeof e=="string"?e:void 0,u=B(p({},typeof e=="object"&&e!==null?e:t),{query:s}),f=await this.get("tweets/search/recent",u,{fullResponse:!0});return new he.TweetSearchRecentV2Paginator({realData:f.data,rateLimit:f.rateLimit,instance:this,queryParams:u})}async searchAll(e,t={}){let s=B(p({},t),{query:e}),a=await this.get("tweets/search/all",s,{fullResponse:!0});return new he.TweetSearchAllV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:s})}singleTweet(e,t={}){return this.get("tweets/:id",t,{params:{id:e}})}tweets(e,t={}){return this.get("tweets",p({ids:e},t))}tweetCountRecent(e,t={}){return this.get("tweets/counts/recent",p({query:e},t))}tweetCountAll(e,t={}){return this.get("tweets/counts/all",p({query:e},t))}async tweetRetweetedBy(e,t={}){let f=t,{asPaginator:s}=f,a=W(f,["asPaginator"]),u=await this.get("tweets/:id/retweeted_by",a,{fullResponse:!0,params:{id:e}});return s?new ut.TweetRetweetersUsersV2Paginator({realData:u.data,rateLimit:u.rateLimit,instance:this,queryParams:a,sharedParams:{id:e}}):u.data}async tweetLikedBy(e,t={}){let f=t,{asPaginator:s}=f,a=W(f,["asPaginator"]),u=await this.get("tweets/:id/liking_users",a,{fullResponse:!0,params:{id:e}});return s?new ut.TweetLikingUsersV2Paginator({realData:u.data,rateLimit:u.rateLimit,instance:this,queryParams:a,sharedParams:{id:e}}):u.data}async homeTimeline(e={}){let t=await this.getCurrentUserV2Object(),s=await this.get("users/:id/timelines/reverse_chronological",e,{fullResponse:!0,params:{id:t.data.id}});return new he.TweetHomeTimelineV2Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:e,sharedParams:{id:t.data.id}})}async userTimeline(e,t={}){let s=await this.get("users/:id/tweets",t,{fullResponse:!0,params:{id:e}});return new he.TweetUserTimelineV2Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async userMentionTimeline(e,t={}){let s=await this.get("users/:id/mentions",t,{fullResponse:!0,params:{id:e}});return new he.TweetUserMentionTimelineV2Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async quotes(e,t={}){let s=await this.get("tweets/:id/quote_tweets",t,{fullResponse:!0,params:{id:e}});return new he.QuotedTweetsTimelineV2Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async bookmarks(e={}){let t=await this.getCurrentUserV2Object(),s=await this.get("users/:id/bookmarks",e,{fullResponse:!0,params:{id:t.data.id}});return new he.TweetBookmarksTimelineV2Paginator({realData:s.data,rateLimit:s.rateLimit,instance:this,queryParams:e,sharedParams:{id:t.data.id}})}me(e={}){return this.get("users/me",e)}user(e,t={}){return this.get("users/:id",t,{params:{id:e}})}users(e,t={}){let s=Array.isArray(e)?e.join(","):e;return this.get("users",B(p({},t),{ids:s}))}userByUsername(e,t={}){return this.get("users/by/username/:username",t,{params:{username:e}})}usersByUsernames(e,t={}){return e=Array.isArray(e)?e.join(","):e,this.get("users/by",B(p({},t),{usernames:e}))}async followers(e,t={}){let c=t,{asPaginator:s}=c,a=W(c,["asPaginator"]),u={id:e};if(!s)return this.get("users/:id/followers",a,{params:u});let f=await this.get("users/:id/followers",a,{fullResponse:!0,params:u});return new ut.UserFollowersV2Paginator({realData:f.data,rateLimit:f.rateLimit,instance:this,queryParams:a,sharedParams:u})}async following(e,t={}){let c=t,{asPaginator:s}=c,a=W(c,["asPaginator"]),u={id:e};if(!s)return this.get("users/:id/following",a,{params:u});let f=await this.get("users/:id/following",a,{fullResponse:!0,params:u});return new ut.UserFollowingV2Paginator({realData:f.data,rateLimit:f.rateLimit,instance:this,queryParams:a,sharedParams:u})}async userLikedTweets(e,t={}){let s={id:e},a=await this.get("users/:id/liked_tweets",t,{fullResponse:!0,params:s});return new he.TweetV2UserLikedTweetsPaginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}async userBlockingUsers(e,t={}){let s={id:e},a=await this.get("users/:id/blocking",t,{fullResponse:!0,params:s});return new ut.UserBlockingUsersV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}async userMutingUsers(e,t={}){let s={id:e},a=await this.get("users/:id/muting",t,{fullResponse:!0,params:s});return new ut.UserMutingUsersV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}list(e,t={}){return this.get("lists/:id",t,{params:{id:e}})}async listsOwned(e,t={}){let s={id:e},a=await this.get("users/:id/owned_lists",t,{fullResponse:!0,params:s});return new he.UserOwnedListsV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}async listMemberships(e,t={}){let s={id:e},a=await this.get("users/:id/list_memberships",t,{fullResponse:!0,params:s});return new he.UserListMembershipsV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}async listFollowed(e,t={}){let s={id:e},a=await this.get("users/:id/followed_lists",t,{fullResponse:!0,params:s});return new he.UserListFollowedV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}async listTweets(e,t={}){let s={id:e},a=await this.get("lists/:id/tweets",t,{fullResponse:!0,params:s});return new he.TweetV2ListTweetsPaginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}async listMembers(e,t={}){let s={id:e},a=await this.get("lists/:id/members",t,{fullResponse:!0,params:s});return new ut.UserListMembersV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}async listFollowers(e,t={}){let s={id:e},a=await this.get("lists/:id/followers",t,{fullResponse:!0,params:s});return new ut.UserListFollowersV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:s})}space(e,t={}){return this.get("spaces/:id",t,{params:{id:e}})}spaces(e,t={}){return this.get("spaces",p({ids:e},t))}spacesByCreators(e,t={}){return this.get("spaces/by/creator_ids",p({user_ids:e},t))}searchSpaces(e){return this.get("spaces/search",e)}spaceBuyers(e,t={}){return this.get("spaces/:id/buyers",t,{params:{id:e}})}searchStream(s={}){var a=s,{autoConnect:e}=a,t=W(a,["autoConnect"]);return this.getStream("tweets/search/stream",t,{payloadIsError:ll.isTweetStreamV2ErrorPayload,autoConnect:e})}streamRules(e={}){return this.get("tweets/search/stream/rules",e)}updateStreamRules(e,t={}){return this.post("tweets/search/stream/rules",e,{query:t})}sampleStream(s={}){var a=s,{autoConnect:e}=a,t=W(a,["autoConnect"]);return this.getStream("tweets/sample/stream",t,{payloadIsError:ll.isTweetStreamV2ErrorPayload,autoConnect:e})}complianceJobs(e){return this.get("compliance/jobs",e)}complianceJob(e){return this.get("compliance/jobs/:id",void 0,{params:{id:e}})}async sendComplianceJob(e){let t=await this.post("compliance/jobs",{type:e.type,name:e.name}),s=e.ids instanceof Buffer?e.ids:Buffer.from(e.ids.join(`
`));return await this.put(t.data.upload_url,s,{forceBodyMode:"raw",enableAuth:!1,headers:{"Content-Type":"text/plain"},prefix:""}),t}async complianceJobResult(e){let t=e;for(;t.status!=="complete";){if(t.status==="expired"||t.status==="failed")throw new Error("Job failed to be completed.");await new Promise(a=>setTimeout(a,3500)),t=(await this.complianceJob(e.id)).data}return(await this.get(e.download_url,void 0,{enableAuth:!1,prefix:""})).trim().split(`
`).filter(a=>a).map(a=>JSON.parse(a))}};Ar.default=dl});var ui=y(Dr=>{"use strict";var Ah=Dr&&Dr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Dr,"__esModule",{value:!0});var Dh=Te(),Ch=Ah(ai()),fl=class extends Ch.default{constructor(){super(...arguments);this._prefix=Dh.API_V2_LABS_PREFIX}get readOnly(){return this}};Dr.default=fl});var li=y(Cr=>{"use strict";var hl=Cr&&Cr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Cr,"__esModule",{value:!0});var Oh=Te(),Eh=hl(oi()),Mh=hl(ui()),ml=class extends Eh.default{constructor(){super(...arguments);this._prefix=Oh.API_V2_PREFIX}get readOnly(){return this}get labs(){return this._labs?this._labs:this._labs=new Mh.default(this)}hideReply(e,t){return this.put("tweets/:id/hidden",{hidden:t},{params:{id:e}})}like(e,t){return this.post("users/:id/likes",{tweet_id:t},{params:{id:e}})}unlike(e,t){return this.delete("users/:id/likes/:tweet_id",void 0,{params:{id:e,tweet_id:t}})}retweet(e,t){return this.post("users/:id/retweets",{tweet_id:t},{params:{id:e}})}unretweet(e,t){return this.delete("users/:id/retweets/:tweet_id",void 0,{params:{id:e,tweet_id:t}})}tweet(e,t={}){return typeof e=="object"?t=e:t=p({text:e},t),this.post("tweets",t)}reply(e,t,s={}){var a;let u=p({in_reply_to_tweet_id:t},(a=s.reply)!==null&&a!==void 0?a:{});return this.post("tweets",B(p({text:e},s),{reply:u}))}quote(e,t,s={}){return this.tweet(e,B(p({},s),{quote_tweet_id:t}))}async tweetThread(e){var t,s;let a=[];for(let u of e){let f=a.length?a[a.length-1]:null,c=p({},typeof u=="string"?{text:u}:u),h=f?f.data.id:(t=c.reply)===null||t===void 0?void 0:t.in_reply_to_tweet_id,S=(s=c.text)!==null&&s!==void 0?s:"";h?a.push(await this.reply(S,h,c)):a.push(await this.tweet(S,c))}return a}deleteTweet(e){return this.delete("tweets/:id",void 0,{params:{id:e}})}async bookmark(e){let t=await this.getCurrentUserV2Object();return this.post("users/:id/bookmarks",{tweet_id:e},{params:{id:t.data.id}})}async deleteBookmark(e){let t=await this.getCurrentUserV2Object();return this.delete("users/:id/bookmarks/:tweet_id",void 0,{params:{id:t.data.id,tweet_id:e}})}follow(e,t){return this.post("users/:id/following",{target_user_id:t},{params:{id:e}})}unfollow(e,t){return this.delete("users/:source_user_id/following/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}block(e,t){return this.post("users/:id/blocking",{target_user_id:t},{params:{id:e}})}unblock(e,t){return this.delete("users/:source_user_id/blocking/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}mute(e,t){return this.post("users/:id/muting",{target_user_id:t},{params:{id:e}})}unmute(e,t){return this.delete("users/:source_user_id/muting/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}createList(e){return this.post("lists",e)}updateList(e,t={}){return this.put("lists/:id",t,{params:{id:e}})}removeList(e){return this.delete("lists/:id",void 0,{params:{id:e}})}addListMember(e,t){return this.post("lists/:id/members",{user_id:t},{params:{id:e}})}removeListMember(e,t){return this.delete("lists/:id/members/:user_id",void 0,{params:{id:e,user_id:t}})}subscribeToList(e,t){return this.post("users/:id/followed_lists",{list_id:t},{params:{id:e}})}unsubscribeOfList(e,t){return this.delete("users/:id/followed_lists/:list_id",void 0,{params:{id:e,list_id:t}})}pinList(e,t){return this.post("users/:id/pinned_lists",{list_id:t},{params:{id:e}})}unpinList(e,t){return this.delete("users/:id/pinned_lists/:list_id",void 0,{params:{id:e,list_id:t}})}};Cr.default=ml});var di=y(Rt=>{"use strict";var Lh=Rt&&Rt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Rt,"__esModule",{value:!0});Rt.TwitterApiv2Labs=void 0;var kh=Te(),Ih=Lh(ui()),ci=class extends Ih.default{constructor(){super(...arguments);this._prefix=kh.API_V2_LABS_PREFIX}get readWrite(){return this}};Rt.TwitterApiv2Labs=ci;Rt.default=ci});var hi=y(Pt=>{"use strict";var pl=Pt&&Pt.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Pt,"__esModule",{value:!0});Pt.TwitterApiv2=void 0;var jh=Te(),Bh=pl(li()),Fh=pl(di()),fi=class extends Bh.default{constructor(){super(...arguments);this._prefix=jh.API_V2_PREFIX}get readWrite(){return this}get labs(){return this._labs?this._labs:this._labs=new Fh.default(this)}};Pt.TwitterApiv2=fi;Pt.default=fi});var pi=y(Or=>{"use strict";var Er=Or&&Or.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Or,"__esModule",{value:!0});var jn=Er(Bn()),xh=Er(Us()),Uh=Er(Ks()),Wh=Er(oi()),mi=Fs(),zh=Er(Bs()),_l=class extends xh.default{get v1(){return this._v1?this._v1:this._v1=new Uh.default(this)}get v2(){return this._v2?this._v2:this._v2=new Wh.default(this)}async currentUser(e=!1){return await this.getCurrentUserObject(e)}async currentUserV2(e=!1){return await this.getCurrentUserV2Object(e)}search(e,t){return this.v2.search(e,t)}async generateAuthLink(e="oob",{authAccessType:t,linkMode:s="authenticate",forceLogin:a,screenName:u}={}){let f=await this.post("https://api.twitter.com/oauth/request_token",{oauth_callback:e,x_auth_access_type:t}),c=`https://api.twitter.com/oauth/${s}?oauth_token=${encodeURIComponent(f.oauth_token)}`;return a!==void 0&&(c+=`&force_login=${encodeURIComponent(a)}`),u!==void 0&&(c+=`&screen_name=${encodeURIComponent(u)}`),this._requestMaker.hasPlugins()&&this._requestMaker.applyPluginMethod("onOAuth1RequestToken",{client:this._requestMaker,url:c,oauthResult:f}),p({url:c},f)}async login(e){let t=this.getActiveTokens();if(t.type!=="oauth-1.0a")throw new Error("You must setup TwitterApi instance with consumer keys to accept OAuth 1.0 login");let s=await this.post("https://api.twitter.com/oauth/access_token",{oauth_token:t.accessToken,oauth_verifier:e}),a=new jn.default({appKey:t.appKey,appSecret:t.appSecret,accessToken:s.oauth_token,accessSecret:s.oauth_token_secret},this._requestMaker.clientSettings);return{accessToken:s.oauth_token,accessSecret:s.oauth_token_secret,userId:s.user_id,screenName:s.screen_name,client:a}}async appLogin(){let e=this.getActiveTokens();if(e.type!=="oauth-1.0a")throw new Error("You must setup TwitterApi instance with consumer keys to accept app-only login");let s=await new jn.default({username:e.appKey,password:e.appSecret}).post("https://api.twitter.com/oauth2/token",{grant_type:"client_credentials"});return new jn.default(s.access_token,this._requestMaker.clientSettings)}generateOAuth2AuthLink(e,t={}){var s,a;if(!this._requestMaker.clientId)throw new Error("Twitter API instance is not initialized with client ID. You can find your client ID in Twitter Developer Portal. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let u=(s=t.state)!==null&&s!==void 0?s:mi.OAuth2Helper.generateRandomString(32),f=mi.OAuth2Helper.getCodeVerifier(),c=mi.OAuth2Helper.getCodeChallengeFromVerifier(f),h=(a=t.scope)!==null&&a!==void 0?a:"",S=Array.isArray(h)?h.join(" "):h,T=new URL("https://twitter.com/i/oauth2/authorize"),P={response_type:"code",client_id:this._requestMaker.clientId,redirect_uri:e,state:u,code_challenge:c,code_challenge_method:"s256",scope:S};zh.default.addQueryParamsToUrl(T,P);let w={url:T.toString(),state:u,codeVerifier:f,codeChallenge:c};return this._requestMaker.hasPlugins()&&this._requestMaker.applyPluginMethod("onOAuth2RequestToken",{client:this._requestMaker,result:w,redirectUri:e}),w}async loginWithOAuth2({code:e,codeVerifier:t,redirectUri:s}){if(!this._requestMaker.clientId)throw new Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let a=await this.post("https://api.twitter.com/2/oauth2/token",{code:e,code_verifier:t,redirect_uri:s,grant_type:"authorization_code",client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret});return this.parseOAuth2AccessTokenResult(a)}async refreshOAuth2Token(e){if(!this._requestMaker.clientId)throw new Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let t=await this.post("https://api.twitter.com/2/oauth2/token",{refresh_token:e,grant_type:"refresh_token",client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret});return this.parseOAuth2AccessTokenResult(t)}async revokeOAuth2Token(e,t="access_token"){if(!this._requestMaker.clientId)throw new Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");return await this.post("https://api.twitter.com/2/oauth2/revoke",{client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret,token:e,token_type_hint:t})}parseOAuth2AccessTokenResult(e){let t=new jn.default(e.access_token,this._requestMaker.clientSettings),s=e.scope.split(" ").filter(a=>a);return{client:t,expiresIn:e.expires_in,accessToken:e.access_token,scope:s,refreshToken:e.refresh_token}}};Or.default=_l});var gi=y(Mr=>{"use strict";var _i=Mr&&Mr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Mr,"__esModule",{value:!0});var Nh=_i(Xs()),Vh=_i(li()),$h=_i(pi()),gl=class extends $h.default{get v1(){return this._v1?this._v1:this._v1=new Nh.default(this)}get v2(){return this._v2?this._v2:this._v2=new Vh.default(this)}get readOnly(){return this}};Mr.default=gl});var Bn=y(qe=>{"use strict";var Lr=qe&&qe.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(qe,"__esModule",{value:!0});qe.TwitterApiReadOnly=qe.TwitterApiReadWrite=qe.TwitterApi=void 0;var Hh=Lr(On()),Qh=Lr(hi()),Yh=Lr(gi()),bi=class extends Yh.default{get v1(){return this._v1?this._v1:this._v1=new Hh.default(this)}get v2(){return this._v2?this._v2:this._v2=new Qh.default(this)}get readWrite(){return this}static getErrors(e){var t;return typeof e!="object"?[]:"data"in e?(t=e.data.errors)!==null&&t!==void 0?t:[]:[]}static getProfileImageInSize(e,t){let s=e.split("/").pop(),a=["normal","bigger","mini"],u=e;for(let c of a)if(s.includes(`_${c}`)){u=e.replace(`_${c}`,"");break}if(t==="original")return u;let f=u.lastIndexOf(".");if(f!==-1){let c=u.slice(f+1);return u.slice(0,f)+"_"+t+"."+c}else return u+"_"+t}};qe.TwitterApi=bi;var Kh=gi();Object.defineProperty(qe,"TwitterApiReadWrite",{enumerable:!0,get:function(){return Lr(Kh).default}});var Gh=pi();Object.defineProperty(qe,"TwitterApiReadOnly",{enumerable:!0,get:function(){return Lr(Gh).default}});qe.default=bi});var yi=y(V=>{"use strict";var Xh=V&&V.__createBinding||(Object.create?function(n,e,t,s){s===void 0&&(s=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,s,a)}:function(n,e,t,s){s===void 0&&(s=t),n[s]=e[t]}),Ye=V&&V.__exportStar||function(n,e){for(var t in n)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Xh(e,n,t)},Jh=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(V,"__esModule",{value:!0});V.default=void 0;var Zh=Bn();Object.defineProperty(V,"default",{enumerable:!0,get:function(){return Jh(Zh).default}});Ye(Bn(),V);Ye(On(),V);Ye(hi(),V);Ye(Zs(),V);Ye(di(),V);Ye(Me(),V);Ye(ii(),V);Ye(Tn(),V);Ye(Sn(),V)});var Pl=y((Vp,Rl)=>{"use strict";function im(n){if(!/^data:/i.test(n))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');n=n.replace(/\r?\n/g,"");let e=n.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=n.substring(5,e).split(";"),s="",a=!1,u=t[0]||"text/plain",f=u;for(let T=1;T<t.length;T++)t[T]==="base64"?a=!0:(f+=`;${t[T]}`,t[T].indexOf("charset=")===0&&(s=t[T].substring(8)));!t[0]&&!s.length&&(f+=";charset=US-ASCII",s="US-ASCII");let c=a?"base64":"ascii",h=unescape(n.substring(e+1)),S=Buffer.from(h,c);return S.type=u,S.typeFull=f,S.charset=s,S}Rl.exports=im});var Al=y((xn,ql)=>{(function(n,e){typeof xn=="object"&&typeof ql<"u"?e(xn):typeof define=="function"&&define.amd?define(["exports"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.WebStreamsPolyfill={}))})(xn,function(n){"use strict";let e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:r=>`Symbol(${r})`;function t(){}function s(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}let a=s();function u(r){return typeof r=="object"&&r!==null||typeof r=="function"}let f=t,c=Promise,h=Promise.prototype.then,S=Promise.resolve.bind(c),T=Promise.reject.bind(c);function P(r){return new c(r)}function w(r){return S(r)}function g(r){return T(r)}function C(r,i,o){return h.call(r,i,o)}function E(r,i,o){C(C(r,i,o),void 0,f)}function ue(r,i){E(r,i)}function De(r,i){E(r,void 0,i)}function Be(r,i,o){return C(r,i,o)}function Fe(r){C(r,void 0,f)}let _e=(()=>{let r=a&&a.queueMicrotask;if(typeof r=="function")return r;let i=w(void 0);return o=>C(i,o)})();function xe(r,i,o){if(typeof r!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(r,i,o)}function dt(r,i,o){try{return w(xe(r,i,o))}catch(l){return g(l)}}let Li=16384;class ge{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(i){let o=this._back,l=o;o._elements.length===Li-1&&(l={_elements:[],_next:void 0}),o._elements.push(i),l!==o&&(this._back=l,o._next=l),++this._size}shift(){let i=this._front,o=i,l=this._cursor,d=l+1,m=i._elements,_=m[l];return d===Li&&(o=i._next,d=0),--this._size,this._cursor=d,i!==o&&(this._front=o),m[l]=void 0,_}forEach(i){let o=this._cursor,l=this._front,d=l._elements;for(;(o!==d.length||l._next!==void 0)&&!(o===d.length&&(l=l._next,d=l._elements,o=0,d.length===0));)i(d[o]),++o}peek(){let i=this._front,o=this._cursor;return i._elements[o]}}function ki(r,i){r._ownerReadableStream=i,i._reader=r,i._state==="readable"?Kn(r):i._state==="closed"?oc(r):Ii(r,i._storedError)}function Yn(r,i){let o=r._ownerReadableStream;return we(o,i)}function Ue(r){r._ownerReadableStream._state==="readable"?Gn(r,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):uc(r,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),r._ownerReadableStream._reader=void 0,r._ownerReadableStream=void 0}function Dt(r){return new TypeError("Cannot "+r+" a stream using a released reader")}function Kn(r){r._closedPromise=P((i,o)=>{r._closedPromise_resolve=i,r._closedPromise_reject=o})}function Ii(r,i){Kn(r),Gn(r,i)}function oc(r){Kn(r),ji(r)}function Gn(r,i){r._closedPromise_reject!==void 0&&(Fe(r._closedPromise),r._closedPromise_reject(i),r._closedPromise_resolve=void 0,r._closedPromise_reject=void 0)}function uc(r,i){Ii(r,i)}function ji(r){r._closedPromise_resolve!==void 0&&(r._closedPromise_resolve(void 0),r._closedPromise_resolve=void 0,r._closedPromise_reject=void 0)}let Bi=e("[[AbortSteps]]"),Fi=e("[[ErrorSteps]]"),Xn=e("[[CancelSteps]]"),Jn=e("[[PullSteps]]"),xi=Number.isFinite||function(r){return typeof r=="number"&&isFinite(r)},lc=Math.trunc||function(r){return r<0?Math.ceil(r):Math.floor(r)};function cc(r){return typeof r=="object"||typeof r=="function"}function We(r,i){if(r!==void 0&&!cc(r))throw new TypeError(`${i} is not an object.`)}function be(r,i){if(typeof r!="function")throw new TypeError(`${i} is not a function.`)}function dc(r){return typeof r=="object"&&r!==null||typeof r=="function"}function Ui(r,i){if(!dc(r))throw new TypeError(`${i} is not an object.`)}function ze(r,i,o){if(r===void 0)throw new TypeError(`Parameter ${i} is required in '${o}'.`)}function Zn(r,i,o){if(r===void 0)throw new TypeError(`${i} is required in '${o}'.`)}function es(r){return Number(r)}function Wi(r){return r===0?0:r}function fc(r){return Wi(lc(r))}function zi(r,i){let l=Number.MAX_SAFE_INTEGER,d=Number(r);if(d=Wi(d),!xi(d))throw new TypeError(`${i} is not a finite number`);if(d=fc(d),d<0||d>l)throw new TypeError(`${i} is outside the accepted range of ${0} to ${l}, inclusive`);return!xi(d)||d===0?0:d}function ts(r,i){if(!et(r))throw new TypeError(`${i} is not a ReadableStream.`)}function Ct(r){return new Xt(r)}function Ni(r,i){r._reader._readRequests.push(i)}function rs(r,i,o){let d=r._reader._readRequests.shift();o?d._closeSteps():d._chunkSteps(i)}function Br(r){return r._reader._readRequests.length}function Vi(r){let i=r._reader;return!(i===void 0||!Ge(i))}class Xt{constructor(i){if(ze(i,1,"ReadableStreamDefaultReader"),ts(i,"First parameter"),tt(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");ki(this,i),this._readRequests=new ge}get closed(){return Ge(this)?this._closedPromise:g(Fr("closed"))}cancel(i=void 0){return Ge(this)?this._ownerReadableStream===void 0?g(Dt("cancel")):Yn(this,i):g(Fr("cancel"))}read(){if(!Ge(this))return g(Fr("read"));if(this._ownerReadableStream===void 0)return g(Dt("read from"));let i,o,l=P((m,_)=>{i=m,o=_});return Jt(this,{_chunkSteps:m=>i({value:m,done:!1}),_closeSteps:()=>i({value:void 0,done:!0}),_errorSteps:m=>o(m)}),l}releaseLock(){if(!Ge(this))throw Fr("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Ue(this)}}}Object.defineProperties(Xt.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Xt.prototype,e.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function Ge(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_readRequests")?!1:r instanceof Xt}function Jt(r,i){let o=r._ownerReadableStream;o._disturbed=!0,o._state==="closed"?i._closeSteps():o._state==="errored"?i._errorSteps(o._storedError):o._readableStreamController[Jn](i)}function Fr(r){return new TypeError(`ReadableStreamDefaultReader.prototype.${r} can only be used on a ReadableStreamDefaultReader`)}let $i=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Hi{constructor(i,o){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=i,this._preventCancel=o}next(){let i=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?Be(this._ongoingPromise,i,i):i(),this._ongoingPromise}return(i){let o=()=>this._returnSteps(i);return this._ongoingPromise?Be(this._ongoingPromise,o,o):o()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let i=this._reader;if(i._ownerReadableStream===void 0)return g(Dt("iterate"));let o,l,d=P((_,b)=>{o=_,l=b});return Jt(i,{_chunkSteps:_=>{this._ongoingPromise=void 0,_e(()=>o({value:_,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,Ue(i),o({value:void 0,done:!0})},_errorSteps:_=>{this._ongoingPromise=void 0,this._isFinished=!0,Ue(i),l(_)}}),d}_returnSteps(i){if(this._isFinished)return Promise.resolve({value:i,done:!0});this._isFinished=!0;let o=this._reader;if(o._ownerReadableStream===void 0)return g(Dt("finish iterating"));if(!this._preventCancel){let l=Yn(o,i);return Ue(o),Be(l,()=>({value:i,done:!0}))}return Ue(o),w({value:i,done:!0})}}let Qi={next(){return Yi(this)?this._asyncIteratorImpl.next():g(Ki("next"))},return(r){return Yi(this)?this._asyncIteratorImpl.return(r):g(Ki("return"))}};$i!==void 0&&Object.setPrototypeOf(Qi,$i);function hc(r,i){let o=Ct(r),l=new Hi(o,i),d=Object.create(Qi);return d._asyncIteratorImpl=l,d}function Yi(r){if(!u(r)||!Object.prototype.hasOwnProperty.call(r,"_asyncIteratorImpl"))return!1;try{return r._asyncIteratorImpl instanceof Hi}catch{return!1}}function Ki(r){return new TypeError(`ReadableStreamAsyncIterator.${r} can only be used on a ReadableSteamAsyncIterator`)}let Gi=Number.isNaN||function(r){return r!==r};function Zt(r){return r.slice()}function Xi(r,i,o,l,d){new Uint8Array(r).set(new Uint8Array(o,l,d),i)}function ym(r){return r}function xr(r){return!1}function Ji(r,i,o){if(r.slice)return r.slice(i,o);let l=o-i,d=new ArrayBuffer(l);return Xi(d,0,r,i,l),d}function mc(r){return!(typeof r!="number"||Gi(r)||r<0)}function Zi(r){let i=Ji(r.buffer,r.byteOffset,r.byteOffset+r.byteLength);return new Uint8Array(i)}function ns(r){let i=r._queue.shift();return r._queueTotalSize-=i.size,r._queueTotalSize<0&&(r._queueTotalSize=0),i.value}function ss(r,i,o){if(!mc(o)||o===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");r._queue.push({value:i,size:o}),r._queueTotalSize+=o}function pc(r){return r._queue.peek().value}function Xe(r){r._queue=new ge,r._queueTotalSize=0}class er{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!is(this))throw cs("view");return this._view}respond(i){if(!is(this))throw cs("respond");if(ze(i,1,"respond"),i=zi(i,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");xr(this._view.buffer),Nr(this._associatedReadableByteStreamController,i)}respondWithNewView(i){if(!is(this))throw cs("respondWithNewView");if(ze(i,1,"respondWithNewView"),!ArrayBuffer.isView(i))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");xr(i.buffer),Vr(this._associatedReadableByteStreamController,i)}}Object.defineProperties(er.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(er.prototype,e.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Ot{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!ft(this))throw rr("byobRequest");return ls(this)}get desiredSize(){if(!ft(this))throw rr("desiredSize");return oa(this)}close(){if(!ft(this))throw rr("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let i=this._controlledReadableByteStream._state;if(i!=="readable")throw new TypeError(`The stream (in ${i} state) is not in the readable state and cannot be closed`);tr(this)}enqueue(i){if(!ft(this))throw rr("enqueue");if(ze(i,1,"enqueue"),!ArrayBuffer.isView(i))throw new TypeError("chunk must be an array buffer view");if(i.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(i.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let o=this._controlledReadableByteStream._state;if(o!=="readable")throw new TypeError(`The stream (in ${o} state) is not in the readable state and cannot be enqueued to`);zr(this,i)}error(i=void 0){if(!ft(this))throw rr("error");ye(this,i)}[Xn](i){ea(this),Xe(this);let o=this._cancelAlgorithm(i);return Wr(this),o}[Jn](i){let o=this._controlledReadableByteStream;if(this._queueTotalSize>0){let d=this._queue.shift();this._queueTotalSize-=d.byteLength,sa(this);let m=new Uint8Array(d.buffer,d.byteOffset,d.byteLength);i._chunkSteps(m);return}let l=this._autoAllocateChunkSize;if(l!==void 0){let d;try{d=new ArrayBuffer(l)}catch(_){i._errorSteps(_);return}let m={buffer:d,bufferByteLength:l,byteOffset:0,byteLength:l,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(m)}Ni(o,i),ht(this)}}Object.defineProperties(Ot.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Ot.prototype,e.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function ft(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_controlledReadableByteStream")?!1:r instanceof Ot}function is(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_associatedReadableByteStreamController")?!1:r instanceof er}function ht(r){if(!yc(r))return;if(r._pulling){r._pullAgain=!0;return}r._pulling=!0;let o=r._pullAlgorithm();E(o,()=>{r._pulling=!1,r._pullAgain&&(r._pullAgain=!1,ht(r))},l=>{ye(r,l)})}function ea(r){os(r),r._pendingPullIntos=new ge}function as(r,i){let o=!1;r._state==="closed"&&(o=!0);let l=ta(i);i.readerType==="default"?rs(r,l,o):Tc(r,l,o)}function ta(r){let i=r.bytesFilled,o=r.elementSize;return new r.viewConstructor(r.buffer,r.byteOffset,i/o)}function Ur(r,i,o,l){r._queue.push({buffer:i,byteOffset:o,byteLength:l}),r._queueTotalSize+=l}function ra(r,i){let o=i.elementSize,l=i.bytesFilled-i.bytesFilled%o,d=Math.min(r._queueTotalSize,i.byteLength-i.bytesFilled),m=i.bytesFilled+d,_=m-m%o,b=d,v=!1;_>l&&(b=_-i.bytesFilled,v=!0);let D=r._queue;for(;b>0;){let j=D.peek(),L=Math.min(b,j.byteLength),U=i.byteOffset+i.bytesFilled;Xi(i.buffer,U,j.buffer,j.byteOffset,L),j.byteLength===L?D.shift():(j.byteOffset+=L,j.byteLength-=L),r._queueTotalSize-=L,na(r,L,i),b-=L}return v}function na(r,i,o){o.bytesFilled+=i}function sa(r){r._queueTotalSize===0&&r._closeRequested?(Wr(r),cr(r._controlledReadableByteStream)):ht(r)}function os(r){r._byobRequest!==null&&(r._byobRequest._associatedReadableByteStreamController=void 0,r._byobRequest._view=null,r._byobRequest=null)}function ia(r){for(;r._pendingPullIntos.length>0;){if(r._queueTotalSize===0)return;let i=r._pendingPullIntos.peek();ra(r,i)&&(us(r),as(r._controlledReadableByteStream,i))}}function _c(r,i,o){let l=r._controlledReadableByteStream,d=1;i.constructor!==DataView&&(d=i.constructor.BYTES_PER_ELEMENT);let m=i.constructor,_=i.buffer,b={buffer:_,bufferByteLength:_.byteLength,byteOffset:i.byteOffset,byteLength:i.byteLength,bytesFilled:0,elementSize:d,viewConstructor:m,readerType:"byob"};if(r._pendingPullIntos.length>0){r._pendingPullIntos.push(b),ca(l,o);return}if(l._state==="closed"){let v=new m(b.buffer,b.byteOffset,0);o._closeSteps(v);return}if(r._queueTotalSize>0){if(ra(r,b)){let v=ta(b);sa(r),o._chunkSteps(v);return}if(r._closeRequested){let v=new TypeError("Insufficient bytes to fill elements in the given buffer");ye(r,v),o._errorSteps(v);return}}r._pendingPullIntos.push(b),ca(l,o),ht(r)}function gc(r,i){let o=r._controlledReadableByteStream;if(ds(o))for(;da(o)>0;){let l=us(r);as(o,l)}}function bc(r,i,o){if(na(r,i,o),o.bytesFilled<o.elementSize)return;us(r);let l=o.bytesFilled%o.elementSize;if(l>0){let d=o.byteOffset+o.bytesFilled,m=Ji(o.buffer,d-l,d);Ur(r,m,0,m.byteLength)}o.bytesFilled-=l,as(r._controlledReadableByteStream,o),ia(r)}function aa(r,i){let o=r._pendingPullIntos.peek();os(r),r._controlledReadableByteStream._state==="closed"?gc(r):bc(r,i,o),ht(r)}function us(r){return r._pendingPullIntos.shift()}function yc(r){let i=r._controlledReadableByteStream;return i._state!=="readable"||r._closeRequested||!r._started?!1:!!(Vi(i)&&Br(i)>0||ds(i)&&da(i)>0||oa(r)>0)}function Wr(r){r._pullAlgorithm=void 0,r._cancelAlgorithm=void 0}function tr(r){let i=r._controlledReadableByteStream;if(!(r._closeRequested||i._state!=="readable")){if(r._queueTotalSize>0){r._closeRequested=!0;return}if(r._pendingPullIntos.length>0&&r._pendingPullIntos.peek().bytesFilled>0){let l=new TypeError("Insufficient bytes to fill elements in the given buffer");throw ye(r,l),l}Wr(r),cr(i)}}function zr(r,i){let o=r._controlledReadableByteStream;if(r._closeRequested||o._state!=="readable")return;let l=i.buffer,d=i.byteOffset,m=i.byteLength,_=l;if(r._pendingPullIntos.length>0){let b=r._pendingPullIntos.peek();xr(b.buffer),b.buffer=b.buffer}if(os(r),Vi(o))if(Br(o)===0)Ur(r,_,d,m);else{let b=new Uint8Array(_,d,m);rs(o,b,!1)}else ds(o)?(Ur(r,_,d,m),ia(r)):Ur(r,_,d,m);ht(r)}function ye(r,i){let o=r._controlledReadableByteStream;o._state==="readable"&&(ea(r),Xe(r),Wr(r),Ia(o,i))}function ls(r){if(r._byobRequest===null&&r._pendingPullIntos.length>0){let i=r._pendingPullIntos.peek(),o=new Uint8Array(i.buffer,i.byteOffset+i.bytesFilled,i.byteLength-i.bytesFilled),l=Object.create(er.prototype);Sc(l,r,o),r._byobRequest=l}return r._byobRequest}function oa(r){let i=r._controlledReadableByteStream._state;return i==="errored"?null:i==="closed"?0:r._strategyHWM-r._queueTotalSize}function Nr(r,i){let o=r._pendingPullIntos.peek();if(r._controlledReadableByteStream._state==="closed"){if(i!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(i===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(o.bytesFilled+i>o.byteLength)throw new RangeError("bytesWritten out of range")}o.buffer=o.buffer,aa(r,i)}function Vr(r,i){let o=r._pendingPullIntos.peek();if(r._controlledReadableByteStream._state==="closed"){if(i.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(i.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(o.byteOffset+o.bytesFilled!==i.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(o.bufferByteLength!==i.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(o.bytesFilled+i.byteLength>o.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");o.buffer=i.buffer,aa(r,i.byteLength)}function ua(r,i,o,l,d,m,_){i._controlledReadableByteStream=r,i._pullAgain=!1,i._pulling=!1,i._byobRequest=null,i._queue=i._queueTotalSize=void 0,Xe(i),i._closeRequested=!1,i._started=!1,i._strategyHWM=m,i._pullAlgorithm=l,i._cancelAlgorithm=d,i._autoAllocateChunkSize=_,i._pendingPullIntos=new ge,r._readableStreamController=i;let b=o();E(w(b),()=>{i._started=!0,ht(i)},v=>{ye(i,v)})}function wc(r,i,o){let l=Object.create(Ot.prototype),d=()=>{},m=()=>w(void 0),_=()=>w(void 0);i.start!==void 0&&(d=()=>i.start(l)),i.pull!==void 0&&(m=()=>i.pull(l)),i.cancel!==void 0&&(_=v=>i.cancel(v));let b=i.autoAllocateChunkSize;if(b===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");ua(r,l,d,m,_,o,b)}function Sc(r,i,o){r._associatedReadableByteStreamController=i,r._view=o}function cs(r){return new TypeError(`ReadableStreamBYOBRequest.prototype.${r} can only be used on a ReadableStreamBYOBRequest`)}function rr(r){return new TypeError(`ReadableByteStreamController.prototype.${r} can only be used on a ReadableByteStreamController`)}function la(r){return new nr(r)}function ca(r,i){r._reader._readIntoRequests.push(i)}function Tc(r,i,o){let d=r._reader._readIntoRequests.shift();o?d._closeSteps(i):d._chunkSteps(i)}function da(r){return r._reader._readIntoRequests.length}function ds(r){let i=r._reader;return!(i===void 0||!mt(i))}class nr{constructor(i){if(ze(i,1,"ReadableStreamBYOBReader"),ts(i,"First parameter"),tt(i))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!ft(i._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");ki(this,i),this._readIntoRequests=new ge}get closed(){return mt(this)?this._closedPromise:g($r("closed"))}cancel(i=void 0){return mt(this)?this._ownerReadableStream===void 0?g(Dt("cancel")):Yn(this,i):g($r("cancel"))}read(i){if(!mt(this))return g($r("read"));if(!ArrayBuffer.isView(i))return g(new TypeError("view must be an array buffer view"));if(i.byteLength===0)return g(new TypeError("view must have non-zero byteLength"));if(i.buffer.byteLength===0)return g(new TypeError("view's buffer must have non-zero byteLength"));if(xr(i.buffer),this._ownerReadableStream===void 0)return g(Dt("read from"));let o,l,d=P((_,b)=>{o=_,l=b});return fa(this,i,{_chunkSteps:_=>o({value:_,done:!1}),_closeSteps:_=>o({value:_,done:!0}),_errorSteps:_=>l(_)}),d}releaseLock(){if(!mt(this))throw $r("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Ue(this)}}}Object.defineProperties(nr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(nr.prototype,e.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function mt(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_readIntoRequests")?!1:r instanceof nr}function fa(r,i,o){let l=r._ownerReadableStream;l._disturbed=!0,l._state==="errored"?o._errorSteps(l._storedError):_c(l._readableStreamController,i,o)}function $r(r){return new TypeError(`ReadableStreamBYOBReader.prototype.${r} can only be used on a ReadableStreamBYOBReader`)}function sr(r,i){let{highWaterMark:o}=r;if(o===void 0)return i;if(Gi(o)||o<0)throw new RangeError("Invalid highWaterMark");return o}function Hr(r){let{size:i}=r;return i||(()=>1)}function Qr(r,i){We(r,i);let o=r==null?void 0:r.highWaterMark,l=r==null?void 0:r.size;return{highWaterMark:o===void 0?void 0:es(o),size:l===void 0?void 0:vc(l,`${i} has member 'size' that`)}}function vc(r,i){return be(r,i),o=>es(r(o))}function Rc(r,i){We(r,i);let o=r==null?void 0:r.abort,l=r==null?void 0:r.close,d=r==null?void 0:r.start,m=r==null?void 0:r.type,_=r==null?void 0:r.write;return{abort:o===void 0?void 0:Pc(o,r,`${i} has member 'abort' that`),close:l===void 0?void 0:qc(l,r,`${i} has member 'close' that`),start:d===void 0?void 0:Ac(d,r,`${i} has member 'start' that`),write:_===void 0?void 0:Dc(_,r,`${i} has member 'write' that`),type:m}}function Pc(r,i,o){return be(r,o),l=>dt(r,i,[l])}function qc(r,i,o){return be(r,o),()=>dt(r,i,[])}function Ac(r,i,o){return be(r,o),l=>xe(r,i,[l])}function Dc(r,i,o){return be(r,o),(l,d)=>dt(r,i,[l,d])}function ha(r,i){if(!Et(r))throw new TypeError(`${i} is not a WritableStream.`)}function Cc(r){if(typeof r!="object"||r===null)return!1;try{return typeof r.aborted=="boolean"}catch{return!1}}let Oc=typeof AbortController=="function";function Ec(){if(Oc)return new AbortController}class ir{constructor(i={},o={}){i===void 0?i=null:Ui(i,"First parameter");let l=Qr(o,"Second parameter"),d=Rc(i,"First parameter");if(pa(this),d.type!==void 0)throw new RangeError("Invalid type is specified");let _=Hr(l),b=sr(l,1);$c(this,d,b,_)}get locked(){if(!Et(this))throw Jr("locked");return Mt(this)}abort(i=void 0){return Et(this)?Mt(this)?g(new TypeError("Cannot abort a stream that already has a writer")):Yr(this,i):g(Jr("abort"))}close(){return Et(this)?Mt(this)?g(new TypeError("Cannot close a stream that already has a writer")):Ce(this)?g(new TypeError("Cannot close an already-closing stream")):_a(this):g(Jr("close"))}getWriter(){if(!Et(this))throw Jr("getWriter");return ma(this)}}Object.defineProperties(ir.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(ir.prototype,e.toStringTag,{value:"WritableStream",configurable:!0});function ma(r){return new ar(r)}function Mc(r,i,o,l,d=1,m=()=>1){let _=Object.create(ir.prototype);pa(_);let b=Object.create(Lt.prototype);return Ta(_,b,r,i,o,l,d,m),_}function pa(r){r._state="writable",r._storedError=void 0,r._writer=void 0,r._writableStreamController=void 0,r._writeRequests=new ge,r._inFlightWriteRequest=void 0,r._closeRequest=void 0,r._inFlightCloseRequest=void 0,r._pendingAbortRequest=void 0,r._backpressure=!1}function Et(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_writableStreamController")?!1:r instanceof ir}function Mt(r){return r._writer!==void 0}function Yr(r,i){var o;if(r._state==="closed"||r._state==="errored")return w(void 0);r._writableStreamController._abortReason=i,(o=r._writableStreamController._abortController)===null||o===void 0||o.abort();let l=r._state;if(l==="closed"||l==="errored")return w(void 0);if(r._pendingAbortRequest!==void 0)return r._pendingAbortRequest._promise;let d=!1;l==="erroring"&&(d=!0,i=void 0);let m=P((_,b)=>{r._pendingAbortRequest={_promise:void 0,_resolve:_,_reject:b,_reason:i,_wasAlreadyErroring:d}});return r._pendingAbortRequest._promise=m,d||hs(r,i),m}function _a(r){let i=r._state;if(i==="closed"||i==="errored")return g(new TypeError(`The stream (in ${i} state) is not in the writable state and cannot be closed`));let o=P((d,m)=>{let _={_resolve:d,_reject:m};r._closeRequest=_}),l=r._writer;return l!==void 0&&r._backpressure&&i==="writable"&&Ts(l),Hc(r._writableStreamController),o}function Lc(r){return P((o,l)=>{let d={_resolve:o,_reject:l};r._writeRequests.push(d)})}function fs(r,i){if(r._state==="writable"){hs(r,i);return}ms(r)}function hs(r,i){let o=r._writableStreamController;r._state="erroring",r._storedError=i;let l=r._writer;l!==void 0&&ba(l,i),!Fc(r)&&o._started&&ms(r)}function ms(r){r._state="errored",r._writableStreamController[Fi]();let i=r._storedError;if(r._writeRequests.forEach(d=>{d._reject(i)}),r._writeRequests=new ge,r._pendingAbortRequest===void 0){Kr(r);return}let o=r._pendingAbortRequest;if(r._pendingAbortRequest=void 0,o._wasAlreadyErroring){o._reject(i),Kr(r);return}let l=r._writableStreamController[Bi](o._reason);E(l,()=>{o._resolve(),Kr(r)},d=>{o._reject(d),Kr(r)})}function kc(r){r._inFlightWriteRequest._resolve(void 0),r._inFlightWriteRequest=void 0}function Ic(r,i){r._inFlightWriteRequest._reject(i),r._inFlightWriteRequest=void 0,fs(r,i)}function jc(r){r._inFlightCloseRequest._resolve(void 0),r._inFlightCloseRequest=void 0,r._state==="erroring"&&(r._storedError=void 0,r._pendingAbortRequest!==void 0&&(r._pendingAbortRequest._resolve(),r._pendingAbortRequest=void 0)),r._state="closed";let o=r._writer;o!==void 0&&qa(o)}function Bc(r,i){r._inFlightCloseRequest._reject(i),r._inFlightCloseRequest=void 0,r._pendingAbortRequest!==void 0&&(r._pendingAbortRequest._reject(i),r._pendingAbortRequest=void 0),fs(r,i)}function Ce(r){return!(r._closeRequest===void 0&&r._inFlightCloseRequest===void 0)}function Fc(r){return!(r._inFlightWriteRequest===void 0&&r._inFlightCloseRequest===void 0)}function xc(r){r._inFlightCloseRequest=r._closeRequest,r._closeRequest=void 0}function Uc(r){r._inFlightWriteRequest=r._writeRequests.shift()}function Kr(r){r._closeRequest!==void 0&&(r._closeRequest._reject(r._storedError),r._closeRequest=void 0);let i=r._writer;i!==void 0&&ws(i,r._storedError)}function ps(r,i){let o=r._writer;o!==void 0&&i!==r._backpressure&&(i?Zc(o):Ts(o)),r._backpressure=i}class ar{constructor(i){if(ze(i,1,"WritableStreamDefaultWriter"),ha(i,"First parameter"),Mt(i))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=i,i._writer=this;let o=i._state;if(o==="writable")!Ce(i)&&i._backpressure?en(this):Aa(this),Zr(this);else if(o==="erroring")Ss(this,i._storedError),Zr(this);else if(o==="closed")Aa(this),Xc(this);else{let l=i._storedError;Ss(this,l),Pa(this,l)}}get closed(){return pt(this)?this._closedPromise:g(_t("closed"))}get desiredSize(){if(!pt(this))throw _t("desiredSize");if(this._ownerWritableStream===void 0)throw or("desiredSize");return Vc(this)}get ready(){return pt(this)?this._readyPromise:g(_t("ready"))}abort(i=void 0){return pt(this)?this._ownerWritableStream===void 0?g(or("abort")):Wc(this,i):g(_t("abort"))}close(){if(!pt(this))return g(_t("close"));let i=this._ownerWritableStream;return i===void 0?g(or("close")):Ce(i)?g(new TypeError("Cannot close an already-closing stream")):ga(this)}releaseLock(){if(!pt(this))throw _t("releaseLock");this._ownerWritableStream!==void 0&&ya(this)}write(i=void 0){return pt(this)?this._ownerWritableStream===void 0?g(or("write to")):wa(this,i):g(_t("write"))}}Object.defineProperties(ar.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(ar.prototype,e.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function pt(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_ownerWritableStream")?!1:r instanceof ar}function Wc(r,i){let o=r._ownerWritableStream;return Yr(o,i)}function ga(r){let i=r._ownerWritableStream;return _a(i)}function zc(r){let i=r._ownerWritableStream,o=i._state;return Ce(i)||o==="closed"?w(void 0):o==="errored"?g(i._storedError):ga(r)}function Nc(r,i){r._closedPromiseState==="pending"?ws(r,i):Jc(r,i)}function ba(r,i){r._readyPromiseState==="pending"?Da(r,i):ed(r,i)}function Vc(r){let i=r._ownerWritableStream,o=i._state;return o==="errored"||o==="erroring"?null:o==="closed"?0:va(i._writableStreamController)}function ya(r){let i=r._ownerWritableStream,o=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");ba(r,o),Nc(r,o),i._writer=void 0,r._ownerWritableStream=void 0}function wa(r,i){let o=r._ownerWritableStream,l=o._writableStreamController,d=Qc(l,i);if(o!==r._ownerWritableStream)return g(or("write to"));let m=o._state;if(m==="errored")return g(o._storedError);if(Ce(o)||m==="closed")return g(new TypeError("The stream is closing or closed and cannot be written to"));if(m==="erroring")return g(o._storedError);let _=Lc(o);return Yc(l,i,d),_}let Sa={};class Lt{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!_s(this))throw ys("abortReason");return this._abortReason}get signal(){if(!_s(this))throw ys("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(i=void 0){if(!_s(this))throw ys("error");this._controlledWritableStream._state==="writable"&&Ra(this,i)}[Bi](i){let o=this._abortAlgorithm(i);return Gr(this),o}[Fi](){Xe(this)}}Object.defineProperties(Lt.prototype,{error:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Lt.prototype,e.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function _s(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_controlledWritableStream")?!1:r instanceof Lt}function Ta(r,i,o,l,d,m,_,b){i._controlledWritableStream=r,r._writableStreamController=i,i._queue=void 0,i._queueTotalSize=void 0,Xe(i),i._abortReason=void 0,i._abortController=Ec(),i._started=!1,i._strategySizeAlgorithm=b,i._strategyHWM=_,i._writeAlgorithm=l,i._closeAlgorithm=d,i._abortAlgorithm=m;let v=bs(i);ps(r,v);let D=o(),j=w(D);E(j,()=>{i._started=!0,Xr(i)},L=>{i._started=!0,fs(r,L)})}function $c(r,i,o,l){let d=Object.create(Lt.prototype),m=()=>{},_=()=>w(void 0),b=()=>w(void 0),v=()=>w(void 0);i.start!==void 0&&(m=()=>i.start(d)),i.write!==void 0&&(_=D=>i.write(D,d)),i.close!==void 0&&(b=()=>i.close()),i.abort!==void 0&&(v=D=>i.abort(D)),Ta(r,d,m,_,b,v,o,l)}function Gr(r){r._writeAlgorithm=void 0,r._closeAlgorithm=void 0,r._abortAlgorithm=void 0,r._strategySizeAlgorithm=void 0}function Hc(r){ss(r,Sa,0),Xr(r)}function Qc(r,i){try{return r._strategySizeAlgorithm(i)}catch(o){return gs(r,o),1}}function va(r){return r._strategyHWM-r._queueTotalSize}function Yc(r,i,o){try{ss(r,i,o)}catch(d){gs(r,d);return}let l=r._controlledWritableStream;if(!Ce(l)&&l._state==="writable"){let d=bs(r);ps(l,d)}Xr(r)}function Xr(r){let i=r._controlledWritableStream;if(!r._started||i._inFlightWriteRequest!==void 0)return;if(i._state==="erroring"){ms(i);return}if(r._queue.length===0)return;let l=pc(r);l===Sa?Kc(r):Gc(r,l)}function gs(r,i){r._controlledWritableStream._state==="writable"&&Ra(r,i)}function Kc(r){let i=r._controlledWritableStream;xc(i),ns(r);let o=r._closeAlgorithm();Gr(r),E(o,()=>{jc(i)},l=>{Bc(i,l)})}function Gc(r,i){let o=r._controlledWritableStream;Uc(o);let l=r._writeAlgorithm(i);E(l,()=>{kc(o);let d=o._state;if(ns(r),!Ce(o)&&d==="writable"){let m=bs(r);ps(o,m)}Xr(r)},d=>{o._state==="writable"&&Gr(r),Ic(o,d)})}function bs(r){return va(r)<=0}function Ra(r,i){let o=r._controlledWritableStream;Gr(r),hs(o,i)}function Jr(r){return new TypeError(`WritableStream.prototype.${r} can only be used on a WritableStream`)}function ys(r){return new TypeError(`WritableStreamDefaultController.prototype.${r} can only be used on a WritableStreamDefaultController`)}function _t(r){return new TypeError(`WritableStreamDefaultWriter.prototype.${r} can only be used on a WritableStreamDefaultWriter`)}function or(r){return new TypeError("Cannot "+r+" a stream using a released writer")}function Zr(r){r._closedPromise=P((i,o)=>{r._closedPromise_resolve=i,r._closedPromise_reject=o,r._closedPromiseState="pending"})}function Pa(r,i){Zr(r),ws(r,i)}function Xc(r){Zr(r),qa(r)}function ws(r,i){r._closedPromise_reject!==void 0&&(Fe(r._closedPromise),r._closedPromise_reject(i),r._closedPromise_resolve=void 0,r._closedPromise_reject=void 0,r._closedPromiseState="rejected")}function Jc(r,i){Pa(r,i)}function qa(r){r._closedPromise_resolve!==void 0&&(r._closedPromise_resolve(void 0),r._closedPromise_resolve=void 0,r._closedPromise_reject=void 0,r._closedPromiseState="resolved")}function en(r){r._readyPromise=P((i,o)=>{r._readyPromise_resolve=i,r._readyPromise_reject=o}),r._readyPromiseState="pending"}function Ss(r,i){en(r),Da(r,i)}function Aa(r){en(r),Ts(r)}function Da(r,i){r._readyPromise_reject!==void 0&&(Fe(r._readyPromise),r._readyPromise_reject(i),r._readyPromise_resolve=void 0,r._readyPromise_reject=void 0,r._readyPromiseState="rejected")}function Zc(r){en(r)}function ed(r,i){Ss(r,i)}function Ts(r){r._readyPromise_resolve!==void 0&&(r._readyPromise_resolve(void 0),r._readyPromise_resolve=void 0,r._readyPromise_reject=void 0,r._readyPromiseState="fulfilled")}let Ca=typeof DOMException<"u"?DOMException:void 0;function td(r){if(!(typeof r=="function"||typeof r=="object"))return!1;try{return new r,!0}catch{return!1}}function rd(){let r=function(o,l){this.message=o||"",this.name=l||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return r.prototype=Object.create(Error.prototype),Object.defineProperty(r.prototype,"constructor",{value:r,writable:!0,configurable:!0}),r}let nd=td(Ca)?Ca:rd();function Oa(r,i,o,l,d,m){let _=Ct(r),b=ma(i);r._disturbed=!0;let v=!1,D=w(void 0);return P((j,L)=>{let U;if(m!==void 0){if(U=()=>{let R=new nd("Aborted","AbortError"),O=[];l||O.push(()=>i._state==="writable"?Yr(i,R):w(void 0)),d||O.push(()=>r._state==="readable"?we(r,R):w(void 0)),X(()=>Promise.all(O.map(N=>N())),!0,R)},m.aborted){U();return}m.addEventListener("abort",U)}function rt(){return P((R,O)=>{function N(Se){Se?R():C(fr(),N,O)}N(!1)})}function fr(){return v?w(!0):C(b._readyPromise,()=>P((R,O)=>{Jt(_,{_chunkSteps:N=>{D=C(wa(b,N),void 0,t),R(!1)},_closeSteps:()=>R(!0),_errorSteps:O})}))}if(G(r,_._closedPromise,R=>{l?k(!0,R):X(()=>Yr(i,R),!0,R)}),G(i,b._closedPromise,R=>{d?k(!0,R):X(()=>we(r,R),!0,R)}),Oe(r,_._closedPromise,()=>{o?k():X(()=>zc(b))}),Ce(i)||i._state==="closed"){let R=new TypeError("the destination writable stream closed before all data could be piped to it");d?k(!0,R):X(()=>we(r,R),!0,R)}Fe(rt());function nt(){let R=D;return C(D,()=>R!==D?nt():void 0)}function G(R,O,N){R._state==="errored"?N(R._storedError):De(O,N)}function Oe(R,O,N){R._state==="closed"?N():ue(O,N)}function X(R,O,N){if(v)return;v=!0,i._state==="writable"&&!Ce(i)?ue(nt(),Se):Se();function Se(){E(R(),()=>F(O,N),st=>F(!0,st))}}function k(R,O){v||(v=!0,i._state==="writable"&&!Ce(i)?ue(nt(),()=>F(R,O)):F(R,O))}function F(R,O){ya(b),Ue(_),m!==void 0&&m.removeEventListener("abort",U),R?L(O):j(void 0)}})}class kt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!tn(this))throw sn("desiredSize");return vs(this)}close(){if(!tn(this))throw sn("close");if(!It(this))throw new TypeError("The stream is not in a state that permits close");lr(this)}enqueue(i=void 0){if(!tn(this))throw sn("enqueue");if(!It(this))throw new TypeError("The stream is not in a state that permits enqueue");return nn(this,i)}error(i=void 0){if(!tn(this))throw sn("error");Je(this,i)}[Xn](i){Xe(this);let o=this._cancelAlgorithm(i);return rn(this),o}[Jn](i){let o=this._controlledReadableStream;if(this._queue.length>0){let l=ns(this);this._closeRequested&&this._queue.length===0?(rn(this),cr(o)):ur(this),i._chunkSteps(l)}else Ni(o,i),ur(this)}}Object.defineProperties(kt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(kt.prototype,e.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function tn(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_controlledReadableStream")?!1:r instanceof kt}function ur(r){if(!Ea(r))return;if(r._pulling){r._pullAgain=!0;return}r._pulling=!0;let o=r._pullAlgorithm();E(o,()=>{r._pulling=!1,r._pullAgain&&(r._pullAgain=!1,ur(r))},l=>{Je(r,l)})}function Ea(r){let i=r._controlledReadableStream;return!It(r)||!r._started?!1:!!(tt(i)&&Br(i)>0||vs(r)>0)}function rn(r){r._pullAlgorithm=void 0,r._cancelAlgorithm=void 0,r._strategySizeAlgorithm=void 0}function lr(r){if(!It(r))return;let i=r._controlledReadableStream;r._closeRequested=!0,r._queue.length===0&&(rn(r),cr(i))}function nn(r,i){if(!It(r))return;let o=r._controlledReadableStream;if(tt(o)&&Br(o)>0)rs(o,i,!1);else{let l;try{l=r._strategySizeAlgorithm(i)}catch(d){throw Je(r,d),d}try{ss(r,i,l)}catch(d){throw Je(r,d),d}}ur(r)}function Je(r,i){let o=r._controlledReadableStream;o._state==="readable"&&(Xe(r),rn(r),Ia(o,i))}function vs(r){let i=r._controlledReadableStream._state;return i==="errored"?null:i==="closed"?0:r._strategyHWM-r._queueTotalSize}function sd(r){return!Ea(r)}function It(r){let i=r._controlledReadableStream._state;return!r._closeRequested&&i==="readable"}function Ma(r,i,o,l,d,m,_){i._controlledReadableStream=r,i._queue=void 0,i._queueTotalSize=void 0,Xe(i),i._started=!1,i._closeRequested=!1,i._pullAgain=!1,i._pulling=!1,i._strategySizeAlgorithm=_,i._strategyHWM=m,i._pullAlgorithm=l,i._cancelAlgorithm=d,r._readableStreamController=i;let b=o();E(w(b),()=>{i._started=!0,ur(i)},v=>{Je(i,v)})}function id(r,i,o,l){let d=Object.create(kt.prototype),m=()=>{},_=()=>w(void 0),b=()=>w(void 0);i.start!==void 0&&(m=()=>i.start(d)),i.pull!==void 0&&(_=()=>i.pull(d)),i.cancel!==void 0&&(b=v=>i.cancel(v)),Ma(r,d,m,_,b,o,l)}function sn(r){return new TypeError(`ReadableStreamDefaultController.prototype.${r} can only be used on a ReadableStreamDefaultController`)}function ad(r,i){return ft(r._readableStreamController)?ud(r):od(r)}function od(r,i){let o=Ct(r),l=!1,d=!1,m=!1,_,b,v,D,j,L=P(G=>{j=G});function U(){return l||(l=!0,Jt(o,{_chunkSteps:Oe=>{_e(()=>{l=!1;let X=Oe,k=Oe;d||nn(v._readableStreamController,X),m||nn(D._readableStreamController,k)})},_closeSteps:()=>{l=!1,d||lr(v._readableStreamController),m||lr(D._readableStreamController),(!d||!m)&&j(void 0)},_errorSteps:()=>{l=!1}})),w(void 0)}function rt(G){if(d=!0,_=G,m){let Oe=Zt([_,b]),X=we(r,Oe);j(X)}return L}function fr(G){if(m=!0,b=G,d){let Oe=Zt([_,b]),X=we(r,Oe);j(X)}return L}function nt(){}return v=Rs(nt,U,rt),D=Rs(nt,U,fr),De(o._closedPromise,G=>{Je(v._readableStreamController,G),Je(D._readableStreamController,G),(!d||!m)&&j(void 0)}),[v,D]}function ud(r){let i=Ct(r),o=!1,l=!1,d=!1,m,_,b,v,D,j=P(k=>{D=k});function L(k){De(k._closedPromise,F=>{k===i&&(ye(b._readableStreamController,F),ye(v._readableStreamController,F),(!l||!d)&&D(void 0))})}function U(){mt(i)&&(Ue(i),i=Ct(r),L(i)),Jt(i,{_chunkSteps:F=>{_e(()=>{o=!1;let R=F,O=F;if(!l&&!d)try{O=Zi(F)}catch(N){ye(b._readableStreamController,N),ye(v._readableStreamController,N),D(we(r,N));return}l||zr(b._readableStreamController,R),d||zr(v._readableStreamController,O)})},_closeSteps:()=>{o=!1,l||tr(b._readableStreamController),d||tr(v._readableStreamController),b._readableStreamController._pendingPullIntos.length>0&&Nr(b._readableStreamController,0),v._readableStreamController._pendingPullIntos.length>0&&Nr(v._readableStreamController,0),(!l||!d)&&D(void 0)},_errorSteps:()=>{o=!1}})}function rt(k,F){Ge(i)&&(Ue(i),i=la(r),L(i));let R=F?v:b,O=F?b:v;fa(i,k,{_chunkSteps:Se=>{_e(()=>{o=!1;let st=F?d:l;if(F?l:d)st||Vr(R._readableStreamController,Se);else{let Ya;try{Ya=Zi(Se)}catch(qs){ye(R._readableStreamController,qs),ye(O._readableStreamController,qs),D(we(r,qs));return}st||Vr(R._readableStreamController,Se),zr(O._readableStreamController,Ya)}})},_closeSteps:Se=>{o=!1;let st=F?d:l,mn=F?l:d;st||tr(R._readableStreamController),mn||tr(O._readableStreamController),Se!==void 0&&(st||Vr(R._readableStreamController,Se),!mn&&O._readableStreamController._pendingPullIntos.length>0&&Nr(O._readableStreamController,0)),(!st||!mn)&&D(void 0)},_errorSteps:()=>{o=!1}})}function fr(){if(o)return w(void 0);o=!0;let k=ls(b._readableStreamController);return k===null?U():rt(k._view,!1),w(void 0)}function nt(){if(o)return w(void 0);o=!0;let k=ls(v._readableStreamController);return k===null?U():rt(k._view,!0),w(void 0)}function G(k){if(l=!0,m=k,d){let F=Zt([m,_]),R=we(r,F);D(R)}return j}function Oe(k){if(d=!0,_=k,l){let F=Zt([m,_]),R=we(r,F);D(R)}return j}function X(){}return b=ka(X,fr,G),v=ka(X,nt,Oe),L(i),[b,v]}function ld(r,i){We(r,i);let o=r,l=o==null?void 0:o.autoAllocateChunkSize,d=o==null?void 0:o.cancel,m=o==null?void 0:o.pull,_=o==null?void 0:o.start,b=o==null?void 0:o.type;return{autoAllocateChunkSize:l===void 0?void 0:zi(l,`${i} has member 'autoAllocateChunkSize' that`),cancel:d===void 0?void 0:cd(d,o,`${i} has member 'cancel' that`),pull:m===void 0?void 0:dd(m,o,`${i} has member 'pull' that`),start:_===void 0?void 0:fd(_,o,`${i} has member 'start' that`),type:b===void 0?void 0:hd(b,`${i} has member 'type' that`)}}function cd(r,i,o){return be(r,o),l=>dt(r,i,[l])}function dd(r,i,o){return be(r,o),l=>dt(r,i,[l])}function fd(r,i,o){return be(r,o),l=>xe(r,i,[l])}function hd(r,i){if(r=`${r}`,r!=="bytes")throw new TypeError(`${i} '${r}' is not a valid enumeration value for ReadableStreamType`);return r}function md(r,i){We(r,i);let o=r==null?void 0:r.mode;return{mode:o===void 0?void 0:pd(o,`${i} has member 'mode' that`)}}function pd(r,i){if(r=`${r}`,r!=="byob")throw new TypeError(`${i} '${r}' is not a valid enumeration value for ReadableStreamReaderMode`);return r}function _d(r,i){We(r,i);let o=r==null?void 0:r.preventCancel;return{preventCancel:Boolean(o)}}function La(r,i){We(r,i);let o=r==null?void 0:r.preventAbort,l=r==null?void 0:r.preventCancel,d=r==null?void 0:r.preventClose,m=r==null?void 0:r.signal;return m!==void 0&&gd(m,`${i} has member 'signal' that`),{preventAbort:Boolean(o),preventCancel:Boolean(l),preventClose:Boolean(d),signal:m}}function gd(r,i){if(!Cc(r))throw new TypeError(`${i} is not an AbortSignal.`)}function bd(r,i){We(r,i);let o=r==null?void 0:r.readable;Zn(o,"readable","ReadableWritablePair"),ts(o,`${i} has member 'readable' that`);let l=r==null?void 0:r.writable;return Zn(l,"writable","ReadableWritablePair"),ha(l,`${i} has member 'writable' that`),{readable:o,writable:l}}class Ze{constructor(i={},o={}){i===void 0?i=null:Ui(i,"First parameter");let l=Qr(o,"Second parameter"),d=ld(i,"First parameter");if(Ps(this),d.type==="bytes"){if(l.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let m=sr(l,0);wc(this,d,m)}else{let m=Hr(l),_=sr(l,1);id(this,d,_,m)}}get locked(){if(!et(this))throw gt("locked");return tt(this)}cancel(i=void 0){return et(this)?tt(this)?g(new TypeError("Cannot cancel a stream that already has a reader")):we(this,i):g(gt("cancel"))}getReader(i=void 0){if(!et(this))throw gt("getReader");return md(i,"First parameter").mode===void 0?Ct(this):la(this)}pipeThrough(i,o={}){if(!et(this))throw gt("pipeThrough");ze(i,1,"pipeThrough");let l=bd(i,"First parameter"),d=La(o,"Second parameter");if(tt(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Mt(l.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let m=Oa(this,l.writable,d.preventClose,d.preventAbort,d.preventCancel,d.signal);return Fe(m),l.readable}pipeTo(i,o={}){if(!et(this))return g(gt("pipeTo"));if(i===void 0)return g("Parameter 1 is required in 'pipeTo'.");if(!Et(i))return g(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let l;try{l=La(o,"Second parameter")}catch(d){return g(d)}return tt(this)?g(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Mt(i)?g(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Oa(this,i,l.preventClose,l.preventAbort,l.preventCancel,l.signal)}tee(){if(!et(this))throw gt("tee");let i=ad(this);return Zt(i)}values(i=void 0){if(!et(this))throw gt("values");let o=_d(i,"First parameter");return hc(this,o.preventCancel)}}Object.defineProperties(Ze.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Ze.prototype,e.toStringTag,{value:"ReadableStream",configurable:!0}),typeof e.asyncIterator=="symbol"&&Object.defineProperty(Ze.prototype,e.asyncIterator,{value:Ze.prototype.values,writable:!0,configurable:!0});function Rs(r,i,o,l=1,d=()=>1){let m=Object.create(Ze.prototype);Ps(m);let _=Object.create(kt.prototype);return Ma(m,_,r,i,o,l,d),m}function ka(r,i,o){let l=Object.create(Ze.prototype);Ps(l);let d=Object.create(Ot.prototype);return ua(l,d,r,i,o,0,void 0),l}function Ps(r){r._state="readable",r._reader=void 0,r._storedError=void 0,r._disturbed=!1}function et(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_readableStreamController")?!1:r instanceof Ze}function tt(r){return r._reader!==void 0}function we(r,i){if(r._disturbed=!0,r._state==="closed")return w(void 0);if(r._state==="errored")return g(r._storedError);cr(r);let o=r._reader;o!==void 0&&mt(o)&&(o._readIntoRequests.forEach(d=>{d._closeSteps(void 0)}),o._readIntoRequests=new ge);let l=r._readableStreamController[Xn](i);return Be(l,t)}function cr(r){r._state="closed";let i=r._reader;i!==void 0&&(ji(i),Ge(i)&&(i._readRequests.forEach(o=>{o._closeSteps()}),i._readRequests=new ge))}function Ia(r,i){r._state="errored",r._storedError=i;let o=r._reader;o!==void 0&&(Gn(o,i),Ge(o)?(o._readRequests.forEach(l=>{l._errorSteps(i)}),o._readRequests=new ge):(o._readIntoRequests.forEach(l=>{l._errorSteps(i)}),o._readIntoRequests=new ge))}function gt(r){return new TypeError(`ReadableStream.prototype.${r} can only be used on a ReadableStream`)}function ja(r,i){We(r,i);let o=r==null?void 0:r.highWaterMark;return Zn(o,"highWaterMark","QueuingStrategyInit"),{highWaterMark:es(o)}}let Ba=r=>r.byteLength;Object.defineProperty(Ba,"name",{value:"size",configurable:!0});class an{constructor(i){ze(i,1,"ByteLengthQueuingStrategy"),i=ja(i,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!xa(this))throw Fa("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!xa(this))throw Fa("size");return Ba}}Object.defineProperties(an.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(an.prototype,e.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Fa(r){return new TypeError(`ByteLengthQueuingStrategy.prototype.${r} can only be used on a ByteLengthQueuingStrategy`)}function xa(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_byteLengthQueuingStrategyHighWaterMark")?!1:r instanceof an}let Ua=()=>1;Object.defineProperty(Ua,"name",{value:"size",configurable:!0});class on{constructor(i){ze(i,1,"CountQueuingStrategy"),i=ja(i,"First parameter"),this._countQueuingStrategyHighWaterMark=i.highWaterMark}get highWaterMark(){if(!za(this))throw Wa("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!za(this))throw Wa("size");return Ua}}Object.defineProperties(on.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(on.prototype,e.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function Wa(r){return new TypeError(`CountQueuingStrategy.prototype.${r} can only be used on a CountQueuingStrategy`)}function za(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_countQueuingStrategyHighWaterMark")?!1:r instanceof on}function yd(r,i){We(r,i);let o=r==null?void 0:r.flush,l=r==null?void 0:r.readableType,d=r==null?void 0:r.start,m=r==null?void 0:r.transform,_=r==null?void 0:r.writableType;return{flush:o===void 0?void 0:wd(o,r,`${i} has member 'flush' that`),readableType:l,start:d===void 0?void 0:Sd(d,r,`${i} has member 'start' that`),transform:m===void 0?void 0:Td(m,r,`${i} has member 'transform' that`),writableType:_}}function wd(r,i,o){return be(r,o),l=>dt(r,i,[l])}function Sd(r,i,o){return be(r,o),l=>xe(r,i,[l])}function Td(r,i,o){return be(r,o),(l,d)=>dt(r,i,[l,d])}class un{constructor(i={},o={},l={}){i===void 0&&(i=null);let d=Qr(o,"Second parameter"),m=Qr(l,"Third parameter"),_=yd(i,"First parameter");if(_.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(_.writableType!==void 0)throw new RangeError("Invalid writableType specified");let b=sr(m,0),v=Hr(m),D=sr(d,1),j=Hr(d),L,U=P(rt=>{L=rt});vd(this,U,D,j,b,v),Pd(this,_),_.start!==void 0?L(_.start(this._transformStreamController)):L(void 0)}get readable(){if(!Na(this))throw Qa("readable");return this._readable}get writable(){if(!Na(this))throw Qa("writable");return this._writable}}Object.defineProperties(un.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(un.prototype,e.toStringTag,{value:"TransformStream",configurable:!0});function vd(r,i,o,l,d,m){function _(){return i}function b(U){return Dd(r,U)}function v(U){return Cd(r,U)}function D(){return Od(r)}r._writable=Mc(_,b,D,v,o,l);function j(){return Ed(r)}function L(U){return cn(r,U),w(void 0)}r._readable=Rs(_,j,L,d,m),r._backpressure=void 0,r._backpressureChangePromise=void 0,r._backpressureChangePromise_resolve=void 0,dn(r,!0),r._transformStreamController=void 0}function Na(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_transformStreamController")?!1:r instanceof un}function ln(r,i){Je(r._readable._readableStreamController,i),cn(r,i)}function cn(r,i){Va(r._transformStreamController),gs(r._writable._writableStreamController,i),r._backpressure&&dn(r,!1)}function dn(r,i){r._backpressureChangePromise!==void 0&&r._backpressureChangePromise_resolve(),r._backpressureChangePromise=P(o=>{r._backpressureChangePromise_resolve=o}),r._backpressure=i}class dr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!fn(this))throw hn("desiredSize");let i=this._controlledTransformStream._readable._readableStreamController;return vs(i)}enqueue(i=void 0){if(!fn(this))throw hn("enqueue");$a(this,i)}error(i=void 0){if(!fn(this))throw hn("error");qd(this,i)}terminate(){if(!fn(this))throw hn("terminate");Ad(this)}}Object.defineProperties(dr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(dr.prototype,e.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function fn(r){return!u(r)||!Object.prototype.hasOwnProperty.call(r,"_controlledTransformStream")?!1:r instanceof dr}function Rd(r,i,o,l){i._controlledTransformStream=r,r._transformStreamController=i,i._transformAlgorithm=o,i._flushAlgorithm=l}function Pd(r,i){let o=Object.create(dr.prototype),l=m=>{try{return $a(o,m),w(void 0)}catch(_){return g(_)}},d=()=>w(void 0);i.transform!==void 0&&(l=m=>i.transform(m,o)),i.flush!==void 0&&(d=()=>i.flush(o)),Rd(r,o,l,d)}function Va(r){r._transformAlgorithm=void 0,r._flushAlgorithm=void 0}function $a(r,i){let o=r._controlledTransformStream,l=o._readable._readableStreamController;if(!It(l))throw new TypeError("Readable side is not in a state that permits enqueue");try{nn(l,i)}catch(m){throw cn(o,m),o._readable._storedError}sd(l)!==o._backpressure&&dn(o,!0)}function qd(r,i){ln(r._controlledTransformStream,i)}function Ha(r,i){let o=r._transformAlgorithm(i);return Be(o,void 0,l=>{throw ln(r._controlledTransformStream,l),l})}function Ad(r){let i=r._controlledTransformStream,o=i._readable._readableStreamController;lr(o);let l=new TypeError("TransformStream terminated");cn(i,l)}function Dd(r,i){let o=r._transformStreamController;if(r._backpressure){let l=r._backpressureChangePromise;return Be(l,()=>{let d=r._writable;if(d._state==="erroring")throw d._storedError;return Ha(o,i)})}return Ha(o,i)}function Cd(r,i){return ln(r,i),w(void 0)}function Od(r){let i=r._readable,o=r._transformStreamController,l=o._flushAlgorithm();return Va(o),Be(l,()=>{if(i._state==="errored")throw i._storedError;lr(i._readableStreamController)},d=>{throw ln(r,d),i._storedError})}function Ed(r){return dn(r,!1),r._backpressureChangePromise}function hn(r){return new TypeError(`TransformStreamDefaultController.prototype.${r} can only be used on a TransformStreamDefaultController`)}function Qa(r){return new TypeError(`TransformStream.prototype.${r} can only be used on a TransformStream`)}n.ByteLengthQueuingStrategy=an,n.CountQueuingStrategy=on,n.ReadableByteStreamController=Ot,n.ReadableStream=Ze,n.ReadableStreamBYOBReader=nr,n.ReadableStreamBYOBRequest=er,n.ReadableStreamDefaultController=kt,n.ReadableStreamDefaultReader=Xt,n.TransformStream=un,n.TransformStreamDefaultController=dr,n.WritableStream=ir,n.WritableStreamDefaultController=Lt,n.WritableStreamDefaultWriter=ar,Object.defineProperty(n,"__esModule",{value:!0})})});var Dl=y(()=>{if(!globalThis.ReadableStream)try{Object.assign(globalThis,require("stream/web"))}catch{Object.assign(globalThis,Al())}try{let{Blob:n}=require("buffer");n&&!n.prototype.stream&&(n.prototype.stream=function(t){let s=0,a=this;return new ReadableStream({type:"bytes",async pull(u){let c=await a.slice(s,Math.min(a.size,s+65536)).arrayBuffer();s+=c.byteLength,u.enqueue(new Uint8Array(c)),s===a.size&&u.close()}})})}catch{}});var bm={};Fd(bm,{default:()=>ac});var Za=require("@raycast/api");function eo(){let n=(0,Za.getPreferenceValues)(),e=n.appkey||"",t=n.appsecret||"",s=n.accesstoken||"",a=n.accesssecret||"";return e.length>0||t.length>0||s.length>0||a.length>0?(console.log("use v1"),!1):(console.log("use v2"),!0)}var q=require("@raycast/api"),Fn=require("react");var bl=require("@raycast/api"),yl=require("react"),wl=Ee(yi());function Qt(n){return n instanceof Error?n.message:"unknown error"}var kp=new Intl.NumberFormat("en",{notation:"compact"});function em(){let n=(0,bl.getPreferenceValues)(),e=n.appkey||"",t=n.appsecret||"",s=n.accesstoken||"",a=n.accesssecret||"";return new wl.TwitterApi({appKey:e,appSecret:t,accessToken:s,accessSecret:a})}var wi=null;function Si(){return wi||(wi=em()),wi}function tm(n){let e=n.text,t=Sl(e);return _jsx(q.Form.Description,{text:`${e.length}/280 ${t?"\u2705":"\u274C"}`})}function rm(n){let e=n.index,t=n.content,s=e===0?"What's happening?":"Another Tweet";return _jsx(Fn.Fragment,null,_jsx(q.Form.TextArea,{id:`${e}`,title:`Tweet ${e>0?e+1:""}`,placeholder:s,value:t.text,onChange:a=>n.onTextChange(a,e)}),_jsx(tm,{text:t.text}))}function Sl(n){let e=n.length;return!(e<1||e>280)}function nm(n){return Sl(n.text)}function Tl(n){if(n.length<1)return!1;for(let e of n)if(!nm(e))return!1;return!0}async function sm(n){try{if(!Tl(n)){await(0,q.showToast)({style:q.Toast.Style.Failure,title:"Invalid Tweet",message:"Tweets are not valid"});return}if(n.length===1){let e=n[0];await Si().v1.tweet(e.text),await(0,q.showToast)({style:q.Toast.Style.Success,title:"Tweet created",message:"Tweet creation successful"}),(0,q.popToRoot)()}else{let e=n.map(t=>t.text);await Si().v1.tweetThread(e),await(0,q.showToast)({style:q.Toast.Style.Success,title:"Thread created",message:"Thread creation successful"}),(0,q.popToRoot)()}}catch(e){await(0,q.showToast)({style:q.Toast.Style.Failure,title:"Error",message:Qt(e)})}}function vl(){let[n,e]=(0,Fn.useState)([{text:""}]),t=()=>{let c=[...n,{text:""}];e(c)},s=n&&n.length>1?"Send Thread":"Send Tweet",a=async()=>{if(n.length>1){let c=n[n.length-1],h=!0;if(c.text.length>0&&(h=await(0,q.confirmAlert)({title:"Really remove last Tweet?",message:"You last tweet contain content, it will get lost",icon:"\u26A0\uFE0F"})),h){let S=[...n];S.pop(),e(S)}}},u=(c,h)=>{let S=[...n];S[h].text=c,e(S)},f=()=>{let c=[...n];for(let h=0;h<c.length;h++)c[h].text+=` ${h+1}/${c.length}`;e(c)};return _jsx(q.Form,{actions:_jsx(q.ActionPanel,null,_jsx(q.ActionPanel.Section,null,Tl(n)&&_jsx(q.Action.SubmitForm,{title:s,icon:"twitter.png",onSubmit:c=>sm(n)})),_jsx(q.ActionPanel.Section,{title:"Thread"},_jsx(q.Action,{title:"Add Tweet",onAction:t,icon:{source:q.Icon.Plus,tintColor:q.Color.PrimaryText},shortcut:{modifiers:["cmd"],key:"+"}}),n.length>1&&_jsx(q.Action,{title:"Remove last Tweet",onAction:a,icon:{source:q.Icon.Trash,tintColor:q.Color.Red},shortcut:{modifiers:["cmd"],key:"-"}}),n.length>1&&_jsx(q.Action,{title:"Add Tweet Numbers",onAction:f,icon:q.Icon.Document,shortcut:{modifiers:["cmd"],key:"n"}})))},n.map((c,h)=>_jsx(rm,{key:h,index:h,content:c,onTextChange:u})))}var A=require("@raycast/api"),Qn=require("react");var tc=require("react"),Gt=Ee(yi());var Oi=require("@raycast/api");var $l=Ee(require("http"),1),Hl=Ee(require("https"),1),At=Ee(require("zlib"),1),oe=Ee(require("stream"),1),Ql=Ee(Pl(),1);var pe=Ee(require("stream"),1),qi=require("util");var Qp=Ee(Dl(),1),Cl=65536;async function*Ti(n,e=!0){for(let t of n)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let s=t.byteOffset,a=t.byteOffset+t.byteLength;for(;s!==a;){let u=Math.min(a-s,Cl),f=t.buffer.slice(s,s+u);s+=f.byteLength,yield new Uint8Array(f)}}else yield t;else{let s=0;for(;s!==t.size;){let u=await t.slice(s,Math.min(t.size,s+Cl)).arrayBuffer();s+=u.byteLength,yield new Uint8Array(u)}}}var Ol=class vi{#e=[];#r="";#t=0;constructor(e=[],t={}){let s=0,a=e.map(f=>{let c;return ArrayBuffer.isView(f)?c=new Uint8Array(f.buffer.slice(f.byteOffset,f.byteOffset+f.byteLength)):f instanceof ArrayBuffer?c=new Uint8Array(f.slice(0)):f instanceof vi?c=f:c=new TextEncoder().encode(f),s+=ArrayBuffer.isView(c)?c.byteLength:c.size,c}),u=t.type===void 0?"":String(t.type);this.#r=/[^\u0020-\u007E]/.test(u)?"":u,this.#t=s,this.#e=a}get size(){return this.#t}get type(){return this.#r}async text(){let e=new TextDecoder,t="";for await(let s of Ti(this.#e,!1))t+=e.decode(s,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let s of Ti(this.#e,!1))e.set(s,t),t+=s.length;return e.buffer}stream(){let e=Ti(this.#e,!0);return new ReadableStream({type:"bytes",async pull(t){let s=await e.next();s.done?t.close():t.enqueue(s.value)}})}slice(e=0,t=this.size,s=""){let{size:a}=this,u=e<0?Math.max(a+e,0):Math.min(e,a),f=t<0?Math.max(a+t,0):Math.min(t,a),c=Math.max(f-u,0),h=this.#e,S=[],T=0;for(let w of h){if(T>=c)break;let g=ArrayBuffer.isView(w)?w.byteLength:w.size;if(u&&g<=u)u-=g,f-=g;else{let C;ArrayBuffer.isView(w)?(C=w.subarray(u,Math.min(g,f)),T+=C.byteLength):(C=w.slice(u,Math.min(g,f)),T+=C.size),S.push(C),u=0}}let P=new vi([],{type:String(s).toLowerCase()});return P.#t=c,P.#e=S,P}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(Ol.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});var am=Ol,El=am;var lt=class extends Error{constructor(e,t){super(e);Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var me=class extends lt{constructor(e,t,s){super(e,t);s&&(this.code=this.errno=s.code,this.erroredSysCall=s.syscall)}};var Ll=require("crypto");var kr=Symbol.toStringTag,Ri=n=>typeof n=="object"&&typeof n.append=="function"&&typeof n.delete=="function"&&typeof n.get=="function"&&typeof n.getAll=="function"&&typeof n.has=="function"&&typeof n.set=="function"&&typeof n.sort=="function"&&n[kr]==="URLSearchParams",je=n=>typeof n=="object"&&typeof n.arrayBuffer=="function"&&typeof n.type=="string"&&typeof n.stream=="function"&&typeof n.constructor=="function"&&/^(Blob|File)$/.test(n[kr]);function Un(n){return typeof n=="object"&&typeof n.append=="function"&&typeof n.set=="function"&&typeof n.get=="function"&&typeof n.getAll=="function"&&typeof n.delete=="function"&&typeof n.keys=="function"&&typeof n.values=="function"&&typeof n.entries=="function"&&typeof n.constructor=="function"&&n[kr]==="FormData"}var Ml=n=>typeof n=="object"&&(n[kr]==="AbortSignal"||n[kr]==="EventTarget");var Yt=`\r
`,Pi="-".repeat(2),om=Buffer.byteLength(Yt),kl=n=>`${Pi}${n}${Pi}${Yt.repeat(2)}`;function Il(n,e,t){let s="";return s+=`${Pi}${n}${Yt}`,s+=`Content-Disposition: form-data; name="${e}"`,je(t)&&(s+=`; filename="${t.name}"${Yt}`,s+=`Content-Type: ${t.type||"application/octet-stream"}`),`${s}${Yt.repeat(2)}`}var jl=()=>(0,Ll.randomBytes)(8).toString("hex");async function*Bl(n,e){for(let[t,s]of n)yield Il(e,t,s),je(s)?yield*s.stream():yield s,yield Yt;yield kl(e)}function Fl(n,e){let t=0;for(let[s,a]of n)t+=Buffer.byteLength(Il(e,s,a)),t+=je(a)?a.size:Buffer.byteLength(String(a)),t+=om;return t+=Buffer.byteLength(kl(e)),t}var ie=Symbol("Body internals"),qt=class{constructor(e,{size:t=0}={}){let s=null;e===null?e=null:Ri(e)?e=Buffer.from(e.toString()):je(e)||Buffer.isBuffer(e)||(qi.types.isAnyArrayBuffer(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof pe.default||(Un(e)?(s=`NodeFetchFormDataBoundary${jl()}`,e=pe.default.Readable.from(Bl(e,s))):e=Buffer.from(String(e)))),this[ie]={body:e,boundary:s,disturbed:!1,error:null},this.size=t,e instanceof pe.default&&e.on("error",a=>{let u=a instanceof lt?a:new me(`Invalid response body while trying to fetch ${this.url}: ${a.message}`,"system",a);this[ie].error=u})}get body(){return this[ie].body}get bodyUsed(){return this[ie].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:s}=await Wn(this);return e.slice(t,t+s)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[ie].body&&this[ie].body.type||"",t=await this.buffer();return new El([t],{type:e})}async json(){let e=await Wn(this);return JSON.parse(e.toString())}async text(){return(await Wn(this)).toString()}buffer(){return Wn(this)}};Object.defineProperties(qt.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}});async function Wn(n){if(n[ie].disturbed)throw new TypeError(`body used already for: ${n.url}`);if(n[ie].disturbed=!0,n[ie].error)throw n[ie].error;let{body:e}=n;if(e===null)return Buffer.alloc(0);if(je(e)&&(e=pe.default.Readable.from(e.stream())),Buffer.isBuffer(e))return e;if(!(e instanceof pe.default))return Buffer.alloc(0);let t=[],s=0;try{for await(let a of e){if(n.size>0&&s+a.length>n.size){let u=new me(`content size at ${n.url} over limit: ${n.size}`,"max-size");throw e.destroy(u),u}s+=a.length,t.push(a)}}catch(a){throw a instanceof lt?a:new me(`Invalid response body while trying to fetch ${n.url}: ${a.message}`,"system",a)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(a=>typeof a=="string")?Buffer.from(t.join("")):Buffer.concat(t,s)}catch(a){throw new me(`Could not create Buffer from response body for ${n.url}: ${a.message}`,"system",a)}else throw new me(`Premature close of server response while trying to fetch ${n.url}`)}var zn=(n,e)=>{let t,s,{body:a}=n;if(n.bodyUsed)throw new Error("cannot clone body after it is used");return a instanceof pe.default&&typeof a.getBoundary!="function"&&(t=new pe.PassThrough({highWaterMark:e}),s=new pe.PassThrough({highWaterMark:e}),a.pipe(t),a.pipe(s),n[ie].body=t,a=s),a},Nn=(n,e)=>n===null?null:typeof n=="string"?"text/plain;charset=UTF-8":Ri(n)?"application/x-www-form-urlencoded;charset=UTF-8":je(n)?n.type||null:Buffer.isBuffer(n)||qi.types.isAnyArrayBuffer(n)||ArrayBuffer.isView(n)?null:n&&typeof n.getBoundary=="function"?`multipart/form-data;boundary=${n.getBoundary()}`:Un(n)?`multipart/form-data; boundary=${e[ie].boundary}`:n instanceof pe.default?null:"text/plain;charset=UTF-8",xl=n=>{let{body:e}=n;return e===null?0:je(e)?e.size:Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"?e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null:Un(e)?Fl(n[ie].boundary):null},Ul=(n,{body:e})=>{e===null?n.end():je(e)?pe.default.Readable.from(e.stream()).pipe(n):Buffer.isBuffer(e)?(n.write(e),n.end()):e.pipe(n)};var Ai=require("util"),Ir=Ee(require("http"),1),Vn=typeof Ir.default.validateHeaderName=="function"?Ir.default.validateHeaderName:n=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(n)){let e=new TypeError(`Header name must be a valid HTTP token [${n}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},Di=typeof Ir.default.validateHeaderValue=="function"?Ir.default.validateHeaderValue:(n,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${n}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},ae=class extends URLSearchParams{constructor(e){let t=[];if(e instanceof ae){let s=e.raw();for(let[a,u]of Object.entries(s))t.push(...u.map(f=>[a,f]))}else if(e!=null)if(typeof e=="object"&&!Ai.types.isBoxedPrimitive(e)){let s=e[Symbol.iterator];if(s==null)t.push(...Object.entries(e));else{if(typeof s!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(a=>{if(typeof a!="object"||Ai.types.isBoxedPrimitive(a))throw new TypeError("Each header pair must be an iterable object");return[...a]}).map(a=>{if(a.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...a]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");t=t.length>0?t.map(([s,a])=>(Vn(s),Di(s,String(a)),[String(s).toLowerCase(),String(a)])):void 0;super(t);return new Proxy(this,{get(s,a,u){switch(a){case"append":case"set":return(f,c)=>(Vn(f),Di(f,String(c)),URLSearchParams.prototype[a].call(s,String(f).toLowerCase(),String(c)));case"delete":case"has":case"getAll":return f=>(Vn(f),URLSearchParams.prototype[a].call(s,String(f).toLowerCase()));case"keys":return()=>(s.sort(),new Set(URLSearchParams.prototype.keys.call(s)).keys());default:return Reflect.get(s,a,u)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let s=t.join(", ");return/^content-encoding$/i.test(e)&&(s=s.toLowerCase()),s}forEach(e,t=void 0){for(let s of this.keys())Reflect.apply(e,t,[this.get(s),s,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let s=this.getAll(t);return t==="host"?e[t]=s[0]:e[t]=s.length>1?s:s[0],e},{})}};Object.defineProperties(ae.prototype,["get","entries","forEach","values"].reduce((n,e)=>(n[e]={enumerable:!0},n),{}));function Wl(n=[]){return new ae(n.reduce((e,t,s,a)=>(s%2===0&&e.push(a.slice(s,s+2)),e),[]).filter(([e,t])=>{try{return Vn(e),Di(e,String(t)),!0}catch{return!1}}))}var um=new Set([301,302,303,307,308]),$n=n=>um.has(n);var Ae=Symbol("Response internals"),ee=class extends qt{constructor(e=null,t={}){super(e,t);let s=t.status!=null?t.status:200,a=new ae(t.headers);if(e!==null&&!a.has("Content-Type")){let u=Nn(e);u&&a.append("Content-Type",u)}this[Ae]={type:"default",url:t.url,status:s,statusText:t.statusText||"",headers:a,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[Ae].type}get url(){return this[Ae].url||""}get status(){return this[Ae].status}get ok(){return this[Ae].status>=200&&this[Ae].status<300}get redirected(){return this[Ae].counter>0}get statusText(){return this[Ae].statusText}get headers(){return this[Ae].headers}get highWaterMark(){return this[Ae].highWaterMark}clone(){return new ee(zn(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size})}static redirect(e,t=302){if(!$n(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new ee(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new ee(null,{status:0,statusText:""});return e[Ae].type="error",e}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(ee.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var Nl=require("url");var zl=n=>{if(n.search)return n.search;let e=n.href.length-1,t=n.hash||(n.href[e]==="#"?"#":"");return n.href[e-t.length]==="?"?"?":""};var Ke=Symbol("Request internals"),Hn=n=>typeof n=="object"&&typeof n[Ke]=="object",ct=class extends qt{constructor(e,t={}){let s;Hn(e)?s=new URL(e.url):(s=new URL(e),e={});let a=t.method||e.method||"GET";if(a=a.toUpperCase(),(t.body!=null||Hn(e))&&e.body!==null&&(a==="GET"||a==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let u=t.body?t.body:Hn(e)&&e.body!==null?zn(e):null;super(u,{size:t.size||e.size||0});let f=new ae(t.headers||e.headers||{});if(u!==null&&!f.has("Content-Type")){let h=Nn(u,this);h&&f.append("Content-Type",h)}let c=Hn(e)?e.signal:null;if("signal"in t&&(c=t.signal),c!=null&&!Ml(c))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");this[Ke]={method:a,redirect:t.redirect||e.redirect||"follow",headers:f,parsedURL:s,signal:c},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1}get method(){return this[Ke].method}get url(){return(0,Nl.format)(this[Ke].parsedURL)}get headers(){return this[Ke].headers}get redirect(){return this[Ke].redirect}get signal(){return this[Ke].signal}clone(){return new ct(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(ct.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});var Vl=n=>{let{parsedURL:e}=n[Ke],t=new ae(n[Ke].headers);t.has("Accept")||t.set("Accept","*/*");let s=null;if(n.body===null&&/^(post|put)$/i.test(n.method)&&(s="0"),n.body!==null){let c=xl(n);typeof c=="number"&&!Number.isNaN(c)&&(s=String(c))}s&&t.set("Content-Length",s),t.has("User-Agent")||t.set("User-Agent","node-fetch"),n.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip,deflate,br");let{agent:a}=n;typeof a=="function"&&(a=a(e)),!t.has("Connection")&&!a&&t.set("Connection","close");let u=zl(e);return{path:e.pathname+u,pathname:e.pathname,hostname:e.hostname,protocol:e.protocol,port:e.port,hash:e.hash,search:e.search,query:e.query,href:e.href,method:n.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:n.insecureHTTPParser,agent:a}};var Ci=class extends lt{constructor(e,t="aborted"){super(e,t)}};var lm=new Set(["data:","http:","https:"]);async function jr(n,e){return new Promise((t,s)=>{let a=new ct(n,e),u=Vl(a);if(!lm.has(u.protocol))throw new TypeError(`node-fetch cannot load ${n}. URL scheme "${u.protocol.replace(/:$/,"")}" is not supported.`);if(u.protocol==="data:"){let g=(0,Ql.default)(a.url),C=new ee(g,{headers:{"Content-Type":g.typeFull}});t(C);return}let f=(u.protocol==="https:"?Hl.default:$l.default).request,{signal:c}=a,h=null,S=()=>{let g=new Ci("The operation was aborted.");s(g),a.body&&a.body instanceof oe.default.Readable&&a.body.destroy(g),!(!h||!h.body)&&h.body.emit("error",g)};if(c&&c.aborted){S();return}let T=()=>{S(),w()},P=f(u);c&&c.addEventListener("abort",T);let w=()=>{P.abort(),c&&c.removeEventListener("abort",T)};P.on("error",g=>{s(new me(`request to ${a.url} failed, reason: ${g.message}`,"system",g)),w()}),cm(P,g=>{h.body.destroy(g)}),process.version<"v14"&&P.on("socket",g=>{let C;g.prependListener("end",()=>{C=g._eventsCount}),g.prependListener("close",E=>{if(h&&C<g._eventsCount&&!E){let ue=new Error("Premature close");ue.code="ERR_STREAM_PREMATURE_CLOSE",h.body.emit("error",ue)}})}),P.on("response",g=>{P.setTimeout(0);let C=Wl(g.rawHeaders);if($n(g.statusCode)){let Fe=C.get("Location"),_e=Fe===null?null:new URL(Fe,a.url);switch(a.redirect){case"error":s(new me(`uri requested responds with a redirect, redirect mode is set to error: ${a.url}`,"no-redirect")),w();return;case"manual":_e!==null&&C.set("Location",_e);break;case"follow":{if(_e===null)break;if(a.counter>=a.follow){s(new me(`maximum redirect reached at: ${a.url}`,"max-redirect")),w();return}let xe={headers:new ae(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:a.body,signal:a.signal,size:a.size};if(g.statusCode!==303&&a.body&&e.body instanceof oe.default.Readable){s(new me("Cannot follow redirect with body being a readable stream","unsupported-redirect")),w();return}(g.statusCode===303||(g.statusCode===301||g.statusCode===302)&&a.method==="POST")&&(xe.method="GET",xe.body=void 0,xe.headers.delete("content-length")),t(jr(new ct(_e,xe))),w();return}default:return s(new TypeError(`Redirect option '${a.redirect}' is not a valid value of RequestRedirect`))}}c&&g.once("end",()=>{c.removeEventListener("abort",T)});let E=(0,oe.pipeline)(g,new oe.PassThrough,s);process.version<"v12.10"&&g.on("aborted",T);let ue={url:a.url,status:g.statusCode,statusText:g.statusMessage,headers:C,size:a.size,counter:a.counter,highWaterMark:a.highWaterMark},De=C.get("Content-Encoding");if(!a.compress||a.method==="HEAD"||De===null||g.statusCode===204||g.statusCode===304){h=new ee(E,ue),t(h);return}let Be={flush:At.default.Z_SYNC_FLUSH,finishFlush:At.default.Z_SYNC_FLUSH};if(De==="gzip"||De==="x-gzip"){E=(0,oe.pipeline)(E,At.default.createGunzip(Be),s),h=new ee(E,ue),t(h);return}if(De==="deflate"||De==="x-deflate"){(0,oe.pipeline)(g,new oe.PassThrough,s).once("data",_e=>{E=(_e[0]&15)===8?(0,oe.pipeline)(E,At.default.createInflate(),s):(0,oe.pipeline)(E,At.default.createInflateRaw(),s),h=new ee(E,ue),t(h)});return}if(De==="br"){E=(0,oe.pipeline)(E,At.default.createBrotliDecompress(),s),h=new ee(E,ue),t(h);return}h=new ee(E,ue),t(h)}),Ul(P,a)})}function cm(n,e){let t=Buffer.from(`0\r
\r
`),s=!1,a=!1,u;n.on("response",f=>{let{headers:c}=f;s=c["transfer-encoding"]==="chunked"&&!c["content-length"]}),n.on("socket",f=>{let c=()=>{if(s&&!a){let h=new Error("Premature close");h.code="ERR_STREAM_PREMATURE_CLOSE",e(h)}};f.prependListener("close",c),n.on("abort",()=>{f.removeListener("close",c)}),f.on("data",h=>{a=Buffer.compare(h.slice(-5),t)===0,!a&&u&&(a=Buffer.compare(u.slice(-3),t.slice(0,3))===0&&Buffer.compare(h.slice(-2),t.slice(3))===0),u=h})})}function Ei(){return"aHB6TFU2T3hid2stVjdFZ2ljanM6MTpjaQ"}var Kt=new Oi.OAuth.PKCEClient({redirectMethod:Oi.OAuth.RedirectMethod.Web,providerName:"Twitter",providerIcon:"twitter.png",providerId:"twitter",description:"Connect your Twitter account"});async function Yl(){let n=await Kt.getTokens();if(n?.accessToken){n.refreshToken&&n.isExpired()&&await Kt.setTokens(await fm(n.refreshToken));return}let e=await Kt.authorizationRequest({endpoint:"https://twitter.com/i/oauth2/authorize",clientId:Ei(),scope:"tweet.read tweet.write users.read follows.read like.read like.write offline.access"}),{authorizationCode:t}=await Kt.authorize(e);await Kt.setTokens(await dm(e,t))}async function dm(n,e){let t=new URLSearchParams;t.append("client_id",Ei()),t.append("code",e),t.append("code_verifier",n.codeVerifier),t.append("grant_type","authorization_code"),t.append("redirect_uri",n.redirectURI);let s=await jr("https://api.twitter.com/2/oauth2/token",{method:"POST",body:t});if(!s.ok)throw console.error("fetch tokens error:",await s.text()),new Error(s.statusText);return await s.json()}async function Kl(){return await Kt.getTokens()}async function fm(n){let e=new URLSearchParams;e.append("client_id",Ei()),e.append("refresh_token",n),e.append("grant_type","refresh_token");let t=await jr("https://api.twitter.com/2/oauth2/token",{method:"POST",body:e});if(!t.ok)throw console.error("refresh tokens error:",await t.text()),new Error(t.statusText);let s=await t.json();return s.refresh_token=s.refresh_token??n,s}var Gl=20,Xl=["public_metrics","author_id","attachments","created_at","id","entities","conversation_id"],Jl=["attachments.media_keys","author_id","in_reply_to_user_id","entities.mentions.username","referenced_tweets.id"],Zl=["url","type","media_key","preview_image_url"];function ec(n){return{id:n.id,name:n.name,username:n.username,profile_image_url:n.profile_image_url}}var rc=class{constructor(){this.userCache={}}async getAPI(){await Yl();let t=(await Kl())?.accessToken;return new Gt.TwitterApi(t||"")}async getUserAccount(e){if(e in this.userCache)return this.userCache[e];let s=await(await this.getAPI()).v2.user(e,{"user.fields":["profile_image_url"]}),a=ec(s.data);return this.userCache[e]=a,a}async prefetchUserAccounts(e){let t=[];for(let s of e)s.author_id&&!(s.author_id in this.userCache)&&t.push(s.author_id);if(t.length>0){let a=await(await this.getAPI()).v2.users(t,{"user.fields":["profile_image_url"]});for(let u of a.data){let f=ec(u);this.userCache[f.id]=f}}}async me(){if(this.meCache)return this.meCache;let t=await(await this.getAPI()).v2.me(),s={id:t.data.id,name:t.data.name,username:t.data.username,profile_image_url:t.data.profile_image_url};return this.meCache=s,s}async getMyTweets(){let t=await(await this.getAPI()).v2.me();return await this.getTweetsFromAuthor(t.data.id,["non_public_metrics","organic_metrics"])}async getTweetsFromAuthor(e,t){let s=await this.getAPI(),a=[...Xl];t&&a.push(...t);let u=await s.v2.userTimeline(e,{max_results:Gl,"tweet.fields":a,"media.fields":Zl,expansions:Jl}),f=new Gt.TwitterV2IncludesHelper(u),c=[];await this.prefetchUserAccounts(u);for(let h of u)c.push(await this.tweetV2ToTweet(h,f));return c}async tweetV2ToTweet(e,t){let s=e,a=t.medias(s),u;s.non_public_metrics&&(u={impression_count:s.non_public_metrics.impression_count,url_link_clicks:s.non_public_metrics.url_link_clicks});let f;s.organic_metrics&&(f={impression_count:s.organic_metrics.impression_count,url_link_clicks:s.organic_metrics.url_link_clicks,user_profile_clicks:s.organic_metrics.user_profile_clicks,retweet_count:s.organic_metrics.retweet_count,reply_count:s.organic_metrics.reply_count,like_count:s.organic_metrics.like_count});let c;if(a&&a.length>0){let S=a[0];S.type==="animated_gif"||S.type==="video"?c=S.preview_image_url:c=S.url}if(!s.author_id)throw Error("No author ID");return{id:s.id,text:s.text,created_at:s.created_at,conversation_id:s.conversation_id,source:s.source||"",image_url:c,user:await this.getUserAccount(s.author_id),quote_count:s.public_metrics?.quote_count||0,reply_count:s.public_metrics?.reply_count||0,retweet_count:s.public_metrics?.retweet_count||0,like_count:s.public_metrics?.like_count||0,non_public_metrics:u,organic_metrics:f}}async refreshTweets(e){if(e===void 0)return;let t=()=>e.length===e.filter(T=>T.non_public_metrics!==void 0).length,s=()=>e.length===e.filter(T=>T.organic_metrics!==void 0).length,a=await this.getAPI(),u=e.map(T=>T.id),f=[...Xl];t()&&f.push("non_public_metrics"),s()&&f.push("organic_metrics");let c=await a.v2.tweets(u,{"tweet.fields":f,"media.fields":Zl,expansions:Jl}),h=new Gt.TwitterV2IncludesHelper(c);return await Promise.all(c.data.map(async T=>await this.tweetV2ToTweet(T,h)))}async sendTweet(e){await(await this.getAPI()).v2.tweet(e)}async sendThread(e){await(await this.getAPI()).v2.tweetThread(e)}async replyTweetID(e,t){await(await this.getAPI()).v2.reply(e,t)}async replyTweet(e,t){await this.replyTweetID(e,t.id)}async retweet(e){let t=await this.getAPI(),s=await this.me();await t.v2.retweet(s.id,e.id)}async deleteTweetID(e){await(await this.getAPI()).v2.deleteTweet(e)}async deleteTweet(e){await this.deleteTweetID(e.id)}async likeTweet(e){let t=await this.getAPI(),s=await this.me();t.v2.like(s.id,e.id)}async unlikeTweet(e){let t=await this.getAPI(),s=await this.me();t.v2.unlike(s.id,e.id)}async homeTimeline(){let t=await(await this.getAPI()).v2.homeTimeline({exclude:"replies",max_results:Gl,"tweet.fields":["public_metrics","author_id","attachments","created_at","id","entities","conversation_id"],"media.fields":["url","type","media_key","preview_image_url"],expansions:["attachments.media_keys","author_id","in_reply_to_user_id","entities.mentions.username","referenced_tweets.id"]}),s=new Gt.TwitterV2IncludesHelper(t),a=[];await this.prefetchUserAccounts(t);for(let u of t){let f=s.medias(u),c;if(f&&f.length>0){let S=f[0];S.type==="animated_gif"||S.type==="video"?c=S.preview_image_url:c=S.url}if(!u.author_id)continue;let h={id:u.id,text:u.text,created_at:u.created_at,conversation_id:u.conversation_id,source:u.source||"",image_url:c,user:await this.getUserAccount(u.author_id),quote_count:u.public_metrics?.quote_count||0,reply_count:u.public_metrics?.reply_count||0,retweet_count:u.public_metrics?.retweet_count||0,like_count:u.public_metrics?.like_count||0};a.push(h)}return a}};function hm(){return new rc}var Mi=hm();function mm(n){let e=n.text,t=nc(e);return _jsx(A.Form.Description,{text:`${e.length}/280 ${t?"\u2705":"\u274C"}`})}function pm(n){let e=n.index,t=n.content,s=e===0?"What's happening?":"Another Tweet";return _jsx(Qn.Fragment,null,_jsx(A.Form.TextArea,{id:`${e}`,title:`Tweet ${e>0?e+1:""}`,placeholder:s,value:t.text,onChange:a=>n.onTextChange(a,e)}),_jsx(mm,{text:t.text}))}function nc(n){let e=n.length;return!(e<1||e>280)}function _m(n){return nc(n.text)}function sc(n){if(n.length<1)return!1;for(let e of n)if(!_m(e))return!1;return!0}async function gm(n){try{if(!sc(n)){await(0,A.showToast)({style:A.Toast.Style.Failure,title:"Invalid Tweet",message:"Tweets are not valid"});return}if(n.length===1){let e=n[0];await Mi.sendTweet(e.text),await(0,A.showToast)({style:A.Toast.Style.Success,title:"Tweet created",message:"Tweet creation successful"}),(0,A.popToRoot)()}else{let e=n.map(t=>t.text);await Mi.sendThread(e),await(0,A.showToast)({style:A.Toast.Style.Success,title:"Thread created",message:"Thread creation successful"}),(0,A.popToRoot)()}}catch(e){await(0,A.showToast)({style:A.Toast.Style.Failure,title:"Error",message:Qt(e)})}}function ic(){let[n,e]=(0,Qn.useState)([{text:""}]),t=()=>{let c=[...n,{text:""}];e(c)},s=n&&n.length>1?"Send Thread":"Send Tweet",a=async()=>{if(n.length>1){let c=n[n.length-1],h=!0;if(c.text.length>0&&(h=await(0,A.confirmAlert)({title:"Really remove last Tweet?",message:"You last tweet contain content, it will get lost",icon:"\u26A0\uFE0F"})),h){let S=[...n];S.pop(),e(S)}}},u=(c,h)=>{let S=[...n];S[h].text=c,e(S)},f=()=>{let c=[...n];for(let h=0;h<c.length;h++)c[h].text+=` ${h+1}/${c.length}`;e(c)};return _jsx(A.Form,{actions:_jsx(A.ActionPanel,null,_jsx(A.ActionPanel.Section,null,sc(n)&&_jsx(A.Action.SubmitForm,{title:s,icon:"twitter.png",onSubmit:c=>gm(n)})),_jsx(A.ActionPanel.Section,{title:"Thread"},_jsx(A.Action,{title:"Add Tweet",onAction:t,icon:{source:A.Icon.Plus,tintColor:A.Color.PrimaryText},shortcut:{modifiers:["cmd"],key:"+"}}),n.length>1&&_jsx(A.Action,{title:"Remove last Tweet",onAction:a,icon:{source:A.Icon.Trash,tintColor:A.Color.Red},shortcut:{modifiers:["cmd"],key:"-"}}),n.length>1&&_jsx(A.Action,{title:"Add Tweet Numbers",onAction:f,icon:A.Icon.Document,shortcut:{modifiers:["cmd"],key:"n"}})))},n.map((c,h)=>_jsx(pm,{key:h,index:h,content:c,onTextChange:u})))}function ac(){return eo()?_jsx(ic,null):_jsx(vl,null)}module.exports=xd(bm);0&&(module.exports={});
