var Of=Object.create;var Pr=Object.defineProperty,Mf=Object.defineProperties,xf=Object.getOwnPropertyDescriptor,Ff=Object.getOwnPropertyDescriptors,Bf=Object.getOwnPropertyNames,Cn=Object.getOwnPropertySymbols,jf=Object.getPrototypeOf,ns=Object.prototype.hasOwnProperty,Uo=Object.prototype.propertyIsEnumerable;var jo=(r,e,t)=>e in r?Pr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,p=(r,e)=>{for(var t in e||(e={}))ns.call(e,t)&&jo(r,t,e[t]);if(Cn)for(var t of Cn(e))Uo.call(e,t)&&jo(r,t,e[t]);return r},j=(r,e)=>Mf(r,Ff(e)),Wo=r=>Pr(r,"__esModule",{value:!0});var H=(r,e)=>{var t={};for(var i in r)ns.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&Cn)for(var i of Cn(r))e.indexOf(i)<0&&Uo.call(r,i)&&(t[i]=r[i]);return t};var T=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Uf=(r,e)=>{for(var t in e)Pr(r,t,{get:e[t],enumerable:!0})},zo=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of Bf(e))!ns.call(r,a)&&(t||a!=="default")&&Pr(r,a,{get:()=>e[a],enumerable:!(i=xf(e,a))||i.enumerable});return r},Ve=(r,e)=>zo(Wo(Pr(r!=null?Of(jf(r)):{},"default",!e&&r&&r.__esModule?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r),Wf=(r=>(e,t)=>r&&r.get(e)||(t=zo(Wo({}),e,1),r&&r.set(e,t),t))(typeof WeakMap!="undefined"?new WeakMap:0);var Ho=T((Up,No)=>{"use strict";function Vf(r){if(!/^data:/i.test(r))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');r=r.replace(/\r?\n/g,"");let e=r.indexOf(",");if(e===-1||e<=4)throw new TypeError("malformed data: URI");let t=r.substring(5,e).split(";"),i="",a=!1,u=t[0]||"text/plain",c=u;for(let y=1;y<t.length;y++)t[y]==="base64"?a=!0:(c+=`;${t[y]}`,t[y].indexOf("charset=")===0&&(i=t[y].substring(8)));!t[0]&&!i.length&&(c+=";charset=US-ASCII",i="US-ASCII");let d=a?"base64":"ascii",h=unescape(r.substring(e+1)),S=Buffer.from(h,d);return S.type=u,S.typeFull=c,S.charset=i,S}No.exports=Vf});var Yo=T((In,Qo)=>{(function(r,e){typeof In=="object"&&typeof Qo<"u"?e(In):typeof define=="function"&&define.amd?define(["exports"],e):(r=typeof globalThis<"u"?globalThis:r||self,e(r.WebStreamsPolyfill={}))})(In,function(r){"use strict";let e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol:n=>`Symbol(${n})`;function t(){}function i(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global}let a=i();function u(n){return typeof n=="object"&&n!==null||typeof n=="function"}let c=t,d=Promise,h=Promise.prototype.then,S=Promise.resolve.bind(d),y=Promise.reject.bind(d);function R(n){return new d(n)}function w(n){return S(n)}function _(n){return y(n)}function D(n,s,o){return h.call(n,s,o)}function L(n,s,o){D(D(n,s,o),void 0,c)}function Z(n,s){L(n,s)}function oe(n,s){L(n,void 0,s)}function re(n,s,o){return D(n,s,o)}function ne(n){D(n,void 0,c)}let U=(()=>{let n=a&&a.queueMicrotask;if(typeof n=="function")return n;let s=w(void 0);return o=>D(s,o)})();function $(n,s,o){if(typeof n!="function")throw new TypeError("Argument is not a function");return Function.prototype.apply.call(n,s,o)}function Le(n,s,o){try{return w($(n,s,o))}catch(l){return _(l)}}let Xr=16384;class Ce{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(s){let o=this._back,l=o;o._elements.length===Xr-1&&(l={_elements:[],_next:void 0}),o._elements.push(s),l!==o&&(this._back=l,o._next=l),++this._size}shift(){let s=this._front,o=s,l=this._cursor,f=l+1,m=s._elements,g=m[l];return f===Xr&&(o=s._next,f=0),--this._size,this._cursor=f,s!==o&&(this._front=o),m[l]=void 0,g}forEach(s){let o=this._cursor,l=this._front,f=l._elements;for(;(o!==f.length||l._next!==void 0)&&!(o===f.length&&(l=l._next,f=l._elements,o=0,f.length===0));)s(f[o]),++o}peek(){let s=this._front,o=this._cursor;return s._elements[o]}}function Ra(n,s){n._ownerReadableStream=s,s._reader=n,s._state==="readable"?Pi(n):s._state==="closed"?ud(n):va(n,s._storedError)}function vi(n,s){let o=n._ownerReadableStream;return Ee(o,s)}function Ke(n){n._ownerReadableStream._state==="readable"?qi(n,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):ld(n,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),n._ownerReadableStream._reader=void 0,n._ownerReadableStream=void 0}function jt(n){return new TypeError("Cannot "+n+" a stream using a released reader")}function Pi(n){n._closedPromise=R((s,o)=>{n._closedPromise_resolve=s,n._closedPromise_reject=o})}function va(n,s){Pi(n),qi(n,s)}function ud(n){Pi(n),Pa(n)}function qi(n,s){n._closedPromise_reject!==void 0&&(ne(n._closedPromise),n._closedPromise_reject(s),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0)}function ld(n,s){va(n,s)}function Pa(n){n._closedPromise_resolve!==void 0&&(n._closedPromise_resolve(void 0),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0)}let qa=e("[[AbortSteps]]"),Aa=e("[[ErrorSteps]]"),Ai=e("[[CancelSteps]]"),Di=e("[[PullSteps]]"),Da=Number.isFinite||function(n){return typeof n=="number"&&isFinite(n)},cd=Math.trunc||function(n){return n<0?Math.ceil(n):Math.floor(n)};function dd(n){return typeof n=="object"||typeof n=="function"}function Ge(n,s){if(n!==void 0&&!dd(n))throw new TypeError(`${s} is not an object.`)}function ke(n,s){if(typeof n!="function")throw new TypeError(`${s} is not a function.`)}function fd(n){return typeof n=="object"&&n!==null||typeof n=="function"}function La(n,s){if(!fd(n))throw new TypeError(`${s} is not an object.`)}function Xe(n,s,o){if(n===void 0)throw new TypeError(`Parameter ${s} is required in '${o}'.`)}function Li(n,s,o){if(n===void 0)throw new TypeError(`${s} is required in '${o}'.`)}function Ci(n){return Number(n)}function Ca(n){return n===0?0:n}function hd(n){return Ca(cd(n))}function ka(n,s){let l=Number.MAX_SAFE_INTEGER,f=Number(n);if(f=Ca(f),!Da(f))throw new TypeError(`${s} is not a finite number`);if(f=hd(f),f<0||f>l)throw new TypeError(`${s} is outside the accepted range of ${0} to ${l}, inclusive`);return!Da(f)||f===0?0:f}function ki(n,s){if(!lt(n))throw new TypeError(`${s} is not a ReadableStream.`)}function Ut(n){return new lr(n)}function Ia(n,s){n._reader._readRequests.push(s)}function Ii(n,s,o){let f=n._reader._readRequests.shift();o?f._closeSteps():f._chunkSteps(s)}function Jr(n){return n._reader._readRequests.length}function Ea(n){let s=n._reader;return!(s===void 0||!st(s))}class lr{constructor(s){if(Xe(s,1,"ReadableStreamDefaultReader"),ki(s,"First parameter"),ct(s))throw new TypeError("This stream has already been locked for exclusive reading by another reader");Ra(this,s),this._readRequests=new Ce}get closed(){return st(this)?this._closedPromise:_(Zr("closed"))}cancel(s=void 0){return st(this)?this._ownerReadableStream===void 0?_(jt("cancel")):vi(this,s):_(Zr("cancel"))}read(){if(!st(this))return _(Zr("read"));if(this._ownerReadableStream===void 0)return _(jt("read from"));let s,o,l=R((m,g)=>{s=m,o=g});return cr(this,{_chunkSteps:m=>s({value:m,done:!1}),_closeSteps:()=>s({value:void 0,done:!0}),_errorSteps:m=>o(m)}),l}releaseLock(){if(!st(this))throw Zr("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Ke(this)}}}Object.defineProperties(lr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(lr.prototype,e.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});function st(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_readRequests")?!1:n instanceof lr}function cr(n,s){let o=n._ownerReadableStream;o._disturbed=!0,o._state==="closed"?s._closeSteps():o._state==="errored"?s._errorSteps(o._storedError):o._readableStreamController[Di](s)}function Zr(n){return new TypeError(`ReadableStreamDefaultReader.prototype.${n} can only be used on a ReadableStreamDefaultReader`)}let Oa=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Ma{constructor(s,o){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=s,this._preventCancel=o}next(){let s=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?re(this._ongoingPromise,s,s):s(),this._ongoingPromise}return(s){let o=()=>this._returnSteps(s);return this._ongoingPromise?re(this._ongoingPromise,o,o):o()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let s=this._reader;if(s._ownerReadableStream===void 0)return _(jt("iterate"));let o,l,f=R((g,b)=>{o=g,l=b});return cr(s,{_chunkSteps:g=>{this._ongoingPromise=void 0,U(()=>o({value:g,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,Ke(s),o({value:void 0,done:!0})},_errorSteps:g=>{this._ongoingPromise=void 0,this._isFinished=!0,Ke(s),l(g)}}),f}_returnSteps(s){if(this._isFinished)return Promise.resolve({value:s,done:!0});this._isFinished=!0;let o=this._reader;if(o._ownerReadableStream===void 0)return _(jt("finish iterating"));if(!this._preventCancel){let l=vi(o,s);return Ke(o),re(l,()=>({value:s,done:!0}))}return Ke(o),w({value:s,done:!0})}}let xa={next(){return Fa(this)?this._asyncIteratorImpl.next():_(Ba("next"))},return(n){return Fa(this)?this._asyncIteratorImpl.return(n):_(Ba("return"))}};Oa!==void 0&&Object.setPrototypeOf(xa,Oa);function md(n,s){let o=Ut(n),l=new Ma(o,s),f=Object.create(xa);return f._asyncIteratorImpl=l,f}function Fa(n){if(!u(n)||!Object.prototype.hasOwnProperty.call(n,"_asyncIteratorImpl"))return!1;try{return n._asyncIteratorImpl instanceof Ma}catch{return!1}}function Ba(n){return new TypeError(`ReadableStreamAsyncIterator.${n} can only be used on a ReadableSteamAsyncIterator`)}let ja=Number.isNaN||function(n){return n!==n};function dr(n){return n.slice()}function Ua(n,s,o,l,f){new Uint8Array(n).set(new Uint8Array(o,l,f),s)}function xp(n){return n}function en(n){return!1}function Wa(n,s,o){if(n.slice)return n.slice(s,o);let l=o-s,f=new ArrayBuffer(l);return Ua(f,0,n,s,l),f}function pd(n){return!(typeof n!="number"||ja(n)||n<0)}function za(n){let s=Wa(n.buffer,n.byteOffset,n.byteOffset+n.byteLength);return new Uint8Array(s)}function Ei(n){let s=n._queue.shift();return n._queueTotalSize-=s.size,n._queueTotalSize<0&&(n._queueTotalSize=0),s.value}function Oi(n,s,o){if(!pd(o)||o===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");n._queue.push({value:s,size:o}),n._queueTotalSize+=o}function _d(n){return n._queue.peek().value}function at(n){n._queue=new Ce,n._queueTotalSize=0}class fr{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Mi(this))throw Ui("view");return this._view}respond(s){if(!Mi(this))throw Ui("respond");if(Xe(s,1,"respond"),s=ka(s,"First parameter"),this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");en(this._view.buffer),sn(this._associatedReadableByteStreamController,s)}respondWithNewView(s){if(!Mi(this))throw Ui("respondWithNewView");if(Xe(s,1,"respondWithNewView"),!ArrayBuffer.isView(s))throw new TypeError("You can only respond with array buffer views");if(this._associatedReadableByteStreamController===void 0)throw new TypeError("This BYOB request has been invalidated");en(s.buffer),an(this._associatedReadableByteStreamController,s)}}Object.defineProperties(fr.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(fr.prototype,e.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Wt{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!bt(this))throw mr("byobRequest");return ji(this)}get desiredSize(){if(!bt(this))throw mr("desiredSize");return Ga(this)}close(){if(!bt(this))throw mr("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");let s=this._controlledReadableByteStream._state;if(s!=="readable")throw new TypeError(`The stream (in ${s} state) is not in the readable state and cannot be closed`);hr(this)}enqueue(s){if(!bt(this))throw mr("enqueue");if(Xe(s,1,"enqueue"),!ArrayBuffer.isView(s))throw new TypeError("chunk must be an array buffer view");if(s.byteLength===0)throw new TypeError("chunk must have non-zero byteLength");if(s.buffer.byteLength===0)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");let o=this._controlledReadableByteStream._state;if(o!=="readable")throw new TypeError(`The stream (in ${o} state) is not in the readable state and cannot be enqueued to`);nn(this,s)}error(s=void 0){if(!bt(this))throw mr("error");Ie(this,s)}[Ai](s){Va(this),at(this);let o=this._cancelAlgorithm(s);return rn(this),o}[Di](s){let o=this._controlledReadableByteStream;if(this._queueTotalSize>0){let f=this._queue.shift();this._queueTotalSize-=f.byteLength,Qa(this);let m=new Uint8Array(f.buffer,f.byteOffset,f.byteLength);s._chunkSteps(m);return}let l=this._autoAllocateChunkSize;if(l!==void 0){let f;try{f=new ArrayBuffer(l)}catch(g){s._errorSteps(g);return}let m={buffer:f,bufferByteLength:l,byteOffset:0,byteLength:l,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(m)}Ia(o,s),Tt(this)}}Object.defineProperties(Wt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Wt.prototype,e.toStringTag,{value:"ReadableByteStreamController",configurable:!0});function bt(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledReadableByteStream")?!1:n instanceof Wt}function Mi(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_associatedReadableByteStreamController")?!1:n instanceof fr}function Tt(n){if(!bd(n))return;if(n._pulling){n._pullAgain=!0;return}n._pulling=!0;let o=n._pullAlgorithm();L(o,()=>{n._pulling=!1,n._pullAgain&&(n._pullAgain=!1,Tt(n))},l=>{Ie(n,l)})}function Va(n){Fi(n),n._pendingPullIntos=new Ce}function xi(n,s){let o=!1;n._state==="closed"&&(o=!0);let l=$a(s);s.readerType==="default"?Ii(n,l,o):Rd(n,l,o)}function $a(n){let s=n.bytesFilled,o=n.elementSize;return new n.viewConstructor(n.buffer,n.byteOffset,s/o)}function tn(n,s,o,l){n._queue.push({buffer:s,byteOffset:o,byteLength:l}),n._queueTotalSize+=l}function Na(n,s){let o=s.elementSize,l=s.bytesFilled-s.bytesFilled%o,f=Math.min(n._queueTotalSize,s.byteLength-s.bytesFilled),m=s.bytesFilled+f,g=m-m%o,b=f,v=!1;g>l&&(b=g-s.bytesFilled,v=!0);let C=n._queue;for(;b>0;){let B=C.peek(),M=Math.min(b,B.byteLength),N=s.byteOffset+s.bytesFilled;Ua(s.buffer,N,B.buffer,B.byteOffset,M),B.byteLength===M?C.shift():(B.byteOffset+=M,B.byteLength-=M),n._queueTotalSize-=M,Ha(n,M,s),b-=M}return v}function Ha(n,s,o){o.bytesFilled+=s}function Qa(n){n._queueTotalSize===0&&n._closeRequested?(rn(n),Sr(n._controlledReadableByteStream)):Tt(n)}function Fi(n){n._byobRequest!==null&&(n._byobRequest._associatedReadableByteStreamController=void 0,n._byobRequest._view=null,n._byobRequest=null)}function Ya(n){for(;n._pendingPullIntos.length>0;){if(n._queueTotalSize===0)return;let s=n._pendingPullIntos.peek();Na(n,s)&&(Bi(n),xi(n._controlledReadableByteStream,s))}}function gd(n,s,o){let l=n._controlledReadableByteStream,f=1;s.constructor!==DataView&&(f=s.constructor.BYTES_PER_ELEMENT);let m=s.constructor,g=s.buffer,b={buffer:g,bufferByteLength:g.byteLength,byteOffset:s.byteOffset,byteLength:s.byteLength,bytesFilled:0,elementSize:f,viewConstructor:m,readerType:"byob"};if(n._pendingPullIntos.length>0){n._pendingPullIntos.push(b),Za(l,o);return}if(l._state==="closed"){let v=new m(b.buffer,b.byteOffset,0);o._closeSteps(v);return}if(n._queueTotalSize>0){if(Na(n,b)){let v=$a(b);Qa(n),o._chunkSteps(v);return}if(n._closeRequested){let v=new TypeError("Insufficient bytes to fill elements in the given buffer");Ie(n,v),o._errorSteps(v);return}}n._pendingPullIntos.push(b),Za(l,o),Tt(n)}function wd(n,s){let o=n._controlledReadableByteStream;if(Wi(o))for(;eo(o)>0;){let l=Bi(n);xi(o,l)}}function yd(n,s,o){if(Ha(n,s,o),o.bytesFilled<o.elementSize)return;Bi(n);let l=o.bytesFilled%o.elementSize;if(l>0){let f=o.byteOffset+o.bytesFilled,m=Wa(o.buffer,f-l,f);tn(n,m,0,m.byteLength)}o.bytesFilled-=l,xi(n._controlledReadableByteStream,o),Ya(n)}function Ka(n,s){let o=n._pendingPullIntos.peek();Fi(n),n._controlledReadableByteStream._state==="closed"?wd(n):yd(n,s,o),Tt(n)}function Bi(n){return n._pendingPullIntos.shift()}function bd(n){let s=n._controlledReadableByteStream;return s._state!=="readable"||n._closeRequested||!n._started?!1:!!(Ea(s)&&Jr(s)>0||Wi(s)&&eo(s)>0||Ga(n)>0)}function rn(n){n._pullAlgorithm=void 0,n._cancelAlgorithm=void 0}function hr(n){let s=n._controlledReadableByteStream;if(!(n._closeRequested||s._state!=="readable")){if(n._queueTotalSize>0){n._closeRequested=!0;return}if(n._pendingPullIntos.length>0&&n._pendingPullIntos.peek().bytesFilled>0){let l=new TypeError("Insufficient bytes to fill elements in the given buffer");throw Ie(n,l),l}rn(n),Sr(s)}}function nn(n,s){let o=n._controlledReadableByteStream;if(n._closeRequested||o._state!=="readable")return;let l=s.buffer,f=s.byteOffset,m=s.byteLength,g=l;if(n._pendingPullIntos.length>0){let b=n._pendingPullIntos.peek();en(b.buffer),b.buffer=b.buffer}if(Fi(n),Ea(o))if(Jr(o)===0)tn(n,g,f,m);else{let b=new Uint8Array(g,f,m);Ii(o,b,!1)}else Wi(o)?(tn(n,g,f,m),Ya(n)):tn(n,g,f,m);Tt(n)}function Ie(n,s){let o=n._controlledReadableByteStream;o._state==="readable"&&(Va(n),at(n),rn(n),Po(o,s))}function ji(n){if(n._byobRequest===null&&n._pendingPullIntos.length>0){let s=n._pendingPullIntos.peek(),o=new Uint8Array(s.buffer,s.byteOffset+s.bytesFilled,s.byteLength-s.bytesFilled),l=Object.create(fr.prototype);Sd(l,n,o),n._byobRequest=l}return n._byobRequest}function Ga(n){let s=n._controlledReadableByteStream._state;return s==="errored"?null:s==="closed"?0:n._strategyHWM-n._queueTotalSize}function sn(n,s){let o=n._pendingPullIntos.peek();if(n._controlledReadableByteStream._state==="closed"){if(s!==0)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(s===0)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(o.bytesFilled+s>o.byteLength)throw new RangeError("bytesWritten out of range")}o.buffer=o.buffer,Ka(n,s)}function an(n,s){let o=n._pendingPullIntos.peek();if(n._controlledReadableByteStream._state==="closed"){if(s.byteLength!==0)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(s.byteLength===0)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(o.byteOffset+o.bytesFilled!==s.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(o.bufferByteLength!==s.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(o.bytesFilled+s.byteLength>o.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");o.buffer=s.buffer,Ka(n,s.byteLength)}function Xa(n,s,o,l,f,m,g){s._controlledReadableByteStream=n,s._pullAgain=!1,s._pulling=!1,s._byobRequest=null,s._queue=s._queueTotalSize=void 0,at(s),s._closeRequested=!1,s._started=!1,s._strategyHWM=m,s._pullAlgorithm=l,s._cancelAlgorithm=f,s._autoAllocateChunkSize=g,s._pendingPullIntos=new Ce,n._readableStreamController=s;let b=o();L(w(b),()=>{s._started=!0,Tt(s)},v=>{Ie(s,v)})}function Td(n,s,o){let l=Object.create(Wt.prototype),f=()=>{},m=()=>w(void 0),g=()=>w(void 0);s.start!==void 0&&(f=()=>s.start(l)),s.pull!==void 0&&(m=()=>s.pull(l)),s.cancel!==void 0&&(g=v=>s.cancel(v));let b=s.autoAllocateChunkSize;if(b===0)throw new TypeError("autoAllocateChunkSize must be greater than 0");Xa(n,l,f,m,g,o,b)}function Sd(n,s,o){n._associatedReadableByteStreamController=s,n._view=o}function Ui(n){return new TypeError(`ReadableStreamBYOBRequest.prototype.${n} can only be used on a ReadableStreamBYOBRequest`)}function mr(n){return new TypeError(`ReadableByteStreamController.prototype.${n} can only be used on a ReadableByteStreamController`)}function Ja(n){return new pr(n)}function Za(n,s){n._reader._readIntoRequests.push(s)}function Rd(n,s,o){let f=n._reader._readIntoRequests.shift();o?f._closeSteps(s):f._chunkSteps(s)}function eo(n){return n._reader._readIntoRequests.length}function Wi(n){let s=n._reader;return!(s===void 0||!St(s))}class pr{constructor(s){if(Xe(s,1,"ReadableStreamBYOBReader"),ki(s,"First parameter"),ct(s))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!bt(s._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");Ra(this,s),this._readIntoRequests=new Ce}get closed(){return St(this)?this._closedPromise:_(on("closed"))}cancel(s=void 0){return St(this)?this._ownerReadableStream===void 0?_(jt("cancel")):vi(this,s):_(on("cancel"))}read(s){if(!St(this))return _(on("read"));if(!ArrayBuffer.isView(s))return _(new TypeError("view must be an array buffer view"));if(s.byteLength===0)return _(new TypeError("view must have non-zero byteLength"));if(s.buffer.byteLength===0)return _(new TypeError("view's buffer must have non-zero byteLength"));if(en(s.buffer),this._ownerReadableStream===void 0)return _(jt("read from"));let o,l,f=R((g,b)=>{o=g,l=b});return to(this,s,{_chunkSteps:g=>o({value:g,done:!1}),_closeSteps:g=>o({value:g,done:!0}),_errorSteps:g=>l(g)}),f}releaseLock(){if(!St(this))throw on("releaseLock");if(this._ownerReadableStream!==void 0){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");Ke(this)}}}Object.defineProperties(pr.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(pr.prototype,e.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});function St(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_readIntoRequests")?!1:n instanceof pr}function to(n,s,o){let l=n._ownerReadableStream;l._disturbed=!0,l._state==="errored"?o._errorSteps(l._storedError):gd(l._readableStreamController,s,o)}function on(n){return new TypeError(`ReadableStreamBYOBReader.prototype.${n} can only be used on a ReadableStreamBYOBReader`)}function _r(n,s){let{highWaterMark:o}=n;if(o===void 0)return s;if(ja(o)||o<0)throw new RangeError("Invalid highWaterMark");return o}function un(n){let{size:s}=n;return s||(()=>1)}function ln(n,s){Ge(n,s);let o=n==null?void 0:n.highWaterMark,l=n==null?void 0:n.size;return{highWaterMark:o===void 0?void 0:Ci(o),size:l===void 0?void 0:vd(l,`${s} has member 'size' that`)}}function vd(n,s){return ke(n,s),o=>Ci(n(o))}function Pd(n,s){Ge(n,s);let o=n==null?void 0:n.abort,l=n==null?void 0:n.close,f=n==null?void 0:n.start,m=n==null?void 0:n.type,g=n==null?void 0:n.write;return{abort:o===void 0?void 0:qd(o,n,`${s} has member 'abort' that`),close:l===void 0?void 0:Ad(l,n,`${s} has member 'close' that`),start:f===void 0?void 0:Dd(f,n,`${s} has member 'start' that`),write:g===void 0?void 0:Ld(g,n,`${s} has member 'write' that`),type:m}}function qd(n,s,o){return ke(n,o),l=>Le(n,s,[l])}function Ad(n,s,o){return ke(n,o),()=>Le(n,s,[])}function Dd(n,s,o){return ke(n,o),l=>$(n,s,[l])}function Ld(n,s,o){return ke(n,o),(l,f)=>Le(n,s,[l,f])}function ro(n,s){if(!zt(n))throw new TypeError(`${s} is not a WritableStream.`)}function Cd(n){if(typeof n!="object"||n===null)return!1;try{return typeof n.aborted=="boolean"}catch{return!1}}let kd=typeof AbortController=="function";function Id(){if(kd)return new AbortController}class gr{constructor(s={},o={}){s===void 0?s=null:La(s,"First parameter");let l=ln(o,"Second parameter"),f=Pd(s,"First parameter");if(io(this),f.type!==void 0)throw new RangeError("Invalid type is specified");let g=un(l),b=_r(l,1);Hd(this,f,b,g)}get locked(){if(!zt(this))throw mn("locked");return Vt(this)}abort(s=void 0){return zt(this)?Vt(this)?_(new TypeError("Cannot abort a stream that already has a writer")):cn(this,s):_(mn("abort"))}close(){return zt(this)?Vt(this)?_(new TypeError("Cannot close a stream that already has a writer")):We(this)?_(new TypeError("Cannot close an already-closing stream")):so(this):_(mn("close"))}getWriter(){if(!zt(this))throw mn("getWriter");return no(this)}}Object.defineProperties(gr.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(gr.prototype,e.toStringTag,{value:"WritableStream",configurable:!0});function no(n){return new wr(n)}function Ed(n,s,o,l,f=1,m=()=>1){let g=Object.create(gr.prototype);io(g);let b=Object.create($t.prototype);return fo(g,b,n,s,o,l,f,m),g}function io(n){n._state="writable",n._storedError=void 0,n._writer=void 0,n._writableStreamController=void 0,n._writeRequests=new Ce,n._inFlightWriteRequest=void 0,n._closeRequest=void 0,n._inFlightCloseRequest=void 0,n._pendingAbortRequest=void 0,n._backpressure=!1}function zt(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_writableStreamController")?!1:n instanceof gr}function Vt(n){return n._writer!==void 0}function cn(n,s){var o;if(n._state==="closed"||n._state==="errored")return w(void 0);n._writableStreamController._abortReason=s,(o=n._writableStreamController._abortController)===null||o===void 0||o.abort();let l=n._state;if(l==="closed"||l==="errored")return w(void 0);if(n._pendingAbortRequest!==void 0)return n._pendingAbortRequest._promise;let f=!1;l==="erroring"&&(f=!0,s=void 0);let m=R((g,b)=>{n._pendingAbortRequest={_promise:void 0,_resolve:g,_reject:b,_reason:s,_wasAlreadyErroring:f}});return n._pendingAbortRequest._promise=m,f||Vi(n,s),m}function so(n){let s=n._state;if(s==="closed"||s==="errored")return _(new TypeError(`The stream (in ${s} state) is not in the writable state and cannot be closed`));let o=R((f,m)=>{let g={_resolve:f,_reject:m};n._closeRequest=g}),l=n._writer;return l!==void 0&&n._backpressure&&s==="writable"&&Ji(l),Qd(n._writableStreamController),o}function Od(n){return R((o,l)=>{let f={_resolve:o,_reject:l};n._writeRequests.push(f)})}function zi(n,s){if(n._state==="writable"){Vi(n,s);return}$i(n)}function Vi(n,s){let o=n._writableStreamController;n._state="erroring",n._storedError=s;let l=n._writer;l!==void 0&&oo(l,s),!jd(n)&&o._started&&$i(n)}function $i(n){n._state="errored",n._writableStreamController[Aa]();let s=n._storedError;if(n._writeRequests.forEach(f=>{f._reject(s)}),n._writeRequests=new Ce,n._pendingAbortRequest===void 0){dn(n);return}let o=n._pendingAbortRequest;if(n._pendingAbortRequest=void 0,o._wasAlreadyErroring){o._reject(s),dn(n);return}let l=n._writableStreamController[qa](o._reason);L(l,()=>{o._resolve(),dn(n)},f=>{o._reject(f),dn(n)})}function Md(n){n._inFlightWriteRequest._resolve(void 0),n._inFlightWriteRequest=void 0}function xd(n,s){n._inFlightWriteRequest._reject(s),n._inFlightWriteRequest=void 0,zi(n,s)}function Fd(n){n._inFlightCloseRequest._resolve(void 0),n._inFlightCloseRequest=void 0,n._state==="erroring"&&(n._storedError=void 0,n._pendingAbortRequest!==void 0&&(n._pendingAbortRequest._resolve(),n._pendingAbortRequest=void 0)),n._state="closed";let o=n._writer;o!==void 0&&_o(o)}function Bd(n,s){n._inFlightCloseRequest._reject(s),n._inFlightCloseRequest=void 0,n._pendingAbortRequest!==void 0&&(n._pendingAbortRequest._reject(s),n._pendingAbortRequest=void 0),zi(n,s)}function We(n){return!(n._closeRequest===void 0&&n._inFlightCloseRequest===void 0)}function jd(n){return!(n._inFlightWriteRequest===void 0&&n._inFlightCloseRequest===void 0)}function Ud(n){n._inFlightCloseRequest=n._closeRequest,n._closeRequest=void 0}function Wd(n){n._inFlightWriteRequest=n._writeRequests.shift()}function dn(n){n._closeRequest!==void 0&&(n._closeRequest._reject(n._storedError),n._closeRequest=void 0);let s=n._writer;s!==void 0&&Gi(s,n._storedError)}function Ni(n,s){let o=n._writer;o!==void 0&&s!==n._backpressure&&(s?ef(o):Ji(o)),n._backpressure=s}class wr{constructor(s){if(Xe(s,1,"WritableStreamDefaultWriter"),ro(s,"First parameter"),Vt(s))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=s,s._writer=this;let o=s._state;if(o==="writable")!We(s)&&s._backpressure?_n(this):go(this),pn(this);else if(o==="erroring")Xi(this,s._storedError),pn(this);else if(o==="closed")go(this),Jd(this);else{let l=s._storedError;Xi(this,l),po(this,l)}}get closed(){return Rt(this)?this._closedPromise:_(vt("closed"))}get desiredSize(){if(!Rt(this))throw vt("desiredSize");if(this._ownerWritableStream===void 0)throw yr("desiredSize");return Nd(this)}get ready(){return Rt(this)?this._readyPromise:_(vt("ready"))}abort(s=void 0){return Rt(this)?this._ownerWritableStream===void 0?_(yr("abort")):zd(this,s):_(vt("abort"))}close(){if(!Rt(this))return _(vt("close"));let s=this._ownerWritableStream;return s===void 0?_(yr("close")):We(s)?_(new TypeError("Cannot close an already-closing stream")):ao(this)}releaseLock(){if(!Rt(this))throw vt("releaseLock");this._ownerWritableStream!==void 0&&uo(this)}write(s=void 0){return Rt(this)?this._ownerWritableStream===void 0?_(yr("write to")):lo(this,s):_(vt("write"))}}Object.defineProperties(wr.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(wr.prototype,e.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});function Rt(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_ownerWritableStream")?!1:n instanceof wr}function zd(n,s){let o=n._ownerWritableStream;return cn(o,s)}function ao(n){let s=n._ownerWritableStream;return so(s)}function Vd(n){let s=n._ownerWritableStream,o=s._state;return We(s)||o==="closed"?w(void 0):o==="errored"?_(s._storedError):ao(n)}function $d(n,s){n._closedPromiseState==="pending"?Gi(n,s):Zd(n,s)}function oo(n,s){n._readyPromiseState==="pending"?wo(n,s):tf(n,s)}function Nd(n){let s=n._ownerWritableStream,o=s._state;return o==="errored"||o==="erroring"?null:o==="closed"?0:ho(s._writableStreamController)}function uo(n){let s=n._ownerWritableStream,o=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");oo(n,o),$d(n,o),s._writer=void 0,n._ownerWritableStream=void 0}function lo(n,s){let o=n._ownerWritableStream,l=o._writableStreamController,f=Yd(l,s);if(o!==n._ownerWritableStream)return _(yr("write to"));let m=o._state;if(m==="errored")return _(o._storedError);if(We(o)||m==="closed")return _(new TypeError("The stream is closing or closed and cannot be written to"));if(m==="erroring")return _(o._storedError);let g=Od(o);return Kd(l,s,f),g}let co={};class $t{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!Hi(this))throw Ki("abortReason");return this._abortReason}get signal(){if(!Hi(this))throw Ki("signal");if(this._abortController===void 0)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(s=void 0){if(!Hi(this))throw Ki("error");this._controlledWritableStream._state==="writable"&&mo(this,s)}[qa](s){let o=this._abortAlgorithm(s);return fn(this),o}[Aa](){at(this)}}Object.defineProperties($t.prototype,{error:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty($t.prototype,e.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});function Hi(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledWritableStream")?!1:n instanceof $t}function fo(n,s,o,l,f,m,g,b){s._controlledWritableStream=n,n._writableStreamController=s,s._queue=void 0,s._queueTotalSize=void 0,at(s),s._abortReason=void 0,s._abortController=Id(),s._started=!1,s._strategySizeAlgorithm=b,s._strategyHWM=g,s._writeAlgorithm=l,s._closeAlgorithm=f,s._abortAlgorithm=m;let v=Yi(s);Ni(n,v);let C=o(),B=w(C);L(B,()=>{s._started=!0,hn(s)},M=>{s._started=!0,zi(n,M)})}function Hd(n,s,o,l){let f=Object.create($t.prototype),m=()=>{},g=()=>w(void 0),b=()=>w(void 0),v=()=>w(void 0);s.start!==void 0&&(m=()=>s.start(f)),s.write!==void 0&&(g=C=>s.write(C,f)),s.close!==void 0&&(b=()=>s.close()),s.abort!==void 0&&(v=C=>s.abort(C)),fo(n,f,m,g,b,v,o,l)}function fn(n){n._writeAlgorithm=void 0,n._closeAlgorithm=void 0,n._abortAlgorithm=void 0,n._strategySizeAlgorithm=void 0}function Qd(n){Oi(n,co,0),hn(n)}function Yd(n,s){try{return n._strategySizeAlgorithm(s)}catch(o){return Qi(n,o),1}}function ho(n){return n._strategyHWM-n._queueTotalSize}function Kd(n,s,o){try{Oi(n,s,o)}catch(f){Qi(n,f);return}let l=n._controlledWritableStream;if(!We(l)&&l._state==="writable"){let f=Yi(n);Ni(l,f)}hn(n)}function hn(n){let s=n._controlledWritableStream;if(!n._started||s._inFlightWriteRequest!==void 0)return;if(s._state==="erroring"){$i(s);return}if(n._queue.length===0)return;let l=_d(n);l===co?Gd(n):Xd(n,l)}function Qi(n,s){n._controlledWritableStream._state==="writable"&&mo(n,s)}function Gd(n){let s=n._controlledWritableStream;Ud(s),Ei(n);let o=n._closeAlgorithm();fn(n),L(o,()=>{Fd(s)},l=>{Bd(s,l)})}function Xd(n,s){let o=n._controlledWritableStream;Wd(o);let l=n._writeAlgorithm(s);L(l,()=>{Md(o);let f=o._state;if(Ei(n),!We(o)&&f==="writable"){let m=Yi(n);Ni(o,m)}hn(n)},f=>{o._state==="writable"&&fn(n),xd(o,f)})}function Yi(n){return ho(n)<=0}function mo(n,s){let o=n._controlledWritableStream;fn(n),Vi(o,s)}function mn(n){return new TypeError(`WritableStream.prototype.${n} can only be used on a WritableStream`)}function Ki(n){return new TypeError(`WritableStreamDefaultController.prototype.${n} can only be used on a WritableStreamDefaultController`)}function vt(n){return new TypeError(`WritableStreamDefaultWriter.prototype.${n} can only be used on a WritableStreamDefaultWriter`)}function yr(n){return new TypeError("Cannot "+n+" a stream using a released writer")}function pn(n){n._closedPromise=R((s,o)=>{n._closedPromise_resolve=s,n._closedPromise_reject=o,n._closedPromiseState="pending"})}function po(n,s){pn(n),Gi(n,s)}function Jd(n){pn(n),_o(n)}function Gi(n,s){n._closedPromise_reject!==void 0&&(ne(n._closedPromise),n._closedPromise_reject(s),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0,n._closedPromiseState="rejected")}function Zd(n,s){po(n,s)}function _o(n){n._closedPromise_resolve!==void 0&&(n._closedPromise_resolve(void 0),n._closedPromise_resolve=void 0,n._closedPromise_reject=void 0,n._closedPromiseState="resolved")}function _n(n){n._readyPromise=R((s,o)=>{n._readyPromise_resolve=s,n._readyPromise_reject=o}),n._readyPromiseState="pending"}function Xi(n,s){_n(n),wo(n,s)}function go(n){_n(n),Ji(n)}function wo(n,s){n._readyPromise_reject!==void 0&&(ne(n._readyPromise),n._readyPromise_reject(s),n._readyPromise_resolve=void 0,n._readyPromise_reject=void 0,n._readyPromiseState="rejected")}function ef(n){_n(n)}function tf(n,s){Xi(n,s)}function Ji(n){n._readyPromise_resolve!==void 0&&(n._readyPromise_resolve(void 0),n._readyPromise_resolve=void 0,n._readyPromise_reject=void 0,n._readyPromiseState="fulfilled")}let yo=typeof DOMException<"u"?DOMException:void 0;function rf(n){if(!(typeof n=="function"||typeof n=="object"))return!1;try{return new n,!0}catch{return!1}}function nf(){let n=function(o,l){this.message=o||"",this.name=l||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return n.prototype=Object.create(Error.prototype),Object.defineProperty(n.prototype,"constructor",{value:n,writable:!0,configurable:!0}),n}let sf=rf(yo)?yo:nf();function bo(n,s,o,l,f,m){let g=Ut(n),b=no(s);n._disturbed=!0;let v=!1,C=w(void 0);return R((B,M)=>{let N;if(m!==void 0){if(N=()=>{let q=new sf("Aborted","AbortError"),k=[];l||k.push(()=>s._state==="writable"?cn(s,q):w(void 0)),f||k.push(()=>n._state==="readable"?Ee(n,q):w(void 0)),le(()=>Promise.all(k.map(Y=>Y())),!0,q)},m.aborted){N();return}m.addEventListener("abort",N)}function dt(){return R((q,k)=>{function Y(Oe){Oe?q():D(vr(),Y,k)}Y(!1)})}function vr(){return v?w(!0):D(b._readyPromise,()=>R((q,k)=>{cr(g,{_chunkSteps:Y=>{C=D(lo(b,Y),void 0,t),q(!1)},_closeSteps:()=>q(!0),_errorSteps:k})}))}if(ue(n,g._closedPromise,q=>{l?x(!0,q):le(()=>cn(s,q),!0,q)}),ue(s,b._closedPromise,q=>{f?x(!0,q):le(()=>Ee(n,q),!0,q)}),ze(n,g._closedPromise,()=>{o?x():le(()=>Vd(b))}),We(s)||s._state==="closed"){let q=new TypeError("the destination writable stream closed before all data could be piped to it");f?x(!0,q):le(()=>Ee(n,q),!0,q)}ne(dt());function ft(){let q=C;return D(C,()=>q!==C?ft():void 0)}function ue(q,k,Y){q._state==="errored"?Y(q._storedError):oe(k,Y)}function ze(q,k,Y){q._state==="closed"?Y():Z(k,Y)}function le(q,k,Y){if(v)return;v=!0,s._state==="writable"&&!We(s)?Z(ft(),Oe):Oe();function Oe(){L(q(),()=>W(k,Y),ht=>W(!0,ht))}}function x(q,k){v||(v=!0,s._state==="writable"&&!We(s)?Z(ft(),()=>W(q,k)):W(q,k))}function W(q,k){uo(b),Ke(g),m!==void 0&&m.removeEventListener("abort",N),q?M(k):B(void 0)}})}class Nt{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!gn(this))throw bn("desiredSize");return Zi(this)}close(){if(!gn(this))throw bn("close");if(!Ht(this))throw new TypeError("The stream is not in a state that permits close");Tr(this)}enqueue(s=void 0){if(!gn(this))throw bn("enqueue");if(!Ht(this))throw new TypeError("The stream is not in a state that permits enqueue");return yn(this,s)}error(s=void 0){if(!gn(this))throw bn("error");ot(this,s)}[Ai](s){at(this);let o=this._cancelAlgorithm(s);return wn(this),o}[Di](s){let o=this._controlledReadableStream;if(this._queue.length>0){let l=Ei(this);this._closeRequested&&this._queue.length===0?(wn(this),Sr(o)):br(this),s._chunkSteps(l)}else Ia(o,s),br(this)}}Object.defineProperties(Nt.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Nt.prototype,e.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});function gn(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledReadableStream")?!1:n instanceof Nt}function br(n){if(!To(n))return;if(n._pulling){n._pullAgain=!0;return}n._pulling=!0;let o=n._pullAlgorithm();L(o,()=>{n._pulling=!1,n._pullAgain&&(n._pullAgain=!1,br(n))},l=>{ot(n,l)})}function To(n){let s=n._controlledReadableStream;return!Ht(n)||!n._started?!1:!!(ct(s)&&Jr(s)>0||Zi(n)>0)}function wn(n){n._pullAlgorithm=void 0,n._cancelAlgorithm=void 0,n._strategySizeAlgorithm=void 0}function Tr(n){if(!Ht(n))return;let s=n._controlledReadableStream;n._closeRequested=!0,n._queue.length===0&&(wn(n),Sr(s))}function yn(n,s){if(!Ht(n))return;let o=n._controlledReadableStream;if(ct(o)&&Jr(o)>0)Ii(o,s,!1);else{let l;try{l=n._strategySizeAlgorithm(s)}catch(f){throw ot(n,f),f}try{Oi(n,s,l)}catch(f){throw ot(n,f),f}}br(n)}function ot(n,s){let o=n._controlledReadableStream;o._state==="readable"&&(at(n),wn(n),Po(o,s))}function Zi(n){let s=n._controlledReadableStream._state;return s==="errored"?null:s==="closed"?0:n._strategyHWM-n._queueTotalSize}function af(n){return!To(n)}function Ht(n){let s=n._controlledReadableStream._state;return!n._closeRequested&&s==="readable"}function So(n,s,o,l,f,m,g){s._controlledReadableStream=n,s._queue=void 0,s._queueTotalSize=void 0,at(s),s._started=!1,s._closeRequested=!1,s._pullAgain=!1,s._pulling=!1,s._strategySizeAlgorithm=g,s._strategyHWM=m,s._pullAlgorithm=l,s._cancelAlgorithm=f,n._readableStreamController=s;let b=o();L(w(b),()=>{s._started=!0,br(s)},v=>{ot(s,v)})}function of(n,s,o,l){let f=Object.create(Nt.prototype),m=()=>{},g=()=>w(void 0),b=()=>w(void 0);s.start!==void 0&&(m=()=>s.start(f)),s.pull!==void 0&&(g=()=>s.pull(f)),s.cancel!==void 0&&(b=v=>s.cancel(v)),So(n,f,m,g,b,o,l)}function bn(n){return new TypeError(`ReadableStreamDefaultController.prototype.${n} can only be used on a ReadableStreamDefaultController`)}function uf(n,s){return bt(n._readableStreamController)?cf(n):lf(n)}function lf(n,s){let o=Ut(n),l=!1,f=!1,m=!1,g,b,v,C,B,M=R(ue=>{B=ue});function N(){return l||(l=!0,cr(o,{_chunkSteps:ze=>{U(()=>{l=!1;let le=ze,x=ze;f||yn(v._readableStreamController,le),m||yn(C._readableStreamController,x)})},_closeSteps:()=>{l=!1,f||Tr(v._readableStreamController),m||Tr(C._readableStreamController),(!f||!m)&&B(void 0)},_errorSteps:()=>{l=!1}})),w(void 0)}function dt(ue){if(f=!0,g=ue,m){let ze=dr([g,b]),le=Ee(n,ze);B(le)}return M}function vr(ue){if(m=!0,b=ue,f){let ze=dr([g,b]),le=Ee(n,ze);B(le)}return M}function ft(){}return v=es(ft,N,dt),C=es(ft,N,vr),oe(o._closedPromise,ue=>{ot(v._readableStreamController,ue),ot(C._readableStreamController,ue),(!f||!m)&&B(void 0)}),[v,C]}function cf(n){let s=Ut(n),o=!1,l=!1,f=!1,m,g,b,v,C,B=R(x=>{C=x});function M(x){oe(x._closedPromise,W=>{x===s&&(Ie(b._readableStreamController,W),Ie(v._readableStreamController,W),(!l||!f)&&C(void 0))})}function N(){St(s)&&(Ke(s),s=Ut(n),M(s)),cr(s,{_chunkSteps:W=>{U(()=>{o=!1;let q=W,k=W;if(!l&&!f)try{k=za(W)}catch(Y){Ie(b._readableStreamController,Y),Ie(v._readableStreamController,Y),C(Ee(n,Y));return}l||nn(b._readableStreamController,q),f||nn(v._readableStreamController,k)})},_closeSteps:()=>{o=!1,l||hr(b._readableStreamController),f||hr(v._readableStreamController),b._readableStreamController._pendingPullIntos.length>0&&sn(b._readableStreamController,0),v._readableStreamController._pendingPullIntos.length>0&&sn(v._readableStreamController,0),(!l||!f)&&C(void 0)},_errorSteps:()=>{o=!1}})}function dt(x,W){st(s)&&(Ke(s),s=Ja(n),M(s));let q=W?v:b,k=W?b:v;to(s,x,{_chunkSteps:Oe=>{U(()=>{o=!1;let ht=W?f:l;if(W?l:f)ht||an(q._readableStreamController,Oe);else{let Bo;try{Bo=za(Oe)}catch(rs){Ie(q._readableStreamController,rs),Ie(k._readableStreamController,rs),C(Ee(n,rs));return}ht||an(q._readableStreamController,Oe),nn(k._readableStreamController,Bo)}})},_closeSteps:Oe=>{o=!1;let ht=W?f:l,Ln=W?l:f;ht||hr(q._readableStreamController),Ln||hr(k._readableStreamController),Oe!==void 0&&(ht||an(q._readableStreamController,Oe),!Ln&&k._readableStreamController._pendingPullIntos.length>0&&sn(k._readableStreamController,0)),(!ht||!Ln)&&C(void 0)},_errorSteps:()=>{o=!1}})}function vr(){if(o)return w(void 0);o=!0;let x=ji(b._readableStreamController);return x===null?N():dt(x._view,!1),w(void 0)}function ft(){if(o)return w(void 0);o=!0;let x=ji(v._readableStreamController);return x===null?N():dt(x._view,!0),w(void 0)}function ue(x){if(l=!0,m=x,f){let W=dr([m,g]),q=Ee(n,W);C(q)}return B}function ze(x){if(f=!0,g=x,l){let W=dr([m,g]),q=Ee(n,W);C(q)}return B}function le(){}return b=vo(le,vr,ue),v=vo(le,ft,ze),M(s),[b,v]}function df(n,s){Ge(n,s);let o=n,l=o==null?void 0:o.autoAllocateChunkSize,f=o==null?void 0:o.cancel,m=o==null?void 0:o.pull,g=o==null?void 0:o.start,b=o==null?void 0:o.type;return{autoAllocateChunkSize:l===void 0?void 0:ka(l,`${s} has member 'autoAllocateChunkSize' that`),cancel:f===void 0?void 0:ff(f,o,`${s} has member 'cancel' that`),pull:m===void 0?void 0:hf(m,o,`${s} has member 'pull' that`),start:g===void 0?void 0:mf(g,o,`${s} has member 'start' that`),type:b===void 0?void 0:pf(b,`${s} has member 'type' that`)}}function ff(n,s,o){return ke(n,o),l=>Le(n,s,[l])}function hf(n,s,o){return ke(n,o),l=>Le(n,s,[l])}function mf(n,s,o){return ke(n,o),l=>$(n,s,[l])}function pf(n,s){if(n=`${n}`,n!=="bytes")throw new TypeError(`${s} '${n}' is not a valid enumeration value for ReadableStreamType`);return n}function _f(n,s){Ge(n,s);let o=n==null?void 0:n.mode;return{mode:o===void 0?void 0:gf(o,`${s} has member 'mode' that`)}}function gf(n,s){if(n=`${n}`,n!=="byob")throw new TypeError(`${s} '${n}' is not a valid enumeration value for ReadableStreamReaderMode`);return n}function wf(n,s){Ge(n,s);let o=n==null?void 0:n.preventCancel;return{preventCancel:Boolean(o)}}function Ro(n,s){Ge(n,s);let o=n==null?void 0:n.preventAbort,l=n==null?void 0:n.preventCancel,f=n==null?void 0:n.preventClose,m=n==null?void 0:n.signal;return m!==void 0&&yf(m,`${s} has member 'signal' that`),{preventAbort:Boolean(o),preventCancel:Boolean(l),preventClose:Boolean(f),signal:m}}function yf(n,s){if(!Cd(n))throw new TypeError(`${s} is not an AbortSignal.`)}function bf(n,s){Ge(n,s);let o=n==null?void 0:n.readable;Li(o,"readable","ReadableWritablePair"),ki(o,`${s} has member 'readable' that`);let l=n==null?void 0:n.writable;return Li(l,"writable","ReadableWritablePair"),ro(l,`${s} has member 'writable' that`),{readable:o,writable:l}}class ut{constructor(s={},o={}){s===void 0?s=null:La(s,"First parameter");let l=ln(o,"Second parameter"),f=df(s,"First parameter");if(ts(this),f.type==="bytes"){if(l.size!==void 0)throw new RangeError("The strategy for a byte stream cannot have a size function");let m=_r(l,0);Td(this,f,m)}else{let m=un(l),g=_r(l,1);of(this,f,g,m)}}get locked(){if(!lt(this))throw Pt("locked");return ct(this)}cancel(s=void 0){return lt(this)?ct(this)?_(new TypeError("Cannot cancel a stream that already has a reader")):Ee(this,s):_(Pt("cancel"))}getReader(s=void 0){if(!lt(this))throw Pt("getReader");return _f(s,"First parameter").mode===void 0?Ut(this):Ja(this)}pipeThrough(s,o={}){if(!lt(this))throw Pt("pipeThrough");Xe(s,1,"pipeThrough");let l=bf(s,"First parameter"),f=Ro(o,"Second parameter");if(ct(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Vt(l.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");let m=bo(this,l.writable,f.preventClose,f.preventAbort,f.preventCancel,f.signal);return ne(m),l.readable}pipeTo(s,o={}){if(!lt(this))return _(Pt("pipeTo"));if(s===void 0)return _("Parameter 1 is required in 'pipeTo'.");if(!zt(s))return _(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let l;try{l=Ro(o,"Second parameter")}catch(f){return _(f)}return ct(this)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Vt(s)?_(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):bo(this,s,l.preventClose,l.preventAbort,l.preventCancel,l.signal)}tee(){if(!lt(this))throw Pt("tee");let s=uf(this);return dr(s)}values(s=void 0){if(!lt(this))throw Pt("values");let o=wf(s,"First parameter");return md(this,o.preventCancel)}}Object.defineProperties(ut.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(ut.prototype,e.toStringTag,{value:"ReadableStream",configurable:!0}),typeof e.asyncIterator=="symbol"&&Object.defineProperty(ut.prototype,e.asyncIterator,{value:ut.prototype.values,writable:!0,configurable:!0});function es(n,s,o,l=1,f=()=>1){let m=Object.create(ut.prototype);ts(m);let g=Object.create(Nt.prototype);return So(m,g,n,s,o,l,f),m}function vo(n,s,o){let l=Object.create(ut.prototype);ts(l);let f=Object.create(Wt.prototype);return Xa(l,f,n,s,o,0,void 0),l}function ts(n){n._state="readable",n._reader=void 0,n._storedError=void 0,n._disturbed=!1}function lt(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_readableStreamController")?!1:n instanceof ut}function ct(n){return n._reader!==void 0}function Ee(n,s){if(n._disturbed=!0,n._state==="closed")return w(void 0);if(n._state==="errored")return _(n._storedError);Sr(n);let o=n._reader;o!==void 0&&St(o)&&(o._readIntoRequests.forEach(f=>{f._closeSteps(void 0)}),o._readIntoRequests=new Ce);let l=n._readableStreamController[Ai](s);return re(l,t)}function Sr(n){n._state="closed";let s=n._reader;s!==void 0&&(Pa(s),st(s)&&(s._readRequests.forEach(o=>{o._closeSteps()}),s._readRequests=new Ce))}function Po(n,s){n._state="errored",n._storedError=s;let o=n._reader;o!==void 0&&(qi(o,s),st(o)?(o._readRequests.forEach(l=>{l._errorSteps(s)}),o._readRequests=new Ce):(o._readIntoRequests.forEach(l=>{l._errorSteps(s)}),o._readIntoRequests=new Ce))}function Pt(n){return new TypeError(`ReadableStream.prototype.${n} can only be used on a ReadableStream`)}function qo(n,s){Ge(n,s);let o=n==null?void 0:n.highWaterMark;return Li(o,"highWaterMark","QueuingStrategyInit"),{highWaterMark:Ci(o)}}let Ao=n=>n.byteLength;Object.defineProperty(Ao,"name",{value:"size",configurable:!0});class Tn{constructor(s){Xe(s,1,"ByteLengthQueuingStrategy"),s=qo(s,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=s.highWaterMark}get highWaterMark(){if(!Lo(this))throw Do("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Lo(this))throw Do("size");return Ao}}Object.defineProperties(Tn.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Tn.prototype,e.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});function Do(n){return new TypeError(`ByteLengthQueuingStrategy.prototype.${n} can only be used on a ByteLengthQueuingStrategy`)}function Lo(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_byteLengthQueuingStrategyHighWaterMark")?!1:n instanceof Tn}let Co=()=>1;Object.defineProperty(Co,"name",{value:"size",configurable:!0});class Sn{constructor(s){Xe(s,1,"CountQueuingStrategy"),s=qo(s,"First parameter"),this._countQueuingStrategyHighWaterMark=s.highWaterMark}get highWaterMark(){if(!Io(this))throw ko("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Io(this))throw ko("size");return Co}}Object.defineProperties(Sn.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Sn.prototype,e.toStringTag,{value:"CountQueuingStrategy",configurable:!0});function ko(n){return new TypeError(`CountQueuingStrategy.prototype.${n} can only be used on a CountQueuingStrategy`)}function Io(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_countQueuingStrategyHighWaterMark")?!1:n instanceof Sn}function Tf(n,s){Ge(n,s);let o=n==null?void 0:n.flush,l=n==null?void 0:n.readableType,f=n==null?void 0:n.start,m=n==null?void 0:n.transform,g=n==null?void 0:n.writableType;return{flush:o===void 0?void 0:Sf(o,n,`${s} has member 'flush' that`),readableType:l,start:f===void 0?void 0:Rf(f,n,`${s} has member 'start' that`),transform:m===void 0?void 0:vf(m,n,`${s} has member 'transform' that`),writableType:g}}function Sf(n,s,o){return ke(n,o),l=>Le(n,s,[l])}function Rf(n,s,o){return ke(n,o),l=>$(n,s,[l])}function vf(n,s,o){return ke(n,o),(l,f)=>Le(n,s,[l,f])}class Rn{constructor(s={},o={},l={}){s===void 0&&(s=null);let f=ln(o,"Second parameter"),m=ln(l,"Third parameter"),g=Tf(s,"First parameter");if(g.readableType!==void 0)throw new RangeError("Invalid readableType specified");if(g.writableType!==void 0)throw new RangeError("Invalid writableType specified");let b=_r(m,0),v=un(m),C=_r(f,1),B=un(f),M,N=R(dt=>{M=dt});Pf(this,N,C,B,b,v),Af(this,g),g.start!==void 0?M(g.start(this._transformStreamController)):M(void 0)}get readable(){if(!Eo(this))throw Fo("readable");return this._readable}get writable(){if(!Eo(this))throw Fo("writable");return this._writable}}Object.defineProperties(Rn.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Rn.prototype,e.toStringTag,{value:"TransformStream",configurable:!0});function Pf(n,s,o,l,f,m){function g(){return s}function b(N){return Cf(n,N)}function v(N){return kf(n,N)}function C(){return If(n)}n._writable=Ed(g,b,C,v,o,l);function B(){return Ef(n)}function M(N){return Pn(n,N),w(void 0)}n._readable=es(g,B,M,f,m),n._backpressure=void 0,n._backpressureChangePromise=void 0,n._backpressureChangePromise_resolve=void 0,qn(n,!0),n._transformStreamController=void 0}function Eo(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_transformStreamController")?!1:n instanceof Rn}function vn(n,s){ot(n._readable._readableStreamController,s),Pn(n,s)}function Pn(n,s){Oo(n._transformStreamController),Qi(n._writable._writableStreamController,s),n._backpressure&&qn(n,!1)}function qn(n,s){n._backpressureChangePromise!==void 0&&n._backpressureChangePromise_resolve(),n._backpressureChangePromise=R(o=>{n._backpressureChangePromise_resolve=o}),n._backpressure=s}class Rr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!An(this))throw Dn("desiredSize");let s=this._controlledTransformStream._readable._readableStreamController;return Zi(s)}enqueue(s=void 0){if(!An(this))throw Dn("enqueue");Mo(this,s)}error(s=void 0){if(!An(this))throw Dn("error");Df(this,s)}terminate(){if(!An(this))throw Dn("terminate");Lf(this)}}Object.defineProperties(Rr.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),typeof e.toStringTag=="symbol"&&Object.defineProperty(Rr.prototype,e.toStringTag,{value:"TransformStreamDefaultController",configurable:!0});function An(n){return!u(n)||!Object.prototype.hasOwnProperty.call(n,"_controlledTransformStream")?!1:n instanceof Rr}function qf(n,s,o,l){s._controlledTransformStream=n,n._transformStreamController=s,s._transformAlgorithm=o,s._flushAlgorithm=l}function Af(n,s){let o=Object.create(Rr.prototype),l=m=>{try{return Mo(o,m),w(void 0)}catch(g){return _(g)}},f=()=>w(void 0);s.transform!==void 0&&(l=m=>s.transform(m,o)),s.flush!==void 0&&(f=()=>s.flush(o)),qf(n,o,l,f)}function Oo(n){n._transformAlgorithm=void 0,n._flushAlgorithm=void 0}function Mo(n,s){let o=n._controlledTransformStream,l=o._readable._readableStreamController;if(!Ht(l))throw new TypeError("Readable side is not in a state that permits enqueue");try{yn(l,s)}catch(m){throw Pn(o,m),o._readable._storedError}af(l)!==o._backpressure&&qn(o,!0)}function Df(n,s){vn(n._controlledTransformStream,s)}function xo(n,s){let o=n._transformAlgorithm(s);return re(o,void 0,l=>{throw vn(n._controlledTransformStream,l),l})}function Lf(n){let s=n._controlledTransformStream,o=s._readable._readableStreamController;Tr(o);let l=new TypeError("TransformStream terminated");Pn(s,l)}function Cf(n,s){let o=n._transformStreamController;if(n._backpressure){let l=n._backpressureChangePromise;return re(l,()=>{let f=n._writable;if(f._state==="erroring")throw f._storedError;return xo(o,s)})}return xo(o,s)}function kf(n,s){return vn(n,s),w(void 0)}function If(n){let s=n._readable,o=n._transformStreamController,l=o._flushAlgorithm();return Oo(o),re(l,()=>{if(s._state==="errored")throw s._storedError;Tr(s._readableStreamController)},f=>{throw vn(n,f),s._storedError})}function Ef(n){return qn(n,!1),n._backpressureChangePromise}function Dn(n){return new TypeError(`TransformStreamDefaultController.prototype.${n} can only be used on a TransformStreamDefaultController`)}function Fo(n){return new TypeError(`TransformStream.prototype.${n} can only be used on a TransformStream`)}r.ByteLengthQueuingStrategy=Tn,r.CountQueuingStrategy=Sn,r.ReadableByteStreamController=Wt,r.ReadableStream=ut,r.ReadableStreamBYOBReader=pr,r.ReadableStreamBYOBRequest=fr,r.ReadableStreamDefaultController=Nt,r.ReadableStreamDefaultReader=lr,r.TransformStream=Rn,r.TransformStreamDefaultController=Rr,r.WritableStream=gr,r.WritableStreamDefaultController=$t,r.WritableStreamDefaultWriter=wr,Object.defineProperty(r,"__esModule",{value:!0})})});var Ko=T(()=>{if(!globalThis.ReadableStream)try{Object.assign(globalThis,require("stream/web"))}catch{Object.assign(globalThis,Yo())}try{let{Blob:r}=require("buffer");r&&!r.prototype.stream&&(r.prototype.stream=function(t){let i=0,a=this;return new ReadableStream({type:"bytes",async pull(u){let d=await a.slice(i,Math.min(a.size,i+65536)).arrayBuffer();i+=d.byteLength,u.enqueue(new Uint8Array(d)),i===a.size&&u.close()}})})}catch{}});var xe=T(ve=>{"use strict";Object.defineProperty(ve,"__esModule",{value:!0});ve.API_V1_1_STREAM_PREFIX=ve.API_V1_1_UPLOAD_PREFIX=ve.API_V1_1_PREFIX=ve.API_V2_LABS_PREFIX=ve.API_V2_PREFIX=void 0;ve.API_V2_PREFIX="https://api.twitter.com/2/";ve.API_V2_LABS_PREFIX="https://api.twitter.com/labs/2/";ve.API_V1_1_PREFIX="https://api.twitter.com/1.1/";ve.API_V1_1_UPLOAD_PREFIX="https://upload.twitter.com/1.1/";ve.API_V1_1_STREAM_PREFIX="https://stream.twitter.com/1.1/"});var Kt=T(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.PreviousableTwitterPaginator=Lt.TwitterPaginator=void 0;var Un=class{constructor({realData:e,rateLimit:t,instance:i,queryParams:a,sharedParams:u}){this._maxResultsWhenFetchLast=100,this._realData=e,this._rateLimit=t,this._instance=i,this._queryParams=a,this._sharedParams=u}get _isRateLimitOk(){return this._rateLimit.reset*1e3<Date.now()?!0:this._rateLimit.remaining>0}makeRequest(e){return this._instance.get(this.getEndpoint(),e,{fullResponse:!0,params:this._sharedParams})}makeNewInstanceFromResult(e,t){return new this.constructor({realData:e.data,rateLimit:e.rateLimit,instance:this._instance,queryParams:t,sharedParams:this._sharedParams})}getEndpoint(){return this._endpoint}injectQueryParams(e){return p(p({},e?{max_results:e}:{}),this._queryParams)}async next(e){let t=this.getNextQueryParams(e),i=await this.makeRequest(t);return this.makeNewInstanceFromResult(i,t)}async fetchNext(e){let t=this.getNextQueryParams(e),i=await this.makeRequest(t);return await this.refreshInstanceFromResult(i,!0),this}async fetchLast(e=1/0){let t=this.getNextQueryParams(this._maxResultsWhenFetchLast),i=0;for(;i<e&&this._isRateLimitOk;){let a=await this.makeRequest(t);if(await this.refreshInstanceFromResult(a,!0),i+=this.getPageLengthFromRequest(a),this.isFetchLastOver(a))break;t=this.getNextQueryParams(this._maxResultsWhenFetchLast)}return this}get rateLimit(){return p({},this._rateLimit)}get data(){return this._realData}get done(){return!this.canFetchNextPage(this._realData)}*[Symbol.iterator](){yield*this.getItemArray()}async*[Symbol.asyncIterator](){yield*this.getItemArray();let e=this,t=this.canFetchNextPage(this._realData);for(;t&&this._isRateLimitOk&&e.getItemArray().length>0;){let i=await e.next(this._maxResultsWhenFetchLast);this.refreshInstanceFromResult({data:i._realData,headers:{},rateLimit:i._rateLimit},!0),t=this.canFetchNextPage(i._realData),yield*i.getItemArray(),e=i}}async*fetchAndIterate(){for(let i of this.getItemArray())yield[i,this];let e=this,t=this.canFetchNextPage(this._realData);for(;t&&this._isRateLimitOk&&e.getItemArray().length>0;){let i=await e.next(this._maxResultsWhenFetchLast);this.refreshInstanceFromResult({data:i._realData,headers:{},rateLimit:i._rateLimit},!0),t=this.canFetchNextPage(i._realData);for(let a of i.getItemArray())yield[a,i];this._rateLimit=i._rateLimit,e=i}}};Lt.TwitterPaginator=Un;var wu=class extends Un{async previous(e){let t=this.getPreviousQueryParams(e),i=await this.makeRequest(t);return this.makeNewInstanceFromResult(i,t)}async fetchPrevious(e){let t=this.getPreviousQueryParams(e),i=await this.makeRequest(t);return await this.refreshInstanceFromResult(i,!1),this}};Lt.PreviousableTwitterPaginator=wu;Lt.default=Un});var Lr=T(Gt=>{"use strict";var Xf=Gt&&Gt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Gt,"__esModule",{value:!0});Gt.CursoredV1Paginator=void 0;var Jf=Xf(Kt()),yu=class extends Jf.default{getNextQueryParams(e){var t;return p(j(p({},this._queryParams),{cursor:(t=this._realData.next_cursor_str)!==null&&t!==void 0?t:this._realData.next_cursor}),e?{count:e}:{})}isFetchLastOver(e){return!this.canFetchNextPage(e.data)}canFetchNextPage(e){return!this.isNextCursorInvalid(e.next_cursor)||!this.isNextCursorInvalid(e.next_cursor_str)}isNextCursorInvalid(e){return e===void 0||e===0||e===-1||e==="0"||e==="-1"}};Gt.CursoredV1Paginator=yu});var gs=T(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.WelcomeDmV1Paginator=Xt.DmEventsV1Paginator=void 0;var bu=Lr(),Tu=class extends bu.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="direct_messages/events/list.json"}refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.events.push(...i.events),this._realData.next_cursor=i.next_cursor)}getPageLengthFromRequest(e){return e.data.events.length}getItemArray(){return this.events}get events(){return this._realData.events}};Xt.DmEventsV1Paginator=Tu;var Su=class extends bu.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="direct_messages/welcome_messages/list.json"}refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.welcome_messages.push(...i.welcome_messages),this._realData.next_cursor=i.next_cursor)}getPageLengthFromRequest(e){return e.data.welcome_messages.length}getItemArray(){return this.welcomeMessages}get welcomeMessages(){return this._realData.welcome_messages}};Xt.WelcomeDmV1Paginator=Su});var vu=T(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0})});var Pu=T(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.EUploadMimeType=void 0;var Zf;(function(r){r.Jpeg="image/jpeg",r.Mp4="video/mp4",r.Gif="image/gif",r.Png="image/png",r.Srt="text/plain",r.Webp="image/webp"})(Zf=Cr.EUploadMimeType||(Cr.EUploadMimeType={}))});var Au=T(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0})});var Lu=T(Du=>{"use strict";Object.defineProperty(Du,"__esModule",{value:!0})});var ku=T(Cu=>{"use strict";Object.defineProperty(Cu,"__esModule",{value:!0})});var Eu=T(Iu=>{"use strict";Object.defineProperty(Iu,"__esModule",{value:!0})});var Mu=T(Ou=>{"use strict";Object.defineProperty(Ou,"__esModule",{value:!0})});var xu=T(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.EDirectMessageEventTypeV1=void 0;var eh;(function(r){r.Create="message_create",r.WelcomeCreate="welcome_message"})(eh=kr.EDirectMessageEventTypeV1||(kr.EDirectMessageEventTypeV1={}))});var Bu=T(Fu=>{"use strict";Object.defineProperty(Fu,"__esModule",{value:!0})});var ju=T(ie=>{"use strict";var th=ie&&ie.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),Ze=ie&&ie.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&th(e,r,t)};Object.defineProperty(ie,"__esModule",{value:!0});Ze(vu(),ie);Ze(Pu(),ie);Ze(Au(),ie);Ze(Lu(),ie);Ze(ku(),ie);Ze(Eu(),ie);Ze(Mu(),ie);Ze(xu(),ie);Ze(Bu(),ie)});var Wu=T(Uu=>{"use strict";Object.defineProperty(Uu,"__esModule",{value:!0})});var Vu=T(zu=>{"use strict";Object.defineProperty(zu,"__esModule",{value:!0})});var Nu=T($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0})});var Qu=T(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0})});var Ku=T(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0})});var Xu=T(Gu=>{"use strict";Object.defineProperty(Gu,"__esModule",{value:!0})});var Ju=T(Pe=>{"use strict";var rh=Pe&&Pe.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),Jt=Pe&&Pe.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&rh(e,r,t)};Object.defineProperty(Pe,"__esModule",{value:!0});Jt(Wu(),Pe);Jt(Vu(),Pe);Jt(Nu(),Pe);Jt(Qu(),Pe);Jt(Ku(),Pe);Jt(Xu(),Pe)});var rl=T(J=>{"use strict";Object.defineProperty(J,"__esModule",{value:!0});J.EApiV2ErrorCode=J.EApiV1ErrorCode=J.ApiResponseError=J.ApiPartialResponseError=J.ApiRequestError=J.ETwitterApiError=void 0;var Wn;(function(r){r.Request="request",r.PartialResponse="partial-response",r.Response="response"})(Wn=J.ETwitterApiError||(J.ETwitterApiError={}));var zn=class extends Error{constructor(){super(...arguments);this.error=!0}},Zu=class extends zn{constructor(e,t){super(e);this.type=Wn.Request,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t})}get request(){return this._options.request}get requestError(){return this._options.requestError}toJSON(){return{type:this.type,error:this.requestError}}};J.ApiRequestError=Zu;var el=class extends zn{constructor(e,t){super(e);this.type=Wn.PartialResponse,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t})}get request(){return this._options.request}get response(){return this._options.response}get responseError(){return this._options.responseError}get rawContent(){return this._options.rawContent}toJSON(){return{type:this.type,error:this.responseError}}};J.ApiPartialResponseError=el;var tl=class extends zn{constructor(e,t){super(e);this.type=Wn.Response,Error.captureStackTrace(this,this.constructor),Object.defineProperty(this,"_options",{value:t}),this.code=t.code,this.headers=t.headers,this.rateLimit=t.rateLimit,this.data=t.data}get request(){return this._options.request}get response(){return this._options.response}hasErrorCode(...e){let t=this.errors;if(!(t==null?void 0:t.length))return!1;if("code"in t[0])return t.some(u=>e.includes(u.code));let i=this.data;return e.includes(i.type)}get errors(){var e;return(e=this.data)===null||e===void 0?void 0:e.errors}get rateLimitError(){return this.code===420||this.code===429}get isAuthError(){return this.code===401?!0:this.hasErrorCode(Ir.AuthTimestampInvalid,Ir.AuthenticationFail,Ir.BadAuthenticationData,Ir.InvalidOrExpiredToken)}toJSON(){return{type:this.type,code:this.code,error:this.data,rateLimit:this.rateLimit,headers:this.headers}}};J.ApiResponseError=tl;var Ir;(function(r){r[r.InvalidCoordinates=3]="InvalidCoordinates",r[r.NoLocationFound=13]="NoLocationFound",r[r.AuthenticationFail=32]="AuthenticationFail",r[r.InvalidOrExpiredToken=89]="InvalidOrExpiredToken",r[r.UnableToVerifyCredentials=99]="UnableToVerifyCredentials",r[r.AuthTimestampInvalid=135]="AuthTimestampInvalid",r[r.BadAuthenticationData=215]="BadAuthenticationData",r[r.NoUserMatch=17]="NoUserMatch",r[r.UserNotFound=50]="UserNotFound",r[r.ResourceNotFound=34]="ResourceNotFound",r[r.TweetNotFound=144]="TweetNotFound",r[r.TweetNotVisible=179]="TweetNotVisible",r[r.NotAllowedResource=220]="NotAllowedResource",r[r.MediaIdNotFound=325]="MediaIdNotFound",r[r.TweetNoLongerAvailable=421]="TweetNoLongerAvailable",r[r.TweetViolatedRules=422]="TweetViolatedRules",r[r.TargetUserSuspended=63]="TargetUserSuspended",r[r.YouAreSuspended=64]="YouAreSuspended",r[r.AccountUpdateFailed=120]="AccountUpdateFailed",r[r.NoSelfSpamReport=36]="NoSelfSpamReport",r[r.NoSelfMute=271]="NoSelfMute",r[r.AccountLocked=326]="AccountLocked",r[r.RateLimitExceeded=88]="RateLimitExceeded",r[r.NoDMRightForApp=93]="NoDMRightForApp",r[r.OverCapacity=130]="OverCapacity",r[r.InternalError=131]="InternalError",r[r.TooManyFollowings=161]="TooManyFollowings",r[r.TweetLimitExceeded=185]="TweetLimitExceeded",r[r.DuplicatedTweet=187]="DuplicatedTweet",r[r.TooManySpamReports=205]="TooManySpamReports",r[r.RequestLooksLikeSpam=226]="RequestLooksLikeSpam",r[r.NoWriteRightForApp=261]="NoWriteRightForApp",r[r.TweetActionsDisabled=425]="TweetActionsDisabled",r[r.TweetRepliesRestricted=433]="TweetRepliesRestricted",r[r.NamedParameterMissing=38]="NamedParameterMissing",r[r.InvalidAttachmentUrl=44]="InvalidAttachmentUrl",r[r.TweetTextTooLong=186]="TweetTextTooLong",r[r.MissingUrlParameter=195]="MissingUrlParameter",r[r.NoMultipleGifs=323]="NoMultipleGifs",r[r.InvalidMediaIds=324]="InvalidMediaIds",r[r.InvalidUrl=407]="InvalidUrl",r[r.TooManyTweetAttachments=386]="TooManyTweetAttachments",r[r.StatusAlreadyFavorited=139]="StatusAlreadyFavorited",r[r.FollowRequestAlreadySent=160]="FollowRequestAlreadySent",r[r.CannotUnmuteANonMutedAccount=272]="CannotUnmuteANonMutedAccount",r[r.TweetAlreadyRetweeted=327]="TweetAlreadyRetweeted",r[r.ReplyToDeletedTweet=385]="ReplyToDeletedTweet",r[r.DMReceiverNotFollowingYou=150]="DMReceiverNotFollowingYou",r[r.UnableToSendDM=151]="UnableToSendDM",r[r.MustAllowDMFromAnyone=214]="MustAllowDMFromAnyone",r[r.CannotSendDMToThisUser=349]="CannotSendDMToThisUser",r[r.DMTextTooLong=354]="DMTextTooLong",r[r.SubscriptionAlreadyExists=355]="SubscriptionAlreadyExists",r[r.CallbackUrlNotApproved=415]="CallbackUrlNotApproved",r[r.SuspendedApplication=416]="SuspendedApplication",r[r.OobOauthIsNotAllowed=417]="OobOauthIsNotAllowed"})(Ir=J.EApiV1ErrorCode||(J.EApiV1ErrorCode={}));var nh;(function(r){r.InvalidRequest="https://api.twitter.com/2/problems/invalid-request",r.ClientForbidden="https://api.twitter.com/2/problems/client-forbidden",r.UnsupportedAuthentication="https://api.twitter.com/2/problems/unsupported-authentication",r.InvalidRules="https://api.twitter.com/2/problems/invalid-rules",r.TooManyRules="https://api.twitter.com/2/problems/rule-cap",r.DuplicatedRules="https://api.twitter.com/2/problems/duplicate-rules",r.RateLimitExceeded="https://api.twitter.com/2/problems/usage-capped",r.ConnectionError="https://api.twitter.com/2/problems/streaming-connection",r.ClientDisconnected="https://api.twitter.com/2/problems/client-disconnected",r.TwitterDisconnectedYou="https://api.twitter.com/2/problems/operational-disconnect",r.ResourceNotFound="https://api.twitter.com/2/problems/resource-not-found",r.ResourceUnauthorized="https://api.twitter.com/2/problems/not-authorized-for-resource",r.DisallowedResource="https://api.twitter.com/2/problems/disallowed-resource"})(nh=J.EApiV2ErrorCode||(J.EApiV2ErrorCode={}))});var il=T(nl=>{"use strict";Object.defineProperty(nl,"__esModule",{value:!0})});var sl=T(Er=>{"use strict";Object.defineProperty(Er,"__esModule",{value:!0});Er.ETwitterStreamEvent=void 0;var ih;(function(r){r.Connected="connected",r.ConnectError="connect error",r.ConnectionError="connection error",r.ConnectionClosed="connection closed",r.ConnectionLost="connection lost",r.ReconnectAttempt="reconnect attempt",r.Reconnected="reconnected",r.ReconnectError="reconnect error",r.ReconnectLimitExceeded="reconnect limit exceeded",r.DataKeepAlive="data keep-alive",r.Data="data event content",r.DataError="data twitter error",r.TweetParseError="data tweet parse error",r.Error="stream error"})(ih=Er.ETwitterStreamEvent||(Er.ETwitterStreamEvent={}))});var ol=T(al=>{"use strict";Object.defineProperty(al,"__esModule",{value:!0})});var ll=T(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.TwitterApiPluginResponseOverride=void 0;var ul=class{constructor(e){this.value=e}};Vn.TwitterApiPluginResponseOverride=ul});var cl=T(Ct=>{"use strict";var sh=Ct&&Ct.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),ah=Ct&&Ct.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&sh(e,r,t)};Object.defineProperty(Ct,"__esModule",{value:!0});ah(ll(),Ct)});var Ne=T(ge=>{"use strict";var oh=ge&&ge.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),kt=ge&&ge.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&oh(e,r,t)};Object.defineProperty(ge,"__esModule",{value:!0});kt(ju(),ge);kt(Ju(),ge);kt(rl(),ge);kt(il(),ge);kt(sl(),ge);kt(ol(),ge);kt(cl(),ge)});var Nn=T($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.TwitterApiV2Settings=void 0;$n.TwitterApiV2Settings={debug:!1,deprecationWarnings:!0,logger:{log:console.log.bind(console)}}});var bs=T(we=>{"use strict";var uh=we&&we.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),lh=we&&we.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),ch=we&&we.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&uh(e,r,t);return lh(e,r),e},dh=we&&we.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(we,"__esModule",{value:!0});we.RequestHandlerHelper=void 0;var fh=require("https"),fe=Nn(),hh=dh(Hn()),ws=Ne(),et=ch(require("zlib")),ys=class{constructor(e){this.requestData=e,this.requestErrorHandled=!1,this.responseData=[]}get hrefPathname(){let e=this.requestData.url;return e.hostname+e.pathname}isCompressionDisabled(){return!this.requestData.compression||this.requestData.compression==="identity"}isFormEncodedEndpoint(){return this.requestData.url.href.startsWith("https://api.twitter.com/oauth/")}createRequestError(e){return fe.TwitterApiV2Settings.debug&&fe.TwitterApiV2Settings.logger.log("Request error:",e),new ws.ApiRequestError("Request failed.",{request:this.req,error:e})}createPartialResponseError(e,t){let a=`Request failed with partial response with HTTP code ${this.res.statusCode}`;return t?a+=" (connection abruptly closed)":a+=" (parse error)",new ws.ApiPartialResponseError(a,{request:this.req,response:this.res,responseError:e,rawContent:Buffer.concat(this.responseData).toString()})}formatV1Errors(e){return e.map(({code:t,message:i})=>`${i} (Twitter code ${t})`).join(", ")}formatV2Error(e){return`${e.title}: ${e.detail} (see ${e.type})`}createResponseError({res:e,data:t,rateLimit:i,code:a}){var u;fe.TwitterApiV2Settings.debug&&(fe.TwitterApiV2Settings.logger.log(`Request failed with code ${a}, data:`,t),fe.TwitterApiV2Settings.logger.log("Response headers:",e.headers));let c=`Request failed with code ${a}`;if((u=t==null?void 0:t.errors)===null||u===void 0?void 0:u.length){let d=t.errors;"code"in d[0]?c+=" - "+this.formatV1Errors(d):c+=" - "+this.formatV2Error(t)}return new ws.ApiResponseError(c,{code:a,data:t,headers:e.headers,request:this.req,response:e,rateLimit:i})}getResponseDataStream(e){if(this.isCompressionDisabled())return e;let t=(e.headers["content-encoding"]||"identity").trim().toLowerCase();if(t==="br"){let i=et.createBrotliDecompress({flush:et.constants.BROTLI_OPERATION_FLUSH,finishFlush:et.constants.BROTLI_OPERATION_FLUSH});return e.pipe(i),i}if(t==="gzip"){let i=et.createGunzip({flush:et.constants.Z_SYNC_FLUSH,finishFlush:et.constants.Z_SYNC_FLUSH});return e.pipe(i),i}if(t==="deflate"){let i=et.createInflate({flush:et.constants.Z_SYNC_FLUSH,finishFlush:et.constants.Z_SYNC_FLUSH});return e.pipe(i),i}return e}detectResponseType(e){var t,i;return((t=e.headers["content-type"])===null||t===void 0?void 0:t.includes("application/json"))||((i=e.headers["content-type"])===null||i===void 0?void 0:i.includes("application/problem+json"))?"json":this.isFormEncodedEndpoint()?"url":"text"}getParsedResponse(e){let t=this.responseData,i=this.requestData.forceParseMode||this.detectResponseType(e);if(i==="buffer")return Buffer.concat(t);if(i==="text")return Buffer.concat(t).toString();if(i==="json"){let a=Buffer.concat(t).toString();return a.length?JSON.parse(a):void 0}else if(i==="url"){let a=Buffer.concat(t).toString(),u={};for(let[c,d]of new URLSearchParams(a))u[c]=d;return u}else return}getRateLimitFromResponse(e){let t;return e.headers["x-rate-limit-limit"]&&(t={limit:Number(e.headers["x-rate-limit-limit"]),remaining:Number(e.headers["x-rate-limit-remaining"]),reset:Number(e.headers["x-rate-limit-reset"])},this.requestData.rateLimitSaver&&this.requestData.rateLimitSaver(t)),t}onSocketEventHandler(e,t){t.on("close",this.onSocketCloseHandler.bind(this,e))}onSocketCloseHandler(e){if(this.req.removeAllListeners("timeout"),!this.res&&!this.requestErrorHandled)return e(this.createRequestError(new Error("Socket closed without any information.")))}requestErrorHandler(e,t){var i,a;(a=(i=this.requestData).requestEventDebugHandler)===null||a===void 0||a.call(i,"request-error",{requestError:t}),this.requestErrorHandled=!0,e(this.createRequestError(t))}timeoutErrorHandler(){this.requestErrorHandled=!0,this.req.destroy(new Error("Request timeout."))}classicResponseHandler(e,t,i){this.res=i;let a=this.getResponseDataStream(i);a.on("data",u=>this.responseData.push(u)),a.on("end",this.onResponseEndHandler.bind(this,e,t)),a.on("close",this.onResponseCloseHandler.bind(this,e,t)),this.requestData.requestEventDebugHandler&&(this.requestData.requestEventDebugHandler("response",{res:i}),i.on("aborted",u=>this.requestData.requestEventDebugHandler("response-aborted",{error:u})),i.on("error",u=>this.requestData.requestEventDebugHandler("response-error",{error:u})),i.on("close",()=>this.requestData.requestEventDebugHandler("response-close",{data:this.responseData})),i.on("end",()=>this.requestData.requestEventDebugHandler("response-end")))}onResponseEndHandler(e,t){let i=this.getRateLimitFromResponse(this.res),a;try{a=this.getParsedResponse(this.res)}catch(c){t(this.createPartialResponseError(c,!1));return}let u=this.res.statusCode;if(u>=400){t(this.createResponseError({data:a,res:this.res,rateLimit:i,code:u}));return}fe.TwitterApiV2Settings.debug&&(fe.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${this.res.statusCode}`),fe.TwitterApiV2Settings.logger.log("Response body:",a)),e({data:a,headers:this.res.headers,rateLimit:i})}onResponseCloseHandler(e,t){let i=this.res;if(i.aborted)try{return this.getParsedResponse(this.res),this.onResponseEndHandler(e,t)}catch(a){return t(this.createPartialResponseError(a,!0))}if(!i.complete)return t(this.createPartialResponseError(new Error("Response has been interrupted before response could be parsed."),!0))}streamResponseHandler(e,t,i){if(i.statusCode<400){fe.TwitterApiV2Settings.debug&&fe.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]: Request succeeds with code ${i.statusCode} (starting stream)`);let u=this.getResponseDataStream(i);e({req:this.req,res:u,originalResponse:i,requestData:this.requestData})}else this.classicResponseHandler(()=>{},t,i)}debugRequest(){let e=this.requestData.url;fe.TwitterApiV2Settings.logger.log(`[${this.requestData.options.method} ${this.hrefPathname}]`,this.requestData.options),e.search&&fe.TwitterApiV2Settings.logger.log("Request parameters:",[...e.searchParams.entries()].map(([t,i])=>`${t}: ${i}`)),this.requestData.body&&fe.TwitterApiV2Settings.logger.log("Request body:",this.requestData.body)}buildRequest(){var e;let t=this.requestData.url,i=t.username?`${t.username}:${t.password}`:void 0,a=(e=this.requestData.options.headers)!==null&&e!==void 0?e:{};this.requestData.compression===!0||this.requestData.compression==="brotli"?a["accept-encoding"]="br;q=1.0, gzip;q=0.8, deflate;q=0.5, *;q=0.1":this.requestData.compression==="gzip"?a["accept-encoding"]="gzip;q=1, deflate;q=0.5, *;q=0.1":this.requestData.compression==="deflate"&&(a["accept-encoding"]="deflate;q=1, *;q=0.1"),fe.TwitterApiV2Settings.debug&&this.debugRequest(),this.req=(0,fh.request)(j(p({},this.requestData.options),{host:t.hostname,port:t.port||void 0,path:t.pathname+t.search,protocol:t.protocol,auth:i,headers:a}))}registerRequestEventDebugHandlers(e){e.on("close",()=>this.requestData.requestEventDebugHandler("close")),e.on("abort",()=>this.requestData.requestEventDebugHandler("abort")),e.on("socket",t=>{this.requestData.requestEventDebugHandler("socket",{socket:t}),t.on("error",i=>this.requestData.requestEventDebugHandler("socket-error",{socket:t,error:i})),t.on("connect",()=>this.requestData.requestEventDebugHandler("socket-connect",{socket:t})),t.on("close",i=>this.requestData.requestEventDebugHandler("socket-close",{socket:t,withError:i})),t.on("end",()=>this.requestData.requestEventDebugHandler("socket-end",{socket:t})),t.on("lookup",(...i)=>this.requestData.requestEventDebugHandler("socket-lookup",{socket:t,data:i})),t.on("timeout",()=>this.requestData.requestEventDebugHandler("socket-timeout",{socket:t}))})}makeRequest(){return this.buildRequest(),new Promise((e,t)=>{let i=this.req;i.on("error",this.requestErrorHandler.bind(this,t)),i.on("socket",this.onSocketEventHandler.bind(this,t)),i.on("response",this.classicResponseHandler.bind(this,e,t)),this.requestData.options.timeout&&i.on("timeout",this.timeoutErrorHandler.bind(this)),this.requestData.requestEventDebugHandler&&this.registerRequestEventDebugHandlers(i),this.requestData.body&&i.write(this.requestData.body),i.end()})}async makeRequestAsStream(){let{req:e,res:t,requestData:i,originalResponse:a}=await this.makeRequestAndResolveWhenReady();return new hh.default(i,{req:e,res:t,originalResponse:a})}makeRequestAndResolveWhenReady(){return this.buildRequest(),new Promise((e,t)=>{let i=this.req;i.on("error",this.requestErrorHandler.bind(this,t)),i.on("response",this.streamResponseHandler.bind(this,e,t)),this.requestData.body&&i.write(this.requestData.body),i.end()})}};we.RequestHandlerHelper=ys;we.default=ys});var dl=T(Or=>{"use strict";Object.defineProperty(Or,"__esModule",{value:!0});Or.TweetStreamEventCombiner=void 0;var mh=require("events"),_t=Ne(),Ts=class extends mh.EventEmitter{constructor(e){super();this.stream=e,this.stack=[],this.onStreamData=this.onStreamData.bind(this),this.onStreamError=this.onStreamError.bind(this),this.onceNewEvent=this.once.bind(this,"event"),e.on(_t.ETwitterStreamEvent.Data,this.onStreamData),e.on(_t.ETwitterStreamEvent.ConnectionError,this.onStreamError),e.on(_t.ETwitterStreamEvent.TweetParseError,this.onStreamError),e.on(_t.ETwitterStreamEvent.ConnectionClosed,this.onStreamError)}nextEvent(){return new Promise(this.onceNewEvent)}hasStack(){return this.stack.length>0}popStack(){let e=this.stack;return this.stack=[],e}destroy(){this.removeAllListeners(),this.stream.off(_t.ETwitterStreamEvent.Data,this.onStreamData),this.stream.off(_t.ETwitterStreamEvent.ConnectionError,this.onStreamError),this.stream.off(_t.ETwitterStreamEvent.TweetParseError,this.onStreamError),this.stream.off(_t.ETwitterStreamEvent.ConnectionClosed,this.onStreamError)}emitEvent(e,t){this.emit("event",{type:e,payload:t})}onStreamError(e){this.emitEvent("error",e)}onStreamData(e){this.stack.push(e),this.emitEvent("data",e)}};Or.TweetStreamEventCombiner=Ts;Or.default=Ts});var hl=T(Zt=>{"use strict";Object.defineProperty(Zt,"__esModule",{value:!0});Zt.EStreamParserEvent=void 0;var ph=require("events"),fl=class extends ph.EventEmitter{constructor(){super(...arguments);this.currentMessage=""}push(e){this.currentMessage+=e,e=this.currentMessage;let t=e.length,i=0,a=0;for(;a<t;){if(e.slice(a,a+2)===`\r
`){let u=e.slice(i,a);if(i=a+=2,!u.length)continue;try{let c=JSON.parse(u);if(c){this.emit(Ss.ParsedData,c);continue}}catch(c){this.emit(Ss.ParseError,c)}}a++}this.currentMessage=e.slice(i,t)}reset(){this.currentMessage=""}};Zt.default=fl;var Ss;(function(r){r.ParsedData="parsed data",r.ParseError="parse error"})(Ss=Zt.EStreamParserEvent||(Zt.EStreamParserEvent={}))});var Hn=T(ye=>{"use strict";var _h=ye&&ye.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),gh=ye&&ye.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),wh=ye&&ye.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&_h(e,r,t);return gh(e,r),e},_l=ye&&ye.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ye,"__esModule",{value:!0});ye.TweetStream=void 0;var yh=require("events"),ml=_l(bs()),O=Ne(),bh=_l(dl()),Rs=wh(hl()),pl=[5,15,30,60,90,120,180,300,600,900],Th=r=>r>pl.length?901e3:pl[r-1]*1e3,vs=class extends yh.EventEmitter{constructor(e,t){super();this.requestData=e,this.autoReconnect=!1,this.autoReconnectRetries=5,this.keepAliveTimeoutMs=1e3*120,this.nextRetryTimeout=Th,this.parser=new Rs.default,this.connectionProcessRunning=!1,this.onKeepAliveTimeout=this.onKeepAliveTimeout.bind(this),this.initEventsFromParser(),t&&(this.req=t.req,this.res=t.res,this.originalResponse=t.originalResponse,this.initEventsFromRequest())}on(e,t){return super.on(e,t)}initEventsFromRequest(){if(!this.req||!this.res)throw new Error("TweetStream error: You cannot init TweetStream without a request and response object.");let e=t=>{this.emit(O.ETwitterStreamEvent.ConnectionError,t),this.emit(O.ETwitterStreamEvent.Error,{type:O.ETwitterStreamEvent.ConnectionError,error:t,message:"Connection lost or closed by Twitter."}),this.onConnectionError()};this.req.on("error",e),this.res.on("error",e),this.res.on("close",()=>e(new Error("Connection closed by Twitter."))),this.res.on("data",t=>{if(this.resetKeepAliveTimeout(),t.toString()===`\r
`)return this.emit(O.ETwitterStreamEvent.DataKeepAlive);this.parser.push(t.toString())}),this.resetKeepAliveTimeout()}initEventsFromParser(){let e=this.requestData.payloadIsError;this.parser.on(Rs.EStreamParserEvent.ParsedData,t=>{e&&e(t)?(this.emit(O.ETwitterStreamEvent.DataError,t),this.emit(O.ETwitterStreamEvent.Error,{type:O.ETwitterStreamEvent.DataError,error:t,message:"Twitter sent a payload that is detected as an error payload."})):this.emit(O.ETwitterStreamEvent.Data,t)}),this.parser.on(Rs.EStreamParserEvent.ParseError,t=>{this.emit(O.ETwitterStreamEvent.TweetParseError,t),this.emit(O.ETwitterStreamEvent.Error,{type:O.ETwitterStreamEvent.TweetParseError,error:t,message:"Failed to parse stream data."})})}resetKeepAliveTimeout(){this.unbindKeepAliveTimeout(),this.keepAliveTimeoutMs!==1/0&&(this.keepAliveTimeout=setTimeout(this.onKeepAliveTimeout,this.keepAliveTimeoutMs))}onKeepAliveTimeout(){this.emit(O.ETwitterStreamEvent.ConnectionLost),this.onConnectionError()}unbindTimeouts(){this.unbindRetryTimeout(),this.unbindKeepAliveTimeout()}unbindKeepAliveTimeout(){this.keepAliveTimeout&&(clearTimeout(this.keepAliveTimeout),this.keepAliveTimeout=void 0)}unbindRetryTimeout(){this.retryTimeout&&(clearTimeout(this.retryTimeout),this.retryTimeout=void 0)}closeWithoutEmit(){this.unbindTimeouts(),this.res&&(this.res.removeAllListeners(),this.res.destroy()),this.req&&(this.req.removeAllListeners(),this.req.destroy())}close(){this.emit(O.ETwitterStreamEvent.ConnectionClosed),this.closeWithoutEmit()}destroy(){this.removeAllListeners(),this.close()}async clone(){let t=await new ml.default(this.requestData).makeRequestAsStream(),i=this.eventNames();for(let a of i){let u=this.listeners(a);for(let c of u)t.on(a,c)}return t}async connect(e={}){typeof e.autoReconnect<"u"&&(this.autoReconnect=e.autoReconnect),typeof e.autoReconnectRetries<"u"&&(this.autoReconnectRetries=e.autoReconnectRetries==="unlimited"?1/0:e.autoReconnectRetries),typeof e.keepAliveTimeout<"u"&&(this.keepAliveTimeoutMs=e.keepAliveTimeout==="disable"?1/0:e.keepAliveTimeout),typeof e.nextRetryTimeout<"u"&&(this.nextRetryTimeout=e.nextRetryTimeout),this.unbindTimeouts();try{await this.reconnect()}catch(t){if(this.emit(O.ETwitterStreamEvent.ConnectError,0),this.emit(O.ETwitterStreamEvent.Error,{type:O.ETwitterStreamEvent.ConnectError,error:t,message:"Connect error - Initial connection just failed."}),this.autoReconnect)this.makeAutoReconnectRetry(0,t);else throw t}return this}async reconnect(){if(this.connectionProcessRunning)throw new Error("Connection process is already running.");this.connectionProcessRunning=!0;try{let e=!0;this.req&&(e=!1,this.closeWithoutEmit());let{req:t,res:i,originalResponse:a}=await new ml.default(this.requestData).makeRequestAndResolveWhenReady();this.req=t,this.res=i,this.originalResponse=a,this.emit(e?O.ETwitterStreamEvent.Connected:O.ETwitterStreamEvent.Reconnected),this.parser.reset(),this.initEventsFromRequest()}finally{this.connectionProcessRunning=!1}}async onConnectionError(e=0){if(this.unbindTimeouts(),this.closeWithoutEmit(),!this.autoReconnect){this.emit(O.ETwitterStreamEvent.ConnectionClosed);return}if(e>=this.autoReconnectRetries){this.emit(O.ETwitterStreamEvent.ReconnectLimitExceeded),this.emit(O.ETwitterStreamEvent.ConnectionClosed);return}try{this.emit(O.ETwitterStreamEvent.ReconnectAttempt,e),await this.reconnect()}catch(t){this.emit(O.ETwitterStreamEvent.ReconnectError,e),this.emit(O.ETwitterStreamEvent.Error,{type:O.ETwitterStreamEvent.ReconnectError,error:t,message:`Reconnect error - ${e+1} attempts made yet.`}),this.makeAutoReconnectRetry(e,t)}}makeAutoReconnectRetry(e,t){let i=this.nextRetryTimeout(e+1,t);this.retryTimeout=setTimeout(()=>{this.onConnectionError(e+1)},i)}async*[Symbol.asyncIterator](){let e=new bh.default(this);try{for(;;){if(!this.req||this.req.aborted)throw new Error("Connection closed");e.hasStack()&&(yield*e.popStack());let{type:t,payload:i}=await e.nextEvent();if(t==="error")throw i}}finally{e.destroy()}}};ye.TweetStream=vs;ye.default=vs});var gl=T(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.applyResponseHooks=er.hasRequestErrorPlugins=void 0;var Qn=Ne();function Sh(r){var e;if(!((e=r.clientSettings.plugins)===null||e===void 0?void 0:e.length))return!1;for(let t of r.clientSettings.plugins)if(t.onRequestError||t.onResponseError)return!0;return!1}er.hasRequestErrorPlugins=Sh;async function Rh(r,e,t,i){let a;return i instanceof Qn.ApiRequestError||i instanceof Qn.ApiPartialResponseError?a=await this.applyPluginMethod("onRequestError",{client:this,url:this.getUrlObjectFromUrlString(r.url),params:r,computedParams:e,requestOptions:t,error:i}):i instanceof Qn.ApiResponseError&&(a=await this.applyPluginMethod("onResponseError",{client:this,url:this.getUrlObjectFromUrlString(r.url),params:r,computedParams:e,requestOptions:t,error:i})),a&&a instanceof Qn.TwitterApiPluginResponseOverride?a.value:Promise.reject(i)}er.applyResponseHooks=Rh});var gt=T(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.safeDeprecationWarning=he.hasMultipleItems=he.isTweetStreamV2ErrorPayload=he.trimUndefinedProperties=he.arrayWrap=he.sharedPromise=void 0;var vh=Nn();function Ph(r){let e={value:void 0,promise:r().then(t=>(e.value=t,t))};return e}he.sharedPromise=Ph;function qh(r){return Array.isArray(r)?r:[r]}he.arrayWrap=qh;function Ah(r){for(let e in r)r[e]===void 0&&delete r[e]}he.trimUndefinedProperties=Ah;function Dh(r){return typeof r=="object"&&"errors"in r&&!("data"in r)}he.isTweetStreamV2ErrorPayload=Dh;function Lh(r){return Array.isArray(r)&&r.length>1?!0:r.toString().includes(",")}he.hasMultipleItems=Lh;var wl=new Set;function Ch(r){if(typeof console>"u"||!console.warn||!vh.TwitterApiV2Settings.deprecationWarnings)return;let e=`${r.instance}-${r.method}-${r.problem}`;if(wl.has(e))return;let t=`[twitter-api-v2] Deprecation warning: In ${r.instance}.${r.method}() call, ${r.problem}.
${r.resolution}.`;console.warn(t),console.warn("To disable this message, import variable TwitterApiV2Settings from twitter-api-v2 and set TwitterApiV2Settings.deprecationWarnings to false."),wl.add(e)}he.safeDeprecationWarning=Ch});var Ps=T(Fe=>{"use strict";var kh=Fe&&Fe.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),Ih=Fe&&Fe.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Eh=Fe&&Fe.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&kh(e,r,t);return Ih(e,r),e};Object.defineProperty(Fe,"__esModule",{value:!0});Fe.OAuth1Helper=void 0;var Oh=Eh(require("crypto")),be=class{constructor(e){this.nonceLength=32,this.consumerKeys=e.consumerKeys}static percentEncode(e){return encodeURIComponent(e).replace(/!/g,"%21").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")}hash(e,t){return Oh.createHmac("sha1",t).update(e).digest("base64")}authorize(e,t={}){let i={oauth_consumer_key:this.consumerKeys.key,oauth_nonce:this.getNonce(),oauth_signature_method:"HMAC-SHA1",oauth_timestamp:this.getTimestamp(),oauth_version:"1.0"};return t.key!==void 0&&(i.oauth_token=t.key),e.data||(e.data={}),i.oauth_signature=this.getSignature(e,t.secret,i),i}toHeader(e){let t=bl(e),i="OAuth ";for(let a of t)a.key.indexOf("oauth_")===0&&(i+=be.percentEncode(a.key)+'="'+be.percentEncode(a.value)+'",');return{Authorization:i.slice(0,i.length-1)}}getNonce(){let e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",t="";for(let i=0;i<this.nonceLength;i++)t+=e[Math.trunc(Math.random()*e.length)];return t}getTimestamp(){return Math.trunc(new Date().getTime()/1e3)}getSignature(e,t,i){return this.hash(this.getBaseString(e,i),this.getSigningKey(t))}getSigningKey(e){return be.percentEncode(this.consumerKeys.secret)+"&"+be.percentEncode(e||"")}getBaseString(e,t){return e.method.toUpperCase()+"&"+be.percentEncode(this.getBaseUrl(e.url))+"&"+be.percentEncode(this.getParameterString(e,t))}getParameterString(e,t){let i=bl(Fh(yl(t,yl(e.data,xh(e.url))))),a="";for(let{key:u,value:c}of i)if(c&&Array.isArray(c)){c.sort();let d="";c.forEach((h,S)=>{d+=u+"="+h,S<c.length&&(d+="&")}),a+=d}else a+=u+"="+c+"&";return a.slice(0,a.length-1)}getBaseUrl(e){return e.split("?")[0]}};Fe.OAuth1Helper=be;Fe.default=be;function yl(r,e){return p(p({},r||{}),e||{})}function bl(r){return Object.keys(r).sort().map(e=>({key:e,value:r[e]}))}function Mh(r){let e=r.split("&"),t={};for(let i of e){let[a,u=""]=i.split("=");t[a]?(Array.isArray(t[a])||(t[a]=[t[a]]),t[a].push(decodeURIComponent(u))):t[a]=decodeURIComponent(u)}return t}function xh(r){let e=r.split("?");return e.length===1?{}:Mh(e[1])}function Fh(r){let e={};for(let t in r){let i=r[t];i&&Array.isArray(i)?i=i.map(a=>be.percentEncode(a)):i=be.percentEncode(i),e[be.percentEncode(t)]=i}return e}});var Tl=T(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.FormDataHelper=void 0;var Bh=gt(),Be=class{constructor(){this._boundary="",this._chunks=[]}bodyAppend(...e){let t=e.map(i=>i instanceof Buffer?i:Buffer.from(i));this._chunks.push(...t)}append(e,t,i){let a=t instanceof Buffer?t:t.toString(),u=this.getMultipartHeader(e,a,i);this.bodyAppend(u,a,Be.LINE_BREAK)}getHeaders(){return{"content-type":"multipart/form-data; boundary="+this.getBoundary()}}getLength(){return this._chunks.reduce((e,t)=>e+t.length,this.getMultipartFooter().length)}getBuffer(){let e=[...this._chunks,this.getMultipartFooter()],t=Buffer.alloc(this.getLength()),i=0;for(let a of e)for(let u=0;u<a.length;i++,u++)t[i]=a[u];return t}getBoundary(){return this._boundary||this.generateBoundary(),this._boundary}generateBoundary(){let e="--------------------------";for(let t=0;t<24;t++)e+=Math.floor(Math.random()*10).toString(16);this._boundary=e}getMultipartHeader(e,t,i){i||(i=t instanceof Buffer?Be.DEFAULT_CONTENT_TYPE:"");let a={"Content-Disposition":["form-data",`name="${e}"`],"Content-Type":i},u="";for(let[c,d]of Object.entries(a))!d.length||(u+=c+": "+(0,Bh.arrayWrap)(d).join("; ")+Be.LINE_BREAK);return"--"+this.getBoundary()+Be.LINE_BREAK+u+Be.LINE_BREAK}getMultipartFooter(){return this._footerChunk?this._footerChunk:this._footerChunk=Buffer.from("--"+this.getBoundary()+"--"+Be.LINE_BREAK)}};Yn.FormDataHelper=Be;Be.LINE_BREAK=`\r
`;Be.DEFAULT_CONTENT_TYPE="application/octet-stream"});var qs=T(It=>{"use strict";var jh=It&&It.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(It,"__esModule",{value:!0});It.RequestParamHelpers=void 0;var Uh=Tl(),Sl=jh(Ps()),Kn=class{static formatQueryToString(e){let t={};for(let i in e)typeof e[i]=="string"?t[i]=e[i]:typeof e[i]<"u"&&(t[i]=String(e[i]));return t}static autoDetectBodyType(e){if(e.pathname.startsWith("/2/")||e.pathname.startsWith("/labs/2/"))return e.password.startsWith("/2/oauth2")?"url":"json";if(e.hostname==="upload.twitter.com")return e.pathname==="/1.1/media/upload.json"?"form-data":"json";let t=e.pathname.split("/1.1/",2)[1];return this.JSON_1_1_ENDPOINTS.has(t)?"json":"url"}static addQueryParamsToUrl(e,t){let i=Object.entries(t);if(i.length){let a="";for(let[u,c]of i)a+=(a.length?"&":"?")+`${Sl.default.percentEncode(u)}=${Sl.default.percentEncode(c)}`;e.search=a}}static constructBodyParams(e,t,i){if(e instanceof Buffer)return e;if(i==="json")return t["content-type"]="application/json;charset=UTF-8",JSON.stringify(e);if(i==="url")return t["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",Object.keys(e).length?new URLSearchParams(e).toString().replace(/\*/g,"%2A"):"";if(i==="raw")throw new Error("You can only use raw body mode with Buffers. To give a string, use Buffer.from(str).");{let a=new Uh.FormDataHelper;for(let c in e)a.append(c,e[c]);let u=a.getHeaders();return t["content-type"]=u["content-type"],a.getBuffer()}}static setBodyLengthHeader(e,t){var i;e.headers=(i=e.headers)!==null&&i!==void 0?i:{},typeof t=="string"?e.headers["content-length"]=Buffer.byteLength(t):e.headers["content-length"]=t.length}static isOAuthSerializable(e){return!(e instanceof Buffer)}static mergeQueryAndBodyForOAuth(e,t){let i={};for(let a in e)i[a]=e[a];if(this.isOAuthSerializable(t))for(let a in t){let u=t[a];this.isOAuthSerializable(u)&&(i[a]=typeof u=="object"&&u!==null&&"toString"in u?u.toString():u)}return i}static moveUrlQueryParamsIntoObject(e,t){for(let[i,a]of e.searchParams)t[i]=a;return e.search="",e}static applyRequestParametersToUrl(e,t){return e.pathname=e.pathname.replace(/:([A-Z_-]+)/ig,(i,a)=>t[a]!==void 0?String(t[a]):i),e}};It.RequestParamHelpers=Kn;Kn.JSON_1_1_ENDPOINTS=new Set(["direct_messages/events/new.json","direct_messages/welcome_messages/new.json","direct_messages/welcome_messages/rules/new.json","media/metadata/create.json","collections/entries/curate.json"]);It.default=Kn});var As=T(He=>{"use strict";var Wh=He&&He.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),zh=He&&He.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),Vh=He&&He.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&Wh(e,r,t);return zh(e,r),e};Object.defineProperty(He,"__esModule",{value:!0});He.OAuth2Helper=void 0;var $h=Vh(require("crypto")),Rl=class{static getCodeVerifier(){return this.generateRandomString(128)}static getCodeChallengeFromVerifier(e){return this.escapeBase64Url($h.createHash("sha256").update(e).digest("base64"))}static getAuthHeader(e,t){let i=encodeURIComponent(e)+":"+encodeURIComponent(t);return Buffer.from(i).toString("base64")}static generateRandomString(e){let t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";for(let a=0;a<e;a++)t+=i[Math.floor(Math.random()*i.length)];return t}static escapeBase64Url(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}};He.OAuth2Helper=Rl});var Pl=T(rr=>{"use strict";var Gn=rr&&rr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(rr,"__esModule",{value:!0});rr.ClientRequestMaker=void 0;var Nh=Ne(),Hh=Gn(Hn()),vl=gl(),Qh=gt(),Yh=Gn(Ps()),Kh=Gn(bs()),tt=Gn(qs()),Gh=As(),tr=class{constructor(e){this.rateLimits={},this.clientSettings={},e&&(this.clientSettings=e)}getRateLimits(){return this.rateLimits}saveRateLimit(e,t){this.rateLimits[e]=t}async send(e){var t,i,a,u,c;if((t=this.clientSettings.plugins)===null||t===void 0?void 0:t.length){let w=await this.applyPreRequestConfigHooks(e);if(w)return w}let d=this.getHttpRequestArgs(e),h={method:d.method,headers:d.headers,timeout:e.timeout,agent:this.clientSettings.httpAgent},S=e.enableRateLimitSave!==!1;d.body&&tt.default.setBodyLengthHeader(h,d.body),((i=this.clientSettings.plugins)===null||i===void 0?void 0:i.length)&&await this.applyPreRequestHooks(e,d,h);let y=new Kh.default({url:d.url,options:h,body:d.body,rateLimitSaver:S?this.saveRateLimit.bind(this,d.rawUrl):void 0,requestEventDebugHandler:e.requestEventDebugHandler,compression:(u=(a=e.compression)!==null&&a!==void 0?a:this.clientSettings.compression)!==null&&u!==void 0?u:!0,forceParseMode:e.forceParseMode}).makeRequest();(0,vl.hasRequestErrorPlugins)(this)&&(y=this.applyResponseErrorHooks(e,d,h,y));let R=await y;if((c=this.clientSettings.plugins)===null||c===void 0?void 0:c.length){let w=await this.applyPostRequestHooks(e,d,h,R);if(w)return w.value}return R}sendStream(e){var t,i;this.clientSettings.plugins&&this.applyPreStreamRequestConfigHooks(e);let a=this.getHttpRequestArgs(e),u={method:a.method,headers:a.headers,agent:this.clientSettings.httpAgent},c=e.enableRateLimitSave!==!1,d=e.autoConnect!==!1;a.body&&tt.default.setBodyLengthHeader(u,a.body);let h={url:a.url,options:u,body:a.body,rateLimitSaver:c?this.saveRateLimit.bind(this,a.rawUrl):void 0,payloadIsError:e.payloadIsError,compression:(i=(t=e.compression)!==null&&t!==void 0?t:this.clientSettings.compression)!==null&&i!==void 0?i:!0},S=new Hh.default(h);return d?S.connect():S}initializeToken(e){if(typeof e=="string")this.bearerToken=e;else if(typeof e=="object"&&"appKey"in e)this.consumerToken=e.appKey,this.consumerSecret=e.appSecret,e.accessToken&&e.accessSecret&&(this.accessToken=e.accessToken,this.accessSecret=e.accessSecret),this._oauth=this.buildOAuth();else if(typeof e=="object"&&"username"in e){let t=encodeURIComponent(e.username)+":"+encodeURIComponent(e.password);this.basicToken=Buffer.from(t).toString("base64")}else typeof e=="object"&&"clientId"in e&&(this.clientId=e.clientId,this.clientSecret=e.clientSecret)}getActiveTokens(){return this.bearerToken?{type:"oauth2",bearerToken:this.bearerToken}:this.basicToken?{type:"basic",token:this.basicToken}:this.consumerSecret&&this._oauth?{type:"oauth-1.0a",appKey:this.consumerToken,appSecret:this.consumerSecret,accessToken:this.accessToken,accessSecret:this.accessSecret}:this.clientId?{type:"oauth2-user",clientId:this.clientId}:{type:"none"}}buildOAuth(){if(!this.consumerSecret||!this.consumerToken)throw new Error("Invalid consumer tokens");return new Yh.default({consumerKeys:{key:this.consumerToken,secret:this.consumerSecret}})}getOAuthAccessTokens(){if(!(!this.accessSecret||!this.accessToken))return{key:this.accessToken,secret:this.accessSecret}}getPlugins(){var e;return(e=this.clientSettings.plugins)!==null&&e!==void 0?e:[]}hasPlugins(){var e;return!!((e=this.clientSettings.plugins)===null||e===void 0?void 0:e.length)}async applyPluginMethod(e,t){var i;let a;for(let u of this.getPlugins()){let c=await((i=u[e])===null||i===void 0?void 0:i.call(u,t));c&&c instanceof Nh.TwitterApiPluginResponseOverride&&(a=c)}return a}writeAuthHeaders({headers:e,bodyInSignature:t,url:i,method:a,query:u,body:c}){if(e=p({},e),this.bearerToken)e.Authorization="Bearer "+this.bearerToken;else if(this.basicToken)e.Authorization="Basic "+this.basicToken;else if(this.clientId&&this.clientSecret)e.Authorization="Basic "+Gh.OAuth2Helper.getAuthHeader(this.clientId,this.clientSecret);else if(this.consumerSecret&&this._oauth){let d=t?tt.default.mergeQueryAndBodyForOAuth(u,c):u,h=this._oauth.authorize({url:i.toString(),method:a,data:d},this.getOAuthAccessTokens());e=p(p({},e),this._oauth.toHeader(h))}return e}getUrlObjectFromUrlString(e){return e.startsWith("http")||(e="https://"+e),new URL(e)}getHttpRequestArgs({url:e,method:t,query:i={},body:a={},headers:u,forceBodyMode:c,enableAuth:d,params:h}){let S;t=t.toUpperCase(),u=u??{},u["x-user-agent"]||(u["x-user-agent"]="Node.twitter-api-v2");let y=this.getUrlObjectFromUrlString(e),R=y.origin+y.pathname;h&&tt.default.applyRequestParametersToUrl(y,h);let w=tt.default.formatQueryToString(i);tt.default.moveUrlQueryParamsIntoObject(y,w),a instanceof Buffer||(0,Qh.trimUndefinedProperties)(a);let _=c??tt.default.autoDetectBodyType(y);if(d!==!1){let D=tr.BODY_METHODS.has(t)&&_==="url";u=this.writeAuthHeaders({headers:u,bodyInSignature:D,method:t,query:w,url:y,body:a})}return tr.BODY_METHODS.has(t)&&(S=tt.default.constructBodyParams(a,u,_)||void 0),tt.default.addQueryParamsToUrl(y,w),{rawUrl:R,url:y,method:t,headers:u,body:S}}async applyPreRequestConfigHooks(e){var t;let i=this.getUrlObjectFromUrlString(e.url);for(let a of this.getPlugins()){let u=await((t=a.onBeforeRequestConfig)===null||t===void 0?void 0:t.call(a,{client:this,url:i,params:e}));if(u)return u}}applyPreStreamRequestConfigHooks(e){var t;let i=this.getUrlObjectFromUrlString(e.url);for(let a of this.getPlugins())(t=a.onBeforeStreamRequestConfig)===null||t===void 0||t.call(a,{client:this,url:i,params:e})}async applyPreRequestHooks(e,t,i){await this.applyPluginMethod("onBeforeRequest",{client:this,url:this.getUrlObjectFromUrlString(e.url),params:e,computedParams:t,requestOptions:i})}async applyPostRequestHooks(e,t,i,a){return await this.applyPluginMethod("onAfterRequest",{client:this,url:this.getUrlObjectFromUrlString(e.url),params:e,computedParams:t,requestOptions:i,response:a})}applyResponseErrorHooks(e,t,i,a){return a.catch(vl.applyResponseHooks.bind(this,e,t,i))}};rr.ClientRequestMaker=tr;tr.BODY_METHODS=new Set(["POST","PUT","PATCH"])});var Ls=T(Ds=>{"use strict";Object.defineProperty(Ds,"__esModule",{value:!0});var Xh=Pl(),ql=gt(),Al=xe(),Xn=class{constructor(e,t={}){this._currentUser=null,this._currentUserV2=null,e instanceof Xn?this._requestMaker=e._requestMaker:(this._requestMaker=new Xh.ClientRequestMaker(t),this._requestMaker.initializeToken(e))}setPrefix(e){this._prefix=e}cloneWithPrefix(e){let t=this.constructor(this);return t.setPrefix(e),t}getActiveTokens(){return this._requestMaker.getActiveTokens()}getPlugins(){return this._requestMaker.getPlugins()}getPluginOfType(e){return this.getPlugins().find(t=>t instanceof e)}hasHitRateLimit(e){var t;return this.isRateLimitStatusObsolete(e)?!1:((t=this.getLastRateLimitStatus(e))===null||t===void 0?void 0:t.remaining)===0}isRateLimitStatusObsolete(e){let t=this.getLastRateLimitStatus(e);return t===void 0?!0:t.reset*1e3<Date.now()}getLastRateLimitStatus(e){let t=e.match(/^https?:\/\//)?e:this._prefix+e;return this._requestMaker.getRateLimits()[t]}getCurrentUserObject(e=!1){return!e&&this._currentUser?this._currentUser.value?Promise.resolve(this._currentUser.value):this._currentUser.promise:(this._currentUser=(0,ql.sharedPromise)(()=>this.get("account/verify_credentials.json",{tweet_mode:"extended"},{prefix:Al.API_V1_1_PREFIX})),this._currentUser.promise)}getCurrentUserV2Object(e=!1){return!e&&this._currentUserV2?this._currentUserV2.value?Promise.resolve(this._currentUserV2.value):this._currentUserV2.promise:(this._currentUserV2=(0,ql.sharedPromise)(()=>this.get("users/me",void 0,{prefix:Al.API_V2_PREFIX})),this._currentUserV2.promise)}async get(e,t={},c={}){var d=c,{fullResponse:i,prefix:a=this._prefix}=d,u=H(d,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"GET",query:t},u));return i?h:h.data}async delete(e,t={},c={}){var d=c,{fullResponse:i,prefix:a=this._prefix}=d,u=H(d,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"DELETE",query:t},u));return i?h:h.data}async post(e,t,c={}){var d=c,{fullResponse:i,prefix:a=this._prefix}=d,u=H(d,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"POST",body:t},u));return i?h:h.data}async put(e,t,c={}){var d=c,{fullResponse:i,prefix:a=this._prefix}=d,u=H(d,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"PUT",body:t},u));return i?h:h.data}async patch(e,t,c={}){var d=c,{fullResponse:i,prefix:a=this._prefix}=d,u=H(d,["fullResponse","prefix"]);a&&(e=a+e);let h=await this._requestMaker.send(p({url:e,method:"PATCH",body:t},u));return i?h:h.data}getStream(e,t,u={}){var c=u,{prefix:i=this._prefix}=c,a=H(c,["prefix"]);return this._requestMaker.sendStream(p({url:i?i+e:e,method:"GET",query:t},a))}postStream(e,t,u={}){var c=u,{prefix:i=this._prefix}=c,a=H(c,["prefix"]);return this._requestMaker.sendStream(p({url:i?i+e:e,method:"POST",body:t},a))}};Ds.default=Xn});var Jn=T(Mr=>{"use strict";var Jh=Mr&&Mr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Mr,"__esModule",{value:!0});var Dl=Jh(Ls()),Ll=class extends Dl.default{constructor(e){if(!(e instanceof Dl.default))throw new Error("You must instance SubTwitterApi instance from existing TwitterApi instance.");super(e)}};Mr.default=Ll});var Cs=T(qe=>{"use strict";var Zh=qe&&qe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(qe,"__esModule",{value:!0});qe.ListTimelineV1Paginator=qe.UserTimelineV1Paginator=qe.MentionTimelineV1Paginator=qe.HomeTimelineV1Paginator=void 0;var em=Zh(Kt()),xr=class extends em.default{constructor(){super(...arguments);this.hasFinishedFetch=!1}refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.push(...i),this.hasFinishedFetch=i.length===0)}getNextQueryParams(e){let t=BigInt(this._realData[this._realData.length-1].id_str);return j(p({},this.injectQueryParams(e)),{max_id:(t-BigInt(1)).toString()})}getPageLengthFromRequest(e){return e.data.length}isFetchLastOver(e){return!e.data.length}canFetchNextPage(e){return e.length>0}getItemArray(){return this.tweets}get tweets(){return this._realData}get done(){return super.done||this.hasFinishedFetch}},Cl=class extends xr{constructor(){super(...arguments);this._endpoint="statuses/home_timeline.json"}};qe.HomeTimelineV1Paginator=Cl;var kl=class extends xr{constructor(){super(...arguments);this._endpoint="statuses/mentions_timeline.json"}};qe.MentionTimelineV1Paginator=kl;var Il=class extends xr{constructor(){super(...arguments);this._endpoint="statuses/user_timeline.json"}};qe.UserTimelineV1Paginator=Il;var El=class extends xr{constructor(){super(...arguments);this._endpoint="lists/statuses.json"}};qe.ListTimelineV1Paginator=El});var ks=T(nr=>{"use strict";Object.defineProperty(nr,"__esModule",{value:!0});nr.MuteUserIdsV1Paginator=nr.MuteUserListV1Paginator=void 0;var Ol=Lr(),Ml=class extends Ol.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="mutes/users/list.json"}refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.users.push(...i.users),this._realData.next_cursor=i.next_cursor)}getPageLengthFromRequest(e){return e.data.users.length}getItemArray(){return this.users}get users(){return this._realData.users}};nr.MuteUserListV1Paginator=Ml;var xl=class extends Ol.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="mutes/users/ids.json",this._maxResultsWhenFetchLast=5e3}refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.ids.push(...i.ids),this._realData.next_cursor=i.next_cursor)}getPageLengthFromRequest(e){return e.data.ids.length}getItemArray(){return this.ids}get ids(){return this._realData.ids}};nr.MuteUserIdsV1Paginator=xl});var Es=T(Qe=>{"use strict";var tm=Qe&&Qe.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Qe,"__esModule",{value:!0});Qe.FriendshipsOutgoingV1Paginator=Qe.FriendshipsIncomingV1Paginator=Qe.UserSearchV1Paginator=void 0;var rm=tm(Kt()),nm=Lr(),Fl=class extends rm.default{constructor(){super(...arguments);this._endpoint="users/search.json"}refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&this._realData.push(...i)}getNextQueryParams(e){var t;let i=Number((t=this._queryParams.page)!==null&&t!==void 0?t:"1");return p(j(p({},this._queryParams),{page:i+1}),e?{count:e}:{})}getPageLengthFromRequest(e){return e.data.length}isFetchLastOver(e){return!e.data.length}canFetchNextPage(e){return e.length>0}getItemArray(){return this.users}get users(){return this._realData}};Qe.UserSearchV1Paginator=Fl;var Is=class extends nm.CursoredV1Paginator{constructor(){super(...arguments);this._endpoint="friendships/incoming.json",this._maxResultsWhenFetchLast=5e3}refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.ids.push(...i.ids),this._realData.next_cursor=i.next_cursor)}getPageLengthFromRequest(e){return e.data.ids.length}getItemArray(){return this.ids}get ids(){return this._realData.ids}};Qe.FriendshipsIncomingV1Paginator=Is;var Bl=class extends Is{constructor(){super(...arguments);this._endpoint="friendships/outgoing.json"}};Qe.FriendshipsOutgoingV1Paginator=Bl});var Ms=T(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.ListSubscribersV1Paginator=Ae.ListMembersV1Paginator=Ae.ListSubscriptionsV1Paginator=Ae.ListOwnershipsV1Paginator=Ae.ListMembershipsV1Paginator=void 0;var jl=Lr(),Zn=class extends jl.CursoredV1Paginator{refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.lists.push(...i.lists),this._realData.next_cursor=i.next_cursor)}getPageLengthFromRequest(e){return e.data.lists.length}getItemArray(){return this.lists}get lists(){return this._realData.lists}},Ul=class extends Zn{constructor(){super(...arguments);this._endpoint="lists/memberships.json"}};Ae.ListMembershipsV1Paginator=Ul;var Wl=class extends Zn{constructor(){super(...arguments);this._endpoint="lists/ownerships.json"}};Ae.ListOwnershipsV1Paginator=Wl;var zl=class extends Zn{constructor(){super(...arguments);this._endpoint="lists/subscriptions.json"}};Ae.ListSubscriptionsV1Paginator=zl;var Os=class extends jl.CursoredV1Paginator{refreshInstanceFromResult(e,t){let i=e.data;this._rateLimit=e.rateLimit,t&&(this._realData.users.push(...i.users),this._realData.next_cursor=i.next_cursor)}getPageLengthFromRequest(e){return e.data.users.length}getItemArray(){return this.users}get users(){return this._realData.users}},Vl=class extends Os{constructor(){super(...arguments);this._endpoint="lists/members.json"}};Ae.ListMembersV1Paginator=Vl;var $l=class extends Os{constructor(){super(...arguments);this._endpoint="lists/subscribers.json"}};Ae.ListSubscribersV1Paginator=$l});var Bs=T(jr=>{"use strict";var Hl=jr&&jr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(jr,"__esModule",{value:!0});var im=Hl(Jn()),xs=xe(),sm=gt(),am=Hl(ei()),Fr=Cs(),Nl=ks(),Fs=Es(),Br=Ms(),Ql=class extends im.default{constructor(){super(...arguments);this._prefix=xs.API_V1_1_PREFIX}singleTweet(e,t={}){return this.get("statuses/show.json",p({tweet_mode:"extended",id:e},t))}tweets(e,t={}){return this.post("statuses/lookup.json",p({tweet_mode:"extended",id:e},t))}oembedTweet(e,t={}){return this.get("oembed",p({url:`https://twitter.com/i/statuses/${e}`},t),{prefix:"https://publish.twitter.com/"})}async homeTimeline(e={}){let t=p({tweet_mode:"extended"},e),i=await this.get("statuses/home_timeline.json",t,{fullResponse:!0});return new Fr.HomeTimelineV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}async mentionTimeline(e={}){let t=p({tweet_mode:"extended"},e),i=await this.get("statuses/mentions_timeline.json",t,{fullResponse:!0});return new Fr.MentionTimelineV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}async userTimeline(e,t={}){let i=p({tweet_mode:"extended",user_id:e},t),a=await this.get("statuses/user_timeline.json",i,{fullResponse:!0});return new Fr.UserTimelineV1Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:i})}async userTimelineByUsername(e,t={}){let i=p({tweet_mode:"extended",screen_name:e},t),a=await this.get("statuses/user_timeline.json",i,{fullResponse:!0});return new Fr.UserTimelineV1Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:i})}user(e){return this.get("users/show.json",p({tweet_mode:"extended"},e))}users(e){return this.get("users/lookup.json",p({tweet_mode:"extended"},e))}verifyCredentials(e={}){return this.get("account/verify_credentials.json",e)}async listMutedUsers(e={}){let t=p({tweet_mode:"extended"},e),i=await this.get("mutes/users/list.json",t,{fullResponse:!0});return new Nl.MuteUserListV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}async listMutedUserIds(e={}){let t=p({stringify_ids:!0},e),i=await this.get("mutes/users/ids.json",t,{fullResponse:!0});return new Nl.MuteUserIdsV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}async searchUsers(e,t={}){let i=p({q:e,tweet_mode:"extended",page:1},t),a=await this.get("users/search.json",i,{fullResponse:!0});return new Fs.UserSearchV1Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:i})}friendship(e){return this.get("friendships/show.json",e)}friendships(e){return this.get("friendships/lookup.json",e)}friendshipsNoRetweets(){return this.get("friendships/no_retweets/ids.json",{stringify_ids:!0})}async friendshipsIncoming(e={}){let t=p({stringify_ids:!0},e),i=await this.get("friendships/incoming.json",t,{fullResponse:!0});return new Fs.FriendshipsIncomingV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}async friendshipsOutgoing(e={}){let t=p({stringify_ids:!0},e),i=await this.get("friendships/outgoing.json",t,{fullResponse:!0});return new Fs.FriendshipsOutgoingV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}accountSettings(){return this.get("account/settings.json")}userProfileBannerSizes(e){return this.get("users/profile_banner.json",e)}list(e){return this.get("lists/show.json",p({tweet_mode:"extended"},e))}lists(e={}){return this.get("lists/list.json",p({tweet_mode:"extended"},e))}async listMembers(e={}){let t=p({tweet_mode:"extended"},e),i=await this.get("lists/members.json",t,{fullResponse:!0});return new Br.ListMembersV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}listGetMember(e){return this.get("lists/members/show.json",p({tweet_mode:"extended"},e))}async listMemberships(e={}){let t=p({tweet_mode:"extended"},e),i=await this.get("lists/memberships.json",t,{fullResponse:!0});return new Br.ListMembershipsV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}async listOwnerships(e={}){let t=p({tweet_mode:"extended"},e),i=await this.get("lists/ownerships.json",t,{fullResponse:!0});return new Br.ListOwnershipsV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}async listStatuses(e){let t=p({tweet_mode:"extended"},e),i=await this.get("lists/statuses.json",t,{fullResponse:!0});return new Fr.ListTimelineV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}async listSubscribers(e={}){let t=p({tweet_mode:"extended"},e),i=await this.get("lists/subscribers.json",t,{fullResponse:!0});return new Br.ListSubscribersV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}listGetSubscriber(e){return this.get("lists/subscribers/show.json",p({tweet_mode:"extended"},e))}async listSubscriptions(e={}){let t=p({tweet_mode:"extended"},e),i=await this.get("lists/subscriptions.json",t,{fullResponse:!0});return new Br.ListSubscriptionsV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}mediaInfo(e){return this.get("media/upload.json",{command:"STATUS",media_id:e},{prefix:xs.API_V1_1_UPLOAD_PREFIX})}filterStream(i={}){var a=i,{autoConnect:e}=a,t=H(a,["autoConnect"]);let u={};for(let[d,h]of Object.entries(t))if(d==="follow"||d==="track")u[d]=h.toString();else if(d==="locations"){let S=h;u.locations=(0,sm.arrayWrap)(S).map(y=>`${y.lng},${y.lat}`).join(",")}else u[d]=h;return this.stream.postStream("statuses/filter.json",u,{autoConnect:e})}sampleStream(i={}){var a=i,{autoConnect:e}=a,t=H(a,["autoConnect"]);return this.stream.getStream("statuses/sample.json",t,{autoConnect:e})}get stream(){let e=new am.default(this);return e.setPrefix(xs.API_V1_1_STREAM_PREFIX),e}trendsByPlace(e,t={}){return this.get("trends/place.json",p({id:e},t))}trendsAvailable(){return this.get("trends/available.json")}trendsClosest(e,t){return this.get("trends/closest.json",{lat:e,long:t})}geoPlace(e){return this.get("geo/id/:place_id.json",void 0,{params:{place_id:e}})}geoSearch(e){return this.get("geo/search.json",e)}geoReverseGeoCode(e){return this.get("geo/reverse_geocode.json",e)}rateLimitStatuses(...e){return this.get("application/rate_limit_status.json",{resources:e})}supportedLanguages(){return this.get("help/languages.json")}};jr.default=Ql});var Gl=T(z=>{"use strict";var om=z&&z.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),um=z&&z.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),lm=z&&z.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&om(e,r,t);return um(e,r),e};Object.defineProperty(z,"__esModule",{value:!0});z.readNextPartOf=z.sleepSecs=z.getMediaCategoryByMime=z.getMimeType=z.getFileSizeFromFileHandle=z.getFileHandle=z.readFileIntoBuffer=void 0;var ti=lm(require("fs")),Yl=gt(),ee=Ne();async function cm(r){let e=await Kl(r);return typeof e=="number"?new Promise((t,i)=>{ti.readFile(e,(a,u)=>{if(a)return i(a);t(u)})}):e instanceof Buffer?e:e.readFile()}z.readFileIntoBuffer=cm;function Kl(r){if(typeof r=="string")return ti.promises.open(r,"r");if(typeof r=="number")return r;if(typeof r=="object"&&!(r instanceof Buffer))return r;if(r instanceof Buffer)return r;throw new Error("Given file is not valid, please check its type.")}z.getFileHandle=Kl;async function dm(r){return typeof r=="number"?(await new Promise((t,i)=>{ti.fstat(r,(a,u)=>{a&&i(a),t(u)})})).size:r instanceof Buffer?r.length:(await r.stat()).size}z.getFileSizeFromFileHandle=dm;function fm(r,e,t){if(typeof t=="string")return t;if(typeof r=="string"&&!e)return hm(r);if(typeof e=="string")return mm(e);throw new Error("You must specify type if file is a file handle or Buffer.")}z.getMimeType=fm;function hm(r){return r.endsWith(".jpeg")||r.endsWith(".jpg")?ee.EUploadMimeType.Jpeg:r.endsWith(".png")?ee.EUploadMimeType.Png:r.endsWith(".webp")?ee.EUploadMimeType.Webp:r.endsWith(".gif")?ee.EUploadMimeType.Gif:r.endsWith(".mpeg4")||r.endsWith(".mp4")?ee.EUploadMimeType.Mp4:r.endsWith(".srt")?ee.EUploadMimeType.Srt:((0,Yl.safeDeprecationWarning)({instance:"TwitterApiv1ReadWrite",method:"uploadMedia",problem:"options.mimeType is missing and filename couldn't help to resolve MIME type, so it will fallback to image/jpeg",resolution:"If you except to give filenames without extensions, please specify explicitlty the MIME type using options.mimeType"}),ee.EUploadMimeType.Jpeg)}function mm(r){return(0,Yl.safeDeprecationWarning)({instance:"TwitterApiv1ReadWrite",method:"uploadMedia",problem:"you're using options.type",resolution:"Remove options.type argument and migrate to options.mimeType which takes the real MIME type. If you're using type=longmp4, add options.longVideo alongside of mimeType=EUploadMimeType.Mp4"}),r==="gif"?ee.EUploadMimeType.Gif:r==="jpg"?ee.EUploadMimeType.Jpeg:r==="png"?ee.EUploadMimeType.Png:r==="webp"?ee.EUploadMimeType.Webp:r==="srt"?ee.EUploadMimeType.Srt:r==="mp4"||r==="longmp4"?ee.EUploadMimeType.Mp4:r}function pm(r,e){return r===ee.EUploadMimeType.Mp4?e==="tweet"?"TweetVideo":"DmVideo":r===ee.EUploadMimeType.Gif?e==="tweet"?"TweetGif":"DmGif":r===ee.EUploadMimeType.Srt?"Subtitles":e==="tweet"?"TweetImage":"DmImage"}z.getMediaCategoryByMime=pm;function _m(r){return new Promise(e=>setTimeout(e,r*1e3))}z.sleepSecs=_m;async function gm(r,e,t=0,i){if(r instanceof Buffer){let u=r.slice(t,t+e);return[u,u.length]}if(!i)throw new Error("Well, we will need a buffer to store file content.");let a;return typeof r=="number"?a=await new Promise((u,c)=>{ti.read(r,i,0,e,t,(d,h)=>{d&&c(d),u(h)})}):a=(await r.read(i,0,e,t)).bytesRead,[i,a]}z.readNextPartOf=gm});var Us=T(je=>{"use strict";var wm=je&&je.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),ym=je&&je.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),bm=je&&je.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&wm(e,r,t);return ym(e,r),e},Tm=je&&je.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(je,"__esModule",{value:!0});var Et=xe(),Sm=Tm(Bs()),Rm=Ne(),Xl=bm(require("fs")),Ye=Gl(),ri=gt(),js="media/upload.json",Jl=class extends Sm.default{constructor(){super(...arguments);this._prefix=Et.API_V1_1_PREFIX}get readOnly(){return this}tweet(e,t={}){let i=p({status:e,tweet_mode:"extended"},t);return this.post("statuses/update.json",i)}async quote(e,t,i={}){let a="https://twitter.com/i/statuses/"+t;return this.tweet(e,j(p({},i),{attachment_url:a}))}async tweetThread(e){let t=[];for(let i of e){let a=t.length?t[t.length-1]:null,u=p({},typeof i=="string"?{status:i}:i),c=a?a.id_str:u.in_reply_to_status_id,d=u.status;c?t.push(await this.reply(d,c,u)):t.push(await this.tweet(d,u))}return t}reply(e,t,i={}){return this.tweet(e,p({auto_populate_reply_metadata:!0,in_reply_to_status_id:t},i))}deleteTweet(e){return this.post("statuses/destroy/:id.json",{tweet_mode:"extended"},{params:{id:e}})}reportUserAsSpam(e){return this.post("users/report_spam.json",p({tweet_mode:"extended"},e))}updateFriendship(e){return this.post("friendships/update.json",e)}updateAccountSettings(e){return this.post("account/settings.json",e)}updateAccountProfile(e){return this.post("account/update_profile.json",e)}async updateAccountProfileBanner(e,t={}){let i=p({banner:await(0,Ye.readFileIntoBuffer)(e)},t);return this.post("account/update_profile_banner.json",i,{forceBodyMode:"form-data"})}async updateAccountProfileImage(e,t={}){let i=p({tweet_mode:"extended",image:await(0,Ye.readFileIntoBuffer)(e)},t);return this.post("account/update_profile_image.json",i,{forceBodyMode:"form-data"})}removeAccountProfileBanner(){return this.post("account/remove_profile_banner.json")}createList(e){return this.post("lists/create.json",p({tweet_mode:"extended"},e))}updateList(e){return this.post("lists/update.json",p({tweet_mode:"extended"},e))}removeList(e){return this.post("lists/destroy.json",p({tweet_mode:"extended"},e))}addListMembers(e){let i=e.user_id&&(0,ri.hasMultipleItems)(e.user_id)||e.screen_name&&(0,ri.hasMultipleItems)(e.screen_name)?"lists/members/create_all.json":"lists/members/create.json";return this.post(i,e)}removeListMembers(e){let i=e.user_id&&(0,ri.hasMultipleItems)(e.user_id)||e.screen_name&&(0,ri.hasMultipleItems)(e.screen_name)?"lists/members/destroy_all.json":"lists/members/destroy.json";return this.post(i,e)}subscribeToList(e){return this.post("lists/subscribers/create.json",p({tweet_mode:"extended"},e))}unsubscribeOfList(e){return this.post("lists/subscribers/destroy.json",p({tweet_mode:"extended"},e))}createMediaMetadata(e,t){return this.post("media/metadata/create.json",p({media_id:e},t),{prefix:Et.API_V1_1_UPLOAD_PREFIX,forceBodyMode:"json"})}createMediaSubtitles(e,t){return this.post("media/subtitles/create.json",{media_id:e,media_category:"TweetVideo",subtitle_info:{subtitles:t}},{prefix:Et.API_V1_1_UPLOAD_PREFIX,forceBodyMode:"json"})}deleteMediaSubtitles(e,...t){return this.post("media/subtitles/delete.json",{media_id:e,media_category:"TweetVideo",subtitle_info:{subtitles:t.map(i=>({language_code:i}))}},{prefix:Et.API_V1_1_UPLOAD_PREFIX,forceBodyMode:"json"})}async uploadMedia(e,t={}){var i;let a=(i=t.chunkLength)!==null&&i!==void 0?i:1048576,{fileHandle:u,mediaCategory:c,fileSize:d,mimeType:h}=await this.getUploadMediaRequirements(e,t);try{let S=await this.post(js,{command:"INIT",total_bytes:d,media_type:h,media_category:c,additional_owners:t.additionalOwners,shared:t.shared?!0:void 0},{prefix:Et.API_V1_1_UPLOAD_PREFIX});await this.mediaChunkedUpload(u,a,S.media_id_string,t.maxConcurrentUploads);let y=await this.post(js,{command:"FINALIZE",media_id:S.media_id_string},{prefix:Et.API_V1_1_UPLOAD_PREFIX});return y.processing_info&&y.processing_info.state!=="succeeded"&&await this.awaitForMediaProcessingCompletion(y),y.media_id_string}finally{typeof e=="number"?Xl.close(e,()=>{}):typeof u=="object"&&!(u instanceof Buffer)&&u.close()}}async awaitForMediaProcessingCompletion(e){for(;;){e=await this.mediaInfo(e.media_id_string);let{processing_info:t}=e;if(!t||t.state==="succeeded")return;if(t.state==="failed"){if(t.error){let{name:i,message:a}=t.error;throw new Error(`Failed to process media: ${i} - ${a}.`)}throw new Error("Failed to process the media.")}t.check_after_secs?await(0,Ye.sleepSecs)(t.check_after_secs):await(0,Ye.sleepSecs)(5)}}async getUploadMediaRequirements(e,{mimeType:t,type:i,target:a,longVideo:u}={}){let c;try{c=await(0,Ye.getFileHandle)(e);let d=(0,Ye.getMimeType)(e,i,t),h;return d===Rm.EUploadMimeType.Mp4&&(!t&&!i&&a!=="dm"||u)?h="amplify_video":h=(0,Ye.getMediaCategoryByMime)(d,a??"tweet"),{fileHandle:c,mediaCategory:h,fileSize:await(0,Ye.getFileSizeFromFileHandle)(c),mimeType:d}}catch(d){throw typeof e=="number"?Xl.close(e,()=>{}):typeof c=="object"&&!(c instanceof Buffer)&&c.close(),d}}async mediaChunkedUpload(e,t,i,a=3){let u=0;if(a<1)throw new RangeError("Bad maxConcurrentUploads parameter.");let c=e instanceof Buffer?void 0:Buffer.alloc(t),d,h,S=0;[d,h]=await(0,Ye.readNextPartOf)(e,t,S,c),S+=h;let y=new Set;for(;h;){let R=d.slice(0,h);if(R.length){let w=this.post(js,{command:"APPEND",media_id:i,segment_index:u,media:R},{prefix:Et.API_V1_1_UPLOAD_PREFIX});y.add(w),w.then(()=>{y.delete(w)}),u++}y.size>=a&&await Promise.race(y),[d,h]=await(0,Ye.readNextPartOf)(e,t,S,c),S+=h}await Promise.all([...y])}};je.default=Jl});var ei=T(Ot=>{"use strict";var vm=Ot&&Ot.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ot,"__esModule",{value:!0});Ot.TwitterApiv1=void 0;var Pm=xe(),Zl=gs(),Ur=Ne(),qm=vm(Us()),Ws=class extends qm.default{constructor(){super(...arguments);this._prefix=Pm.API_V1_1_PREFIX}get readWrite(){return this}sendDm(a){var u=a,{recipient_id:e,custom_profile_id:t}=u,i=H(u,["recipient_id","custom_profile_id"]);let c={event:{type:Ur.EDirectMessageEventTypeV1.Create,[Ur.EDirectMessageEventTypeV1.Create]:{target:{recipient_id:e},message_data:i}}};return t&&(c.event[Ur.EDirectMessageEventTypeV1.Create].custom_profile_id=t),this.post("direct_messages/events/new.json",c,{forceBodyMode:"json"})}getDmEvent(e){return this.get("direct_messages/events/show.json",{id:e})}deleteDm(e){return this.delete("direct_messages/events/destroy.json",{id:e})}async listDmEvents(e={}){let t=p({},e),i=await this.get("direct_messages/events/list.json",t,{fullResponse:!0});return new Zl.DmEventsV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}newWelcomeDm(e,t){let i={[Ur.EDirectMessageEventTypeV1.WelcomeCreate]:{name:e,message_data:t}};return this.post("direct_messages/welcome_messages/new.json",i,{forceBodyMode:"json"})}getWelcomeDm(e){return this.get("direct_messages/welcome_messages/show.json",{id:e})}deleteWelcomeDm(e){return this.delete("direct_messages/welcome_messages/destroy.json",{id:e})}updateWelcomeDm(e,t){let i={message_data:t};return this.put("direct_messages/welcome_messages/update.json",i,{forceBodyMode:"json",query:{id:e}})}async listWelcomeDms(e={}){let t=p({},e),i=await this.get("direct_messages/welcome_messages/list.json",t,{fullResponse:!0});return new Zl.WelcomeDmV1Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t})}newWelcomeDmRule(e){return this.post("direct_messages/welcome_messages/rules/new.json",{welcome_message_rule:{welcome_message_id:e}},{forceBodyMode:"json"})}getWelcomeDmRule(e){return this.get("direct_messages/welcome_messages/rules/show.json",{id:e})}deleteWelcomeDmRule(e){return this.delete("direct_messages/welcome_messages/rules/destroy.json",{id:e})}async listWelcomeDmRules(e={}){let t=p({},e);return this.get("direct_messages/welcome_messages/rules/list.json",t)}async setWelcomeDm(e,t=!0){var i;let a=await this.listWelcomeDmRules();if((i=a.welcome_message_rules)===null||i===void 0?void 0:i.length)for(let u of a.welcome_message_rules)await this.deleteWelcomeDmRule(u.id),t&&await this.deleteWelcomeDm(u.welcome_message_id);return this.newWelcomeDmRule(e)}markDmAsRead(e,t){return this.post("direct_messages/mark_read.json",{last_read_event_id:e,recipient_id:t},{forceBodyMode:"url"})}indicateDmTyping(e){return this.post("direct_messages/indicate_typing.json",{recipient_id:e},{forceBodyMode:"url"})}async downloadDmImage(e){if(typeof e!="string"){let i=e[Ur.EDirectMessageEventTypeV1.Create].message_data.attachment;if(!i)throw new Error("The given direct message doesn't contain any attachment");e=i.media_url_https}let t=await this.get(e,void 0,{forceParseMode:"buffer",prefix:""});if(!t.length)throw new Error("Image not found. Make sure you are logged with credentials able to access direct messages, and check the URL.");return t}};Ot.TwitterApiv1=Ws;Ot.default=Ws});var zs=T(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.TwitterV2IncludesHelper=void 0;var F=class{constructor(e){this.result=e}get tweets(){return F.tweets(this.result)}static tweets(e){var t,i;return(i=(t=e.includes)===null||t===void 0?void 0:t.tweets)!==null&&i!==void 0?i:[]}tweetById(e){return F.tweetById(this.result,e)}static tweetById(e,t){return this.tweets(e).find(i=>i.id===t)}retweet(e){return F.retweet(this.result,e)}static retweet(e,t){var i;let a=((i=t.referenced_tweets)!==null&&i!==void 0?i:[]).filter(u=>u.type==="retweeted").map(u=>u.id);return this.tweets(e).find(u=>a.includes(u.id))}quote(e){return F.quote(this.result,e)}static quote(e,t){var i;let a=((i=t.referenced_tweets)!==null&&i!==void 0?i:[]).filter(u=>u.type==="quoted").map(u=>u.id);return this.tweets(e).find(u=>a.includes(u.id))}repliedTo(e){return F.repliedTo(this.result,e)}static repliedTo(e,t){var i;let a=((i=t.referenced_tweets)!==null&&i!==void 0?i:[]).filter(u=>u.type==="replied_to").map(u=>u.id);return this.tweets(e).find(u=>a.includes(u.id))}author(e){return F.author(this.result,e)}static author(e,t){let i=t.author_id;return i?this.users(e).find(a=>a.id===i):void 0}repliedToAuthor(e){return F.repliedToAuthor(this.result,e)}static repliedToAuthor(e,t){let i=t.in_reply_to_user_id;return i?this.users(e).find(a=>a.id===i):void 0}get users(){return F.users(this.result)}static users(e){var t,i;return(i=(t=e.includes)===null||t===void 0?void 0:t.users)!==null&&i!==void 0?i:[]}userById(e){return F.userById(this.result,e)}static userById(e,t){return this.users(e).find(i=>i.id===t)}pinnedTweet(e){return F.pinnedTweet(this.result,e)}static pinnedTweet(e,t){return t.pinned_tweet_id?this.tweets(e).find(i=>i.id===t.pinned_tweet_id):void 0}get media(){return F.media(this.result)}static media(e){var t,i;return(i=(t=e.includes)===null||t===void 0?void 0:t.media)!==null&&i!==void 0?i:[]}medias(e){return F.medias(this.result,e)}static medias(e,t){var i,a;let u=(a=(i=t.attachments)===null||i===void 0?void 0:i.media_keys)!==null&&a!==void 0?a:[];return this.media(e).filter(c=>u.includes(c.media_key))}get polls(){return F.polls(this.result)}static polls(e){var t,i;return(i=(t=e.includes)===null||t===void 0?void 0:t.polls)!==null&&i!==void 0?i:[]}poll(e){return F.poll(this.result,e)}static poll(e,t){var i,a;let u=(a=(i=t.attachments)===null||i===void 0?void 0:i.poll_ids)!==null&&a!==void 0?a:[];if(u.length){let c=u[0];return this.polls(e).find(d=>d.id===c)}}get places(){return F.places(this.result)}static places(e){var t,i;return(i=(t=e.includes)===null||t===void 0?void 0:t.places)!==null&&i!==void 0?i:[]}place(e){return F.place(this.result,e)}static place(e,t){var i;let a=(i=t.geo)===null||i===void 0?void 0:i.place_id;return a?this.places(e).find(u=>u.id===a):void 0}listOwner(e){return F.listOwner(this.result,e)}static listOwner(e,t){let i=t.owner_id;return i?this.users(e).find(a=>a.id===i):void 0}spaceCreator(e){return F.spaceCreator(this.result,e)}static spaceCreator(e,t){let i=t.creator_id;return i?this.users(e).find(a=>a.id===i):void 0}spaceHosts(e){return F.spaceHosts(this.result,e)}static spaceHosts(e,t){var i;let a=(i=t.host_ids)!==null&&i!==void 0?i:[];return this.users(e).filter(u=>a.includes(u.id))}spaceSpeakers(e){return F.spaceSpeakers(this.result,e)}static spaceSpeakers(e,t){var i;let a=(i=t.speaker_ids)!==null&&i!==void 0?i:[];return this.users(e).filter(u=>a.includes(u.id))}spaceInvitedUsers(e){return F.spaceInvitedUsers(this.result,e)}static spaceInvitedUsers(e,t){var i;let a=(i=t.invited_user_ids)!==null&&i!==void 0?i:[];return this.users(e).filter(u=>a.includes(u.id))}};ni.TwitterV2IncludesHelper=F});var ii=T(ir=>{"use strict";Object.defineProperty(ir,"__esModule",{value:!0});ir.TimelineV2Paginator=ir.TwitterV2Paginator=void 0;var ec=zs(),Am=Kt(),Vs=class extends Am.PreviousableTwitterPaginator{updateIncludes(e){if(e.errors&&(this._realData.errors||(this._realData.errors=[]),this._realData.errors=[...this._realData.errors,...e.errors]),!e.includes)return;this._realData.includes||(this._realData.includes={});let t=this._realData.includes;for(let[i,a]of Object.entries(e.includes))t[i]||(t[i]=[]),t[i]=[...t[i],...a]}assertUsable(){if(this.unusable)throw new Error("Unable to use this paginator to fetch more data, as it does not contain any metadata. Check .errors property for more details.")}get meta(){return this._realData.meta}get includes(){var e;return((e=this._realData)===null||e===void 0?void 0:e.includes)?this._includesInstance?this._includesInstance:this._includesInstance=new ec.TwitterV2IncludesHelper(this._realData):new ec.TwitterV2IncludesHelper(this._realData)}get errors(){var e;return(e=this._realData.errors)!==null&&e!==void 0?e:[]}get unusable(){return this.errors.length>0&&!this._realData.meta&&!this._realData.data}};ir.TwitterV2Paginator=Vs;var tc=class extends Vs{refreshInstanceFromResult(e,t){var i;let a=e.data,u=(i=a.data)!==null&&i!==void 0?i:[];this._rateLimit=e.rateLimit,this._realData.data||(this._realData.data=[]),t?(this._realData.meta.result_count+=a.meta.result_count,this._realData.meta.next_token=a.meta.next_token,this._realData.data.push(...u)):(this._realData.meta.result_count+=a.meta.result_count,this._realData.meta.previous_token=a.meta.previous_token,this._realData.data.unshift(...u)),this.updateIncludes(a)}getNextQueryParams(e){return this.assertUsable(),j(p({},this.injectQueryParams(e)),{pagination_token:this._realData.meta.next_token})}getPreviousQueryParams(e){return this.assertUsable(),j(p({},this.injectQueryParams(e)),{pagination_token:this._realData.meta.previous_token})}getPageLengthFromRequest(e){var t,i;return(i=(t=e.data.data)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0}isFetchLastOver(e){var t;return!((t=e.data.data)===null||t===void 0?void 0:t.length)||!this.canFetchNextPage(e.data)}canFetchNextPage(e){var t;return!!((t=e.meta)===null||t===void 0?void 0:t.next_token)}};ir.TimelineV2Paginator=tc});var dc=T(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.TweetV2ListTweetsPaginator=Q.TweetV2UserLikedTweetsPaginator=Q.TweetBookmarksTimelineV2Paginator=Q.TweetUserMentionTimelineV2Paginator=Q.TweetUserTimelineV2Paginator=Q.TweetHomeTimelineV2Paginator=Q.QuotedTweetsTimelineV2Paginator=Q.TweetSearchAllV2Paginator=Q.TweetSearchRecentV2Paginator=void 0;var $s=ii(),Ns=class extends $s.TwitterV2Paginator{refreshInstanceFromResult(e,t){var i;let a=e.data,u=(i=a.data)!==null&&i!==void 0?i:[];this._rateLimit=e.rateLimit,this._realData.data||(this._realData.data=[]),t?(this._realData.meta.oldest_id=a.meta.oldest_id,this._realData.meta.result_count+=a.meta.result_count,this._realData.meta.next_token=a.meta.next_token,this._realData.data.push(...u)):(this._realData.meta.newest_id=a.meta.newest_id,this._realData.meta.result_count+=a.meta.result_count,this._realData.data.unshift(...u)),this.updateIncludes(a)}getNextQueryParams(e){this.assertUsable();let t=p({},this.injectQueryParams(e));return this._realData.meta.next_token?t.next_token=this._realData.meta.next_token:(t.start_time&&(t.since_id=this.dateStringToSnowflakeId(t.start_time),delete t.start_time),t.end_time&&delete t.end_time,t.until_id=this._realData.meta.oldest_id),t}getPreviousQueryParams(e){return this.assertUsable(),j(p({},this.injectQueryParams(e)),{since_id:this._realData.meta.newest_id})}getPageLengthFromRequest(e){var t,i;return(i=(t=e.data.data)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0}isFetchLastOver(e){var t;return!((t=e.data.data)===null||t===void 0?void 0:t.length)||!this.canFetchNextPage(e.data)}canFetchNextPage(e){return!!e.meta.next_token}getItemArray(){return this.tweets}dateStringToSnowflakeId(e){let t=BigInt("1288834974657"),i=new Date(e);if(isNaN(i.valueOf()))throw new Error("Unable to convert start_time/end_time to a valid date. A ISO 8601 DateTime is excepted, please check your input.");return(BigInt(i.valueOf())-t<<BigInt("22")).toString()}get tweets(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}},sr=class extends $s.TimelineV2Paginator{refreshInstanceFromResult(e,t){super.refreshInstanceFromResult(e,t);let i=e.data;t?this._realData.meta.oldest_id=i.meta.oldest_id:this._realData.meta.newest_id=i.meta.newest_id}getItemArray(){return this.tweets}get tweets(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}},rc=class extends Ns{constructor(){super(...arguments);this._endpoint="tweets/search/recent"}};Q.TweetSearchRecentV2Paginator=rc;var nc=class extends Ns{constructor(){super(...arguments);this._endpoint="tweets/search/all"}};Q.TweetSearchAllV2Paginator=nc;var ic=class extends sr{constructor(){super(...arguments);this._endpoint="tweets/:id/quote_tweets"}};Q.QuotedTweetsTimelineV2Paginator=ic;var sc=class extends sr{constructor(){super(...arguments);this._endpoint="users/:id/timelines/reverse_chronological"}};Q.TweetHomeTimelineV2Paginator=sc;var ac=class extends sr{constructor(){super(...arguments);this._endpoint="users/:id/tweets"}};Q.TweetUserTimelineV2Paginator=ac;var oc=class extends sr{constructor(){super(...arguments);this._endpoint="users/:id/mentions"}};Q.TweetUserMentionTimelineV2Paginator=oc;var uc=class extends sr{constructor(){super(...arguments);this._endpoint="users/:id/bookmarks"}};Q.TweetBookmarksTimelineV2Paginator=uc;var Hs=class extends $s.TimelineV2Paginator{get tweets(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}getItemArray(){return this.tweets}},lc=class extends Hs{constructor(){super(...arguments);this._endpoint="users/:id/liked_tweets"}};Q.TweetV2UserLikedTweetsPaginator=lc;var cc=class extends Hs{constructor(){super(...arguments);this._endpoint="lists/:id/tweets"}};Q.TweetV2ListTweetsPaginator=cc});var Qs=T(X=>{"use strict";Object.defineProperty(X,"__esModule",{value:!0});X.TweetRetweetersUsersV2Paginator=X.TweetLikingUsersV2Paginator=X.UserListFollowersV2Paginator=X.UserListMembersV2Paginator=X.UserFollowingV2Paginator=X.UserFollowersV2Paginator=X.UserMutingUsersV2Paginator=X.UserBlockingUsersV2Paginator=void 0;var Dm=ii(),rt=class extends Dm.TimelineV2Paginator{getItemArray(){return this.users}get users(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}},fc=class extends rt{constructor(){super(...arguments);this._endpoint="users/:id/blocking"}};X.UserBlockingUsersV2Paginator=fc;var hc=class extends rt{constructor(){super(...arguments);this._endpoint="users/:id/muting"}};X.UserMutingUsersV2Paginator=hc;var mc=class extends rt{constructor(){super(...arguments);this._endpoint="users/:id/followers"}};X.UserFollowersV2Paginator=mc;var pc=class extends rt{constructor(){super(...arguments);this._endpoint="users/:id/following"}};X.UserFollowingV2Paginator=pc;var _c=class extends rt{constructor(){super(...arguments);this._endpoint="lists/:id/members"}};X.UserListMembersV2Paginator=_c;var gc=class extends rt{constructor(){super(...arguments);this._endpoint="lists/:id/followers"}};X.UserListFollowersV2Paginator=gc;var wc=class extends rt{constructor(){super(...arguments);this._endpoint="tweets/:id/liking_users"}};X.TweetLikingUsersV2Paginator=wc;var yc=class extends rt{constructor(){super(...arguments);this._endpoint="tweets/:id/retweeted_by"}};X.TweetRetweetersUsersV2Paginator=yc});var Rc=T(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.UserListFollowedV2Paginator=wt.UserListMembershipsV2Paginator=wt.UserOwnedListsV2Paginator=void 0;var Lm=ii(),si=class extends Lm.TimelineV2Paginator{getItemArray(){return this.lists}get lists(){var e;return(e=this._realData.data)!==null&&e!==void 0?e:[]}get meta(){return super.meta}},bc=class extends si{constructor(){super(...arguments);this._endpoint="users/:id/owned_lists"}};wt.UserOwnedListsV2Paginator=bc;var Tc=class extends si{constructor(){super(...arguments);this._endpoint="users/:id/list_memberships"}};wt.UserListMembershipsV2Paginator=Tc;var Sc=class extends si{constructor(){super(...arguments);this._endpoint="users/:id/followed_lists"}};wt.UserListFollowedV2Paginator=Sc});var Ys=T(se=>{"use strict";var Cm=se&&se.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),nt=se&&se.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Cm(e,r,t)};Object.defineProperty(se,"__esModule",{value:!0});nt(dc(),se);nt(Kt(),se);nt(gs(),se);nt(ks(),se);nt(Cs(),se);nt(Es(),se);nt(Qs(),se);nt(Ms(),se);nt(Rc(),se)});var Ks=T(Wr=>{"use strict";var km=Wr&&Wr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Wr,"__esModule",{value:!0});var Im=km(Jn()),Em=xe(),vc=class extends Im.default{constructor(){super(...arguments);this._prefix=Em.API_V2_LABS_PREFIX}};Wr.default=vc});var Gs=T(zr=>{"use strict";var qc=zr&&zr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(zr,"__esModule",{value:!0});var Om=qc(Jn()),Mm=xe(),De=Ys(),xm=qc(Ks()),yt=Qs(),Pc=gt(),Ac=class extends Om.default{constructor(){super(...arguments);this._prefix=Mm.API_V2_PREFIX}get labs(){return this._labs?this._labs:this._labs=new xm.default(this)}async search(e,t={}){let i=typeof e=="string"?e:void 0,u=j(p({},typeof e=="object"&&e!==null?e:t),{query:i}),c=await this.get("tweets/search/recent",u,{fullResponse:!0});return new De.TweetSearchRecentV2Paginator({realData:c.data,rateLimit:c.rateLimit,instance:this,queryParams:u})}async searchAll(e,t={}){let i=j(p({},t),{query:e}),a=await this.get("tweets/search/all",i,{fullResponse:!0});return new De.TweetSearchAllV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:i})}singleTweet(e,t={}){return this.get("tweets/:id",t,{params:{id:e}})}tweets(e,t={}){return this.get("tweets",p({ids:e},t))}tweetCountRecent(e,t={}){return this.get("tweets/counts/recent",p({query:e},t))}tweetCountAll(e,t={}){return this.get("tweets/counts/all",p({query:e},t))}async tweetRetweetedBy(e,t={}){let c=t,{asPaginator:i}=c,a=H(c,["asPaginator"]),u=await this.get("tweets/:id/retweeted_by",a,{fullResponse:!0,params:{id:e}});return i?new yt.TweetRetweetersUsersV2Paginator({realData:u.data,rateLimit:u.rateLimit,instance:this,queryParams:a,sharedParams:{id:e}}):u.data}async tweetLikedBy(e,t={}){let c=t,{asPaginator:i}=c,a=H(c,["asPaginator"]),u=await this.get("tweets/:id/liking_users",a,{fullResponse:!0,params:{id:e}});return i?new yt.TweetLikingUsersV2Paginator({realData:u.data,rateLimit:u.rateLimit,instance:this,queryParams:a,sharedParams:{id:e}}):u.data}async homeTimeline(e={}){let t=await this.getCurrentUserV2Object(),i=await this.get("users/:id/timelines/reverse_chronological",e,{fullResponse:!0,params:{id:t.data.id}});return new De.TweetHomeTimelineV2Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:e,sharedParams:{id:t.data.id}})}async userTimeline(e,t={}){let i=await this.get("users/:id/tweets",t,{fullResponse:!0,params:{id:e}});return new De.TweetUserTimelineV2Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async userMentionTimeline(e,t={}){let i=await this.get("users/:id/mentions",t,{fullResponse:!0,params:{id:e}});return new De.TweetUserMentionTimelineV2Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async quotes(e,t={}){let i=await this.get("tweets/:id/quote_tweets",t,{fullResponse:!0,params:{id:e}});return new De.QuotedTweetsTimelineV2Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:t,sharedParams:{id:e}})}async bookmarks(e={}){let t=await this.getCurrentUserV2Object(),i=await this.get("users/:id/bookmarks",e,{fullResponse:!0,params:{id:t.data.id}});return new De.TweetBookmarksTimelineV2Paginator({realData:i.data,rateLimit:i.rateLimit,instance:this,queryParams:e,sharedParams:{id:t.data.id}})}me(e={}){return this.get("users/me",e)}user(e,t={}){return this.get("users/:id",t,{params:{id:e}})}users(e,t={}){let i=Array.isArray(e)?e.join(","):e;return this.get("users",j(p({},t),{ids:i}))}userByUsername(e,t={}){return this.get("users/by/username/:username",t,{params:{username:e}})}usersByUsernames(e,t={}){return e=Array.isArray(e)?e.join(","):e,this.get("users/by",j(p({},t),{usernames:e}))}async followers(e,t={}){let d=t,{asPaginator:i}=d,a=H(d,["asPaginator"]),u={id:e};if(!i)return this.get("users/:id/followers",a,{params:u});let c=await this.get("users/:id/followers",a,{fullResponse:!0,params:u});return new yt.UserFollowersV2Paginator({realData:c.data,rateLimit:c.rateLimit,instance:this,queryParams:a,sharedParams:u})}async following(e,t={}){let d=t,{asPaginator:i}=d,a=H(d,["asPaginator"]),u={id:e};if(!i)return this.get("users/:id/following",a,{params:u});let c=await this.get("users/:id/following",a,{fullResponse:!0,params:u});return new yt.UserFollowingV2Paginator({realData:c.data,rateLimit:c.rateLimit,instance:this,queryParams:a,sharedParams:u})}async userLikedTweets(e,t={}){let i={id:e},a=await this.get("users/:id/liked_tweets",t,{fullResponse:!0,params:i});return new De.TweetV2UserLikedTweetsPaginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}async userBlockingUsers(e,t={}){let i={id:e},a=await this.get("users/:id/blocking",t,{fullResponse:!0,params:i});return new yt.UserBlockingUsersV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}async userMutingUsers(e,t={}){let i={id:e},a=await this.get("users/:id/muting",t,{fullResponse:!0,params:i});return new yt.UserMutingUsersV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}list(e,t={}){return this.get("lists/:id",t,{params:{id:e}})}async listsOwned(e,t={}){let i={id:e},a=await this.get("users/:id/owned_lists",t,{fullResponse:!0,params:i});return new De.UserOwnedListsV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}async listMemberships(e,t={}){let i={id:e},a=await this.get("users/:id/list_memberships",t,{fullResponse:!0,params:i});return new De.UserListMembershipsV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}async listFollowed(e,t={}){let i={id:e},a=await this.get("users/:id/followed_lists",t,{fullResponse:!0,params:i});return new De.UserListFollowedV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}async listTweets(e,t={}){let i={id:e},a=await this.get("lists/:id/tweets",t,{fullResponse:!0,params:i});return new De.TweetV2ListTweetsPaginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}async listMembers(e,t={}){let i={id:e},a=await this.get("lists/:id/members",t,{fullResponse:!0,params:i});return new yt.UserListMembersV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}async listFollowers(e,t={}){let i={id:e},a=await this.get("lists/:id/followers",t,{fullResponse:!0,params:i});return new yt.UserListFollowersV2Paginator({realData:a.data,rateLimit:a.rateLimit,instance:this,queryParams:p({},t),sharedParams:i})}space(e,t={}){return this.get("spaces/:id",t,{params:{id:e}})}spaces(e,t={}){return this.get("spaces",p({ids:e},t))}spacesByCreators(e,t={}){return this.get("spaces/by/creator_ids",p({user_ids:e},t))}searchSpaces(e){return this.get("spaces/search",e)}spaceBuyers(e,t={}){return this.get("spaces/:id/buyers",t,{params:{id:e}})}searchStream(i={}){var a=i,{autoConnect:e}=a,t=H(a,["autoConnect"]);return this.getStream("tweets/search/stream",t,{payloadIsError:Pc.isTweetStreamV2ErrorPayload,autoConnect:e})}streamRules(e={}){return this.get("tweets/search/stream/rules",e)}updateStreamRules(e,t={}){return this.post("tweets/search/stream/rules",e,{query:t})}sampleStream(i={}){var a=i,{autoConnect:e}=a,t=H(a,["autoConnect"]);return this.getStream("tweets/sample/stream",t,{payloadIsError:Pc.isTweetStreamV2ErrorPayload,autoConnect:e})}complianceJobs(e){return this.get("compliance/jobs",e)}complianceJob(e){return this.get("compliance/jobs/:id",void 0,{params:{id:e}})}async sendComplianceJob(e){let t=await this.post("compliance/jobs",{type:e.type,name:e.name}),i=e.ids instanceof Buffer?e.ids:Buffer.from(e.ids.join(`
`));return await this.put(t.data.upload_url,i,{forceBodyMode:"raw",enableAuth:!1,headers:{"Content-Type":"text/plain"},prefix:""}),t}async complianceJobResult(e){let t=e;for(;t.status!=="complete";){if(t.status==="expired"||t.status==="failed")throw new Error("Job failed to be completed.");await new Promise(a=>setTimeout(a,3500)),t=(await this.complianceJob(e.id)).data}return(await this.get(e.download_url,void 0,{enableAuth:!1,prefix:""})).trim().split(`
`).filter(a=>a).map(a=>JSON.parse(a))}};zr.default=Ac});var Xs=T(Vr=>{"use strict";var Fm=Vr&&Vr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Vr,"__esModule",{value:!0});var Bm=xe(),jm=Fm(Ks()),Dc=class extends jm.default{constructor(){super(...arguments);this._prefix=Bm.API_V2_LABS_PREFIX}get readOnly(){return this}};Vr.default=Dc});var Js=T($r=>{"use strict";var Lc=$r&&$r.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($r,"__esModule",{value:!0});var Um=xe(),Wm=Lc(Gs()),zm=Lc(Xs()),Cc=class extends Wm.default{constructor(){super(...arguments);this._prefix=Um.API_V2_PREFIX}get readOnly(){return this}get labs(){return this._labs?this._labs:this._labs=new zm.default(this)}hideReply(e,t){return this.put("tweets/:id/hidden",{hidden:t},{params:{id:e}})}like(e,t){return this.post("users/:id/likes",{tweet_id:t},{params:{id:e}})}unlike(e,t){return this.delete("users/:id/likes/:tweet_id",void 0,{params:{id:e,tweet_id:t}})}retweet(e,t){return this.post("users/:id/retweets",{tweet_id:t},{params:{id:e}})}unretweet(e,t){return this.delete("users/:id/retweets/:tweet_id",void 0,{params:{id:e,tweet_id:t}})}tweet(e,t={}){return typeof e=="object"?t=e:t=p({text:e},t),this.post("tweets",t)}reply(e,t,i={}){var a;let u=p({in_reply_to_tweet_id:t},(a=i.reply)!==null&&a!==void 0?a:{});return this.post("tweets",j(p({text:e},i),{reply:u}))}quote(e,t,i={}){return this.tweet(e,j(p({},i),{quote_tweet_id:t}))}async tweetThread(e){var t,i;let a=[];for(let u of e){let c=a.length?a[a.length-1]:null,d=p({},typeof u=="string"?{text:u}:u),h=c?c.data.id:(t=d.reply)===null||t===void 0?void 0:t.in_reply_to_tweet_id,S=(i=d.text)!==null&&i!==void 0?i:"";h?a.push(await this.reply(S,h,d)):a.push(await this.tweet(S,d))}return a}deleteTweet(e){return this.delete("tweets/:id",void 0,{params:{id:e}})}async bookmark(e){let t=await this.getCurrentUserV2Object();return this.post("users/:id/bookmarks",{tweet_id:e},{params:{id:t.data.id}})}async deleteBookmark(e){let t=await this.getCurrentUserV2Object();return this.delete("users/:id/bookmarks/:tweet_id",void 0,{params:{id:t.data.id,tweet_id:e}})}follow(e,t){return this.post("users/:id/following",{target_user_id:t},{params:{id:e}})}unfollow(e,t){return this.delete("users/:source_user_id/following/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}block(e,t){return this.post("users/:id/blocking",{target_user_id:t},{params:{id:e}})}unblock(e,t){return this.delete("users/:source_user_id/blocking/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}mute(e,t){return this.post("users/:id/muting",{target_user_id:t},{params:{id:e}})}unmute(e,t){return this.delete("users/:source_user_id/muting/:target_user_id",void 0,{params:{source_user_id:e,target_user_id:t}})}createList(e){return this.post("lists",e)}updateList(e,t={}){return this.put("lists/:id",t,{params:{id:e}})}removeList(e){return this.delete("lists/:id",void 0,{params:{id:e}})}addListMember(e,t){return this.post("lists/:id/members",{user_id:t},{params:{id:e}})}removeListMember(e,t){return this.delete("lists/:id/members/:user_id",void 0,{params:{id:e,user_id:t}})}subscribeToList(e,t){return this.post("users/:id/followed_lists",{list_id:t},{params:{id:e}})}unsubscribeOfList(e,t){return this.delete("users/:id/followed_lists/:list_id",void 0,{params:{id:e,list_id:t}})}pinList(e,t){return this.post("users/:id/pinned_lists",{list_id:t},{params:{id:e}})}unpinList(e,t){return this.delete("users/:id/pinned_lists/:list_id",void 0,{params:{id:e,list_id:t}})}};$r.default=Cc});var ea=T(Mt=>{"use strict";var Vm=Mt&&Mt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Mt,"__esModule",{value:!0});Mt.TwitterApiv2Labs=void 0;var $m=xe(),Nm=Vm(Xs()),Zs=class extends Nm.default{constructor(){super(...arguments);this._prefix=$m.API_V2_LABS_PREFIX}get readWrite(){return this}};Mt.TwitterApiv2Labs=Zs;Mt.default=Zs});var ra=T(xt=>{"use strict";var kc=xt&&xt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(xt,"__esModule",{value:!0});xt.TwitterApiv2=void 0;var Hm=xe(),Qm=kc(Js()),Ym=kc(ea()),ta=class extends Qm.default{constructor(){super(...arguments);this._prefix=Hm.API_V2_PREFIX}get readWrite(){return this}get labs(){return this._labs?this._labs:this._labs=new Ym.default(this)}};xt.TwitterApiv2=ta;xt.default=ta});var ia=T(Nr=>{"use strict";var Hr=Nr&&Nr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Nr,"__esModule",{value:!0});var ai=Hr(oi()),Km=Hr(Ls()),Gm=Hr(Bs()),Xm=Hr(Gs()),na=As(),Jm=Hr(qs()),Ic=class extends Km.default{get v1(){return this._v1?this._v1:this._v1=new Gm.default(this)}get v2(){return this._v2?this._v2:this._v2=new Xm.default(this)}async currentUser(e=!1){return await this.getCurrentUserObject(e)}async currentUserV2(e=!1){return await this.getCurrentUserV2Object(e)}search(e,t){return this.v2.search(e,t)}async generateAuthLink(e="oob",{authAccessType:t,linkMode:i="authenticate",forceLogin:a,screenName:u}={}){let c=await this.post("https://api.twitter.com/oauth/request_token",{oauth_callback:e,x_auth_access_type:t}),d=`https://api.twitter.com/oauth/${i}?oauth_token=${encodeURIComponent(c.oauth_token)}`;return a!==void 0&&(d+=`&force_login=${encodeURIComponent(a)}`),u!==void 0&&(d+=`&screen_name=${encodeURIComponent(u)}`),this._requestMaker.hasPlugins()&&this._requestMaker.applyPluginMethod("onOAuth1RequestToken",{client:this._requestMaker,url:d,oauthResult:c}),p({url:d},c)}async login(e){let t=this.getActiveTokens();if(t.type!=="oauth-1.0a")throw new Error("You must setup TwitterApi instance with consumer keys to accept OAuth 1.0 login");let i=await this.post("https://api.twitter.com/oauth/access_token",{oauth_token:t.accessToken,oauth_verifier:e}),a=new ai.default({appKey:t.appKey,appSecret:t.appSecret,accessToken:i.oauth_token,accessSecret:i.oauth_token_secret},this._requestMaker.clientSettings);return{accessToken:i.oauth_token,accessSecret:i.oauth_token_secret,userId:i.user_id,screenName:i.screen_name,client:a}}async appLogin(){let e=this.getActiveTokens();if(e.type!=="oauth-1.0a")throw new Error("You must setup TwitterApi instance with consumer keys to accept app-only login");let i=await new ai.default({username:e.appKey,password:e.appSecret}).post("https://api.twitter.com/oauth2/token",{grant_type:"client_credentials"});return new ai.default(i.access_token,this._requestMaker.clientSettings)}generateOAuth2AuthLink(e,t={}){var i,a;if(!this._requestMaker.clientId)throw new Error("Twitter API instance is not initialized with client ID. You can find your client ID in Twitter Developer Portal. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let u=(i=t.state)!==null&&i!==void 0?i:na.OAuth2Helper.generateRandomString(32),c=na.OAuth2Helper.getCodeVerifier(),d=na.OAuth2Helper.getCodeChallengeFromVerifier(c),h=(a=t.scope)!==null&&a!==void 0?a:"",S=Array.isArray(h)?h.join(" "):h,y=new URL("https://twitter.com/i/oauth2/authorize"),R={response_type:"code",client_id:this._requestMaker.clientId,redirect_uri:e,state:u,code_challenge:d,code_challenge_method:"s256",scope:S};Jm.default.addQueryParamsToUrl(y,R);let w={url:y.toString(),state:u,codeVerifier:c,codeChallenge:d};return this._requestMaker.hasPlugins()&&this._requestMaker.applyPluginMethod("onOAuth2RequestToken",{client:this._requestMaker,result:w,redirectUri:e}),w}async loginWithOAuth2({code:e,codeVerifier:t,redirectUri:i}){if(!this._requestMaker.clientId)throw new Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let a=await this.post("https://api.twitter.com/2/oauth2/token",{code:e,code_verifier:t,redirect_uri:i,grant_type:"authorization_code",client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret});return this.parseOAuth2AccessTokenResult(a)}async refreshOAuth2Token(e){if(!this._requestMaker.clientId)throw new Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");let t=await this.post("https://api.twitter.com/2/oauth2/token",{refresh_token:e,grant_type:"refresh_token",client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret});return this.parseOAuth2AccessTokenResult(t)}async revokeOAuth2Token(e,t="access_token"){if(!this._requestMaker.clientId)throw new Error("Twitter API instance is not initialized with client ID. Please build an instance with: new TwitterApi({ clientId: '<yourClientId>' })");return await this.post("https://api.twitter.com/2/oauth2/revoke",{client_id:this._requestMaker.clientId,client_secret:this._requestMaker.clientSecret,token:e,token_type_hint:t})}parseOAuth2AccessTokenResult(e){let t=new ai.default(e.access_token,this._requestMaker.clientSettings),i=e.scope.split(" ").filter(a=>a);return{client:t,expiresIn:e.expires_in,accessToken:e.access_token,scope:i,refreshToken:e.refresh_token}}};Nr.default=Ic});var aa=T(Qr=>{"use strict";var sa=Qr&&Qr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Qr,"__esModule",{value:!0});var Zm=sa(Us()),ep=sa(Js()),tp=sa(ia()),Ec=class extends tp.default{get v1(){return this._v1?this._v1:this._v1=new Zm.default(this)}get v2(){return this._v2?this._v2:this._v2=new ep.default(this)}get readOnly(){return this}};Qr.default=Ec});var oi=T(Ue=>{"use strict";var Yr=Ue&&Ue.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ue,"__esModule",{value:!0});Ue.TwitterApiReadOnly=Ue.TwitterApiReadWrite=Ue.TwitterApi=void 0;var rp=Yr(ei()),np=Yr(ra()),ip=Yr(aa()),oa=class extends ip.default{get v1(){return this._v1?this._v1:this._v1=new rp.default(this)}get v2(){return this._v2?this._v2:this._v2=new np.default(this)}get readWrite(){return this}static getErrors(e){var t;return typeof e!="object"?[]:"data"in e?(t=e.data.errors)!==null&&t!==void 0?t:[]:[]}static getProfileImageInSize(e,t){let i=e.split("/").pop(),a=["normal","bigger","mini"],u=e;for(let d of a)if(i.includes(`_${d}`)){u=e.replace(`_${d}`,"");break}if(t==="original")return u;let c=u.lastIndexOf(".");if(c!==-1){let d=u.slice(c+1);return u.slice(0,c)+"_"+t+"."+d}else return u+"_"+t}};Ue.TwitterApi=oa;var sp=aa();Object.defineProperty(Ue,"TwitterApiReadWrite",{enumerable:!0,get:function(){return Yr(sp).default}});var ap=ia();Object.defineProperty(Ue,"TwitterApiReadOnly",{enumerable:!0,get:function(){return Yr(ap).default}});Ue.default=oa});var ua=T(K=>{"use strict";var op=K&&K.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t);var a=Object.getOwnPropertyDescriptor(e,t);(!a||("get"in a?!e.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,i,a)}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),it=K&&K.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&op(e,r,t)},up=K&&K.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(K,"__esModule",{value:!0});K.default=void 0;var lp=oi();Object.defineProperty(K,"default",{enumerable:!0,get:function(){return up(lp).default}});it(oi(),K);it(ei(),K);it(ra(),K);it(zs(),K);it(ea(),K);it(Ne(),K);it(Ys(),K);it(Hn(),K);it(Nn(),K)});var Mp={};Uf(Mp,{default:()=>od});var is=require("@raycast/api");function Vo(){let e=(0,is.getPreferenceValues)().listwithdetail;return e===void 0?!0:e}function $o(){let r=(0,is.getPreferenceValues)(),e=r.appkey||"",t=r.appsecret||"",i=r.accesstoken||"",a=r.accesssecret||"";return e.length>0||t.length>0||i.length>0||a.length>0?(console.log("use v1"),!1):(console.log("use v2"),!0)}var yi=require("@raycast/api");var I=require("@raycast/api"),Yc=require("react");function ce(r){return r instanceof Error?r.message:"unknown error"}var kn=(r,e)=>String(r).padStart(e,"\u2000"),zf=new Intl.NumberFormat("en",{notation:"compact"});function Qt(r){return zf.format(r)}function ss(r){return new Promise(e=>setTimeout(e,r))}function as(r,e,t){return r.replace(e,t)}var P=require("@raycast/api"),wi=require("react");var ps=require("@raycast/api");var fu=Ve(require("http"),1),hu=Ve(require("https"),1),At=Ve(require("zlib"),1),_e=Ve(require("stream"),1),mu=Ve(Ho(),1);var Re=Ve(require("stream"),1),ds=require("util");var Vp=Ve(Ko(),1),Go=65536;async function*os(r,e=!0){for(let t of r)if("stream"in t)yield*t.stream();else if(ArrayBuffer.isView(t))if(e){let i=t.byteOffset,a=t.byteOffset+t.byteLength;for(;i!==a;){let u=Math.min(a-i,Go),c=t.buffer.slice(i,i+u);i+=c.byteLength,yield new Uint8Array(c)}}else yield t;else{let i=0;for(;i!==t.size;){let u=await t.slice(i,Math.min(t.size,i+Go)).arrayBuffer();i+=u.byteLength,yield new Uint8Array(u)}}}var Xo=class us{#e=[];#r="";#t=0;constructor(e=[],t={}){let i=0,a=e.map(c=>{let d;return ArrayBuffer.isView(c)?d=new Uint8Array(c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)):c instanceof ArrayBuffer?d=new Uint8Array(c.slice(0)):c instanceof us?d=c:d=new TextEncoder().encode(c),i+=ArrayBuffer.isView(d)?d.byteLength:d.size,d}),u=t.type===void 0?"":String(t.type);this.#r=/[^\u0020-\u007E]/.test(u)?"":u,this.#t=i,this.#e=a}get size(){return this.#t}get type(){return this.#r}async text(){let e=new TextDecoder,t="";for await(let i of os(this.#e,!1))t+=e.decode(i,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let i of os(this.#e,!1))e.set(i,t),t+=i.length;return e.buffer}stream(){let e=os(this.#e,!0);return new ReadableStream({type:"bytes",async pull(t){let i=await e.next();i.done?t.close():t.enqueue(i.value)}})}slice(e=0,t=this.size,i=""){let{size:a}=this,u=e<0?Math.max(a+e,0):Math.min(e,a),c=t<0?Math.max(a+t,0):Math.min(t,a),d=Math.max(c-u,0),h=this.#e,S=[],y=0;for(let w of h){if(y>=d)break;let _=ArrayBuffer.isView(w)?w.byteLength:w.size;if(u&&_<=u)u-=_,c-=_;else{let D;ArrayBuffer.isView(w)?(D=w.subarray(u,Math.min(_,c)),y+=D.byteLength):(D=w.slice(u,Math.min(_,c)),y+=D.size),S.push(D),u=0}}let R=new us([],{type:String(i).toLowerCase()});return R.#t=d,R.#e=S,R}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&typeof e=="object"&&typeof e.constructor=="function"&&(typeof e.stream=="function"||typeof e.arrayBuffer=="function")&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(Xo.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});var $f=Xo,Jo=$f;var mt=class extends Error{constructor(e,t){super(e);Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var Se=class extends mt{constructor(e,t,i){super(e,t);i&&(this.code=this.errno=i.code,this.erroredSysCall=i.syscall)}};var eu=require("crypto");var qr=Symbol.toStringTag,ls=r=>typeof r=="object"&&typeof r.append=="function"&&typeof r.delete=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.has=="function"&&typeof r.set=="function"&&typeof r.sort=="function"&&r[qr]==="URLSearchParams",$e=r=>typeof r=="object"&&typeof r.arrayBuffer=="function"&&typeof r.type=="string"&&typeof r.stream=="function"&&typeof r.constructor=="function"&&/^(Blob|File)$/.test(r[qr]);function En(r){return typeof r=="object"&&typeof r.append=="function"&&typeof r.set=="function"&&typeof r.get=="function"&&typeof r.getAll=="function"&&typeof r.delete=="function"&&typeof r.keys=="function"&&typeof r.values=="function"&&typeof r.entries=="function"&&typeof r.constructor=="function"&&r[qr]==="FormData"}var Zo=r=>typeof r=="object"&&(r[qr]==="AbortSignal"||r[qr]==="EventTarget");var Yt=`\r
`,cs="-".repeat(2),Nf=Buffer.byteLength(Yt),tu=r=>`${cs}${r}${cs}${Yt.repeat(2)}`;function ru(r,e,t){let i="";return i+=`${cs}${r}${Yt}`,i+=`Content-Disposition: form-data; name="${e}"`,$e(t)&&(i+=`; filename="${t.name}"${Yt}`,i+=`Content-Type: ${t.type||"application/octet-stream"}`),`${i}${Yt.repeat(2)}`}var nu=()=>(0,eu.randomBytes)(8).toString("hex");async function*iu(r,e){for(let[t,i]of r)yield ru(e,t,i),$e(i)?yield*i.stream():yield i,yield Yt;yield tu(e)}function su(r,e){let t=0;for(let[i,a]of r)t+=Buffer.byteLength(ru(e,i,a)),t+=$e(a)?a.size:Buffer.byteLength(String(a)),t+=Nf;return t+=Buffer.byteLength(tu(e)),t}var me=Symbol("Body internals"),qt=class{constructor(e,{size:t=0}={}){let i=null;e===null?e=null:ls(e)?e=Buffer.from(e.toString()):$e(e)||Buffer.isBuffer(e)||(ds.types.isAnyArrayBuffer(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof Re.default||(En(e)?(i=`NodeFetchFormDataBoundary${nu()}`,e=Re.default.Readable.from(iu(e,i))):e=Buffer.from(String(e)))),this[me]={body:e,boundary:i,disturbed:!1,error:null},this.size=t,e instanceof Re.default&&e.on("error",a=>{let u=a instanceof mt?a:new Se(`Invalid response body while trying to fetch ${this.url}: ${a.message}`,"system",a);this[me].error=u})}get body(){return this[me].body}get bodyUsed(){return this[me].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:i}=await On(this);return e.slice(t,t+i)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[me].body&&this[me].body.type||"",t=await this.buffer();return new Jo([t],{type:e})}async json(){let e=await On(this);return JSON.parse(e.toString())}async text(){return(await On(this)).toString()}buffer(){return On(this)}};Object.defineProperties(qt.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}});async function On(r){if(r[me].disturbed)throw new TypeError(`body used already for: ${r.url}`);if(r[me].disturbed=!0,r[me].error)throw r[me].error;let{body:e}=r;if(e===null)return Buffer.alloc(0);if($e(e)&&(e=Re.default.Readable.from(e.stream())),Buffer.isBuffer(e))return e;if(!(e instanceof Re.default))return Buffer.alloc(0);let t=[],i=0;try{for await(let a of e){if(r.size>0&&i+a.length>r.size){let u=new Se(`content size at ${r.url} over limit: ${r.size}`,"max-size");throw e.destroy(u),u}i+=a.length,t.push(a)}}catch(a){throw a instanceof mt?a:new Se(`Invalid response body while trying to fetch ${r.url}: ${a.message}`,"system",a)}if(e.readableEnded===!0||e._readableState.ended===!0)try{return t.every(a=>typeof a=="string")?Buffer.from(t.join("")):Buffer.concat(t,i)}catch(a){throw new Se(`Could not create Buffer from response body for ${r.url}: ${a.message}`,"system",a)}else throw new Se(`Premature close of server response while trying to fetch ${r.url}`)}var Mn=(r,e)=>{let t,i,{body:a}=r;if(r.bodyUsed)throw new Error("cannot clone body after it is used");return a instanceof Re.default&&typeof a.getBoundary!="function"&&(t=new Re.PassThrough({highWaterMark:e}),i=new Re.PassThrough({highWaterMark:e}),a.pipe(t),a.pipe(i),r[me].body=t,a=i),a},xn=(r,e)=>r===null?null:typeof r=="string"?"text/plain;charset=UTF-8":ls(r)?"application/x-www-form-urlencoded;charset=UTF-8":$e(r)?r.type||null:Buffer.isBuffer(r)||ds.types.isAnyArrayBuffer(r)||ArrayBuffer.isView(r)?null:r&&typeof r.getBoundary=="function"?`multipart/form-data;boundary=${r.getBoundary()}`:En(r)?`multipart/form-data; boundary=${e[me].boundary}`:r instanceof Re.default?null:"text/plain;charset=UTF-8",au=r=>{let{body:e}=r;return e===null?0:$e(e)?e.size:Buffer.isBuffer(e)?e.length:e&&typeof e.getLengthSync=="function"?e.hasKnownLength&&e.hasKnownLength()?e.getLengthSync():null:En(e)?su(r[me].boundary):null},ou=(r,{body:e})=>{e===null?r.end():$e(e)?Re.default.Readable.from(e.stream()).pipe(r):Buffer.isBuffer(e)?(r.write(e),r.end()):e.pipe(r)};var fs=require("util"),Ar=Ve(require("http"),1),Fn=typeof Ar.default.validateHeaderName=="function"?Ar.default.validateHeaderName:r=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(r)){let e=new TypeError(`Header name must be a valid HTTP token [${r}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},hs=typeof Ar.default.validateHeaderValue=="function"?Ar.default.validateHeaderValue:(r,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let t=new TypeError(`Invalid character in header content ["${r}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}},pe=class extends URLSearchParams{constructor(e){let t=[];if(e instanceof pe){let i=e.raw();for(let[a,u]of Object.entries(i))t.push(...u.map(c=>[a,c]))}else if(e!=null)if(typeof e=="object"&&!fs.types.isBoxedPrimitive(e)){let i=e[Symbol.iterator];if(i==null)t.push(...Object.entries(e));else{if(typeof i!="function")throw new TypeError("Header pairs must be iterable");t=[...e].map(a=>{if(typeof a!="object"||fs.types.isBoxedPrimitive(a))throw new TypeError("Each header pair must be an iterable object");return[...a]}).map(a=>{if(a.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...a]})}}else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");t=t.length>0?t.map(([i,a])=>(Fn(i),hs(i,String(a)),[String(i).toLowerCase(),String(a)])):void 0;super(t);return new Proxy(this,{get(i,a,u){switch(a){case"append":case"set":return(c,d)=>(Fn(c),hs(c,String(d)),URLSearchParams.prototype[a].call(i,String(c).toLowerCase(),String(d)));case"delete":case"has":case"getAll":return c=>(Fn(c),URLSearchParams.prototype[a].call(i,String(c).toLowerCase()));case"keys":return()=>(i.sort(),new Set(URLSearchParams.prototype.keys.call(i)).keys());default:return Reflect.get(i,a,u)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(t.length===0)return null;let i=t.join(", ");return/^content-encoding$/i.test(e)&&(i=i.toLowerCase()),i}forEach(e,t=void 0){for(let i of this.keys())Reflect.apply(e,t,[this.get(i),i,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let i=this.getAll(t);return t==="host"?e[t]=i[0]:e[t]=i.length>1?i:i[0],e},{})}};Object.defineProperties(pe.prototype,["get","entries","forEach","values"].reduce((r,e)=>(r[e]={enumerable:!0},r),{}));function uu(r=[]){return new pe(r.reduce((e,t,i,a)=>(i%2===0&&e.push(a.slice(i,i+2)),e),[]).filter(([e,t])=>{try{return Fn(e),hs(e,String(t)),!0}catch{return!1}}))}var Hf=new Set([301,302,303,307,308]),Bn=r=>Hf.has(r);var Me=Symbol("Response internals"),de=class extends qt{constructor(e=null,t={}){super(e,t);let i=t.status!=null?t.status:200,a=new pe(t.headers);if(e!==null&&!a.has("Content-Type")){let u=xn(e);u&&a.append("Content-Type",u)}this[Me]={type:"default",url:t.url,status:i,statusText:t.statusText||"",headers:a,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[Me].type}get url(){return this[Me].url||""}get status(){return this[Me].status}get ok(){return this[Me].status>=200&&this[Me].status<300}get redirected(){return this[Me].counter>0}get statusText(){return this[Me].statusText}get headers(){return this[Me].headers}get highWaterMark(){return this[Me].highWaterMark}clone(){return new de(Mn(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size})}static redirect(e,t=302){if(!Bn(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new de(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new de(null,{status:0,statusText:""});return e[Me].type="error",e}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(de.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});var cu=require("url");var lu=r=>{if(r.search)return r.search;let e=r.href.length-1,t=r.hash||(r.href[e]==="#"?"#":"");return r.href[e-t.length]==="?"?"?":""};var Je=Symbol("Request internals"),jn=r=>typeof r=="object"&&typeof r[Je]=="object",pt=class extends qt{constructor(e,t={}){let i;jn(e)?i=new URL(e.url):(i=new URL(e),e={});let a=t.method||e.method||"GET";if(a=a.toUpperCase(),(t.body!=null||jn(e))&&e.body!==null&&(a==="GET"||a==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");let u=t.body?t.body:jn(e)&&e.body!==null?Mn(e):null;super(u,{size:t.size||e.size||0});let c=new pe(t.headers||e.headers||{});if(u!==null&&!c.has("Content-Type")){let h=xn(u,this);h&&c.append("Content-Type",h)}let d=jn(e)?e.signal:null;if("signal"in t&&(d=t.signal),d!=null&&!Zo(d))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");this[Je]={method:a,redirect:t.redirect||e.redirect||"follow",headers:c,parsedURL:i,signal:d},this.follow=t.follow===void 0?e.follow===void 0?20:e.follow:t.follow,this.compress=t.compress===void 0?e.compress===void 0?!0:e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1}get method(){return this[Je].method}get url(){return(0,cu.format)(this[Je].parsedURL)}get headers(){return this[Je].headers}get redirect(){return this[Je].redirect}get signal(){return this[Je].signal}clone(){return new pt(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(pt.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});var du=r=>{let{parsedURL:e}=r[Je],t=new pe(r[Je].headers);t.has("Accept")||t.set("Accept","*/*");let i=null;if(r.body===null&&/^(post|put)$/i.test(r.method)&&(i="0"),r.body!==null){let d=au(r);typeof d=="number"&&!Number.isNaN(d)&&(i=String(d))}i&&t.set("Content-Length",i),t.has("User-Agent")||t.set("User-Agent","node-fetch"),r.compress&&!t.has("Accept-Encoding")&&t.set("Accept-Encoding","gzip,deflate,br");let{agent:a}=r;typeof a=="function"&&(a=a(e)),!t.has("Connection")&&!a&&t.set("Connection","close");let u=lu(e);return{path:e.pathname+u,pathname:e.pathname,hostname:e.hostname,protocol:e.protocol,port:e.port,hash:e.hash,search:e.search,query:e.query,href:e.href,method:r.method,headers:t[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:r.insecureHTTPParser,agent:a}};var ms=class extends mt{constructor(e,t="aborted"){super(e,t)}};var Qf=new Set(["data:","http:","https:"]);async function Dr(r,e){return new Promise((t,i)=>{let a=new pt(r,e),u=du(a);if(!Qf.has(u.protocol))throw new TypeError(`node-fetch cannot load ${r}. URL scheme "${u.protocol.replace(/:$/,"")}" is not supported.`);if(u.protocol==="data:"){let _=(0,mu.default)(a.url),D=new de(_,{headers:{"Content-Type":_.typeFull}});t(D);return}let c=(u.protocol==="https:"?hu.default:fu.default).request,{signal:d}=a,h=null,S=()=>{let _=new ms("The operation was aborted.");i(_),a.body&&a.body instanceof _e.default.Readable&&a.body.destroy(_),!(!h||!h.body)&&h.body.emit("error",_)};if(d&&d.aborted){S();return}let y=()=>{S(),w()},R=c(u);d&&d.addEventListener("abort",y);let w=()=>{R.abort(),d&&d.removeEventListener("abort",y)};R.on("error",_=>{i(new Se(`request to ${a.url} failed, reason: ${_.message}`,"system",_)),w()}),Yf(R,_=>{h.body.destroy(_)}),process.version<"v14"&&R.on("socket",_=>{let D;_.prependListener("end",()=>{D=_._eventsCount}),_.prependListener("close",L=>{if(h&&D<_._eventsCount&&!L){let Z=new Error("Premature close");Z.code="ERR_STREAM_PREMATURE_CLOSE",h.body.emit("error",Z)}})}),R.on("response",_=>{R.setTimeout(0);let D=uu(_.rawHeaders);if(Bn(_.statusCode)){let ne=D.get("Location"),U=ne===null?null:new URL(ne,a.url);switch(a.redirect){case"error":i(new Se(`uri requested responds with a redirect, redirect mode is set to error: ${a.url}`,"no-redirect")),w();return;case"manual":U!==null&&D.set("Location",U);break;case"follow":{if(U===null)break;if(a.counter>=a.follow){i(new Se(`maximum redirect reached at: ${a.url}`,"max-redirect")),w();return}let $={headers:new pe(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:a.body,signal:a.signal,size:a.size};if(_.statusCode!==303&&a.body&&e.body instanceof _e.default.Readable){i(new Se("Cannot follow redirect with body being a readable stream","unsupported-redirect")),w();return}(_.statusCode===303||(_.statusCode===301||_.statusCode===302)&&a.method==="POST")&&($.method="GET",$.body=void 0,$.headers.delete("content-length")),t(Dr(new pt(U,$))),w();return}default:return i(new TypeError(`Redirect option '${a.redirect}' is not a valid value of RequestRedirect`))}}d&&_.once("end",()=>{d.removeEventListener("abort",y)});let L=(0,_e.pipeline)(_,new _e.PassThrough,i);process.version<"v12.10"&&_.on("aborted",y);let Z={url:a.url,status:_.statusCode,statusText:_.statusMessage,headers:D,size:a.size,counter:a.counter,highWaterMark:a.highWaterMark},oe=D.get("Content-Encoding");if(!a.compress||a.method==="HEAD"||oe===null||_.statusCode===204||_.statusCode===304){h=new de(L,Z),t(h);return}let re={flush:At.default.Z_SYNC_FLUSH,finishFlush:At.default.Z_SYNC_FLUSH};if(oe==="gzip"||oe==="x-gzip"){L=(0,_e.pipeline)(L,At.default.createGunzip(re),i),h=new de(L,Z),t(h);return}if(oe==="deflate"||oe==="x-deflate"){(0,_e.pipeline)(_,new _e.PassThrough,i).once("data",U=>{L=(U[0]&15)===8?(0,_e.pipeline)(L,At.default.createInflate(),i):(0,_e.pipeline)(L,At.default.createInflateRaw(),i),h=new de(L,Z),t(h)});return}if(oe==="br"){L=(0,_e.pipeline)(L,At.default.createBrotliDecompress(),i),h=new de(L,Z),t(h);return}h=new de(L,Z),t(h)}),ou(R,a)})}function Yf(r,e){let t=Buffer.from(`0\r
\r
`),i=!1,a=!1,u;r.on("response",c=>{let{headers:d}=c;i=d["transfer-encoding"]==="chunked"&&!d["content-length"]}),r.on("socket",c=>{let d=()=>{if(i&&!a){let h=new Error("Premature close");h.code="ERR_STREAM_PREMATURE_CLOSE",e(h)}};c.prependListener("close",d),r.on("abort",()=>{c.removeListener("close",d)}),c.on("data",h=>{a=Buffer.compare(h.slice(-5),t)===0,!a&&u&&(a=Buffer.compare(u.slice(-3),t.slice(0,3))===0&&Buffer.compare(h.slice(-2),t.slice(3))===0),u=h})})}function _s(){return"aHB6TFU2T3hid2stVjdFZ2ljanM6MTpjaQ"}var Dt=new ps.OAuth.PKCEClient({redirectMethod:ps.OAuth.RedirectMethod.Web,providerName:"Twitter",providerIcon:"twitter.png",providerId:"twitter",description:"Connect your Twitter account"});async function pu(){let r=await Dt.getTokens();if(r?.accessToken){r.refreshToken&&r.isExpired()&&await Dt.setTokens(await Gf(r.refreshToken));return}let e=await Dt.authorizationRequest({endpoint:"https://twitter.com/i/oauth2/authorize",clientId:_s(),scope:"tweet.read tweet.write users.read follows.read like.read like.write offline.access"}),{authorizationCode:t}=await Dt.authorize(e);await Dt.setTokens(await Kf(e,t))}async function Kf(r,e){let t=new URLSearchParams;t.append("client_id",_s()),t.append("code",e),t.append("code_verifier",r.codeVerifier),t.append("grant_type","authorization_code"),t.append("redirect_uri",r.redirectURI);let i=await Dr("https://api.twitter.com/2/oauth2/token",{method:"POST",body:t});if(!i.ok)throw console.error("fetch tokens error:",await i.text()),new Error(i.statusText);return await i.json()}async function _u(){return await Dt.getTokens()}async function gu(){await Dt.removeTokens()}async function Gf(r){let e=new URLSearchParams;e.append("client_id",_s()),e.append("refresh_token",r),e.append("grant_type","refresh_token");let t=await Dr("https://api.twitter.com/2/oauth2/token",{method:"POST",body:e});if(!t.ok)throw console.error("refresh tokens error:",await t.text()),new Error(t.statusText);let i=await t.json();return i.refresh_token=i.refresh_token??r,i}var ae=require("@raycast/api");var Ft=require("react"),ar=Ve(ua());var Oc=20,Mc=["public_metrics","author_id","attachments","created_at","id","entities","conversation_id"],xc=["attachments.media_keys","author_id","in_reply_to_user_id","entities.mentions.username","referenced_tweets.id"],Fc=["url","type","media_key","preview_image_url"];function Bc(r){return{id:r.id,name:r.name,username:r.username,profile_image_url:r.profile_image_url}}var jc=class{constructor(){this.userCache={}}async getAPI(){await pu();let t=(await _u())?.accessToken;return new ar.TwitterApi(t||"")}async getUserAccount(e){if(e in this.userCache)return this.userCache[e];let i=await(await this.getAPI()).v2.user(e,{"user.fields":["profile_image_url"]}),a=Bc(i.data);return this.userCache[e]=a,a}async prefetchUserAccounts(e){let t=[];for(let i of e)i.author_id&&!(i.author_id in this.userCache)&&t.push(i.author_id);if(t.length>0){let a=await(await this.getAPI()).v2.users(t,{"user.fields":["profile_image_url"]});for(let u of a.data){let c=Bc(u);this.userCache[c.id]=c}}}async me(){if(this.meCache)return this.meCache;let t=await(await this.getAPI()).v2.me(),i={id:t.data.id,name:t.data.name,username:t.data.username,profile_image_url:t.data.profile_image_url};return this.meCache=i,i}async getMyTweets(){let t=await(await this.getAPI()).v2.me();return await this.getTweetsFromAuthor(t.data.id,["non_public_metrics","organic_metrics"])}async getTweetsFromAuthor(e,t){let i=await this.getAPI(),a=[...Mc];t&&a.push(...t);let u=await i.v2.userTimeline(e,{max_results:Oc,"tweet.fields":a,"media.fields":Fc,expansions:xc}),c=new ar.TwitterV2IncludesHelper(u),d=[];await this.prefetchUserAccounts(u);for(let h of u)d.push(await this.tweetV2ToTweet(h,c));return d}async tweetV2ToTweet(e,t){let i=e,a=t.medias(i),u;i.non_public_metrics&&(u={impression_count:i.non_public_metrics.impression_count,url_link_clicks:i.non_public_metrics.url_link_clicks});let c;i.organic_metrics&&(c={impression_count:i.organic_metrics.impression_count,url_link_clicks:i.organic_metrics.url_link_clicks,user_profile_clicks:i.organic_metrics.user_profile_clicks,retweet_count:i.organic_metrics.retweet_count,reply_count:i.organic_metrics.reply_count,like_count:i.organic_metrics.like_count});let d;if(a&&a.length>0){let S=a[0];S.type==="animated_gif"||S.type==="video"?d=S.preview_image_url:d=S.url}if(!i.author_id)throw Error("No author ID");return{id:i.id,text:i.text,created_at:i.created_at,conversation_id:i.conversation_id,source:i.source||"",image_url:d,user:await this.getUserAccount(i.author_id),quote_count:i.public_metrics?.quote_count||0,reply_count:i.public_metrics?.reply_count||0,retweet_count:i.public_metrics?.retweet_count||0,like_count:i.public_metrics?.like_count||0,non_public_metrics:u,organic_metrics:c}}async refreshTweets(e){if(e===void 0)return;let t=()=>e.length===e.filter(y=>y.non_public_metrics!==void 0).length,i=()=>e.length===e.filter(y=>y.organic_metrics!==void 0).length,a=await this.getAPI(),u=e.map(y=>y.id),c=[...Mc];t()&&c.push("non_public_metrics"),i()&&c.push("organic_metrics");let d=await a.v2.tweets(u,{"tweet.fields":c,"media.fields":Fc,expansions:xc}),h=new ar.TwitterV2IncludesHelper(d);return await Promise.all(d.data.map(async y=>await this.tweetV2ToTweet(y,h)))}async sendTweet(e){await(await this.getAPI()).v2.tweet(e)}async sendThread(e){await(await this.getAPI()).v2.tweetThread(e)}async replyTweetID(e,t){await(await this.getAPI()).v2.reply(e,t)}async replyTweet(e,t){await this.replyTweetID(e,t.id)}async retweet(e){let t=await this.getAPI(),i=await this.me();await t.v2.retweet(i.id,e.id)}async deleteTweetID(e){await(await this.getAPI()).v2.deleteTweet(e)}async deleteTweet(e){await this.deleteTweetID(e.id)}async likeTweet(e){let t=await this.getAPI(),i=await this.me();t.v2.like(i.id,e.id)}async unlikeTweet(e){let t=await this.getAPI(),i=await this.me();t.v2.unlike(i.id,e.id)}async homeTimeline(){let t=await(await this.getAPI()).v2.homeTimeline({exclude:"replies",max_results:Oc,"tweet.fields":["public_metrics","author_id","attachments","created_at","id","entities","conversation_id"],"media.fields":["url","type","media_key","preview_image_url"],expansions:["attachments.media_keys","author_id","in_reply_to_user_id","entities.mentions.username","referenced_tweets.id"]}),i=new ar.TwitterV2IncludesHelper(t),a=[];await this.prefetchUserAccounts(t);for(let u of t){let c=i.medias(u),d;if(c&&c.length>0){let S=c[0];S.type==="animated_gif"||S.type==="video"?d=S.preview_image_url:d=S.url}if(!u.author_id)continue;let h={id:u.id,text:u.text,created_at:u.created_at,conversation_id:u.conversation_id,source:u.source||"",image_url:d,user:await this.getUserAccount(u.author_id),quote_count:u.public_metrics?.quote_count||0,reply_count:u.public_metrics?.reply_count||0,retweet_count:u.public_metrics?.retweet_count||0,like_count:u.public_metrics?.like_count||0};a.push(h)}return a}};function cp(){return new jc}var te=cp();function or(r,e){let[t,i]=(0,Ft.useState)(),[a,u]=(0,Ft.useState)(),[c,d]=(0,Ft.useState)(!0),[h,S]=(0,Ft.useState)(new Date),y=[h];if(e)for(let D of e)y.push(D);let R=!1,w={updateInline:async()=>{await _(!0)},refresh:async()=>{S(new Date)}};async function _(D=!1){if(!R){d(!0),u(void 0);try{let L=await r(D);R||i(L)}catch(L){R||u(ce(L))}finally{R||d(!1)}}}return(0,Ft.useEffect)(()=>(_(),()=>{R=!0}),y),{data:t,error:a,isLoading:c,fetcher:w}}function Uc(r){return!!(r.text&&r.text.startsWith("RT @"))}function dp(r){if(r.text!==void 0){if(Uc(r)){let e=r.text.indexOf(":");if(e!==void 0&&e>0)return r.text.substring(e+1).trimStart()}return r.text}}function la(r,e){let t=r,i=Uc(t)?" retweeted":"",a=[`## ${t.user.name} \`@${t.user.username}\`${i}`,dp(t)||""];if(t.image_url&&a.push(`![${t.image_url}](${t.image_url})`),e){t.created_at&&a.push(`\`${new Date(t.created_at).toLocaleString()}\``);let c=[`\u{1F4AC} ${t.reply_count||0}`,`\u{1F501} ${t.retweet_count}`,`\u2764\uFE0F ${t.like_count}`];a.push(c.join("   "))}return a.join(`

`)}function fp(r){return _jsx(ae.Action,{title:"Refresh Tweet",shortcut:{modifiers:["cmd"],key:"r"},onAction:async()=>{await r.fetcher.updateInline()}})}function Wc(r){let e=r.tweet,{data:t,error:i,isLoading:a,fetcher:u}=or(async()=>{if(t===void 0)return r.tweet;{let h=await te.refreshTweets([t]);if(h&&h.length>0)return h[0]}});i&&(0,ae.showToast)({style:ae.Toast.Style.Failure,title:"Error",message:i});let c=t||e,d=la(c,!0);return _jsx(ae.Detail,{isLoading:a,markdown:d,actions:_jsx(ae.ActionPanel,null,_jsx(ae.ActionPanel.Section,{title:"Tweet"},_jsx(li,{tweet:c}),_jsx(ui,{tweet:c})),_jsx(ae.ActionPanel.Section,null,_jsx(ci,{tweet:c}),_jsx(di,{tweet:c}),_jsx(fi,{tweet:c})),_jsx(ae.ActionPanel.Section,{title:"Author"},_jsx(mi,{tweet:c}),_jsx(pi,{user:c.user})),_jsx(ae.ActionPanel.Section,{title:"Update"},_jsx(fp,{tweet:c,fetcher:u})),_jsx(ae.ActionPanel.Section,{title:"Destructive"},_jsx(hi,{tweet:c})))})}var G=require("@raycast/api"),ca=require("react");async function hp(r,e){try{let t=r.text;if(t.length<=0)throw Error("Please enter a text");if(t.length>280)throw Error("Tweet text could not be longer than 280 characters");e&&(await te.replyTweet(t,e),await(0,G.showToast)({style:G.Toast.Style.Success,title:"Tweet created",message:"Reply Tweet creation successful"})),(0,G.popToRoot)()}catch(t){await(0,G.showToast)({style:G.Toast.Style.Failure,title:"Error",message:ce(t)})}}function mp(r){let e=r.text,t=pp(e);return _jsx(G.Form.Description,{text:`${e.length}/280 ${t?"\u2705":"\u274C"}`})}function zc(r){let e=r.replyTweet,t=e?"Send Reply":"Send Tweet",i=e?"Reply":"Tweet",a=e?"Tweet your reply":"What's happening?",[u,c]=(0,ca.useState)("");return _jsx(G.Form,{actions:_jsx(G.ActionPanel,null,u.length>0&&u.length<=280&&_jsx(G.Action.SubmitForm,{title:t,onSubmit:d=>hp(d,r.replyTweet)}))},_jsx(G.Form.TextArea,{id:"text",title:i,placeholder:a,onChange:c}),_jsx(mp,{text:u}))}function pp(r){let e=r.length;return!(e<1||e>280)}var _i=require("@raycast/api");function Vc(r){let{data:e,error:t,isLoading:i,fetcher:a}=or(async u=>await te.getTweetsFromAuthor(r.authorID));return t&&(0,_i.showToast)({style:_i.Toast.Style.Failure,title:"Error",message:t}),_jsx(gi,{isLoading:i,tweets:e,fetcher:a})}function $c(){let r=async()=>{await gu(),await(0,P.popToRoot)()};return _jsx(P.Action,{title:"Logout",icon:{source:P.Icon.XmarkCircle},onAction:r})}function Nc(r){return _jsx(P.Action.Push,{title:"Show Tweet",icon:P.Icon.List,target:_jsx(Wc,{tweet:r.tweet})})}function ui(r){let e=r.tweet;return _jsx(P.Action.OpenInBrowser,{url:`https://twitter.com/${e.user.username}/status/${e.id}`})}function li(r){return _jsx(P.Action.Push,{title:"Reply",target:_jsx(zc,{replyTweet:r.tweet}),icon:{source:P.Icon.Bubble,tintColor:P.Color.PrimaryText},shortcut:{modifiers:["cmd"],key:"w"}})}function ci(r){let e=async()=>{te.likeTweet(r.tweet),(0,P.showToast)({style:P.Toast.Style.Success,title:"Tweet liked"}),r.fetcher&&(await ss(1e3),await r.fetcher.updateInline())};return _jsx(P.Action,{title:"Like",icon:{source:"heart_full.png",tintColor:P.Color.Red},shortcut:{modifiers:["cmd"],key:"l"},onAction:e})}function di(r){let e=async()=>{te.unlikeTweet(r.tweet),(0,P.showToast)({style:P.Toast.Style.Success,title:"Tweet unliked"}),r.fetcher&&(await ss(1e3),r.fetcher.updateInline())};return _jsx(P.Action,{title:"Unlike",icon:{source:"heart_empty.png",tintColor:P.Color.PrimaryText},shortcut:{modifiers:["cmd","shift"],key:"l"},onAction:e})}function fi(r){let e=async()=>{te.retweet(r.tweet),(0,P.showToast)({style:P.Toast.Style.Success,title:"Tweet Retweeted"})};return _jsx(P.Action,{title:"Retweet",icon:{source:"retweet.png",tintColor:P.Color.PrimaryText},shortcut:{modifiers:["cmd"],key:"t"},onAction:e})}function hi(r){let[e,t]=(0,wi.useState)();(0,wi.useEffect)(()=>{async function u(){try{let c=await te.me();t(c.username)}catch{}}u()},[]);let i=r.tweet,a=async()=>{try{if((await te.me()).username!==i.user.username)throw Error("You can only delete your own Tweets");await(0,P.confirmAlert)({title:"Delete the Tweet?",icon:"\u{1F5D1}\uFE0F",primaryAction:{title:"Delete",style:P.Alert.ActionStyle.Destructive}})&&(await te.deleteTweet(i),(0,P.showToast)({style:P.Toast.Style.Success,title:"Tweet deleted",message:"Tweet deletion successful"}),(0,P.popToRoot)())}catch(u){(0,P.showToast)({style:P.Toast.Style.Failure,title:"Could not delete Tweet",message:ce(u)})}};return e===i.user.username?_jsx(P.Action,{title:"Delete Tweet",icon:{source:P.Icon.XmarkCircle,tintColor:P.Color.Red},shortcut:{modifiers:["cmd","shift"],key:"d"},onAction:a}):null}function mi(r){return _jsx(P.Action.Push,{title:`Tweets from @${r.tweet.user.username}`,target:_jsx(Vc,{authorID:r.tweet.user.id}),icon:{source:P.Icon.Person,tintColor:P.Color.PrimaryText},shortcut:{modifiers:["cmd","shift"],key:"a"}})}function pi(r){return _jsx(P.Action.OpenInBrowser,{title:"Open Author Profile",url:`https://twitter.com/${r.user.username}`})}function Hc(r){let e=r.fetcher;if(!e)return null;let t=async()=>{await e.updateInline()};return _jsx(P.Action,{title:"Refresh Existing Tweets",icon:P.Icon.Download,shortcut:{modifiers:["cmd","shift"],key:"r"},onAction:t})}function Qc(r){let e=r.fetcher;if(!e)return null;let t=async()=>{await e.refresh()};return _jsx(P.Action,{title:"Refresh Tweets",icon:P.Icon.Binoculars,shortcut:{modifiers:["cmd"],key:"r"},onAction:t})}function _p(r){let e=r.tweet;return _jsx(I.List.Item.Detail.Metadata.Label,{title:"Likes",text:`\u2764\uFE0F ${e.like_count}`})}function gp(r){let e=r.tweet;return _jsx(I.List.Item.Detail.Metadata.Label,{title:"Retweets",text:`\u{1F501} ${e.retweet_count}`})}function wp(r){let e=r.tweet;return _jsx(I.List.Item.Detail.Metadata.Label,{title:"Replies",text:`\u{1F4AC} ${e.reply_count||0}`})}function yp(r){let e=r.tweet;return e.created_at?_jsx(I.List.Item.Detail.Metadata.Label,{title:"Tweeted",text:`${new Date(e.created_at).toLocaleString()}`}):null}function bp(r){let e=r.tweet.non_public_metrics;return e?_jsx(I.List.Item.Detail.Metadata.Label,{title:"Impressions",text:`\u{1F441}\uFE0F ${e.impression_count}`}):null}function Tp(r){let e=r.tweet.organic_metrics;return!e||e.user_profile_clicks===void 0?null:_jsx(I.List.Item.Detail.Metadata.Label,{title:"User Profile Clicks",text:`\u{1F464} ${e.user_profile_clicks}`})}function Sp(r){let e=r.tweet.non_public_metrics;return!e||e.url_link_clicks===void 0?null:_jsx(I.List.Item.Detail.Metadata.Label,{title:"Url Clicks",text:`\u{1F517} ${e.url_link_clicks}`})}function Rp(r){let e=r.showMeta;return _jsx(I.Action,{title:e?"Hide Details":"Show Details",shortcut:{modifiers:["opt"],key:"d"},icon:e?I.Icon.EyeSlash:I.Icon.Eye,onAction:()=>r.onStateChange(!r.showMeta)})}function vp(r){let e=r.tweet;return _jsx(I.List.Item.Detail.Metadata,null,_jsx(yp,{tweet:e}),_jsx(_p,{tweet:e}),_jsx(gp,{tweet:e}),_jsx(wp,{tweet:e}),_jsx(bp,{tweet:e}),_jsx(Tp,{tweet:e}),_jsx(Sp,{tweet:e}))}function Pp(r){let e=r.text?r.text.trim():"",t=as(e,/\n/g," ");return t=as(t,/&amp/g," "),t}function qp(r){let e=r.tweet,t=r.withDetail,i=r.fetcher,a=r.millifyState!==void 0?r.millifyState:!0,[u,c]=(0,Yc.useState)(!0),d=Pp(e),h=e.user.profile_image_url,S=h?{source:h,mask:I.Image.Mask.Circle}:void 0,y=!!e.image_url,R=(U,$)=>{if(U===void 0)return"0";let Le=a?Qt(U):`${U}`;return kn(Le,$)},w=1,_=3,D=U=>U===void 0||U<w?w:U>_?_:U,L=D(r.maxCommentDigits),Z=D(r.maxRTDigits),oe=D(r.maxFavDigits),re=[`\u{1F4AC} ${R(e.reply_count||0,L)}`,`\u{1F501} ${R(e.retweet_count,Z)}`,`\u2764\uFE0F ${R(e.like_count,oe)}`];y&&(re=["\u{1F5BC}\uFE0F",...re]);let ne=[{text:re.join("  ")}];return _jsx(I.List.Item,{id:e.id,key:e.id,title:d,icon:S,accessories:t?void 0:ne,detail:t?_jsx(I.List.Item.Detail,{markdown:la(e,!u),metadata:u?_jsx(vp,{tweet:e}):null}):void 0,actions:_jsx(I.ActionPanel,null,_jsx(I.ActionPanel.Section,null,_jsx(Nc,{tweet:e}),_jsx(ui,{tweet:e})),_jsx(I.ActionPanel.Section,null,_jsx(ci,{tweet:e,fetcher:i}),_jsx(di,{tweet:e,fetcher:i}),_jsx(li,{tweet:e}),_jsx(fi,{tweet:e})),_jsx(I.ActionPanel.Section,null,_jsx(mi,{tweet:e}),_jsx(pi,{user:e.user})),_jsx(I.ActionPanel.Section,{title:"Destructive"},_jsx(hi,{tweet:e})),_jsx(I.ActionPanel.Section,{title:"Update"},_jsx(Hc,{fetcher:i}),_jsx(Qc,{fetcher:i})),_jsx(I.ActionPanel.Section,null,_jsx(Rp,{showMeta:u,onStateChange:c}),_jsx($c,null)))})}function gi(r){let e=r.tweets,t=r.millifyState!==void 0?r.millifyState:!0,i=1,a=1,u=1,c=d=>d===void 0?0:(t?Qt(d):`${d}`).length;if(e)for(let d of e){let h=c(d.like_count);h>i&&(i=h);let S=c(d.retweet_count);S>a&&(a=S);let y=c(d.reply_count);y>u&&(u=y)}return _jsx(I.List,{isLoading:r.isLoading,searchBarPlaceholder:"Filter Tweets by name...",isShowingDetail:!0},e?.map(d=>_jsx(qp,{key:d.id,tweet:d,fetcher:r.fetcher,maxCommentDigits:u,maxFavDigits:i,maxRTDigits:a,millifyState:t,withDetail:!0})))}function Kc(){let{data:r,error:e,isLoading:t,fetcher:i}=or(async a=>a?await te.refreshTweets(r):await te.getMyTweets());return e&&(0,yi.showToast)({style:yi.Toast.Style.Failure,title:"Error",message:e}),_jsx(gi,{isLoading:t,tweets:r,fetcher:i})}var Ri=require("@raycast/api");var E=require("@raycast/api");var Gc=require("@raycast/api"),Bt=require("react"),Xc=Ve(ua());function Ap(){let r=(0,Gc.getPreferenceValues)(),e=r.appkey||"",t=r.appsecret||"",i=r.accesstoken||"",a=r.accesssecret||"";return new Xc.TwitterApi({appKey:e,appSecret:t,accessToken:i,accessSecret:a})}var da=null;function Te(){return da||(da=Ap()),da}var fa;async function Kr(){return fa||(fa=await Te().v1.accountSettings()),fa}async function Gr(r){if(r){let e=r.map(a=>a.id_str),t=await Te().v1.tweets(e),i=[];for(let a of e){let u=t.find(c=>a===c.id_str);u&&i.push(u)}return i}else return}async function Jc(r){let e=await Gr([r]);if(e&&e.length===1)return e[0]}function ur(r,e){let[t,i]=(0,Bt.useState)(),[a,u]=(0,Bt.useState)(),[c,d]=(0,Bt.useState)(!0),[h,S]=(0,Bt.useState)(new Date),y=[h];if(e)for(let D of e)y.push(D);let R=!1,w={updateInline:async()=>{await _(!0)},refresh:async()=>{S(new Date)}};async function _(D=!1){if(!R){d(!0),u(void 0);try{let L=await r(D);R||i(L)}catch(L){R||u(ce(L))}finally{R||d(!1)}}}return(0,Bt.useEffect)(()=>(_(),()=>{R=!0}),y),{data:t,error:a,isLoading:c,fetcher:w}}function ha(r){let e=r.entities.media;if(e){for(let t of e)if(t.type==="photo"&&t.media_url_https)return t.media_url_https}}var A=require("@raycast/api"),Si=require("react");var V=require("@raycast/api"),ma=require("react");async function Dp(r,e){try{let t=r.text;if(t.length<=0)throw Error("Please enter a text");if(t.length>280)throw Error("Tweet text could not be longer than 280 characters");e?(await Te().v1.reply(t,e.id_str),await(0,V.showToast)({style:V.Toast.Style.Success,title:"Tweet created",message:"Reply Tweet creation successful"})):(await Te().v1.tweet(t),await(0,V.showToast)({style:V.Toast.Style.Success,title:"Tweet created",message:"Tweet creation successful"})),(0,V.popToRoot)()}catch(t){await(0,V.showToast)({style:V.Toast.Style.Failure,title:"Error",message:ce(t)})}}function Lp(r){let e=r.text,t=Cp(e);return _jsx(V.Form.Description,{text:`${e.length}/280 ${t?"\u2705":"\u274C"}`})}function Zc(r){let e=r.replyTweet,t=e?"Send Reply":"Send Tweet",i=e?"Reply":"Tweet",a=e?"Tweet your reply":"What's happening?",[u,c]=(0,ma.useState)("");return _jsx(V.Form,{actions:_jsx(V.ActionPanel,null,u.length>0&&u.length<=280&&_jsx(V.Action.SubmitForm,{title:t,onSubmit:d=>Dp(d,e)}))},_jsx(V.Form.TextArea,{id:"text",title:i,placeholder:a,onChange:c}),_jsx(Lp,{text:u}))}function Cp(r){let e=r.length;return!(e<1||e>280)}var bi=require("@raycast/api");function ed(r){let e=r.username,{data:t,error:i,isLoading:a,fetcher:u}=ur(async c=>c?await Gr(t):await kp(e));return i&&(0,bi.showToast)({style:bi.Toast.Style.Failure,title:"Error",message:i}),_jsx(Ti,{isLoading:a,tweets:t,fetcher:u})}async function kp(r){let e=await Te().v1.userTimelineByUsername(r),t=[];for(let i of e.tweets)t.push(i);return t}function td(r){return _jsx(A.Action.Push,{title:"Show Tweet",target:_jsx(nd,{tweet:r.tweet}),icon:{source:A.Icon.List,tintColor:A.Color.PrimaryText}})}function pa(r){return _jsx(A.Action.Push,{title:"Reply",target:_jsx(Zc,{replyTweet:r.tweet}),icon:{source:A.Icon.Bubble,tintColor:A.Color.PrimaryText},shortcut:{modifiers:["cmd"],key:"w"}})}function _a(r){let[e,t]=(0,Si.useState)();(0,Si.useEffect)(()=>{async function u(){try{let c=await Kr();t(c.screen_name)}catch{}}u()},[]);let i=r.tweet,a=async()=>{try{if((await Kr()).screen_name!==i.user.screen_name)throw Error("You can only delete your own Tweets");await Te().v1.deleteTweet(i.id_str),(0,A.showToast)({style:A.Toast.Style.Success,title:"Tweet deleted",message:"Tweet deletion successful"})}catch(u){(0,A.showToast)({style:A.Toast.Style.Failure,title:"Could not delete Tweet",message:ce(u)})}};return e===i.user.screen_name?_jsx(A.Action,{title:"Delete Tweet",icon:{source:A.Icon.XmarkCircle,tintColor:A.Color.Red},onAction:a}):null}function ga(r){let e=r.tweet,t=e.retweeted?"unretweet":"retweet",i=e.retweeted?"Unretweet":"Retweet",a=e.retweeted?{source:"retweet.png",tintColor:A.Color.Green}:{source:"retweet.png",tintColor:A.Color.PrimaryText};return _jsx(A.Action,{title:i,icon:a,onAction:async()=>{try{await Te().v1.post(`statuses/${t}/${e.id_str}.json`),(0,A.showToast)({style:A.Toast.Style.Success,title:"Retweet successful",message:"Retweet creation successful"}),r.fetcher&&await r.fetcher.updateInline()}catch(c){(0,A.showToast)({style:A.Toast.Style.Failure,title:"Could not retweet",message:ce(c)})}},shortcut:{modifiers:["cmd"],key:"t"}})}function wa(r){let e=r.tweet,t=e.favorited?"destroy":"create",i=e.favorited?"Undo Like":"Like",a=e.favorited?{source:"heart_full.png",tintColor:A.Color.Red}:{source:"heart_empty.png",tintColor:A.Color.PrimaryText},u=async()=>{try{await Te().v1.post(`favorites/${t}.json`,{id:e.id_str}),(0,A.showToast)({style:A.Toast.Style.Success,title:`${i} successful`,message:`${i} operation successful`}),r.fetcher&&await r.fetcher.updateInline()}catch(c){(0,A.showToast)({style:A.Toast.Style.Failure,title:`${i} failed`,message:ce(c)})}};return _jsx(A.ActionPanel.Item,{title:i,shortcut:{modifiers:["cmd"],key:"l"},icon:a,onAction:u})}function ya(r){return _jsx(A.Action.OpenInBrowser,{title:"Open Author Profile",url:`https://twitter.com/${r.tweet.user.screen_name}`,icon:{source:A.Icon.Person,tintColor:A.Color.PrimaryText}})}function rd(r){let e=async()=>{r.fetcher&&await r.fetcher.updateInline()};return _jsx(A.Action,{title:"Refresh Existing Tweets",shortcut:{modifiers:["cmd","shift"],key:"r"},icon:{source:A.Icon.Download,tintColor:A.Color.PrimaryText},onAction:e})}function ba(r){let e=async()=>{r.fetcher&&await r.fetcher.refresh()},t=r.title?r.title:"Refresh Tweets";return _jsx(A.Action,{title:t,shortcut:{modifiers:["cmd"],key:"r"},icon:{source:A.Icon.Binoculars,tintColor:A.Color.PrimaryText},onAction:e})}function Ta(r){return _jsx(A.Action.Push,{title:r.title||`Tweets from @${r.username}`,shortcut:{modifiers:["cmd","shift"],key:"a"},icon:{source:"twitter.png",tintColor:A.Color.PrimaryText},target:_jsx(ed,{username:r.username})})}function id(r){return`https://twitter.com/${r.user.screen_name}/status/${r.id_str}`}function Ip(r){let e=r.tweet,t=r.withDetail,i=r.fetcher,a=r.millifyState!==void 0?r.millifyState:!0,u=70,c=e.full_text?e.full_text.trim():"",d=c.slice(0,u)+(c.length>u?" ...":""),S=e.user.profile_image_url_https?{source:e.user.profile_image_url_https,mask:E.Image.Mask.Circle}:void 0,y=e.favorited&&c.startsWith("RT @")?1:0,R=!!ha(e),w=($,Le)=>{if($===void 0)return"0";let Xr=a?Qt($):`${$}`;return kn(Xr,Le)},_=1,D=3,L=$=>$===void 0||$<_?_:$>D?D:$,Z=L(r.maxCommentDigits),oe=L(r.maxRTDigits),re=L(r.maxFavDigits),ne=[`\u{1F4AC} ${w(e.reply_count||0,Z)}`,`\u{1F501} ${w(e.retweet_count,oe)}`,`\u2764\uFE0F ${w(e.favorite_count+y,re)}`];R&&(ne=["\u{1F5BC}\uFE0F",...ne]);let U=[{text:ne.join("  ")}];return _jsx(E.List.Item,{id:e.id_str,key:e.id_str,title:d,icon:S,accessories:t?void 0:U,detail:t?_jsx(E.List.Item.Detail,{markdown:sd(e)}):void 0,actions:_jsx(E.ActionPanel,null,_jsx(E.ActionPanel.Section,{title:"Tweet"},_jsx(td,{tweet:e}),_jsx(E.Action.OpenInBrowser,{url:id(e),shortcut:{modifiers:["cmd"],key:"b"}}),_jsx(wa,{tweet:e,fetcher:i}),_jsx(pa,{tweet:e}),_jsx(ga,{tweet:e,fetcher:i}),_jsx(Ta,{username:e.user.screen_name})),_jsx(E.ActionPanel.Section,{title:"Info"},_jsx(ya,{tweet:e})),_jsx(E.ActionPanel.Section,{title:"Destructive"},_jsx(_a,{tweet:e})),_jsx(E.ActionPanel.Section,{title:"Update"},_jsx(rd,{fetcher:i}),_jsx(ba,{fetcher:i})))})}function Ep(r){if(r.full_text!==void 0){if(Sa(r)){let e=r.full_text.indexOf(":");if(e!==void 0&&e>0)return r.full_text.substring(e+1).trimStart()}return r.full_text}}function Sa(r){return!!(r.full_text&&r.full_text.startsWith("RT @"))}function sd(r){let e=r,t=e.favorited&&Sa(e)?1:0,i=[`\u{1F4AC} ${e.reply_count||0}`,`\u{1F501} ${e.retweet_count}`,`\u2764\uFE0F ${e.favorite_count+t}`],a=ha(e),u=Sa(e)?" retweeted":"",c=[`## ${e.user.name} \`@${e.user.screen_name}\`${u}`,Ep(e)||"",`\`${e.created_at}\``];return a&&c.push(`![${a}](${a})`),c.push(i.join("   ")),c.join(`

`)}function nd(r){let{data:e,error:t,isLoading:i,fetcher:a}=ur(async()=>e===void 0?r.tweet:await Jc(e));t&&(0,E.showToast)({style:E.Toast.Style.Failure,title:"Error",message:t});let u=e||r.tweet,c=sd(u);return _jsx(E.Detail,{isLoading:i,markdown:c,actions:_jsx(E.ActionPanel,null,_jsx(E.ActionPanel.Section,{title:"Tweet"},_jsx(pa,{tweet:u}),_jsx(wa,{tweet:u,fetcher:a}),_jsx(ga,{tweet:u,fetcher:a}),_jsx(Ta,{username:u.user.screen_name}),_jsx(E.Action.OpenInBrowser,{url:id(u),shortcut:{modifiers:["cmd"],key:"b"}})),_jsx(E.ActionPanel.Section,{title:"Info"},_jsx(ya,{tweet:u})),_jsx(E.ActionPanel.Section,{title:"Destructive"},_jsx(_a,{tweet:u})),_jsx(E.ActionPanel.Section,{title:"Update"},_jsx(ba,{title:"Refresh Tweet",fetcher:a})))})}function Ti(r){let e=r.tweets,t=Vo(),i=r.millifyState!==void 0?r.millifyState:!0,a=1,u=1,c=1,d=h=>h===void 0?0:(i?Qt(h):`${h}`).length;if(e)for(let h of e){let S=d(h.favorite_count);S>a&&(a=S);let y=d(h.retweet_count);y>u&&(u=y);let R=d(h.reply_count);R>c&&(c=R)}return _jsx(E.List,{isLoading:r.isLoading,searchBarPlaceholder:"Filter Tweets by name...",isShowingDetail:t},e?.map(h=>_jsx(Ip,{key:h.id_str,tweet:h,fetcher:r.fetcher,maxCommentDigits:c,maxFavDigits:a,maxRTDigits:u,millifyState:i,withDetail:t})))}function ad(){let{data:r,error:e,isLoading:t,fetcher:i}=ur(async a=>a?await Gr(r):await Op());return e&&(0,Ri.showToast)({style:Ri.Toast.Style.Failure,title:"Error",message:e}),_jsx(Ti,{isLoading:t,tweets:r,fetcher:i})}async function Op(){let r=await Kr(),e=await Te().v1.userTimelineByUsername(r.screen_name),t=[];for(let i of e.tweets)t.push(i);return t}function od(){return $o()?_jsx(Kc,null):_jsx(ad,null)}module.exports=Wf(Mp);0&&(module.exports={});
